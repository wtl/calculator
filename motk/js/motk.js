var WTK_HOST_NAME="http://www.drawapp8.com";function wtkGetHostName(){return""}function wtkSetHostName(a){WTK_HOST_NAME=a;return}function wtkGetImageRoot(){return wtkGetHostName()+"/base/images/"}function wtkGetImageURL(a){return wtkGetHostName()+"/base/images/"+a}var browser={versions:function(){var a=navigator.userAgent,b=navigator.appVersion;return{ie9:a.indexOf("MSIE 9.0")>-1,ie10:a.indexOf("MSIE 10.0")>-1,oldIE:a.indexOf("MSIE 8.0")>-1||a.indexOf("MSIE 7.0")>-1||a.indexOf("MSIE 6.0")>-1,android:a.indexOf("Android")>-1&&a.indexOf("Linux")>-1,iPhone:a.indexOf("iPhone")>-1,iPad:a.indexOf("iPad")>-1,blackberry:a.indexOf("BlackBerry")>-1,firefoxMobile:a.indexOf("Mobile")>-1&&a.indexOf("Firefox")>-1,windowPhone:a.indexOf("Windows Phone")>-1}}()};if(browser.versions.oldIE||browser.versions.ie9){window.console={};window.console.log=function(a){}}var gForceMobile=false;function setForceMobile(a){gForceMobile=a;return}function isOldIE(){return browser.versions.oldIE}if(browser.versions.oldIE){console.log("oldIE "+browser.versions.oldIE)}function isMobile(){return gForceMobile||browser.versions.android||browser.versions.iPhone||browser.versions.blackberry||browser.versions.windowPhone||browser.versions.firefoxMobile}function isAndroid(){return browser.versions.android}function isIPhone(){return browser.versions.iPhone}function isBlackBerry(){return browser.versions.blackberry}function isFirefoxMobile(){return browser.versions.firefoxMobile}console.log(navigator.userAgent);Array.prototype.remove=function(c,b){for(var a=0;a<this.length;++a){if(this[a]===c){this.splice(a,1);if(!b){break}}}return};Array.prototype.insert=function(a,b){if(a>=0&&a<this.length){this.splice(a,0,b)}else{this.push(b)}return};Array.prototype.indexOf=function(b){for(var a=0;a<this.length;++a){if(this[a]===b){return a}}return -1};Array.prototype.has=function(a){return this.indexOf(a)>=0};Array.prototype.clear=function(){this.length=0};Array.prototype.copy=function(c){this.clear();for(var a=0;a<c.length;++a){var b=c[a];if(b&&b.dup){b=b.dup()}this.push(b)}return};function makeUniqRandArray(f,b){if(f>=b){return null}var a=[];var c=b-f+1;for(var e=0;e<c;e++){do{var d=f+Math.floor(Math.random()*c);if(!a.has(d)){a.push(d);break}}while(1)}return a}function fixRect(a){if(a.w<0){a.x=a.x+a.w;a.w=-a.w}if(a.h<0){a.y=a.y+a.h;a.h=-a.h}return a}function isPointInRect(a,b){return a.x>=b.x&&a.y>=b.y&&a.x<(b.x+b.w)&&a.y<(b.y+b.h)}function createXMLHTTTPRequest(){var c=null;try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){c=null}}if(!c&&typeof XMLHttpRequest!=="undefined"){c=new XMLHttpRequest()}return c}function wtkAddEventListener(a,b){if(window.attachEvent){window.attachEvent(a,b)}else{if(window.addEventListener){window.addEventListener(a,b)}else{document.addEventListener(a,b,true)}}return}String.prototype.replaceAll=function(a,c,b){if(!RegExp.prototype.isPrototypeOf(a)){return this.replace(new RegExp(a,(b?"gi":"g")),c)}else{return this.replace(a,c)}};function fixJson(b){var a=0;var d="";b=b.replaceAll("<br>","");var f=b.length;for(a=0;a<f;a++){var e=b.charAt(a);if(e==="“"||e==="”"){e='"'}d=d+e}return d}String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$|^\n+|\n+$/g,"")};function drawDashedRect(c,a,j,b,d){var g=8;var i=4;c.beginPath();drawDashedLine(c,{x:a,y:j},{x:b,y:j},g,i);drawDashedLine(c,{x:a,y:d},{x:b,y:d},g,i);drawDashedLine(c,{x:a,y:j},{x:a,y:d},g,i);drawDashedLine(c,{x:b,y:j},{x:b,y:d},g,i);return}function drawDashedLine(b,c,g,h,i){if(!b||!c||!g||!h){return}var l=c.x;var j=c.y;b.moveTo(l,j);if(!i){b.lineTo(g.x,g.y);return}var n=g.x-c.x;var m=g.y-c.y;var a=Math.sqrt(n*n+m*m);var d=Math.atan(m/n);b.save();b.translate(c.x,c.y);b.rotate(d);if(g.x<c.x){b.translate(-a,0)}b.moveTo(0,0);l=0;while(l<a){l+=h;if(l>a){l=a}b.lineTo(l,0);l+=i;b.moveTo(l,0)}b.restore();return}var C_ARROW_NONE=0;var C_ARROW_NORMAL=1;var C_ARROW_CIRCLE=2;var C_ARROW_RECT=3;var C_ARROW_DIAMOND=4;var C_ARROW_TRI=5;var C_ARROW_FILL_CIRCLE=1<<8|C_ARROW_CIRCLE;var C_ARROW_FILL_RECT=1<<8|C_ARROW_RECT;var C_ARROW_FILL_DIAMOND=1<<8|C_ARROW_DIAMOND;var C_ARROW_FILL_TRI=1<<8|C_ARROW_TRI;function drawArrowHeaderNormal(a,b){a.translate(-b/2,0);a.moveTo(-b/2,-b/2);a.lineTo(b/2,0);a.lineTo(-b/2,b/2);a.stroke();a.beginPath();return}function drawArrowHeaderTri(a,b){a.translate(-b/2,0);a.moveTo(b/2,0);a.lineTo(-b/2,-b/2);a.lineTo(-b/2,b/2);a.lineTo(b/2,0);return}function drawArrowHeaderCircle(a,b){a.translate(-b/2,0);a.arc(0,0,b/2,Math.PI*2,0);return}function drawArrowHeaderRect(a,b){a.translate(-b/2,0);a.rect(-b/2,-b/2,b,b);return}function drawArrowHeaderRRect(a,b){a.translate(-b/2,0);a.rotate(Math.PI/4);a.rect(-b/2,-b/2,b,b);return}var arrow_draw_header=[null,drawArrowHeaderNormal,drawArrowHeaderCircle,drawArrowHeaderRect,drawArrowHeaderRRect,drawArrowHeaderTri];function drawArrow(a,g,b,d,f){var l=10;if(!a||!b||!d){return}var j=g>>8;g=g&255;if(g<=0||g>=arrow_draw_header.length){return}if(f){l=f}var e=(d.y-b.y)/(d.x-b.x);var c=Math.atan(e);if(d.x<b.x){c=c+Math.PI}var i=a.fillStyle;var h=a.strokeStyle;a.save();a.translate(d.x,d.y);a.rotate(c);a.beginPath();l=l+a.lineWidth-1;arrow_draw_header[g](a,l);a.closePath();if(j){a.fillStyle=h}else{a.fillStyle="White"}if(g>1){a.fill()}a.stroke();a.restore();a.fillStyle=i;a.strokeStyle=h;return}var gCacheCanvas=null;function CacheCanvasGet(b,a){if(!gCacheCanvas){gCacheCanvas=document.createElement("canvas");gCacheCanvas.type="backend_canvas";gCacheCanvas.width=b;gCacheCanvas.height=a}if(gCacheCanvas){if(gCacheCanvas.width<b){gCacheCanvas.width=b}if(gCacheCanvas.height<a){gCacheCanvas.height=a}}return gCacheCanvas}function drawNinePatchOnCanvas(b,p,o,n,q,v,e,t){var s=0;var g=0;var l=0;var u=0;var c=Math.floor(q/2)+1;var d=q-c;var j=Math.floor(v/2)+1;var m=v-j;var a=e-q+1;var f=t-v+1;var r=b.getContext("2d");r.clearRect(0,0,e,t);if(e<q){c=Math.floor(e/2)+1;d=e-c}if(t<v){j=Math.floor(t/2)+1;m=t-j}r.drawImage(p,o,n,c,j,0,0,c,j);r.drawImage(p,o+c,n,d,j,e-d,0,d,j);r.drawImage(p,o,n+j,c,m,0,t-m,c,m);r.drawImage(p,o+c,n+j,d,m,e-d,t-m,d,m);if(e>q){u=Math.floor(q/2);for(s=0;;s++){l=Math.pow(2,s);g=u+l;l=Math.min(l,a-l);if(l<=0){break}r.drawImage(b,u,0,l,t,g,0,l,t)}}if(t>v){u=Math.floor(v/2);for(s=0;;s++){dh=Math.pow(2,s);dy=u+dh;dh=Math.min(dh,f-dh);if(dh<=0){break}r.drawImage(b,0,u,e,dh,0,dy,e,dh)}}return}function drawNinePatchEx1(a,c,l,i,m,d,n,j,o,f){var b=CacheCanvasGet(o,f);if(o<0||f<0||m<0||d<0){return}try{drawNinePatchOnCanvas(b,c,l,i,m,d,o,f)}catch(g){console.log(g.message)}a.drawImage(b,0,0,o,f,n,j,o,f);return}function drawNinePatchEx2(a,o,d,c,e,p,g,f,j,r){var m=0;var s=0;var l=0;var i=0;if(!o){a.fillRect(g,f,j,r);return}if(r&1){r=r+1}if(j&1){j=j+1}if(!d){d=0}if(!c){c=0}if(!e||e>o.width){e=o.width}if(!p||p>o.height){p=o.height}var q=Math.floor(e/2);var n=Math.floor(p/2);if(e>j&&p>r){a.drawImage(o,d,c,e,p,g,f,j,r);return}var t=Math.min(q,j/2);var b=Math.min(n,r/2);a.drawImage(o,d,c,t,b,g,f,t,b);a.drawImage(o,d+e-t,c,t,b,g+j-t,f,t,b);a.drawImage(o,d,c+p-b,t,b,g,f+r-b,t,b);a.drawImage(o,d+e-t,c+p-b,t,b,g+j-t,f+r-b,t,b);if(j>e){m=j-2*q;a.drawImage(o,d+t,c,1,b,g+t,f,m,b);a.drawImage(o,d+t,c+p-b,1,b,g+t,f+r-b,m,b)}if(r>p){a.drawImage(o,d,c+b,t,1,g,f+b,t,r-p);l=g+j-q;m=q;a.drawImage(o,d+e-t,c+b,t,1,l,f+b,m,r-p)}if(j>e&&r>p){m=j-2*q;a.drawImage(o,d+t,c+b,1,1,g+t,f+b,m,r-p)}return}function drawNinePatchEx(a,p,e,d,f,q,i,g,l,r){var m=0;var j=0;var t=0;var c=0;var b=0;var o=0;var n=0;var s=0;if(!p){a.fillRect(i,g,l,r);return}if(!f||f>p.width){f=p.width}if(!q||q>p.height){q=p.height}t=Math.floor(f/3);c=Math.floor(q/3);b=f-t-t;o=q-c-c;n=l-t-t;s=r-c-c;a.drawImage(p,e,d,t,c,i,g,t,c);a.drawImage(p,e+f-t,d,t,c,i+l-t,g,t,c);a.drawImage(p,e,d+q-c,t,c,i,g+r-c,t,c);a.drawImage(p,e+f-t,d+q-c,t,c,i+l-t,g+r-c,t,c);if(n>0){a.drawImage(p,e+t,d,b,c,i+t-1,g,n+2,c);a.drawImage(p,e+t,d+q-c,b,c,i+t-1,g+r-c,n+2,c)}if(s>0){a.drawImage(p,e,d+c,t,o,i,g+c-1,t,s+2);a.drawImage(p,e+f-t,d+c,t,o,i+l-t,g+c-1,t,s+2)}if(n>0&&s>0){a.drawImage(p,e+t,d+c,b,o,i+t-1,g+c-1,n+2,s+2)}return}function drawNinePatch(c,e,a,f,b,d){if(!e){c.fillRect(a,f,b,d);return}return drawNinePatchEx(c,e,0,0,e.width,e.height,a,f,b,d)}function drawNinePatchIcon(a,g,l,f,m,d){var b=g.getImage();var i=g.getX();var e=g.getY();var j=g.getWidth();var c=g.getHeight();if(!b){a.fillRect(l,f,m,d);return}return drawNinePatchEx(a,b,i,e,j,c,l,f,m,d)}function drawRoundRect(b,a,c,d){if(d){b.arc(d,d,d,Math.PI,1.5*Math.PI,false);b.lineTo(a-d,0);b.arc(a-d,d,d,1.5*Math.PI,2*Math.PI,false);b.lineTo(a,c-d);b.arc(a-d,c-d,d,0,0.5*Math.PI,false);b.lineTo(d,c);b.arc(d,c-d,d,0.5*Math.PI,Math.PI,false);b.lineTo(0,d)}else{b.rect(0,0,a,c)}return}function getViewPort(){var b;var a;if(typeof window.innerWidth!="undefined"){b=window.innerWidth,a=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){b=document.documentElement.clientWidth,a=document.documentElement.clientHeight}else{b=document.getElementsByTagName("body")[0].clientWidth,a=document.getElementsByTagName("body")[0].clientHeight}}return{width:b,height:a}}function layoutText(d,q,n,c){var l=0;var h=0;var o=0;var f=0;var m="";var b=new Array();var e=n.split("\n");var g=new TextLayout(d);for(l=0;l<e.length;l++){var p=e[l];if(p){g.setText(p);while(g.hasNext()){var a=g.nextLine(c,q);b.push(a.text)}}else{b.push(" ")}}return b}function TextLayout(a){this.canvas=a;this.setText=function(b){this.str=b;this.startOffset=0;this.lineInfo={text:"",width:0};return};this.canBreakBefore=function(b){if(b===" "||b==="\t"||b==="."||b===","||b==="?"||b===";"||b===":"||b==="!"||b==="。"||b==="，"||b==="？"||b==="："||b==="."){return false}return true};this.hasNext=function(){return this.startOffset<this.str.length};this.nextLine=function(c,r){var h=false;var q="";var p=this.str;var m=this.startOffset;var e=p.length;var f=Math.floor((c/r)*0.75);var l=e-this.startOffset;if(l<1){this.lineInfo.text="";this.lineInfo.width=0;return null}if(l<f){q=p.substr(this.startOffset,l);this.lineInfo.text=q;this.lineInfo.width=a.measureText(q).width;this.startOffset=this.startOffset+q.length;return this.lineInfo}if(f>3){f=f-3}q=p.substr(this.startOffset,f);var b=0;var g=null;var j=0;var d=null;var o=a.measureText(q).width;for(m=this.startOffset+f;m<e;m++){g=p.charAt(m);b=p.charCodeAt(m);q+=g;j=a.measureText(g).width;o=o+1+j;if((o-60)>c){break}if((o-r)<c){continue}if((b>=97&&b<=122)||(b>=65&&b<=90)){continue}if((m+1)<e){d=p.charAt(m+1);if(this.canBreakBefore(d)){break}}}this.lineInfo.text=q;this.lineInfo.width=a.measureText(q).width;this.startOffset=this.startOffset+q.length;return this.lineInfo};return this}function httpDoRequest(e){var f=null;f=createXMLHTTTPRequest();if(!e||!e.url){return false}var a=e.url;var d=e.data;var g=e.method?e.method:"GET";if(a.indexOf("http")===0&&a.indexOf(window.location.hostname)<0){a="/proxy.php?url="+a+"&mode=native&full_headers=1&send_cookies=1&send_session=0"}f.open(g,a,true);if(e.noCache){f.setRequestHeader("If-Modified-Since","0")}if(e.headers){for(var b in e.headers){var c=e.headers[b];f.setRequestHeader(b,c)}}if(f){f.send(e.data?e.data:null);if(!f.onprogress){f.onreadystatechange=function(){if(e.onProgress){e.onProgress(f)}if(f.readyState===4){if(e.onDone){e.onDone(true,f,f.responseText)}}console.log("onreadystatechange:"+f.readyState);return}}else{f.onprogress=function(i){var h=i.total;if(e.onProgress){e.onProgress(f)}console.log("get:"+h)};f.onload=function(h){if(e.onDone){e.onDone(true,f,h.target.responseText)}};f.onerror=function(h){if(e.onDone){e.onDone(false,f,f.responseText)}}}}return true}function dappModifyViewPort(){var e="";var f=document.createElement("meta");var c=document.getElementsByTagName("head")[0];var d=window.devicePixelRatio?window.devicePixelRatio:1;var g=1/d;var b="initial-scale="+g+", minimum-scale="+g+", maximum-scale="+g+", user-scalable=0";if(browser.versions.iPhone){e="width=device-width, "+b}else{if(isAndroid()){e="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"}else{if(isFirefoxMobile()){var a=getViewPort();e="width="+a.width+", "+b}else{e="width=device-width, "+b}}}f.name="viewport";f.content=e;c.appendChild(f);return}function wtkLog(a){console.log(a);return}var gDelayScripts=new Array();function idrawDelayLoadScript(a){gDelayScripts.push(a);return}function loadDelayScriptsNow(){var c=0;var a=null;var b=null;var d=document.head?document.head:document.body;for(c=0;c<gDelayScripts.length;c++){b=gDelayScripts[c];a=document.createElement("script");a.src=b;d.appendChild(a);console.log("Load: "+b)}gDelayScripts.clear();return}function loadScriptOnce(f){var b=document.scripts;if(b){for(var d=0;d<b.length;d++){var c=b[d];if(c.src&&c.src.indexOf(f)>=0){console.log("script is loaded: "+f);return}}}var e=document.head?document.head:document.body;var a=document.createElement("script");a.src=f;e.appendChild(a);console.log("load script: "+f);return}setTimeout(function(){loadDelayScriptsNow();return},800);function delayLoadScripts(b){var a=getLanguageName();if(b){dappSetResHostName(b)}return}function isScriptLoaded(b){var a=document.getElementsByTagName("script");if(a){for(var c=0;c<a.length;c++){var d=a[c].src;if(d.indexOf(b)>=0){return true}}}return false}function getLanguageName(){var a="";if(navigator.language){a=navigator.language}else{if(navigator.userLanguage){a=navigator.userLanguage}}a=a.toLowerCase();return a}var requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,5)}})();function getQueryParameter(a){var a=a+"=";var b=window.top.location.search.substring(1);if(b.length>0){begin=b.indexOf(a);if(begin!=-1){begin+=a.length;end=b.indexOf("&",begin);if(end==-1){end=b.length}return unescape(b.substring(begin,end))}}return null}window.Modernizr=(function(m,r,g){var c="2.5.3",j={},D=r.documentElement,E="modernizr",B=r.createElement(E),n=B.style,d,u={}.toString,w=" -webkit- -moz- -o- -ms- ".split(" "),h={},b={},s={},A=[],t=A.slice,a,z=function(N,P,I,O){var H,M,K,G=r.createElement("div"),L=r.body,J=L?L:r.createElement("body");if(parseInt(I,10)){while(I--){K=r.createElement("div");K.id=O?O[I]:E+(I+1);G.appendChild(K)}}H=["&#173;","<style>",N,"</style>"].join("");G.id=E;(L?G:J).innerHTML+=H;J.appendChild(G);if(!L){J.style.background="";D.appendChild(J)}M=P(G,N);!L?J.parentNode.removeChild(J):G.parentNode.removeChild(G);return !!M},q=({}).hasOwnProperty,o;if(!i(q,"undefined")&&!i(q.call,"undefined")){o=function(G,H){return q.call(G,H)}}else{o=function(G,H){return((H in G)&&i(G.constructor.prototype[H],"undefined"))}}if(!Function.prototype.bind){Function.prototype.bind=function F(I){var J=this;if(typeof J!="function"){throw new TypeError()}var G=t.call(arguments,1),H=function(){if(this instanceof H){var M=function(){};M.prototype=J.prototype;var L=new M;var K=J.apply(L,G.concat(t.call(arguments)));if(Object(K)===K){return K}return L}else{return J.apply(I,G.concat(t.call(arguments)))}};return H}}function p(G){n.cssText=G}function f(H,G){return p(w.join(H+";")+(G||""))}function i(H,G){return typeof H===G}function l(H,G){return !!~(""+H).indexOf(G)}function v(H,K,J){for(var G in H){var I=K[H[G]];if(I!==g){if(J===false){return H[G]}if(i(I,"function")){return I.bind(J||K)}return I}}return false}var C=(function(J,I){var H=J.join(""),G=I.length;z(H,function(N,P){var M=r.styleSheets[r.styleSheets.length-1],L=M?(M.cssRules&&M.cssRules[0]?M.cssRules[0].cssText:M.cssText||""):"",K=N.childNodes,O={};while(G--){O[K[G].id]=K[G]}j.touch=("ontouchstart" in m)||m.DocumentTouch&&r instanceof DocumentTouch||(O.touch&&O.touch.offsetTop)===9},G,I)})([,["@media (",w.join("touch-enabled),("),E,")","{#touch{top:9px;position:absolute}}"].join("")],[,"touch"]);h.touch=function(){return j.touch};for(var e in h){if(o(h,e)){a=e.toLowerCase();j[a]=h[e]();A.push((j[a]?"":"no-")+a)}}p("");B=d=null;j._version=c;j._prefixes=w;j.testStyles=z;return j})(this,this.document);(function(B){var c=1;function i(C,D,E){this.screenX=E.screenX||0;this.screenY=E.screenY||0;this.pageX=E.pageX||0;this.pageY=E.pageY||0;this.x=E.x||0;this.y=E.y||0;this.clientX=E.clientX||0;this.clientY=E.clientY||0;this.tiltX=E.tiltX||0;this.tiltY=E.tiltY||0;this.pressure=E.pressure||0;this.hwTimestamp=E.hwTimestamp||0;this.pointerType=D;this.identifier=C}var e={TOUCH:"touch",MOUSE:"mouse",PEN:"pen"};function A(C){C.target.mouseEvent=C}function f(C){C.target.mouseEvent=null}function w(C){C.target.touchList=C.targetTouches}function u(){var C=[];var F;if(this.touchList){for(var E=0;E<this.touchList.length;E++){var G=this.touchList[E];F=new i(G.identifier+2,e.TOUCH,G);C.push(F)}}else{if(this.msPointerList){for(var D in this.msPointerList){if(!this.msPointerList.hasOwnProperty(D)){continue}F=this.msPointerList[D];F=new i(D,F.textPointerType,F);C.push(F)}}}if(this.mouseEvent){C.push(new i(c,e.MOUSE,this.mouseEvent))}return C}function m(D,G,F){var E=document.createEvent("Event");E.initEvent(D,true,true);for(var C in F){E[C]=F[C]}G.dispatchEvent(E)}function a(C){C.preventDefault();A(C);var D={pointerType:"mouse",getPointerList:u.bind(this),originalEvent:C};m("pointerdown",C.target,D)}function g(C){C.preventDefault();A(C);var D={pointerType:"mouse",getPointerList:u.bind(this),originalEvent:C};m("pointermove",C.target,D)}function v(C){C.preventDefault();A(C);var D={pointerType:"mouse",getPointerList:u.bind(this),originalEvent:C};m("pointerup",C.target,D)}function z(C){console.log("touchstart");C.preventDefault();w(C);var D={pointerType:"touch",getPointerList:u.bind(this),originalEvent:C};m("pointerdown",C.target,D)}function o(C){C.preventDefault();w(C);var D={pointerType:"touch",getPointerList:u.bind(this),originalEvent:C};m("pointermove",C.target,D)}function q(C){C.preventDefault();w(C);var D={pointerType:"touch",getPointerList:u.bind(this),originalEvent:C};m("pointerup",C.target,D)}function t(C){if(C.target.mouseEvent){console.log(C);C.preventDefault();var D={pointerType:"mouse",getPointerList:u.bind(this),originalEvent:C};m("pointerup",C.target,D)}}function p(C){if(C.pointerType==2){C.textPointerType=e.TOUCH}else{if(C.pointerType==3){C.textPointerType=e.PEN}else{if(C.pointerType==4){C.textPointerType=e.MOUSE}}}if(C.textPointerType==e.MOUSE){C.target.msMouseDown=true}if(!C.target.msPointerList){C.target.msPointerList={}}C.target.msPointerList[C.pointerId]=C;var D={pointerType:C.textPointerType,getPointerList:u.bind(this),originalEvent:C};m("pointerdown",C.target,D)}function s(C){if(C.pointerType==2){C.textPointerType=e.TOUCH}else{if(C.pointerType==3){C.textPointerType=e.PEN}else{if(C.pointerType==4){C.textPointerType=e.MOUSE}}}if(C.textPointerType==e.MOUSE&&!C.target.msMouseDown){return}if(!C.target.msPointerList){C.target.msPointerList={}}C.target.msPointerList[C.pointerId]=C;var D={pointerType:C.textPointerType,getPointerList:u.bind(this),originalEvent:C};m("pointermove",C.target,D)}function j(C){if(C.target.msPointerList){delete C.target.msPointerList[C.pointerId]}if(C.pointerType==2){C.textPointerType=e.TOUCH}else{if(C.pointerType==3){C.textPointerType=e.PEN}else{if(C.pointerType==4){C.textPointerType=e.MOUSE}}}if(C.textPointerType==e.MOUSE){C.target.msMouseDown=false}var D={pointerType:C.textPointerType,getPointerList:u.bind(this),originalEvent:C};m("pointerup",C.target,D)}function b(C){if(!C.isPointerEmitter){if(r()){C.addEventListener("pointerdown",p);C.addEventListener("pointermove",s);C.addEventListener("pointerup",j)}else{if(n()){C.addEventListener("MSPointerDown",p);C.addEventListener("MSPointerMove",s);C.addEventListener("MSPointerUp",j)}else{if(l()){C.addEventListener("touchstart",z);C.addEventListener("touchmove",o);C.addEventListener("touchend",q)}if(!isAndroid()){C.addEventListener("mousedown",a);C.addEventListener("mousemove",g);C.addEventListener("mouseup",v);C.addEventListener("mouseout",t)}}}C.isPointerEmitter=true}}function l(){return Modernizr.touch}function n(){return window.navigator.msPointerEnabled}function r(){return window.navigator.pointerEnabled}function h(E,C){var D=E.prototype.addEventListener;E.prototype.addEventListener=function(G,H,F){C.call(this,G,H,F);D.call(this,G,H,F)}}function d(D,E,C){if(D.indexOf("pointer")===0){b(this)}}if(navigator.userAgent.match(/Firefox/)){h(HTMLDivElement,d);h(HTMLCanvasElement,d)}else{h(HTMLElement,d)}B._createCustomEvent=m;B._augmentAddEventListener=h;B.PointerTypes=e})(window);(function(b){function a(e,f,c){if(e.indexOf("gesture")===0){var d=Gesture._gestureHandlers[e];if(d){d(this)}else{console.error("Warning: no handler found for {{evt}}.".replace("{{evt}}",e))}}}if(navigator.userAgent.match(/Firefox/)){window._augmentAddEventListener(HTMLDivElement,a);window._augmentAddEventListener(HTMLCanvasElement,a)}else{window._augmentAddEventListener(HTMLElement,a)}b.Gesture=b.Gesture||{};b.Gesture._gestureHandlers=b.Gesture._gestureHandlers||{}})(window);(function(c){var d=300;var f=10;function b(g){this.x=g.clientX;this.y=g.clientY}b.prototype.calculateSquaredDistance=function(i){var h=this.x-i.clientX;var g=this.y-i.clientY;return h*h+g*g};function e(j){var g=j.getPointerList();if(g.length!=1){return}var h=new Date();if(h-this.lastDownTime<d&&this.lastPosition&&this.lastPosition.calculateSquaredDistance(g[0])<f*f){this.lastDownTime=0;this.lastPosition=null;var i={};window._createCustomEvent("gesturedoubletap",j.target,i)}this.lastPosition=new b(g[0]);this.lastDownTime=h}function a(g){g.addEventListener("pointerdown",e)}c.Gesture._gestureHandlers.gesturedoubletap=a})(window);(function(c){var b=600;var g=5;function a(i){this.x=i.clientX;this.y=i.clientY}a.prototype.calculateSquaredDistance=function(l){var j=this.x-l.clientX;var i=this.y-l.clientY;return j*j+i*i};function d(j){clearTimeout(this.longPressTimer);var i=j.getPointerList();if(i.length===1){j.target.longpressInitPosition=new a(i[0]);this.longPressTimer=setTimeout(function(){payload={};window._createCustomEvent("gesturelongpress",j.target,payload)},b)}}function e(j){var i=j.getPointerList();if(j.pointerType===PointerTypes.MOUSE){clearTimeout(this.longPressTimer)}else{if(i.length===1){var l=j.target.longpressInitPosition;if(l&&l.calculateSquaredDistance(i[0])>g*g){clearTimeout(this.longPressTimer)}}}}function f(i){clearTimeout(this.longPressTimer)}function h(i){i.addEventListener("pointerdown",d);i.addEventListener("pointermove",e);i.addEventListener("pointerup",f)}c.Gesture._gestureHandlers.gesturelongpress=h})(window);(function(b){var g=0.2;function e(i,h){this.p1=i;this.p2=h}e.prototype.center=function(){return[(this.p1.pageX+this.p2.pageX)/2,(this.p1.pageY+this.p2.pageY)/2]};e.prototype.span=function(){var i=this.p1.pageX-this.p2.pageX;var h=this.p1.pageY-this.p2.pageY;return Math.sqrt(i*i+h*h)};e.prototype.scaleSince=function(i){var j=this.span();var h=i.span();if(h===0){return 0}else{return j/h}};function c(i){var h=i.getPointerList();if(h.length==2){i.target.scaleReferencePair=new e(h[0],h[1])}}function d(j){var h=j.getPointerList();if(h.length==2&&j.target.scaleReferencePair){var m=new e(h[0],h[1]);var l=m.scaleSince(j.target.scaleReferencePair);if(Math.abs(1-l)>g){var i={scale:l,centerX:(j.target.scaleReferencePair.p1.clientX+j.target.scaleReferencePair.p2.clientX)/2,centerY:(j.target.scaleReferencePair.p1.clientY+j.target.scaleReferencePair.p2.clientY)/2};window._createCustomEvent("gesturescale",j.target,i)}}}function f(h){h.target.scaleReferencePair=null}function a(h){h.addEventListener("pointerdown",c);h.addEventListener("pointermove",d);h.addEventListener("pointerup",f)}b.Gesture._gestureHandlers.gesturescale=a})(window);if(typeof KeyEvent==="undefined"){var KeyEvent={DOM_VK_CANCEL:3,DOM_VK_HELP:6,DOM_VK_BACK_SPACE:8,DOM_VK_TAB:9,DOM_VK_CLEAR:12,DOM_VK_RETURN:13,DOM_VK_ENTER:14,DOM_VK_SHIFT:16,DOM_VK_CONTROL:17,DOM_VK_ALT:18,DOM_VK_PAUSE:19,DOM_VK_CAPS_LOCK:20,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_PAGE_UP:33,DOM_VK_PAGE_DOWN:34,DOM_VK_END:35,DOM_VK_HOME:36,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_PRINTSCREEN:44,DOM_VK_INSERT:45,DOM_VK_DELETE:46,DOM_VK_0:48,DOM_VK_1:49,DOM_VK_2:50,DOM_VK_3:51,DOM_VK_4:52,DOM_VK_5:53,DOM_VK_6:54,DOM_VK_7:55,DOM_VK_8:56,DOM_VK_9:57,DOM_VK_SEMICOLON:59,DOM_VK_EQUALS:61,DOM_VK_A:65,DOM_VK_B:66,DOM_VK_C:67,DOM_VK_D:68,DOM_VK_E:69,DOM_VK_F:70,DOM_VK_G:71,DOM_VK_H:72,DOM_VK_I:73,DOM_VK_J:74,DOM_VK_K:75,DOM_VK_L:76,DOM_VK_M:77,DOM_VK_N:78,DOM_VK_O:79,DOM_VK_P:80,DOM_VK_Q:81,DOM_VK_R:82,DOM_VK_S:83,DOM_VK_T:84,DOM_VK_U:85,DOM_VK_V:86,DOM_VK_W:87,DOM_VK_X:88,DOM_VK_Y:89,DOM_VK_Z:90,DOM_VK_CONTEXT_MENU:93,DOM_VK_NUMPAD0:96,DOM_VK_NUMPAD1:97,DOM_VK_NUMPAD2:98,DOM_VK_NUMPAD3:99,DOM_VK_NUMPAD4:100,DOM_VK_NUMPAD5:101,DOM_VK_NUMPAD6:102,DOM_VK_NUMPAD7:103,DOM_VK_NUMPAD8:104,DOM_VK_NUMPAD9:105,DOM_VK_MULTIPLY:106,DOM_VK_ADD:107,DOM_VK_SEPARATOR:108,DOM_VK_SUBTRACT:109,DOM_VK_DECIMAL:110,DOM_VK_DIVIDE:111,DOM_VK_F1:112,DOM_VK_F2:113,DOM_VK_F3:114,DOM_VK_F4:115,DOM_VK_F5:116,DOM_VK_F6:117,DOM_VK_F7:118,DOM_VK_F8:119,DOM_VK_F9:120,DOM_VK_F10:121,DOM_VK_F11:122,DOM_VK_F12:123,DOM_VK_F13:124,DOM_VK_F14:125,DOM_VK_F15:126,DOM_VK_F16:127,DOM_VK_F17:128,DOM_VK_F18:129,DOM_VK_F19:130,DOM_VK_F20:131,DOM_VK_F21:132,DOM_VK_F22:133,DOM_VK_F23:134,DOM_VK_F24:135,DOM_VK_NUM_LOCK:144,DOM_VK_SCROLL_LOCK:145,DOM_VK_COMMA:188,DOM_VK_PERIOD:190,DOM_VK_SLASH:191,DOM_VK_BACK_QUOTE:192,DOM_VK_OPEN_BRACKET:219,DOM_VK_BACK_SLASH:220,DOM_VK_CLOSE_BRACKET:221,DOM_VK_QUOTE:222,DOM_VK_META:224}}KeyEvent.DOM_VK_BACK=225;var C_EVT_POINTER_DOWN=1;var C_EVT_POINTER_MOVE=0;var C_EVT_POINTER_UP=-1;var C_EVT_KEY_DOWN=2;var C_EVT_KEY_UP=3;var C_EVT_DOUBLE_CLICK=4;var C_EVT_CONTEXT_MENU=5;var C_EVT_LONG_PRESS=6;var C_EVT_SCALE=7;var gCancelDefaultAction=false;function canvasMaxizeIt(b,c){var a=getViewPort();b.style.position="absolute";b.style.top=0;b.style.left=0;if(c||isMobile()){b.width=a.width;b.height=a.height}else{b.width=a.width-20;b.height=a.height*1.8}console.log("canvas size:"+b.width+"x"+b.height);if(b.height<200){b.height=600}if(b.width<300){b.width=600}return}function canvasCreate(b){var a=null;if("string"===typeof b){a=document.getElementById(b)}else{a=b}if(!a){a=document.createElement("canvas");a.type="idraw_canvas";document.body.appendChild(a)}return a}function canvasAttachManager(d,l,g){function f(v){return v?v:window.event}function c(z){z=f(z);var w=z.keyCode;if(w===KeyEvent.DOM_VK_F5||w===KeyEvent.DOM_VK_F12||w===KeyEvent.DOM_VK_F11){return true}if(targetIsEditor(z)){return true}if(!l.preprocessEvent(C_EVT_KEY_DOWN,z,w)){return true}l.onKeyDown(w);if(w===KeyEvent.DOM_VK_F8){var v={scale:1,rotation:0};v.isStart=true;l.onGesture(v);v.isStart=false;v.isChange=true;l.onGesture(v);v.isChange=false;v.isEnd=true;l.onGesture(v)}return returnDefaultAction(z)}function b(w){w=f(w);var v=w.keyCode;if(v===KeyEvent.DOM_VK_F5||v===KeyEvent.DOM_VK_F12||v===KeyEvent.DOM_VK_F11){return true}if(targetIsEditor(w)){return true}if(!l.preprocessEvent(C_EVT_KEY_UP,w,v)){return true}l.onKeyUp(v);return returnDefaultAction(w)}wtkAddEventListener("keyup",b);wtkAddEventListener("keydown",c);function e(w){var v=Math.max(w.pageX,w.x);var z=Math.max(w.pageY,w.y);return{x:v,y:z}}function r(v){return v.originalEvent&&v.originalEvent.touches&&v.originalEvent.touches.length>1}function t(){var v={};v.x=l.lastPointerPoint.x;v.y=l.lastPointerPoint.y;return v}function i(z){var w=z.getPointerList();if(r(z)){console.log("onPointerDown Multi touch.");return cancelDefaultAction(z)}if(isRightMouseEvent(z.originalEvent)){console.log("Right button.");return cancelDefaultAction(z)}var A=w[0];var v=e(A);var B=A.identifier||0;if(l.preprocessEvent(C_EVT_POINTER_DOWN,z,v)){l.onPointerDown(v)}console.log("onPointerDown.");return cancelDefaultAction(z)}function n(z){var w=z.getPointerList();if(r(z)){console.log("onPointerMove Multi touch.");return cancelDefaultAction(z)}if(isRightMouseEvent(z.originalEvent)){console.log("Right button.");return cancelDefaultAction(z)}var A=w[0];var v=e(A);if(l.preprocessEvent(C_EVT_POINTER_MOVE,z,v)){l.onPointerMove(v)}return cancelDefaultAction(z)}function o(w){if(r(w)){console.log("onPointerUp Multi touch.");return cancelDefaultAction(w)}var v=t();if(isRightMouseEvent(w.originalEvent)){console.log("Right mouse up");if(l.preprocessEvent(C_EVT_CONTEXT_MENU,w,v)){l.onContextMenu(v)}return true}else{if(l.preprocessEvent(C_EVT_POINTER_UP,w,v)){l.onPointerUp(v)}}console.log("onPointerUp.");return cancelDefaultAction(w)}d.addEventListener("pointerdown",i,false);d.addEventListener("pointermove",n,false);d.addEventListener("pointerup",o,false);function a(w){var z=w.scale;var v={scale:z,rotation:0};v.isChange=false;v.isEnd=true;l.onGesture(v);return}function s(w){var v={};v.x=l.lastPointerPoint.x;v.y=l.lastPointerPoint.y;l.onLongPress(v);console.log("onGestureLongPress");return cancelDefaultAction(w)}function h(w){var v=t();l.onDoubleClick(v);console.log("onGestureDoubleTap");return cancelDefaultAction(w)}d.addEventListener("gesturedoubletap",h);d.addEventListener("gesturelongpress",s);var p=getViewPort();var q=screen.height;function u(){var v=getViewPort();if(p.width!=v.width||p.height!=v.height){g.onSizeChanged();p=v}}window.onresize=function(v){setTimeout(u,50);return};var m=window.orientation;function j(){if(m!==window.orientation){g.onSizeChanged();m=window.orientation}}window.onorientationchange=function(v){setTimeout(j,50);return};document.ontouchend=function(v){return true};return}function cancelDefaultAction(b){var a=b?b:window.event;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}return false}function filterResults(d,b,a){var c=d?d:0;if(b&&(!c||(c>b))){c=b}return a&&(!c||(c>a))?a:c}function scrollLeft(){return filterResults(window.pageXOffset?window.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)}function scrollTop(){return filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}function isRightMouseEvent(b){var a=false;if(b.which===null){a=(b.button>2&&b.button!==4)}else{a=(b.which>2&&b.which!==2)}return a}function setCancelDefaultAction(a){gCancelDefaultAction=a;return}function returnDefaultAction(a){return(gCancelDefaultAction)?cancelDefaultAction(a):true}function targetIsEditor(c){var a=c.srcElement?c.srcElement:c.target;var b=a.localName?a.localName:a.tagName;b=b.toLowerCase();if(b==="input"||b==="textarea"){return true}return false}function targetIsCanvas(c){var a=c.srcElement?c.srcElement:c.target;var b=a.localName?a.localName:a.tagName;b=b.toLowerCase();if(b==="canvas"){return true}return false}function Rect(a,d,b,c){this.x=a;this.y=d;this.w=b;this.h=c;return this}Rect.prototype.dup=function(){return new Rect(this.x,this.y,this.w,this.h)};function Point(a,b){this.x=a;this.y=b;return this}Point.prototype.dup=function(){return new Point(this.x,this.y)};Point.prototype.copy=function(a){this.x=a.x;this.y=a.y;return};function pointEqual(b,a){return b.x===a.x&&b.y===a.y}function distanceBetween(f,c){var b=c.x-f.x;var a=c.y-f.y;var e=Math.sqrt(b*b+a*a);return e}function EditorElement(){this.element=null}EditorElement.prototype.setElement=function(a){this.element=a;return};EditorElement.prototype.removeBorder=function(){this.element.style.background="transparent";this.element.style.border="0px solid";this.element.style.outline="none";return};EditorElement.prototype.setFontSize=function(a){this.element.style["font-size"]=a+"pt";return};EditorElement.prototype.show=function(){this.isVisibile=true;this.element.style.visibility="visible";this.element.focus();return};EditorElement.prototype.setInputType=function(a){this.element.type=a;return};EditorElement.prototype.hide=function(){this.isVisibile=false;this.element.style.visibility="hidden";this.element.blur();this.element.onchange=null;return};EditorElement.prototype.move=function(a,b){this.element.style.position="absolute";this.element.style.left=a+"px";this.element.style.top=b+"px";return};EditorElement.prototype.setFontSize=function(a){this.element.style.fontSize=a+"px";return};EditorElement.prototype.resize=function(a,b){this.element.style.width=a+"px";this.element.style.height=b+"px";return};EditorElement.prototype.getText=function(){return this.element.value};EditorElement.prototype.setText=function(a){this.element.value=a;return};function createElement(c,g,a,f,b,d){var e=new EditorElement();c.id=g;e.setElement(c);e.move(a,f);e.resize(b,d);e.setFontSize(14);e.show();return e}var gWtkInput=null;function wtkShowInput(a,e,b,c){var d="wtk_input";if(!gWtkInput){gWtkInput=createSingleLineEdit(d,a,e,b,c)}else{gWtkInput.move(a,e);gWtkInput.resize(b,c);gWtkInput.show()}return gWtkInput}var gWtkTextArea=null;function wtkShowTextArea(a,e,b,c){var d="wtk_textarea";if(!gWtkTextArea){gWtkTextArea=createMultiLineEdit(d,a,e,b,c)}else{gWtkTextArea.move(a,e);gWtkTextArea.resize(b,c);gWtkTextArea.show()}return gWtkTextArea}function wtkHideAllInput(){if(gWtkInput&&gWtkInput.isVisibile){if(gWtkInput.element.onchange){gWtkInput.element.onchange()}gWtkInput.hide()}if(gWtkTextArea&&gWtkTextArea.isVisibile){if(gWtkTextArea.element.onchange){gWtkTextArea.element.onchange()}gWtkTextArea.hide()}return}function createSingleLineEdit(f,a,e,b,d){var c=document.getElementById(f);if(!c){c=document.createElement("input");document.body.appendChild(c)}return createElement(c,f,a,e,b,d)}function createMultiLineEdit(f,a,e,b,d){var c=document.getElementById(f);if(!c){c=document.createElement("textarea");document.body.appendChild(c)}return createElement(c,f,a,e,b,d)}var C_WIDGET_STATE_NORMAL=0;var C_WIDGET_STATE_ACTIVE=1;var C_WIDGET_STATE_OVER=2;var C_WIDGET_STATE_INSENSITIVE=3;var C_WIDGET_STATE_NR=4;var C_WIDGET_TYPE_NONE=0;var C_WIDGET_TYPE_WINDOW=1;var C_WIDGET_TYPE_DIALOG=2;var C_WIDGET_TYPE_MENU_BAR=3;var C_WIDGET_TYPE_TOOL_BAR=4;var C_WIDGET_TYPE_MENU_ITEM=5;var C_WIDGET_TYPE_MENU_BUTTON=6;var C_WIDGET_TYPE_CONTEXT_MENU_BAR=7;var C_WIDGET_TYPE_MENU=8;var C_WIDGET_TYPE_POPUP=9;var C_WIDGET_TYPE_HBOX=10;var C_WIDGET_TYPE_VBOX=11;var C_WIDGET_TYPE_GRID=12;var C_WIDGET_TYPE_USER=13;var C_WIDGET_TYPE_NR=14;var C_MENU_ITEM_HEIGHT=40;function Widget(d,a,e,b,c){this.id=0;this.text="";this.enable=1;this.visible=0;this.listener=0;this.focusable=1;this.insensitive=0;this.parent=d;this.rect=new Rect(a,e,b,c);this.state=C_WIDGET_STATE_NORMAL;this.point=new Point(0,0);this.children=new Array();this.theme=WidgetThemeGet(this.type);this.lastPointerPoint=new Point(0,0);this.pointerDownPoint=new Point(0,0);if(this.parent!==null){d.appendChild(this)}this.setNeedRelayout=function(f){this.needRelayout=f;return};this.appendChild=function(f){f.parent=this;this.children.push(f);return};this.getManager=function(){return this.getTopWindow().manager};this.isPointerDown=function(){return this.getManager().isPointerDown()};this.isClicked=function(){return this.getManager().isClicked()};this.isAltDown=function(){return this.getManager().isAltDown()};this.isCtrlDown=function(){return this.getManager().isCtrlDown()};this.getApp=function(){return this.getManager().getApp()};this.getCanvas2D=function(){return this.getManager().getCanvas2D()};this.getTopWindow=function(){if(this.parent){return this.parent.getTopWindow()}return this};this.getWidth=function(){return this.rect.w};this.getHeight=function(){return this.rect.h};this.getAbsPosition=function(){var f=this.rect.x;var h=this.rect.y;for(var g=this.parent;g;g=g.parent){f=f+g.rect.x;h=h+g.rect.y}return{x:f,y:h}};this.postRedrawAll=function(){this.getManager().postRedraw(null);return};this.postRedraw=function(f){var g=this.getAbsPosition();if(!f){f={x:0,y:0,w:this.rect.w,h:this.rect.h}}f.x=g.x+f.x;f.y=g.y+f.y;this.getManager().postRedraw(f);return};this.redraw=function(f){var g=this.getAbsPosition();if(!f){f={x:0,y:0,w:this.rect.w,h:this.rect.h}}f.x=g.x+f.x;f.y=g.y+f.y;this.getManager().redraw(f);return};this.findTargetWidgetEx=function(f,h){if(!this.visible){return null}if(!isPointInRect(f,this.rect)){return null}if(h&&this.children.length>0){var o=this.children.length-1;var l=this.point;l.x=f.x-this.rect.x;l.y=f.y-this.rect.y;for(var j=o;j>=0;j--){var m=this.children[j];var g=m.findTargetWidget(l);if(g!==null){return g}}}return this};this.findTargetWidget=function(f){return this.findTargetWidgetEx(f,true)};this.removeChild=function(f){this.children.remove(f);f.parent=null;return};this.setText=function(f){this.text=f;return};this.setID=function(f){this.id=f;return};this.setUserData=function(f){this.userData=f;return};this.setEnable=function(f){this.enable=f;if(!f){this.state=C_WIDGET_STATE_INSENSITIVE}else{if(this.state===C_WIDGET_STATE_INSENSITIVE){this.state=C_WIDGET_STATE_NORMAL}}return};this.setState=function(f){if(this.enable){this.state=f}return};this.measure=function(f){return};this.move=function(f,g){this.rect.x=f;this.rect.y=g;return};this.moveDelta=function(g,f){this.rect.x=this.rect.x+g;this.rect.y=this.rect.y+f;return};this.resize=function(f,g){this.rect.w=f;this.rect.h=g;this.setNeedRelayout(true);return};this.setListener=function(f){this.listener=f;return};this.lookup=function(j){if(this.id===j){return this}if(this.children.length===0){return null}for(var f=0;f<this.children.length;f++){var h=this.children[f];var g=h.lookup(j);if(g!==null){return g}}return null};this.relayout=function(f,g){return};this.paintBackground=function(f){var g=this.theme[this.state].image;if(g){g.draw9Patch(f,this.rect.x,this.rect.y,this.rect.w,this.rect.h)}else{if(this.theme[this.state].bg){f.fillStyle=this.theme[this.state].bg;f.fillRect(this.rect.x,this.rect.y,this.rect.w,this.rect.h)}}return};this.paintSelf=function(f){return};this.beforePaint=function(f){return};this.afterPaint=function(f){return};this.draw=function(f){var h=null;if(!this.visible){return}f.lineWidth=1;f.fillStyle="White";f.strokeStyle="Black";f.beginPath();this.beforePaint(f);this.relayout(f,0);this.paintBackground(f);this.paintSelf(f);if(this.children.length===0){return}f.save();f.translate(this.rect.x,this.rect.y);for(var g=0;g<this.children.length;g++){child=this.children[g];if(child.state===C_WIDGET_STATE_OVER){h=child}else{child.draw(f)}}if(h){h.draw(f)}f.restore();this.afterPaint(f);f.closePath();return};this.isVisible=function(){return this.visible};this.onShow=function(f){return true};this.show=function(f){if(f!=this.visible){this.visible=f;this.onShow(f)}return};this.showAll=function(g){this.show(g);for(var f=0;f<this.children.length;f++){this.children[f].showAll(g)}this.relayout(this.getCanvas2D(),false);if(!this.parent){this.postRedraw()}return};this.onDoubleClick=function(f){return};this.onLongPress=function(f){return};this.onGesture=function(f){return};this.onPointerDown=function(f){this.getTopWindow().grab(this);if(this.state!==C_WIDGET_STATE_INSENSITIVE){this.state=C_WIDGET_STATE_ACTIVE;this.postRedraw()}return};this.onPointerMove=function(f){return};this.onPointerUp=function(f){if(this.state!==C_WIDGET_STATE_INSENSITIVE){this.state=C_WIDGET_STATE_NORMAL}this.getTopWindow().ungrab();if(this.listener&&this.state!==C_WIDGET_STATE_INSENSITIVE){this.listener(this)}this.postRedraw();return};this.onContextMenu=function(f){return};this.onKeyDown=function(f){console.log("onKeyUp Widget:"+this.id+" code="+f);return};this.onKeyUp=function(f){console.log("onKeyUp Widget:"+this.id+" code="+f);return};return this}function WtkImage(a){this.url=a;this.image=WtkImage.createImage(a);this.setImageSrc=function(b){this.image=WtkImage.createImage(b);return};this.getImageSrc=function(){return this.image.src};this.getImage=function(){var b=this.image;return(b&&b.imageLoaded)?b:null};return}var gRefreshAfterImageLoaded=null;function setRefreshAfterImageLoaded(a){gRefreshAfterImageLoaded=a;return}WtkImage.images={};WtkImage.nullImage=new Image();WtkImage.findImage=function(a){return WtkImage.images[a]};WtkImage.createImage=function(b){if(!b){return WtkImage.nullImage}var a=WtkImage.findImage(b);if(!a){a=new Image();a.src=b;WtkImage.images[b]=a;a.onload=function(c){this.imageLoaded=true;if(gRefreshAfterImageLoaded){gRefreshAfterImageLoaded()}};a.onerror=function(c){this.imageLoaded=false;if(b){console.log("load "+b+" failed:"+c.message)}};a.onabort=function(c){this.imageLoaded=false;if(b){console.log("load "+b+" failed(abort):"+c.message)}}}return a};var gWtkBgIcon=null;function wtkGetBgIconInfo(){if(!gWtkBgIcon){gWtkBgIcon=new IconInfo(wtkGetImageURL("wtk.png"),1,20,20,50)}return gWtkBgIcon}var WtkBgImage={MENU_BAR_BG:0,MENU_BAR_ITEM_ACTIVE_BG:1,MENU_BAR_ITEM_OVER_BG:2,MENU_ITEM_H_SEPERATOR:3,MENU_ITEM_V_SEPERATOR:4,MENU_NORMAL_BG:5};function Gc(b,c,a,d){this.bg=c;this.fg=a;this.font=b;this.image=d;this.dup=function(){var e=new Gc(this.font,this.bg,this.fg,this.image);return e};return}function themeDup(b){var c=new Array();if(!b){console.log("Invalid params.");return null}for(var a=0;a<b.length;a++){c.push(b[a].dup())}return c}function themeCreate(){var a=new Array();a.push(new Gc("13pt Bold sans-serif ","#FFFFFF","#000000",null));a.push(new Gc("13pt Bold sans-serif ","#FFFFFF","#000000",null));a.push(new Gc("13pt Bold sans-serif ","#FFFFFF","#000000",null));a.push(new Gc("13pt Bold sans-serif ","#FFFFFF","Gray",null));return a}var gTheme=null;function wtkThemeGet(){var c=null;var b=null;if(gTheme!==null){return gTheme}gTheme=new Array();for(var a=0;a<C_WIDGET_TYPE_NR;a++){gTheme.push(themeCreate())}c=gTheme[C_WIDGET_TYPE_WINDOW];c[C_WIDGET_STATE_NORMAL].fg="#FFFF00";c=gTheme[C_WIDGET_TYPE_MENU_BUTTON];c[C_WIDGET_STATE_NORMAL].font="10pt sans-serif";c[C_WIDGET_STATE_INSENSITIVE].font="10pt sans-serif";c[C_WIDGET_STATE_OVER].font="10pt sans-serif";c[C_WIDGET_STATE_ACTIVE].font="10pt sans-serif";return gTheme}function WidgetThemeGet(a){var b=wtkThemeGet()[a];return themeDup(b)}function toolbarPaintBackground(b,a){a.save();a.translate(b.rect.x,b.rect.y);if(!b.grad){b.grad=a.createLinearGradient(0,0,0,b.rect.h);b.grad.addColorStop(0,"#A0A0A0");b.grad.addColorStop(0.9,"#D0D0D0");b.grad.addColorStop(1,"#B8B8B8")}a.fillStyle=b.grad;a.shadowColor="Black";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=10;a.beginPath();a.lineWidth=2;drawRoundRect(a,b.rect.w,b.rect.h,5);a.fill();a.restore();return true}function gridMenuPaintBackground(b,a){a.save();a.translate(b.rect.x,b.rect.y);if(!b.grad){b.grad=a.createLinearGradient(0,0,0,b.rect.h);b.grad.addColorStop(0,"#E0E0E0");b.grad.addColorStop(0.99,"#484848");b.grad.addColorStop(1,"#E0E0E0")}a.fillStyle=b.grad;a.shadowColor="Black";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=10;a.beginPath();drawRoundRect(a,b.rect.w,b.rect.h,8);a.fill();a.restore();return true}function menuPaintBackground(b,a){a.save();a.translate(b.rect.x,b.rect.y);if(!b.grad){b.grad=a.createLinearGradient(0,0,0,b.rect.h*3);b.grad.addColorStop(0,"#E0E0E0");b.grad.addColorStop(0.95,"#484848");b.grad.addColorStop(1,"#E0E0E0")}a.fillStyle="White";a.shadowColor="Gray";a.shadowOffsetX=0;a.shadowOffsetY=2;a.shadowBlur=5;a.beginPath();a.lineWidth=1;a.strokeStyle="Gray";if(b.asPopup){drawRoundRect(a,b.rect.w,b.rect.h,5)}else{drawRoundRect(a,b.rect.w,b.rect.h,3)}a.fill();a.shadowBlur=0;a.stroke();a.beginPath();a.restore();return true}function contextMenuBarPaintBackground(b,a){a.save();a.translate(b.rect.x,b.rect.y);a.fillStyle="White";a.strokeStyle="#E0E0E0";drawRoundRect(a,b.rect.w,b.rect.h,5);a.fill();a.stroke();a.restore();return true}function menuBarPaintBackground2(d,a){a.save();a.translate(d.rect.x,d.rect.y);if(!d.grad){d.grad=a.createLinearGradient(0,0,0,d.rect.h);d.grad.addColorStop(0,"#FFFFFF");d.grad.addColorStop(0.25,"#E0E0E0");d.grad.addColorStop(0.5,"#D0D0D0");d.grad.addColorStop(0.75,"#C0C0C0");d.grad.addColorStop(0.95,"gray");d.grad.addColorStop(1,"#D0D0D0");var c=d.children;for(var b=0;b<c.length;b++){var e=c[b];e.theme[0].fg="#000000"}}a.fillStyle=d.grad;a.shadowColor="Black";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=10;a.beginPath();a.fillRect(0,0,d.rect.w,d.rect.h);a.restore();return true}function menuBarPaintBackground(d,a){a.save();a.translate(d.rect.x,d.rect.y);if(!d.grad){d.grad=a.createLinearGradient(0,0,0,d.rect.h);d.grad.addColorStop(0,"#3a3a38");d.grad.addColorStop(0.25,"#33322f");d.grad.addColorStop(0.5,"#2c2c26");d.grad.addColorStop(0.75,"#24231a");d.grad.addColorStop(0.9,"#1c1c11");d.grad.addColorStop(1,"gray");var c=d.children;for(var b=0;b<c.length;b++){var e=c[b];e.theme[0].fg="#F0F0F0"}}a.fillStyle=d.grad;a.shadowColor="Black";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=10;a.beginPath();a.fillRect(0,0,d.rect.w,d.rect.h);a.restore();return true}function menuItemPaintBackground(b,a){if(b.state===C_WIDGET_STATE_NORMAL||b.state===C_WIDGET_STATE_INSENSITIVE){return}a.save();a.translate(b.rect.x,b.rect.y);a.lineWidth=1;a.strokeStyle="Gray";if(b.state===C_WIDGET_STATE_OVER){a.fillStyle="#E0E0E0"}else{a.fillStyle="#C0C0C0"}a.beginPath();drawRoundRect(a,b.rect.w,b.rect.h,8);a.fill();a.stroke();a.restore();return true}function toolbarPaintTitle(d,f,c,a,g,b,e){d.font=c;d.textAlign="left";d.textBaseline="middle";d.fillStyle="Black";d.fillText(f,a+5,g+e/2,b-30);return}function Window(d,a,f,b,e){var c=[null,a,f,b,e];this.type=C_WIDGET_TYPE_WINDOW;Widget.apply(this,c);this.center=false;this.grabWidget=null;this.focusWidget=null;this.manager=d;this.setManager=function(g){this.manager=g;return};this.grab=function(g){this.grabWidget=g};this.ungrab=function(){this.grabWidget=0};this.setCenter=function(g){this.center=g;return};this.moveToCenter=function(){var i=getViewPort();var h=Math.min(this.manager.w,i.width);var j=Math.min(this.manager.h,i.height);var g=(h-this.rect.w)/2;var l=(j-this.rect.h)/2+scrollTop();this.rect.x=g;this.rect.y=l;return};this.onDoubleClick=function(g){var h=this;if(this.grabWidget){h=this.grabWidget}else{h=this.findTargetWidget(g)}if(h&&h!==this){h.onDoubleClick(g);this.focusWidget=h}return};this.onPointerDown=function(g){var h=this;if(this.grabWidget){h=this.grabWidget}else{h=this.findTargetWidget(g)}if(h&&h!==this){h.onPointerDown(g);this.focusWidget=h}return};this.onPointerMove=function(g){var h=this;if(this.grabWidget){h=this.grabWidget}else{h=this.findTargetWidget(g)}if(h&&h!==this){if(this.lastTarget&&h!=this.lastTarget){this.lastTarget.onPointerMove(g)}h.onPointerMove(g);this.lastTarget=h}return};this.onPointerUp=function(g){var h=this;if(this.grabWidget){h=this.grabWidget}else{h=this.findTargetWidget(g)}if(h&&h!==this){h.onPointerUp(g)}return};this.onContextMenu=function(g){var h=this;if(this.grabWidget){h=this.grabWidget}else{h=this.findTargetWidget(g)}if(h&&h!==this){h.onContextMenu(g)}return};this.onKeyDown=function(g){if(this.grabWidget){this.grabWidget.onKeyDown(g)}if(this.focusWidget!==0){this.focusWidget.onKeyDown(g)}return};this.onKeyUp=function(g){if(this.grabWidget){this.grabWidget.onKeyUp(g)}if(this.focusWidget!==0){this.focusWidget.onKeyUp(g)}return};this.manager.addWindow(this)}var C_APP_TYPE_WEBAPP=1;var C_APP_TYPE_PREVIEW=2;var C_APP_TYPE_PC_VIEWER=3;var C_APP_TYPE_PC_EDITOR=4;var C_APP_TYPE_MOBILE_EDITOR=5;var C_APP_TYPE_INLINE_EDITOR=6;function AppBase(b,a){this.win=null;this.view=null;this.type=a;this.minHeight=0;this.setMinHeight=function(c){this.minHeight=c;return};this.init=function(){if(this.type===C_APP_TYPE_INLINE_EDITOR){this.isInlineEdit=true}else{this.isInlineEdit=false}this.canvas=canvasCreate(b);this.adjustCanvasSize();this.manager=new WindowManager(this,this.canvas);canvasAttachManager(this.canvas,this.manager,this);return};this.onShapeSelected=function(c){return};this.onSizeChanged=function(){return};this.adjustCanvasSize=function(){var d=0;var f=0;var e=this.canvas;var c=getViewPort();switch(this.type){case C_APP_TYPE_WEBAPP:case C_APP_TYPE_INLINE_EDITOR:case C_APP_TYPE_MOBILE_EDITOR:d=c.width;f=c.height;break;case C_APP_TYPE_PREVIEW:d=c.width;f=c.height;this.setMinHeight(1500);break;default:d=c.width-20;f=c.height*1.5;break}f=Math.max(f,this.minHeight);this.resizeCanvasTo(d,f);return};this.resizeCanvasTo=function(c,e){var d=this.canvas;d.width=c;d.height=e;d.style.top=0;d.style.left=0;d.style.position="absolute";return};this.loadData=function(c){return this.view.loadFromJson(c)};this.init();return this}var gGridImage=null;var gBeforeLoadCallBacks=[];var gAfterLoadCallBacks=[];function registerViewBeforeLoadListener(a){if(a){gBeforeLoadCallBacks.push(a)}return}function registerViewAfterLoadListener(a){if(a){gAfterLoadCallBacks.push(a)}return}function notifyViewBeforeLoad(a,c){for(var b=0;b<gBeforeLoadCallBacks.length;b++){gBeforeLoadCallBacks[b](a,c)}return}function notifyViewAfterLoad(a,c){for(var b=0;b<gAfterLoadCallBacks.length;b++){gAfterLoadCallBacks[b](this,c)}return}function ViewBase(d,a,e,b,c){this.type=C_WIDGET_TYPE_USER;Widget.apply(this,arguments);this.grid=10;this.showGrid=true;this.snapGrid=false;this.fillColor="white";this.autoResize=false;this.allShapes=new Array();this.theme=new Array();this.xscale=1;this.yscale=1;this.pointerDownPosition=new Point(0,0);this.lastPointerPosition=new Point(0,0);this.theme.push(new Gc("18px sans-serif","#FFFFFF","#000000",null));this.theme.push(new Gc("18px sans-serif","#FFFFFF","#000000",null));this.theme.push(new Gc("18px sans-serif","#FFFFFF","#000000",null));this.theme.push(new Gc("18px sans-serif","#FFFFFF","#D0D0D0",null));this.onShapeSelected=function(f){this.getApp().onShapeSelected(f);return};this.setFillColor=function(g){this.fillColor=g;for(var f=0;f<this.theme.length;f++){this.theme[f].bg=g}return};this.setGrid=function(f,g){this.showGrid=f;this.snapGrid=g;return};this.setShowGrid=function(f){this.showGrid=f;return};this.setSnapGrid=function(f){this.snapGrid=f;return};this.snapToGrid=function(f,i){var g=f;var h=i;if(this.snapGrid){g=Math.floor((f+this.grid/2)/this.grid)*this.grid;h=Math.floor((i+this.grid/2)/this.grid)*this.grid}return{x:g,y:h}};this.setAutoResize=function(){this.autoResize=true;return};this.initPage=function(g,f){var h=new Object();h.index=g?g:0;h.shapes=f?f:(new Array());return h};this.getPages=function(){return this.pages};this.newPage=function(){var j=this.getPageNr();var g=this.currentPage+1;var h=this.initPage(g,null);this.pages.push(h);this.saveCurrentPage();if(j>1){for(var f=j;f>g;f--){this.pages[f]=this.pages[f-1]}this.pages[g]=h}this.currentPage=g;this.showCurrentPage();this.getApp().updateContextMenu();return};this.removeCurrentPage=function(){var f=this.getPageNr();if(f>1){this.removePage(this.currentPage)}else{this.allShapes.clear()}this.getApp().updateContextMenu();return};this.removePage=function(f){var h=this.getPageNr();if(f<0||f>=h){f=this.currentPage}var g=this.pages[f];if(this.pages.length>1){this.pages.remove(g)}if(f<=this.currentPage&&this.currentPage>=0){this.currentPage--}this.showCurrentPage();this.getApp().updateContextMenu();return};this.saveCurrentPage=function(){var f=new Array();for(var h=0;h<this.allShapes.length;h++){var g=this.allShapes[h];f.push(g.toJson())}this.pages[this.currentPage]=this.initPage(this.currentPage,f);return};this.setMetaInfo=function(f){this.meta=f;return};this.getMetaInfo=function(){return this.meta};this.saveAsJson=function(){var i=new Object();var g=null;var f=ShapeFactoryGet().getDiagramTypes();this.saveCurrentPage();i.w=this.rect.w;i.h=this.rect.h;i.fillColor=this.fillColor;i.version=1;i.magic="5idraw";i.scale=this.xscale;i.type=this.type?this.type:f[0].name;i.meta=this.meta;i.pages=this.pages;var h=JSON.stringify(i,null,"\t");return h};this.parseJson=function(f){var i=null;var g=null;try{if(f){i=JSON.parse(f);this.reset()}}catch(h){ret=false;console.log("JSON.parse failed:"+h.message);console.log("JSON.parse failed:"+f)}if(!i){return null}if(!i.magic||i.magic!=="5idraw"){console.log("Not supported type");return null}return i};this.beforeLoad=function(f){notifyViewBeforeLoad(this,f);return};this.afterLoad=function(g){notifyViewAfterLoad(this,g);var f=this;setRefreshAfterImageLoaded(function(){f.postRedraw()});return};this.loadJson=function(g){var f=null;if(!g||!g.pages){this.pages=new Array();this.pages.push(this.initPage(0,null));this.currentPage=0;this.showCurrentPage();return}this.beforeLoad(g);if(this.autoResize){this.xscale=this.rect.w/g.w;this.yscale=this.rect.h/g.h;this.xscale=this.xscale<this.yscale?this.xscale:this.yscale;this.yscale=this.xscale}else{this.xscale=1;this.yscale=1}this.meta=g.meta;this.pages=g.pages;this.currentPage=0;this.fillColor=g.fillColor;this.loading=true;this.showCurrentPage();if(g.scale){this.xscale=g.scale;this.yscale=g.scale}this.afterLoad(g);this.loading=false;return};this.loadFromJson=function(f){var h=this.parseJson(f);var g=this;if(h&&h.type==="EDA"){setTimeout(function(){g.loadJson(h)},1500)}else{this.loadJson(h);setTimeout(function(){g.postRedraw()},500)}return};this.onPageShow=function(){};this.showCurrentPage=function(){var h=null;var g=this.pages[this.currentPage].shapes;if(!g){g=this.pages[this.currentPage].glyphs}this.allShapes.clear();if(g){var f=0;for(var j=0;j<g.length;j++){var m=g[j];var l=m.type?m.type:m.id;h=ShapeFactoryGet().createShape(l,C_CREATE_FOR_PROGRAM);if(h){h.fromJson(m);this.addShape(h);if(h.h>f){f=h.h}}else{console.log("createShape "+m.type+" fail.")}}}this.onPageShow();this.postRedraw();return};this.autoScale=function(){var j=null;for(var l=0;l<this.allShapes.length;l++){var h=this.allShapes[l];if(!j){j=h}else{if((h.h+h.w)>(j.h+j.w)){j=h}}}if(j){var g=j.w/this.rect.w;var f=j.h/this.rect.h;if(g>0.8||f>1.4){if(g>1.2||f>2){this.zoomTo(0.5)}else{this.zoomTo(0.7)}}else{this.zoomTo(1)}}return};this.getPageNr=function(){return this.pages?this.pages.length:0};this.gotoPrevPage=function(){var f=this.pages.length;var g=this.currentPage-1;if(g<0){g=g+f}this.gotoPage(g);return};this.getPagesNr=function(){return this.pages.length};this.gotoNextPage=function(){var f=this.pages.length;var g=this.currentPage+1;if(g>=f){g=g-f}this.gotoPage(g);return};this.gotoPage=function(f){if(f<0||f>=this.getPageNr()){return}if(f===this.currentPage){return}this.saveCurrentPage();this.currentPage=f;this.showCurrentPage();return};this.reset=function(){this.allShapes.clear();this.postRedraw();this.pages=new Array();this.pages.push(this.initPage(0,null));this.meta=null;this.currentPage=0;return};this.translatePoint=function(g){var f={x:(g.x-this.rect.x),y:(g.y-this.rect.y)};f.x=f.x/this.xscale;f.y=f.y/this.yscale;return f};this.canZoomIn=function(){return this.xscale<2&&this.yscale<2};this.canZoomOut=function(){return this.xscale>0.5&&this.yscale>0.5};this.onZoomed=function(){return};this.zoomTo=function(j){var g=null;for(var h=0;h<this.allShapes.length;h++){var f=this.allShapes[h];if(!g){g=f}else{if((f.h+f.w)>(g.h+g.w)){g=f}}}if(!this.loading&&g&&g.isUIDevice){var l=this.xscale-j;g.x=Math.floor(g.x+g.x*l);g.y=Math.floor(g.y+g.y*l)}this.xscale=j;this.yscale=j;this.onZoomed();this.postRedraw();return};this.zoomIn=function(){if(this.canZoomIn()){this.zoomTo(this.xscale*1.25)}return};this.zoomOut=function(){if(this.canZoomOut()){this.zoomTo(this.xscale*0.75)}return};this.getCreatingShape=function(){return this.creatingShape};this.addShape=function(f){this.allShapes.push(f);f.setView(this);f.setApp(this.getApp());if(this.creatingShape){this.removeShape(this.creatingShape);this.creatingShape=null}if(f.state!==C_STAT_NORMAL){this.creatingShape=f}if(f.mode!=C_MODE_RUNNING&&f.isUIDevice){this.autoScale()}return};this.removeShape=function(f){this.allShapes.remove(f);f.setView(null);return};this.getSelectedShapes=function(h){var f=[];for(var j=0;j<this.allShapes.length;j++){var g=this.allShapes[j];if(g.selected){f.push(g);continue}if(h&&g.isContainer){g.findSelectedShapes(f)}}return f};this.countShape=function(g){if(!this.allShapes){return 0}var h=this.allShapes.length;if(g){var f=this.getSelectedShapes(true);h=f.length}return h};this.getSelectedShape=function(){var f=this.getSelectedShapes(true);if(f.length){return f[0]}return null};this.selectAll=function(h){for(var g=0;g<this.allShapes.length;g++){var f=this.allShapes[g];f.setSelected(h)}this.postRedraw();return};this.beforePaint=function(f){return};this.afterPaint=function(f){return};this.drawSelf=function(f){this.postRedraw();return};this.paintBackground=function(f){this.canvas=f;if(!this.showGrid){f.fillStyle="White";f.fillRect(this.rect.x,this.rect.y,this.rect.w,this.rect.h);f.beginPath()}return};this.drawGrid=function(g){if(this.showGrid&&this.grid){var I=0;var G=0;var u=0;var q=0;var B=0;var F=0;var z=this.rect.w;var J=this.rect.h;var o=this.rect.x;var m=this.rect.y;var f=this.grid;var C=f-1;var D=J/f;var L=z/f;var K=5;var H=gGridImage.getImage();if(H){var l=H.width;var A=H.height;var E=0;var M=0;preDrawGrids=l/this.grid;var p=L/preDrawGrids;var v=D/preDrawGrids;for(I=0;I<p;I++){u=I*preDrawGrids*f;E=Math.min(l,o+z-u);for(G=0;G<v;G++){q=G*preDrawGrids*f;M=Math.min(A,m+J-q);g.drawImage(H,u,q)}}}}return};this.showLogo=function(i){if(this.shouldShowLogo){var f=0;var l=0;var g=this.rect.w;var j=this.rect.h;i.beginPath();i.textAlign="right";i.textBaseline="bottom";i.font="12pt sans";i.fillStyle="Gold";f=g-20+this.rect.x;l=this.rect.y+j-5;i.fillText(drawingGetLogoText(),f,l)}return};this.showPageIndicator=function(i){var f=0;var m=0;var g=this.rect.w;var j=this.rect.h;var l=dappGetText("Page")+" "+(this.currentPage+1)+"/"+this.getPageNr();i.beginPath();i.textAlign="right";i.textBaseline="top";i.font="18pt sans";i.fillStyle="Gray";f=this.parent.rect.w-10;m=30;i.fillText(l,f,m);return};this.paintSelf=function(j){var f=this.rect.w;var m=this.rect.h;var q=null;var o=this.getAbsPosition();j.save();j.beginPath();j.rect(o.x,o.y,f,m);j.stroke();j.clip();j.beginPath();j.save();this.beforePaint(j);j.translate(this.rect.x,this.rect.y);j.shadowBlur=0;this.drawGrid(j);j.scale(this.xscale,this.yscale);for(var l=0;l<this.allShapes.length;l++){var g=this.allShapes[l];if(g.selected&&!q&&g.isLine){q=g}else{g.paint(j)}}if(q){q.paint(j)}this.afterPaint(j);j.restore();j.restore();var n=m/30;if(n>10){n=10}if(n>8){this.showLogo(j)}if(this.getPageNr()>1){this.showPageIndicator(j)}this.drawStatus(j);return};this.drawStatus=function(f){return};this.selectShapeByPoint=function(f,h){for(var j=this.allShapes.length-1;j>=0;j--){var g=this.allShapes[j];if(g.hitTest(f)){if(g.isContainer){g=g.findShapeByPoint(f,h)}this.postRedraw();this.targetShape=null;if(g.parentShape){g.parentShape.selected=false}if(!g.selected){g.setSelected(false)}g.setSelected(!g.selected);return g}}return null};this.onGesture=function(f){return};this.getMoveDeltaX=function(){return this.moveDeltaX};this.getMoveDeltaY=function(){return this.moveDeltaY};this.getMoveAbsDeltaX=function(){return this.moveAbsDeltaX};this.getMoveAbsDeltaY=function(){return this.moveAbsDeltaY};this.updateLastPointerPoint=function(f){this.moveDeltaX=f.x-this.lastPointerPosition.x;this.moveDeltaY=f.y-this.lastPointerPosition.y;this.moveAbsDeltaX=f.x-this.pointerDownPosition.x;this.moveAbsDeltaY=f.y-this.pointerDownPosition.y;this.lastPointerPosition.x=f.x;this.lastPointerPosition.y=f.y;return};return}function WindowManager(b,a){this.app=b;this.canvas=a;this.w=a.width;this.h=a.height;this.last_point=0;this.pointerDown=0;this.target=null;this.windows=new Array();this.grabWindows=new Array();this.dirtyRegion=new Array();this.eventLogging=false;this.pointerDownPoint={x:0,y:0};this.lastPointerPoint={x:0,y:0};return}WindowManager.prototype.getApp=function(){return this.app};WindowManager.prototype.logEvent=function(d,c,i){var g={t:d};var b=new Date();var f=b.getTime();var a=this.events.length>0?this.events[this.events.length-1]:null;if(!this.pointerDown&&a&&d===C_EVT_POINTER_MOVE&&a.t===C_EVT_POINTER_MOVE){var j=a.p.x-i.x;var h=a.p.y-i.y;if(Math.abs(j)<5&&Math.abs(h)<5){console.log("Skip move event");return}}g.tm=b.getTime()-f;this.lastEventTime=f;switch(d){case C_EVT_POINTER_DOWN:console.log("Record: Mouse down:"+i.x+" x "+i.y);case C_EVT_POINTER_UP:console.log("Record: Mouse up:"+i.x+" x "+i.y);case C_EVT_CONTEXT_MENU:case C_EVT_POINTER_MOVE:case C_EVT_DOUBLE_CLICK:g.p=i;break;case C_EVT_KEY_DOWN:case C_EVT_KEY_UP:g.c=i;break;default:break}if(targetIsEditor(c)){g.other=true}this.events.push(g);return};WindowManager.prototype.replayEvents=function(b){if(b){try{this.events=JSON.parse(b)}catch(d){return}}if(!this.events||this.events.length<1){return}var a=this;this.replayIndex=0;a.eventReplaying=true;console.log("replay events start.");function c(){var e=a.events[a.replayIndex];var f=e.t;if(e.other){if(f===C_EVT_KEY_DOWN){}else{if(f===C_EVT_KEY_UP){}}}else{switch(f){case C_EVT_CONTEXT_MENU:a.onContextMenu(e.p);console.log("Inject: Mouse down:"+e.p.x+" x "+e.p.y);break;case C_EVT_POINTER_DOWN:a.onPointerDown(e.p);console.log("Inject: Mouse down:"+e.p.x+" x "+e.p.y);break;case C_EVT_POINTER_MOVE:a.onPointerMove(e.p);break;case C_EVT_POINTER_UP:a.onPointerUp(e.p);console.log("Inject: Mouse up:"+e.p.x+" x "+e.p.y);break;case C_EVT_DOUBLE_CLICK:a.onDoubleClick(e.p);break;case C_EVT_KEY_DOWN:a.onKeyDown(e.c);break;case C_EVT_KEY_UP:a.onKeyUp(e.c);break;default:break}}a.replayIndex++;if(a.replayIndex<a.events.length){e=a.events[a.replayIndex];setTimeout(c,e.t)}else{a.eventReplaying=false;console.log("replay events end.")}}setTimeout(c,0);return};WindowManager.prototype.preprocessEvent=function(b,c,a){this.currentEvent=c.originalEvent?c.originalEvent:c;return true};WindowManager.prototype.getCanvas2D=function(){return this.canvas.getContext("2d")};WindowManager.prototype.findTargetWin=function(a){var e=null;var c=this.grabWindows.length;if(c>0){e=this.grabWindows[c-1]}else{c=this.windows.length;for(var b=c-1;b>=0;b--){var d=this.windows[b];if(!d.visible||d.insensitive||!d.focusable){continue}if(isPointInRect(a,d.rect)){e=d;break}}}return e};WindowManager.prototype.resize=function(a,b){this.w=a;this.h=b;this.postRedraw();return};WindowManager.prototype.grab=function(a){this.grabWindows.push(a);return};WindowManager.prototype.ungrab=function(a){this.grabWindows.remove(a);return};WindowManager.prototype.onDoubleClick=function(a){this.target=this.findTargetWin(a);if(this.target){this.target.onDoubleClick(a)}else{console.log("Window Manager: no target for x="+a.x+" y="+a.y)}return};WindowManager.prototype.onLongPress=function(a){this.target=this.findTargetWin(a);if(this.target){this.target.onLongPress(a)}else{console.log("Window Manager: no target for x="+a.x+" y="+a.y)}return};WindowManager.prototype.onGesture=function(b){wtkHideAllInput();var a={x:this.w/2,y:this.h/2};this.target=this.findTargetWin(a);if(this.target){this.target.onGesture(b);console.log("WindowManager.prototype.onGesture: scale="+b.scale+" rotation="+b.rotation)}else{console.log("Window Manager: no target for x="+a.x+" y="+a.y)}return};WindowManager.prototype.onPointerDown=function(a){wtkHideAllInput();this.target=this.findTargetWin(a);this.pointerDown=true;this.pointerDownPoint.x=a.x;this.pointerDownPoint.y=a.y;this.lastPointerPoint.x=a.x;this.lastPointerPoint.y=a.y;if(this.target){this.target.onPointerDown(a)}else{console.log("Window Manager: no target for x="+a.x+" y="+a.y)}return};WindowManager.prototype.onPointerMove=function(a){this.target=this.findTargetWin(a);this.lastPointerPoint.x=a.x;this.lastPointerPoint.y=a.y;if(this.target){this.target.onPointerMove(a)}return};WindowManager.prototype.onPointerUp=function(a){this.target=this.findTargetWin(a);this.lastPointerPoint.x=a.x;this.lastPointerPoint.y=a.y;if(this.target){this.target.onPointerUp(a)}else{console.log("Window Manager: no target for x="+a.x+" y="+a.y)}this.pointerDown=false;return};WindowManager.prototype.isPointerDown=function(){return this.pointerDown};WindowManager.prototype.isClicked=function(){var b=Math.abs(this.lastPointerPoint.x-this.pointerDownPoint.x);var a=Math.abs(this.lastPointerPoint.y-this.pointerDownPoint.y);return(b<10&&a<10)};WindowManager.prototype.isCtrlDown=function(){return this.currentEvent&&(this.currentEvent.ctrlKey||this.ctrlDown)};WindowManager.prototype.isAltDown=function(){return this.currentEvent&&(this.currentEvent.altKey||this.altDown)};WindowManager.prototype.onContextMenu=function(a){this.target=this.findTargetWin(a);if(this.target){this.target.onContextMenu(a)}else{console.log("Window Manager: no target for x="+a.x+" y="+a.y)}return};WindowManager.prototype.onKeyDown=function(a){switch(a){case KeyEvent.DOM_VK_SHIFT:this.shitfDown=true;break;case KeyEvent.DOM_VK_CONTROL:this.ctrlDown=true;break;case KeyEvent.DOM_VK_ALT:this.altDown=true;break;default:if(this.target!==null){this.target.onKeyDown(a)}}return};WindowManager.prototype.onKeyUp=function(a){switch(a){case KeyEvent.DOM_VK_SHIFT:this.shitfDown=false;break;case KeyEvent.DOM_VK_CONTROL:this.ctrlDown=false;break;case KeyEvent.DOM_VK_ALT:this.altDown=false;break;default:if(this.target!==null){this.target.onKeyUp(a)}}return};WindowManager.prototype.addWindow=function(a){this.windows.push(a);return};WindowManager.prototype.removeWindow=function(a){this.windows.remove(a);console.log("remove nr="+this.windows.length);this.postRedraw();return};WindowManager.prototype.postRedraw=function(c){this.dirtyRegion.push(1);var a=this;function b(){a.draw()}requestAnimFrame(b);return};WindowManager.prototype.drawWindows=function(a){var c=this.windows.length;for(var b=0;b<c;b++){var d=this.windows[b];d.draw(a)}return};WindowManager.prototype.redraw=function(b){var a=this.getCanvas2D();a.save();if(b){a.beginPath();a.rect(b.x,b.y,b.w,b.h);a.clip()}this.drawWindows(a);a.restore();return};WindowManager.prototype.draw=function(){if(!this.dirtyRegion.length){return}var a=this.getCanvas2D();a.save();this.drawWindows(a);a.restore();this.dirtyRegion.clear();return;var c=this.windows.length;for(var b=0;b<c;b++){var d=this.windows[b];d.draw(a)}a.beginPath();a.strokeStyle="Black";if(this.eventLogging){a.fillStyle="Red";a.arc(30,30,10,0,2*Math.PI)}a.fill();a.stroke();this.dirtyRegion.clear();a.restore();return};var C_MODE_EDITING=0;var C_MODE_RUNNING=1;var C_MODE_PREVIEW=2;var C_HIT_TEST_NONE=0;var C_HIT_TEST_TL=1;var C_HIT_TEST_TM=2;var C_HIT_TEST_TR=3;var C_HIT_TEST_ML=4;var C_HIT_TEST_MR=5;var C_HIT_TEST_BL=6;var C_HIT_TEST_BM=7;var C_HIT_TEST_BR=8;var C_HIT_TEST_HANDLE=9;var C_HIT_TEST_WORKAREA=10;var C_HIT_TEST_MAX=11;var C_HIT_TEST_MM=-1;var C_ALIGN_LEFT=1;var C_ALIGN_RIGHT=2;var C_ALIGN_TOP=3;var C_ALIGN_BOTTOM=4;var C_ALIGN_CENTER=5;var C_ALIGN_MIDDLE=6;var C_ALIGN_TO_SAME_WIDTH=7;var C_ALIGN_TO_SAME_HEIGHT=8;var C_ALIGN_DIST_VER=9;var C_ALIGN_DIST_HOR=10;var C_STAT_CREATING_0=0;var C_STAT_CREATING_1=1;var C_STAT_CREATING_2=2;var C_STAT_NORMAL=3;var C_SHAPE_TEXT_NONE=0;var C_SHAPE_TEXT_INPUT=1;var C_SHAPE_TEXT_TEXTAREA=2;function Shape(){this.textTitle="Text";return}Shape.prototype.canBindingData=function(){return false};Shape.prototype.afterCreated=function(a){return true};Shape.prototype.findNear=function(a){return null};Shape.prototype.getCreatingShape=function(){return this.view?this.view.getCreatingShape():null};Shape.prototype.getTextCookie=function(a){return 0};Shape.prototype.isFillColorTransparent=function(){return !this.style.fillColor||this.style.fillColor==="rgba(0,0,0,0)"};Shape.prototype.isStrokeColorTransparent=function(){return !this.style.lineColor||this.style.lineColor==="rgba(0,0,0,0)"};Shape.prototype.setParent=function(a){this.parentShape=a;return};Shape.prototype.getParent=function(b){if(b){for(var a=this.parentShape;a!=null;a=a.parentShape){if(a.name===b){return a}}}return b?null:this.parentShape};Shape.prototype.textEditable=function(a){return true};Shape.prototype.setInputType=function(a){this.inputType=a;return};Shape.prototype.editText=function(o){if(this.textType&&this.textEditable(o)){var b=this.getPositionInView();var f=this.getRealScale();var d=this.view.rect.x;var c=this.view.rect.y;var m=b.x*f+d;var n=this.getWidth()*f;var g=this.getHeight()*f;var a=this.getTextCookie(o);var j=this;var i=null;var e=this.inputType?this.inputType:"text";if(this.textType===C_SHAPE_TEXT_INPUT){var l=b.y*f+g/3+c;if(n<60){n=60}i=wtkShowInput(m,l,n,18);i.setInputType(e)}else{var l=b.y*f+c;if(g<60){g=60}i=wtkShowTextArea(m,l,n,g)}j.editing=true;i.setText(this.getText(a));i.element.onchange=function(){if(j.text!==this.value){j.exec(new SetTextCommand(j,this.value,a));j.postRedraw()}i.hide();j.editing=false;return}}return};Shape.prototype.exec=function(a){if(this.app){this.app.exec(a)}return};Shape.prototype.setTextTitle=function(a){this.textTitle=a;return};Shape.prototype.initShape=function(a,e,b,d,c){this.w=b;this.h=d;this.x=a;this.y=e;this.type=c;this.text="";this.app=null;this.view=null;this.rotate=0;this.saveDx=0;this.saveDy=0;this.scale=1;this.parentShape=null;this.pointerDown=false;this.selected=false;this.userMovable=true;this.userResizable=true;this.hignlighted=false;this.state=C_STAT_NORMAL;this.hitTestResult=C_HIT_TEST_NONE;this.lastPosition=new Point(0,0);this.selectMarkPoint=new Point(0,0);this.textType=C_SHAPE_TEXT_INPUT;this.setDefaultStyle();return};Shape.prototype.setDefaultStyle=function(){this.style=new ShapeStyle();this.setStyle(DefaultShapeStyleGet());return};Shape.prototype.setState=function(a){this.state=a;return};Shape.prototype.setTextType=function(a){this.textType=a;return};Shape.prototype.isSelected=function(){return this.selected};Shape.prototype.userRemovable=function(){return true};Shape.prototype.intersectWithRect=function(d){var b=false;var f=this.getX();var c=this.getY();var i=this.getWidth();var a=this.getHeight();var l={x:f,y:c};var j={x:f+i,y:c+a};var g={x:f+i,y:c};var e={x:f,y:c+a};return isPointInRect(l,d)||isPointInRect(j,d)||isPointInRect(g,d)||isPointInRect(e,d)};Shape.prototype.isThisInRect=function(e){var c=false;var a=this.getX();var f=this.getY();var b=this.getWidth();var d=this.getHeight();if((a>=e.x&&a<(e.x+e.w))&&(f>=e.y&&f<(e.y+e.h))){c=true}return c};Shape.prototype.snapToGrid=function(a,d){var b=a;var c=d;if(this.view){return this.view.snapToGrid(a,d)}else{return{x:b,y:c}}};Shape.prototype.isClicked=function(){if(this.view){return this.view.isClicked()}return false};Shape.prototype.isAltDown=function(){if(this.view){return this.view.isAltDown()}return false};Shape.prototype.isCtrlDown=function(){if(this.view){return this.view.isCtrlDown()}return false};Shape.prototype.showIconPreview=function(a){return true};Shape.prototype.onMoving=function(){};Shape.prototype.onMoved=function(){};Shape.prototype.onSized=function(){};Shape.prototype.onUserResized=function(){};Shape.prototype.fixChildPosition=function(e){var d=this.w;var c=this.h;var b=e.x>=0?e.x:0;var a=e.y>=0?e.y:0;if((b+e.w)>d){b=d-e.w}if((a+e.h)>c){a=c-e.h}e.x=b;e.y=a;return};Shape.prototype.fixPosition=function(){if(!this.parentShape){return}this.parentShape.fixChildPosition(this);return};Shape.prototype.move=function(b,a){b=Math.floor(b);a=Math.floor(a);if(this.x!=b||this.y!=a){this.x=b;this.y=a;if(!this.isIcon){this.fixPosition();this.onMoved()}this.x=Math.floor(this.x);this.y=Math.floor(this.y)}return};Shape.prototype.moveDelta=function(b,a){this.move(this.x+b,this.y+a);return};Shape.prototype.getWidth=function(){return this.w};Shape.prototype.getHeight=function(){return this.h};Shape.prototype.getPositionInScreen=function(){var a={x:0,y:0};var c=this.getRealScale();var b=this.getPositionInView();if(this.view){a=this.view.getAbsPosition()}b.x=a.x+b.x*c;b.y=a.y+b.y*c;return b};Shape.prototype.getRealScale=function(){return this.view?this.view.xscale:1};Shape.prototype.getAbsPosition=function(){var b=this.getPositionInView();if(this.view){var a=this.view.getAbsPosition();b.x=b.x+a.x;b.y=b.y+a.y}return b};Shape.prototype.getPositionInView=function(){var b=this.getX();var d=this.getY();var a={x:0,y:0};var c=this.parentShape;while(c!=null){b+=c.getX();d+=c.getY();c=c.parentShape}a.x=b;a.y=d;return a};Shape.prototype.getXinView=function(){var a=this.getPositionInView().x;return a};Shape.prototype.getYinView=function(){var a=this.getPositionInView().y;return a};Shape.prototype.getX=function(){return this.x};Shape.prototype.getY=function(){return this.y};Shape.prototype.align=function(a,b){return};Shape.prototype.setRotatable=function(a){this.rotatable=a;return};Shape.prototype.setScale=function(a){this.scale=a;if(a<0.25){this.scale=0.25}if(a>4){this.scale=4}return};Shape.prototype.setRotate=function(a){this.rotate=a%360;return};Shape.prototype.setStyle=function(a){this.style.copy(a);this.textNeedRelayout=true;return};Shape.prototype.getStyle=function(){return this.style};Shape.prototype.setName=function(a){this.name=a;return};Shape.prototype.getName=function(){return this.name};Shape.prototype.getLocaleText=function(a){return a};Shape.prototype.setText=function(b,a){a=a?a:0;b=(b!=null&&b!=undefined)?b+"":"";switch(a){case 2:this.text2=b;break;case 3:this.text3=b;break;default:this.text=b}this.textNeedRelayout=true;return};Shape.prototype.setText2=function(a){this.text2=a;return};Shape.prototype.setText3=function(a){this.text3=a;return};Shape.prototype.getText=function(a){a=a?a:0;switch(a){case 2:return this.text2;case 3:return this.text3;default:break}return this.text};Shape.prototype.setApp=function(a){this.app=a;return};Shape.prototype.setView=function(a){this.view=a;return};Shape.prototype.redrawSelf=function(){if(this.view){var c=this.getRealScale();var b=this.getPositionInView();var a={x:b.x*c,y:b.y*c,w:this.w*c,h:this.h*c};this.view.redraw(a)}return};Shape.prototype.postRedraw=function(a){if(this.view){this.view.postRedraw(a)}return};Shape.prototype.beforePropertyChanged=function(){return};Shape.prototype.afterPropertyChanged=function(){return};Shape.prototype.showProperty=function(){return};Shape.prototype.createSelectedMark=function(c,a,d,b){if(b){c.rect(a-15,d-15,30,30)}else{c.rect(a-10,d-10,20,20)}return};Shape.prototype.isInSelectedMark=function(c,b,d,a){c.beginPath();this.createSelectedMark(c,b,d);return c.isPointInPath(a.x,a.y)};Shape.prototype.paint=function(a){this.paintSelf(a);if(this.near){var c=this.near.point;var b=isMobile()?20:8;a.beginPath();a.arc(c.x,c.y,4,0,Math.PI*2);a.fillStyle="Red";a.fill();a.beginPath();a.lineWidth=2;a.arc(c.x,c.y,b,0,Math.PI*2);a.strokeStyle="Black";a.stroke()}return};Shape.prototype.paintSelf=function(a){return};Shape.prototype.setSelected=function(a){if(this.selected===a){return}this.selected=a;if(this.view){this.view.onShapeSelected(this)}return};Shape.prototype.isVisible=function(){return true};Shape.prototype.findNearPoint=function(c){var d=null;for(var a=0;a<100;a++){d=this.getNearPoint(a);if(!d){break}if(isPointInRect(d,c)){var b={shape:this};b.nearPointIndex=a;b.point={x:d.x,y:d.y};return b}}return null};Shape.prototype.dup=function(){var a=ShapeFactoryGet().createShape(this.type,C_CREATE_FOR_PROGRAM);a.fromJson(this.toJson());a.state=C_STAT_NORMAL;return a};Shape.prototype.hitTest=function(a){return C_HIT_TEST_NONE};Shape.prototype.showProperty=function(){return};Shape.prototype.onDoubleClick=function(a){if(this.textType!=C_SHAPE_TEXT_NONE){this.editText(a)}else{this.showProperty()}return true};Shape.prototype.onPointerDown=function(a){this.pointerDown=true;this.hitTestResult=this.hitTest(a);if(!this.hitTestResult){return false}this.setSelected(true);this.lastPosition.x=a.x;this.lastPosition.y=a.y;this.handlePointerEvent(a,C_EVT_POINTER_DOWN);return true};Shape.prototype.handlePointerEvent=function(a,b){return false};Shape.prototype.onPointerMove=function(a){if(this.hitTestResult){this.handlePointerEvent(a,C_EVT_POINTER_MOVE);return true}return false};Shape.prototype.onPointerUp=function(a){if(this.hitTestResult){this.handlePointerEvent(a,C_EVT_POINTER_UP);this.hitTestResult=C_HIT_TEST_NONE;return true}this.pointerDown=false;return false};Shape.prototype.onKeyDown=function(a){console.log("onKeyUp Widget: code="+a);return};Shape.prototype.onKeyUp=function(a){console.log("onKeyUp Widget: code="+a);return};Shape.prototype.canBeComponent=function(){return false};Shape.prototype.shouldShowContextMenu=function(){return true};Shape.prototype.toJson=function(){return""};Shape.prototype.fromJson=function(a){return this};Shape.prototype.extractFormat=function(){var d=new Object();d.type="";d.name="";for(var a in this){var c=this[a];var b=typeof c;if(b==="function"||b==="object"||b==="undefined"){continue}if(b==="number"||b==="string"||b==="boolean"){d[a]=c}}if(this.images){d.images=this.images}delete d.x;delete d.y;delete d.name;delete d.text;delete d.state;delete d.mode;delete d.selected;delete d.pointerDown;delete d.xAttr;delete d.yAttr;delete d.xParam;delete d.yParam;d.style=this.style.toJson();return d};Shape.prototype.afterApplyFormat=function(){return};Shape.prototype.applyFormat=function(e){if(!e){return}var a=e.type===this.type;for(var b in e){var d=e[b];var c=typeof d;if(c==="function"||c==="object"||c==="undefined"){continue}if(b=="type"){continue}if(!a&&(b==="w"||b==="h")){continue}if(c==="number"||c==="string"||c==="boolean"){if(a||this[b]!=undefined){this[b]=d}}}if(a){if(e.images){for(var b in e.images){var d=e.images[b];if(b==="display"){this.images[b]=d}else{var f=d.getImageSrc();this.setImage(b,f)}}}}if(e.style){this.style.fromJson(e.style)}this.afterApplyFormat();this.textNeedRelayout=true;return};function splitText(a){a=a.replaceAll("\r\n","\n");a=a.replaceAll("\r","\n");return a.split("\n--\n")}function restackShapeInArray(b,e){var h=0;var g=0;var d=null;var a=0;var f=null;for(var c=0;c<b.length;c++){d=b[c];if(d.selected){h++;if(!f){f=d;g=c}}}if(h>1||!f){return}a=g+e;if(a<0||a>=b.length){return}b[g]=b[a];b[a]=f;return}function getParentShapeOfShape(b,a){var c=b.parentShape?b.parentShape:b.container;if(!c){c=a}return c}function getParentShapeOfShapes(b){if(!b||b.length===0){return null}var a=b[0];var d=a.parentShape;for(var e=0;e<b.length;e++){var c=b[e];if(c.parentShape!=d){return null}}return d?d:a.view}function RShape(){return}RShape.prototype=new Shape();RShape.prototype.MIN_SIZE=20;RShape.prototype.isRect=true;RShape.prototype.initRShape=function(a,e,b,d,c){this.initShape(a,e,b,d,c);this.saveWidth=0;this.saveHeight=0;this.image=null;this.imageUrl="";this.rect=new Rect(0,0,b,d);this.lastPosition=new Point(0,0);this.pointerDownPosition=new Point(0,0);this.defWidth=200;this.defHeight=60;this.pointerDown=false;if(b===0||d===0){this.w=this.MIN_SIZE;this.h=this.MIN_SIZE;this.setState(C_STAT_CREATING_0);this.onPointerDown=function(f){this.pointerDownPosition.x=f.x;this.pointerDownPosition.y=f.y;this.postRedraw();if(this.onPointerDownCreating(f)){return true}return this.onPointerDownNormal(f)};this.onPointerMove=function(f){if(this.onPointerMoveCreating(f)){return true}return this.onPointerMoveNormal(f)};this.onPointerUp=function(f){var g=false;if(this.onPointerUpCreating(f)){g=true}else{g=this.onPointerUpNormal(f)}this.pointerDown=false;return g}}return};RShape.prototype.onPointerDownCreating=function(a){if(this.state===C_STAT_CREATING_0){this.state=C_STAT_CREATING_1;this.move(a.x,a.y);this.lastPosition.x=a.x;this.lastPosition.y=a.y;this.postRedraw();this.pointerDown=true;return true}return false};RShape.prototype.onPointerUpCreating=function(a){if(this.state!==C_STAT_NORMAL){var c=a.x-this.lastPosition.x;var b=a.y-this.lastPosition.y;if(this.isClicked()||!this.pointerDown){this.resize(this.defWidth,this.defHeight)}else{this.resizeDelta(c,b)}this.state=C_STAT_NORMAL;this.setSelected(true);this.afterCreated();this.postRedraw()}return false};RShape.prototype.onPointerMoveCreating=function(a){if(this.state===C_STAT_CREATING_0){this.move(a.x,a.y);this.lastPosition.x=a.x;this.lastPosition.y=a.y;this.postRedraw();return true}else{if(this.state===C_STAT_CREATING_1){var b=a.x-this.view.pointerDownPosition.x;var c=a.y-this.view.pointerDownPosition.y;this.resize(b,c);this.lastPosition.x=a.x;this.lastPosition.y=a.y;this.postRedraw();return true}}return false};RShape.prototype.onPointerDownNormal=function(a){this.hitTestResult=this.hitTest(a);if(!this.hitTestResult){return false}this.pointerDown=true;this.setSelected(true);this.lastPosition.x=a.x;this.lastPosition.y=a.y;this.handlePointerEvent(a,1);return true};RShape.prototype.onPointerMoveNormal=function(a){if(this.hitTestResult){this.handlePointerEvent(a,0);return true}return false};RShape.prototype.onPointerUpNormal=function(a){if(this.hitTestResult){this.handlePointerEvent(a,-1);this.hitTestResult=C_HIT_TEST_NONE;return true}return false};RShape.prototype.fixSize=function(){if(this.w<this.MIN_SIZE){this.w=this.MIN_SIZE}if(this.h<this.MIN_SIZE){this.h=this.MIN_SIZE}if(this.wMin&&this.w<this.wMin){this.w=this.wMin}if(this.wMax&&this.w>this.wMax){this.w=this.wMax}if(this.hMax&&this.h>this.hMax){this.h=this.hMax}if(this.hMin&&this.h<this.hMin){this.h=this.hMin}if(this.whRadio){if(this.whRadio>1){this.h=Math.floor(this.w/this.whRadio)}else{this.w=Math.floor(this.h*this.whRadio)}}if(this.parentShape){this.parentShape.fixChildSize(this)}return};RShape.prototype.fixChildSize=function(c){var b=this.w;var a=this.h;if((c.x+c.w)>b){c.w=b-c.x}if((c.y+c.h)>a){c.h=a-c.y}return};RShape.prototype.setDefSize=function(a,b){this.defWidth=a;this.defHeight=b;this.w=a;this.h=b;return};RShape.prototype.setSizeLimit=function(d,e,b,c,a){this.wMin=d;this.wMax=b;this.hMin=e;this.hMax=c;this.whRadio=a;return};RShape.prototype.resizeDelta=function(a,b){this.resize(this.w+a,this.h+b);return};RShape.prototype.setPosition=function(a,b){this.x=a;this.y=b;return};RShape.prototype.setSize=function(a,b){this.w=Math.floor(a);this.h=Math.floor(b);return};RShape.prototype.resize=function(a,b){if(this.w!==a||this.h!==b){this.realResize(a,b)}return};RShape.prototype.realResize=function(a,b){a=Math.floor(a);b=Math.floor(b);if(this.w!=a||this.h!=b){this.w=a;this.h=b;this.textNeedRelayout=true;if(!this.isIcon){this.onSized();this.fixSize()}}return};RShape.prototype.translate=function(b){b.translate(this.x+this.w/2,this.y+this.h/2);if(this.rotate){var a=Math.PI*(this.rotate/180);b.rotate(a)}b.translate(-this.w/2,-this.h/2);return};RShape.prototype.isPointInThis=function(b,a){b.beginPath();b.rect(0,0,this.w,this.h);return b.isPointInPath(a.x,a.y)};RShape.prototype.getMoreSelectMark=function(b,a){return false};RShape.prototype.getNearPoint=function(c){var a=this.getX();var f=this.getY();var b=this.getWidth();var d=this.getHeight();var e={x:0,y:0};switch(c){case 0:e.x=a;e.y=f;break;case 1:e.x=a+b/2;e.y=f;break;case 2:e.x=a+b;e.y=f;break;case 3:e.x=a+b;e.y=f+d/2;break;case 4:e.x=a+b;e.y=f+d;break;case 5:e.x=a+b/2;e.y=f+d;break;case 6:e.x=a;e.y=f+d;break;case 7:e.x=a;e.y=f+d/2;break;case 8:e.x=a+b/2;e.y=f+d/2;break;default:if(b>d){switch(c){case 9:e.x=a+b/4;e.y=f;break;case 10:e.x=a+3*b/4;e.y=f;break;case 11:e.x=a+b/4;e.y=f+d;break;case 12:e.x=a+3*b/4;e.y=f+d;break;default:return null}}else{return null}}return e};RShape.prototype.getSelectMark=function(c,a){var b=true;switch(c){case C_HIT_TEST_TL:a.x=0;a.y=0;break;case C_HIT_TEST_TM:a.x=this.w/2;a.y=0;break;case C_HIT_TEST_TR:a.x=this.w;a.y=0;break;case C_HIT_TEST_ML:a.x=0;a.y=this.h/2;break;case C_HIT_TEST_MR:a.x=this.w;a.y=this.h/2;break;case C_HIT_TEST_BL:a.x=0;a.y=this.h;break;case C_HIT_TEST_BM:a.x=this.w/2;a.y=this.h;break;case C_HIT_TEST_BR:a.x=this.w;a.y=this.h;break;default:b=this.getMoreSelectMark(c,a)}return b};RShape.prototype.drawImage=function(a){return};RShape.prototype.paintShape=function(a){a.rect(0,0,this.w,this.h);return};RShape.prototype.calcTextPosition=function(){var a=this.getHMargin();var b=this.style.textAlignment;this.textY=this.h/2;this.textBaseline="middle";if(b==="left"){this.textX=a;this.textAlign="left"}else{if(b==="right"){this.textX=this.w-a;this.textAlign="right"}else{this.textX=this.w/2;this.textY=this.h/2;this.textAlign="center"}}return};RShape.prototype.fixTextPosition=function(){this.textX=Math.round(this.textX);this.textY=Math.round(this.textY);return};RShape.prototype.setTextNeedRelayout=function(a){this.textNeedRelayout=a;return};RShape.prototype.layoutText=function(b){if(!this.textNeedRelayout||this.textType===C_SHAPE_TEXT_NONE){return}var c=this.vMargin?this.vMargin:10;var a=this.w-2*c;if(a>0){this.lines=layoutText(b,this.style.fontSize,this.getLocaleText(this.text),a)}else{this.lines=[]}this.textNeedRelayout=false;return};RShape.prototype.drawTextUnderLine=function(e,d,b,g){var a=0;var i=0;var f=0;var c=0;if(!this.style.textU){return}c=e.measureText(g).width;if(this.textBaseline==="middle"){f=this.style.fontSize/2;if(this.textAlign==="center"){a=d-c/2}else{if(this.textAlign==="left"){a=d}else{a=d-c}}}else{if(this.textBaseline==="top"){f=this.style.fontSize;if(this.textAlign==="center"){a=d-c/2}else{if(this.textAlign==="left"){a=d}else{a=d-c}}}else{if(this.textAlign==="center"){a=d-c/2}else{if(this.textAlign==="left"){a=d}else{a=d-c}}}}i=b+f;e.moveTo(a,i);e.lineTo(a+c,i);e.lineWidth=1;e.stroke();return};RShape.prototype.needDrawEditTextTips=function(){return true};RShape.prototype.setInputTips=function(a){this.inputTips=a;return};RShape.prototype.drawEditTextTips=function(b){if(this.text||this.isIcon||this.w<150||this.h<40||this.editing){return}var a=this.getWidth()/2;var c=this.getHeight()/2;b.textAlign="center";b.textBaseline="middle";b.font=this.style.getFont();b.fillStyle="#E0E0E0";if(this.inputTips){b.fillText(dappGetText(this.inputTips),a,c,this.getWidth())}else{if(this.needDrawEditTextTips()&&this.selected&&!isMobile()){b.fillText(dappGetText("double click to edit text."),a,c,this.getWidth())}}return};RShape.prototype.getOneLineText=function(c,f){var b="";var a=this.getWidth(true);if(c.measureText(f).width<=a){return f}for(var d=0;d<f.length;d++){var e=f[d];a=a-c.measureText(e).width;if(a<0){break}b=b+e}return b};RShape.prototype.setTextShadow=function(a){this.textShadow=a;return};RShape.prototype.draw1LText=function(b,a){var e=0;var d=this.getLocaleText(this.text);if(d&&!this.editing){b.save();b.beginPath();this.calcTextPosition();this.fixTextPosition();b.textAlign=this.textAlign;b.textBaseline=this.textBaseline;b.font=this.style.getFont();b.fillStyle=this.style.textColor;d=a?d:this.getOneLineText(b,d);this.drawTextUnderLine(b,this.textX,this.textY,d);if(this.textShadow){var c=this.style;b.shadowColor=c.shadow.color;b.shadowOffsetX=c.shadow.x;b.shadowOffsetY=c.shadow.y;b.shadowBlur=c.shadow.blur}b.fillText(d,this.textX,this.textY);if(this.textShadow){b.shadowBlur=0}b.restore();e=b.measureText(d).width}return e};RShape.prototype.setMargin=function(b,a){this.vMargin=b;this.hMargin=a;return};RShape.prototype.getVMargin=function(){return this.vMargin?this.vMargin:0};RShape.prototype.getHMargin=function(){return this.hMargin?this.hMargin:0};RShape.prototype.getWidth=function(a){if(a){return this.w-2*this.getHMargin()}else{return this.w}};RShape.prototype.getHeight=function(a){if(a){return this.h-2*this.getVMargin()}else{return this.h}};RShape.prototype.getLineHeight=function(b){var a=this.style.fontSize;return b?2*a:a};RShape.prototype.getTextHeight=function(){var a=this.getLineHeight(true);if(!this.text||!this.lines){return 0}return this.lines.length*a};RShape.prototype.getTextLineGap=function(){return this.style.fontSize*2};RShape.prototype.drawMLText=function(c,n,f){var m=this.getLocaleText(this.text);if(this.isIcon){c.beginPath();this.calcTextPosition();this.fixTextPosition();c.textAlign=this.textAlign;c.textBaseline=this.textBaseline;c.font=this.style.getFont();c.fillStyle=this.style.textColor;if(this.style.textU){this.drawTextUnderLine(c,this.textX,this.textY,m)}c.fillText(m,this.textX,this.textY,this.w);return}c.textAlign="left";c.textBaseline="top";c.font=this.style.getFont();c.fillStyle=this.style.textColor;this.layoutText(c);if(m&&!this.editing){var j=0;var h=0;var b=this.getWidth(true);var o=this.style.fontSize;var e=this.vMargin?this.vMargin:5;c.beginPath();this.calcTextPosition();this.fixTextPosition();j=this.textX;h=e;c.textAlign=this.textAlign;if(this.textShadow){var a=this.style;c.shadowColor=a.shadow.color;c.shadowOffsetX=a.shadow.x;c.shadowOffsetY=a.shadow.y;c.shadowBlur=a.shadow.blur}var l=this.getTextLineGap();for(var d=0;d<this.lines.length;d++){var g=this.lines[d];if(!n&&!f){if((h+this.style.fontSize)>=this.h&&d>0){break}if((h+this.style.fontSize+10)>=this.h&&d>1){break}}c.fillText(g,j,h,b);h+=l}if(n&&h>50){this.h=h+e}c.shadowBlur=0}return};RShape.prototype.drawText=function(c){var e=this.getLocaleText(this.text);if(e&&!this.editing){c.beginPath();this.calcTextPosition();this.fixTextPosition();c.textAlign=this.textAlign;c.textBaseline=this.textBaseline;c.font=this.style.getFont();c.fillStyle=this.style.textColor;if(c.measureText(e).width<1.2*this.w){this.drawTextUnderLine(c,this.textX,this.textY,e);c.fillText(e,this.textX,this.textY,this.w)}else{this.layoutText(c);var g=this.lines.length;var b=this.style.fontSize;var a=this.textX;var f=Math.round(this.textY-g*b*0.5);if(f<0){f=0}for(var d=0;d<g;d++){var e=this.lines[d];this.drawTextUnderLine(c,a,f,e);c.fillText(e,a,f,this.w);f=f+this.style.fontSize+6;if(f>=this.h){break}}}}return};RShape.prototype.prepareStyle=function(a){var b=this.style;a.lineWidth=b.lineWidth;a.strokeStyle=b.lineColor;if(b.enableGradient){a.fillStyle=b.getGradFillStyle(a,0,0,this.w,this.h)}else{a.fillStyle=b.fillColor}if(b.enableShadow){a.shadowColor=b.shadow.color;a.shadowOffsetX=b.shadow.x;a.shadowOffsetY=b.shadow.y;a.shadowBlur=b.shadow.blur}else{a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0}return};RShape.prototype.resetStyle=function(a){a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.fillStyle="White";a.beginPath();return};RShape.prototype.strokeFill=function(a){if(this.style.enableShadow||isOldIE()){if(a.lineWidth>=1){if(!this.isStrokeColorTransparent()){a.stroke()}}if(!this.isFillColorTransparent()){a.fill()}}else{if(!this.isFillColorTransparent()){a.fill()}if(a.lineWidth>=1){if(!this.isStrokeColorTransparent()){a.stroke()}}}return};RShape.prototype.drawSizeTips=function(a){var b=Math.abs(this.w)+" x "+Math.abs(this.h);a.font="14px serif";a.textAlign="center";a.textBaseline="bottom";a.fillStyle=this.style.textColor;a.beginPath();a.fillText(b,this.w/2,0,this.w);a.fill();return};RShape.prototype.drawSelectMarks=function(a){a.save();a.beginPath();if(this.selected&&!this.hideSelectMark){a.beginPath();a.rect(0,0,this.w,this.h);a.closePath();a.lineWidth=1;a.fillStyle=this.style.fillColor;a.strokeStyle=gSelectMarkColor;a.stroke();a.beginPath();a.lineWidth=1;for(var b=C_HIT_TEST_NONE+1;b<C_HIT_TEST_MAX;b++){if(this.getSelectMark(b,this.selectMarkPoint)){this.createSelectedMark(a,this.selectMarkPoint.x,this.selectMarkPoint.y)}}a.closePath();a.stroke()}a.restore();return};RShape.prototype.paintSelf=function(a){a.save();this.translate(a);a.save();a.beginPath();this.prepareStyle(a);this.paintShape(a);a.closePath();this.strokeFill(a);a.restore();this.resetStyle(a);this.drawImage(a);if(this.drawText&&this.textType!==C_SHAPE_TEXT_NONE){this.drawText(a);this.drawEditTextTips(a)}if(this.hitTestResult!==C_HIT_TEST_NONE||this.state!==C_STAT_NORMAL){this.drawSizeTips(a)}this.drawSelectMarks(a);a.restore();return};RShape.prototype.hitTest=function(a){var c=C_HIT_TEST_NONE;var b=this.view.getCanvas2D();b.save();this.translate(b);if(this.selected){for(var d=C_HIT_TEST_NONE+1;d<C_HIT_TEST_MAX;d++){var e=this.selectMarkPoint;if(this.getSelectMark(d,e)){if(this.isInSelectedMark(b,e.x,e.y,a)){b.restore();return d}}}if(this.isPointInThis(b,a)){c=C_HIT_TEST_MM}}else{if(this.isPointInThis(b,a)){c=C_HIT_TEST_MM}}b.restore();return c};RShape.prototype.exec=function(a){if(this.app&&this.app.cmd_history){this.app.cmd_history.exec(a)}else{a.doit();delete a}return};RShape.prototype.setUserResizable=function(a){this.userResizable=a;return};RShape.prototype.isUserMovable=function(){return this.userMovable};RShape.prototype.isUserResizable=function(){return this.userResizable};RShape.prototype.setUserMovable=function(a){this.userMovable=a;return};RShape.prototype.lockPosition=function(a){this.userMovable=!a;this.isPositionLocked=a;return};RShape.prototype.handlePointerEvent=function(l,g){if(g===C_EVT_POINTER_DOWN){this.saveDx=this.x;this.saveDy=this.y;this.saveWidth=this.w;this.saveHeight=this.h;return}var n=l.x-this.lastPosition.x;var m=l.y-this.lastPosition.y;var b=n;var a=m;var f=0;var e=0;var i=this.w;var c=this.h;switch(this.hitTestResult){case C_HIT_TEST_TL:f=b;e=a;i=this.w-b;c=this.h-a;break;case C_HIT_TEST_TM:e=a;c=this.h-a;break;case C_HIT_TEST_TR:f=0;e=a;i=this.w+b;c=this.h-a;break;case C_HIT_TEST_ML:f=b;i=this.w-b;break;case C_HIT_TEST_MR:i=this.w+b;break;case C_HIT_TEST_BL:f=b;i=this.w-b;c=this.h+a;break;case C_HIT_TEST_BM:c=this.h+a;break;case C_HIT_TEST_BR:i=this.w+b;c=this.h+a;break;case C_HIT_TEST_MM:f=b;e=a;break;default:break}if(g===C_EVT_POINTER_UP){if(this.x!==this.saveDx||this.y!==this.saveDy){var n=this.x;var m=this.y;this.x=this.saveDx;this.y=this.saveDy;if(this.isUserMovable()){this.exec(new MoveResizeCommand(this,n,m))}}if(this.w!==this.saveWidth||this.h!==this.saveHeight){var j=this.w;var d=this.h;this.w=this.saveWidth;this.h=this.saveHeight;if(this.isUserResizable()){this.exec(new MoveResizeCommand(this,null,null,j,d));this.onUserResized()}}this.hitTestResult=C_HIT_TEST_NONE}else{if(f||e){if(this.isUserMovable()){this.setPosition(this.x+f,this.y+e)}this.onMoving()}if(this.w!==i||this.h!==c){if(this.isUserResizable()){this.setSize(i,c)}}}if(this.hitTestResult===C_HIT_TEST_HANDLE){this.moveHandle(n,m)}this.postRedraw();this.lastPosition.x=l.x;this.lastPosition.y=l.y;return true};RShape.prototype.onKeyDown=function(a){return};RShape.prototype.onKeyUp=function(a){return};RShape.prototype.toJsonMore=function(a){return};RShape.prototype.toJson=function(){var d=new Object();d.type="";d.name="";for(var a in this){var c=this[a];var b=typeof c;if(b==="function"||b==="object"||b==="undefined"){continue}if(b==="number"||b==="string"||b==="boolean"){d[a]=c}}delete d.mode;delete d.state;delete d.saveDx;delete d.saveDy;delete d.MIN_SIZE;delete d.selected;delete d.animating;delete d.pointerDown;delete d.saveWidth;delete d.saveHeight;delete d.hignlighted;delete d.textNeedRelayout;delete d.openPending;delete d.pointerDownTime;delete d.hitTestResult;delete d.pointerDownPosition;if(d.rotate==0){delete d.rotate}if(!d.imageUrl){delete d.imageUrl}if(d.offset){d.offset=0}d.x=Math.floor(this.x);d.y=Math.floor(this.y);d.w=Math.floor(this.w);d.h=Math.floor(this.h);d.style=this.style.toJson();if(this.handle){d.handle=this.handle}this.toJsonMore(d);return d};RShape.prototype.fromJsonMore=function(a){return};RShape.prototype.onFromJsonDone=function(){};RShape.prototype.fromJson=function(d){this.isUnpacking=true;for(var a in d){var c=d[a];var b=typeof c;if(b==="function"||b==="object"||b==="undefined"){continue}if(b==="number"||b==="string"||b==="boolean"){this[a]=c}}this.fromJsonMore(d);if(d.style){this.style.fromJson(d.style)}if(d.handle){this.handle=d.handle}if(d.dx!=undefined){this.x=d.dx}if(d.dy!=undefined){this.y=d.dy}this.setText(this.text);this.textNeedRelayout=true;this.state=C_STAT_NORMAL;delete this.isUnpacking;this.onFromJsonDone();return};RShape.prototype.setImage=function(a){if(a===this.imageUrl){return}this.imageUrl=a;this.image=new WtkImage(a);return};RShape.prototype.asIcon=function(){this.resize(36,36);if(!this.isIcon){this.setStyle(getIconShapeStyle())}this.isIcon=true;return};RShape.prototype.showProperty=function(){showGeneralPropertyDialog(this,this.textType,true,false);return};RShape.prototype.getMoveDeltaX=function(){return this.view?this.view.getMoveDeltaX():0};RShape.prototype.getMoveDeltaY=function(){return this.view?this.view.getMoveDeltaY():0};RShape.prototype.getMoveAbsDeltaX=function(){return this.view?this.view.getMoveAbsDeltaX():0};RShape.prototype.getMoveAbsDeltaY=function(){return this.view?this.view.getMoveAbsDeltaY():0};function RShapeInit(e,d){var a=0;var f=0;var b=0;var c=0;e.initRShape(a,f,b,c,d);e.setSize(40,40);e.setText("");return e}var C_CREATE_FOR_USER=0;var C_CREATE_FOR_ICON=1;var C_CREATE_FOR_PROGRAM=2;function ShapeCreator(c,a,b,d){this.type=c;this.icon=b;this.name=a;this.visible=d;this.useCount=0;this.incUseCount=function(){this.useCount++;return};this.isVisibleToUser=function(){return this.visible};this.getID=function(){return this.type};this.getIcon=function(){return this.icon};this.getName=function(){return this.name};this.createIconShape=function(){if(!this.iconShape){this.iconShape=this.createShape(C_CREATE_FOR_ICON)}return this.iconShape};this.createShape=function(e){return null};return}function ShapeFactory(){this.defaultCategory=null;this.creators=new Array();this.categories=new Object();this.categoryNames=new Array();this.diagramTypes=new Array();this.OnCategoryChangeListeners={};this.setOnCategoryChangeListener=function(a,b){this.OnCategoryChangeListeners[a]=b;return};this.setDefaultCategory=function(a){this.defaultCategory=a;console.log("this.setDefaultCategory: defaultCategory="+a);var b=this.OnCategoryChangeListeners[a];if(b){b(a)}return};this.getDiagramTypes=function(){return this.diagramTypes};this.addDiagramType=function(b,a){var c={name:b,defaultCategory:a};this.diagramTypes.push(c);return};this.removeCategoryName=function(a){this.categoryNames.remove(a);return};this.removeShapeCreator=function(a,b){var e=this.find(a);var d=this.categories[b];if(e){this.creators.remove(e);if(d){d.remove(e);if(d.length===0){this.categoryNames.remove(b)}}}return};this.isPlacehodler=function(a){return a==="---"};this.addPlaceholder=function(){this.categoryNames.push("---");return};this.addShapeCreator=function(a,b){this.creators.push(a);if(b){if(!this.defaultCategory){this.setDefaultCategory(b)}if(!this.categories[b]){this.categories[b]=new Array();this.categoryNames.push(b)}else{if(!this.categoryNames.has(b)){this.categoryNames.push(b)}}this.categories[b].push(a)}return};this.getCategoryNames=function(){return this.categoryNames};this.sortDefaultCategoryByUseCount=function(){return;var a=this.categories[this.defaultCategory];if(a&&a.length>30){a.sort(function(d,c){return c.useCount-d.useCount})}return};this.getDefaultCategory=function(){return this.categories[this.defaultCategory]};this.getByCategory=function(a){return this.categories[a]};this.find=function(b){for(var a=0;a<this.creators.length;a++){var d=this.creators[a];if(d.getID()===b){return d}}return null};this.createShape=function(a,b){var d=this.find(a);if(d){d.incUseCount();return d.createShape(b)}else{return null}};return}var gShapeFactory=null;function ShapeFactoryGet(){if(!gShapeFactory){gShapeFactory=new ShapeFactory()}return gShapeFactory}function dappSetDefaultCategory(a){return ShapeFactoryGet().setDefaultCategory(a)}var C_LINE_STYLE_0=(255<<8)|0;var C_LINE_STYLE_1=(2<<8)|4;var C_LINE_STYLE_2=(4<<8)|4;var C_LINE_STYLE_3=(8<<8)|8;var C_LINE_STYLE_4=(10<<8)|10;function ShapeStyle(){this.lineStyle=65280;this.lineWidth=2;this.lineColor="Orange";this.fillColor="White";this.textColor="Blue";this.textAlignment="center";this.fontSize=24;this.fontFamily="serif";this.arrowSize=12;this.firstArrowType=0;this.secondArrowType=0;this.textB=0;this.textI=0;this.textU=0;this.enableShadow=false;this.shadow={x:0,y:0,blur:8,color:"Black"};this.enableGradient=false;this.listener=null;return}ShapeStyle.prototype.getFont=function(){var a="";if(this.textI){a="italic  "}if(this.textB){a=a+"bold "}a=a+this.fontSize+"pt "+this.fontFamily;return a};ShapeStyle.prototype.setListener=function(a){this.listener=a;return};ShapeStyle.prototype.notify=function(){if(this.listener){this.listener.setNewStyle(this)}return};ShapeStyle.prototype.setLineStyle=function(a){this.lineStyle=a;return};ShapeStyle.prototype.setLineWidth=function(a){this.lineWidth=a>0?a:1;return};ShapeStyle.prototype.setLineColor=function(a){this.lineColor=a;return};ShapeStyle.prototype.setFillColor=function(a){if("string"!=typeof a){this.fillColor=a;this.enableGradient=true}else{if(a.length>12&&a.indexOf("rgb")<0){this.fillColor=JSON.parse(a);this.enableGradient=true}else{this.fillColor=a}}return};ShapeStyle.prototype.setTextColor=function(a){this.textColor=a;return};ShapeStyle.prototype.setTextAlignment=function(a){this.textAlignment=a;return};ShapeStyle.prototype.setFontSize=function(a){this.fontSize=a>6?a:6;return};ShapeStyle.prototype.setFontFamily=function(a){this.fontFamily=a?a:"serif";return};ShapeStyle.prototype.setFirstArrowType=function(a){this.firstArrowType=a;return};ShapeStyle.prototype.setSecondArrowType=function(a){this.secondArrowType=a;return};ShapeStyle.prototype.setArrowSize=function(a){this.arrowSize=a;return};ShapeStyle.prototype.setTextB=function(a){this.textB=a;return};ShapeStyle.prototype.setTextU=function(a){this.textU=a;return};ShapeStyle.prototype.setTextI=function(a){this.textI=a;return};ShapeStyle.prototype.setShadow=function(a,b){this.enableShadow=a;this.shadow=b;return};ShapeStyle.prototype.getStrokeStyle=function(a){var b=this.strokeColor;return b};ShapeStyle.prototype.getGradFillStyle=function(c,n,l,p,g){var d=this.fillColor;var b=n;var o=l;var a=n+(d.x1<0?p:d.x1);var m=l+(d.y1<0?g:d.y1);if(isNaN(a)||isNaN(m)||isNaN(b)||isNaN(o)){return this.fillColor}var j=c.createLinearGradient(b,o,a,m);for(var f=0;f<d.data.length;f++){var e=d.data[f];j.addColorStop(e.o,e.c)}return j};ShapeStyle.prototype.copy=function(a){var b=a.toJson();this.fromJson(b);return};ShapeStyle.prototype.toJson=function(){var d=new Object();for(var a in this){var c=this[a];var b=typeof c;if(b==="function"||b==="object"||b==="undefined"){continue}if(b==="number"||b==="string"||b==="boolean"){d[a]=c}}if(this.enableShadow){d.shadow=this.shadow}if(this.enableGradient){d.fillColor=this.fillColor}return d};ShapeStyle.prototype.fromJson=function(d){if(d.ls){this.lineStyle=d.ls;this.lineWidth=d.lw;this.lineColor=d.lc;this.fillColor=d.fc;this.textColor=d.tc;this.fontSize=d.fs;this.fontFamily=(d.fm!=undefined)?d.fm:"serif";this.arrowSize=d.as;this.firstArrowType=d.fat;this.secondArrowType=d.sat;this.textB=d.b;this.textI=d.i;this.textU=d.u;this.textAlignment=d.ta;this.enableShadow=d.es}else{for(var a in d){var c=d[a];var b=typeof c;if(b==="function"||b==="undefined"){continue}this[a]=c}}if(this.enableShadow){this.shadow=d.shadow}if(this.enableGradient){this.setFillColor(this.fillColor)}return};ShapeStyle.prototype.dup=function(){var a=new ShapeStyle();a.copy(this);return a};ShapeStyle.prototype.equalTo=function(c){var b=JSON.stringify(this.toJson());var a=JSON.stringify(c.toJson());return b===a};var gShapeStyle=null;function DefaultShapeStyleGet(){if(gShapeStyle){return gShapeStyle}gShapeStyle=new ShapeStyle();return gShapeStyle}function saveDefaultShapeStyle(){var a=DefaultShapeStyleGet();var b=a.toJson();localStorage.style=JSON.stringify(b);return}function loadDefaultShapeStyle(){var a=false;var b=DefaultShapeStyleGet();if(localStorage.style){var c=JSON.parse(localStorage.style);b.fromJson(c);a=true}return a}var gIconShapeStyle=null;function getIconShapeStyle(){if(!gIconShapeStyle){gIconShapeStyle=new ShapeStyle();gIconShapeStyle.setLineWidth(1);gIconShapeStyle.setFontSize(8);gIconShapeStyle.setLineColor("Black");gIconShapeStyle.setFillColor("White");gIconShapeStyle.setTextColor("Black")}return gIconShapeStyle}function UIElement(){return}UIElement.prototype=new RShape();UIElement.prototype.isUIElement=true;UIElement.prototype.hasChildren=true;UIElement.prototype.isContainer=true;UIElement.prototype.setFreePosition=function(a){this.freePosition=a;return};UIElement.prototype.fixChildPosition=function(g){var a=g.x;var f=g.y;var e=g.h;if(g.freePosition){return}if(g.widthAttr===C_WIDTH_FILL_PARENT){a=this.getHMargin()}if(g.heightAttr===C_HEIGHT_FILL_PARENT){if(this.children.length===2&&!g.isUIWindow&&g.widthAttr===C_WIDTH_FILL_PARENT){var d=null;var b=this.getHeight(true);for(var c=0;c<this.children.length;c++){if(this.children[c]!=g){d=this.children[c];break}}if(d.alwaysOnTop){f=this.getVMargin()}else{if(d.y<=(this.vMargin+20)){f=d.y+d.h;e=b-f}else{e=d.y;f=this.vMargin}}}else{f=this.getVMargin()}}g.x=a;g.y=f;g.h=e;return};UIElement.prototype.setFreeSize=function(a){this.freeSize=a;return};UIElement.prototype.fixChildSize=function(b){if(b.freeSize){return}if(this.autoAdjustHeight){if((b.y+b.h)>this.h){this.h=b.y+b.h+this.vMargin}}var g=b.x;var i=b.w;var f=b.y;var c=b.h;var e=this.getWidth(true);var d=this.getHeight(true);var j=e+this.hMargin;var a=d+this.vMargin;if((g+i)>j&&b.widthAttr!=C_WIDTH_FILL_PARENT&&b.xAttr!=C_X_AFTER_PREV&&b.widthAttr!=C_WIDTH_FILL_AVAILABLE&&this.mode===C_MODE_EDITING){g=j-i;if(g<0){g=0}i=j-g}if((f+c)>a&&b.heightAttr!=C_HEIGHT_FILL_PARENT&&b.yAttr!=C_Y_AFTER_PREV&&b.heightAttr!=C_HEIGHT_FILL_AVAILABLE&&this.mode===C_MODE_EDITING){f=a-c;if(f<0){f=0}c=a-f}if(g<0){g=0}if(f<0){f=0}b.x=g;b.y=f;b.w=i<=e?i:e;b.h=c<=d?c:d;return};UIElement.prototype.onInit=function(){if(this.offset){this.offset=0}if(this.mode!==C_MODE_EDITING){if(this.dataSourceUrl&&this.dataSourceUrl.length>5){this.bindDataUrl(this.dataSourceUrl)}this.callOnInit()}return};UIElement.prototype.onDeinit=function(){return};UIElement.prototype.init=function(){var c=0;var a=null;var b=this.children;var d=this.children.length;this.onInit();for(c=0;c<d;c++){a=b[c];a.init()}return};UIElement.prototype.deinit=function(){var c=0;var a=null;var b=this.children;var d=this.children.length;for(c=0;c<d;c++){a=b[c];a.deinit()}this.onDeinit();return};UIElement.prototype.onModeChanged=function(){return};UIElement.prototype.userRemovable=function(){return this.mode===C_MODE_EDITING};UIElement.prototype.postRedraw=function(){if(this.view){if(this.mode===C_MODE_RUNNING){var a={};var b=this.getPositionInView();a.x=b.x;a.y=b.y;a.w=this.w;a.h=this.h;this.view.postRedraw(a)}else{this.view.postRedrawAll()}}return};UIElement.prototype.setMode=function(c,a){this.mode=c;if(this.type!=="ui-menu-bar"){if(c===C_MODE_EDITING){this.setVisible(true)}}if(a){for(var b=0;b<this.children.length;b++){var d=this.children[b];if(d.isContainer){d.setMode(c,true)}}}this.onModeChanged();return};UIElement.prototype.calcChildrenRange=function(){return this.calcShapesRange(this.children)};UIElement.prototype.calcShapesRange=function(c){var o=0;var m=0;var p=0;var g=0;var a=0;var n=0;var q=10000;var d=10000;var f={};if(c.length>0){for(var e=0;e<c.length;e++){var j=c[e];o=j.getX();m=j.getY();p=j.getWidth();g=j.getHeight();if(o<d){d=o}if(m<q){q=m}if((o+p)>a){a=o+p}if((m+g)>n){n=m+g}}f.l=d;f.r=a;f.t=q;f.b=n}else{f.l=0;f.r=0;f.t=0;f.b=0}return f};UIElement.prototype.relayoutChildren=function(){};UIElement.prototype.onSized=function(){this.updateLayoutParams();this.relayout();return};UIElement.prototype.findSelectedShapes=function(a){for(var b=0;b<this.children.length;b++){var c=this.children[b];if(c.selected){a.push(c);continue}if(c.isContainer){c.findSelectedShapes(a)}}return};UIElement.prototype.setSelected=function(b){if(!b){for(var a=0;a<this.children.length;a++){var c=this.children[a];c.setSelected(false)}}if(this.selected===b){return}this.targetShape=null;this.selected=b;if(this.view){this.view.onShapeSelected(this)}return};UIElement.prototype.setTarget=function(a){for(var b=0;b<this.children.length;b++){var c=this.children[b];if(c!=a){c.setSelected(false)}}this.targetShape=a;this.selected=!a;return};UIElement.prototype.initContainerShape=function(a){this.children=new Array();this.toJsoners=new Array();this.fromJsoners=new Array();RShapeInit(this,a);this.mode=C_MODE_EDITING;this.rectSelectable=true;return this};UIElement.prototype.defaultDispatchPointerDownToChildren=function(b){for(var a=this.children.length;a>0;a--){var c=this.children[a-1];if(c.visible&&c.onPointerDown(b)){this.setTarget(c);return true}}return false};UIElement.prototype.dispatchPointerDownToChildren=function(a){return this.defaultDispatchPointerDownToChildren(a)};UIElement.prototype.callPointerDownHandler=function(point){if(!this.enable){return false}if(!this.handlePointerDown||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onPointerDown;if(sourceCode){sourceCode="this.handlePointerDown = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handlePointerDown){try{this.handlePointerDown(point)}catch(e){console.log("this.handlePointerDown:"+e.message)}}return true};UIElement.prototype.onPointerDownEditing=function(a,b){return};UIElement.prototype.onPointerDownRunning=function(a,b){if(!b){return}return this.callPointerDownHandler(a)};UIElement.prototype.callPointerMoveHandler=function(point){if(!this.enable){return false}if(!this.handlePointerMove||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onPointerMove;if(sourceCode){sourceCode="this.handlePointerMove = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handlePointerMove){try{this.handlePointerMove(point)}catch(e){console.log("this.handlePointerMove:"+e.message)}}return true};UIElement.prototype.onPointerMoveEditing=function(a,b){return};UIElement.prototype.onPointerMoveRunning=function(a,b){if(!b){return}return this.callPointerMoveHandler(a)};UIElement.prototype.callPointerUpHandler=function(point){if(!this.enable){return false}if(!this.handlePointerUp||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onPointerUp;if(sourceCode){sourceCode="this.handlePointerUp = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handlePointerUp){try{this.handlePointerUp(point)}catch(e){console.log("this.handlePointerUp:"+e.message)}}return true};UIElement.prototype.onPointerUpEditing=function(a,b){return};UIElement.prototype.onPointerUpRunning=function(a,b){if(!b){return}return this.callPointerUpHandler(a)};UIElement.prototype.callDoubleClickHandler=function(point){if(this.mode===C_MODE_EDITING){if(this.textType!=C_SHAPE_TEXT_NONE){this.editText(point)}else{this.showProperty()}return true}if(!this.enable){return false}if(!this.handleDoubleClick||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onDoubleClick;if(sourceCode){sourceCode="this.handleDoubleClick = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDoubleClick){try{this.handleDoubleClick(point)}catch(e){console.log("this.handleDoubleClick:"+e.message)}}return true};UIElement.prototype.callTimerHandler=function(){var win=this.getWindow();if(win&&!win.visible){return true}if(this.mode===C_MODE_EDITING){return true}if(!this.enable){return false}if(!this.handleTimer||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onTimer;if(sourceCode){sourceCode="this.handleTimer = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleTimer){try{this.handleTimer()}catch(e){console.log("this.handleTimer:"+e.message)}}return true};UIElement.prototype.callPaintHandler=function(canvas2dCtx){if(this.mode===C_MODE_EDITING){return true}if(!this.enable){return false}if(!this.handlePaint||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onPaint;if(sourceCode){sourceCode="this.handlePaint = function(canvas2dCtx) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handlePaint){try{this.handlePaint(canvas2dCtx)}catch(e){console.log("this.handlePaint:"+e.message)}}return true};UIElement.prototype.onDoubleClick=function(a,b){return this.callDoubleClickHandler(a)};UIElement.prototype.callClickHandler=function(point,onChild){if(!this.enable){return false}if(this.mode===C_MODE_EDITING){return false}if(!this.handleClick||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onClick;if(sourceCode){sourceCode="this.handleClick = function(point) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(!this.children.length){console.log("clicked: "+this.type+"("+this.name+")")}if(this.handleClick){try{this.handleClick(point)}catch(e){console.log("this.handleClick:"+e.message)}}return};UIElement.prototype.onClick=function(a,b){if(b){return}return this.callClickHandler(a,b)};UIElement.prototype.translatePoint=function(a){var b={x:(a.x-this.x),y:(a.y-this.y)};return b};UIElement.prototype.setCanRectSelectable=function(d,a){this.rectSelectable=d;for(var b=0;b<this.children.length;b++){var c=this.children[b];c.setCanRectSelectable(d,a)}return};UIElement.prototype.canRectSelectable=function(){return this.rectSelectable&&this.parentShape};UIElement.prototype.setDraggable=function(a){if(this.draggable===a){return}this.draggable=a;if(a){this.addEventNames(["onDragStart","onDragging","onDragEnd"])}else{this.removeEventNames(["onDragStart","onDragging","onDragEnd"])}return};UIElement.prototype.callOnDragStartHandler=function(){if(!this.enable){return false}if(this.mode===C_MODE_EDITING){return false}if(!this.handleDragStart||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onDragStart;if(sourceCode){sourceCode="this.handleDragStart = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDragStart){try{this.handleDragStart()}catch(e){console.log("this.handleDragStart:"+e.message)}}return};UIElement.prototype.callOnDragEndHandler=function(){if(!this.enable){return false}if(this.mode===C_MODE_EDITING){return false}if(!this.handleDragEnd||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onDragEnd;if(sourceCode){sourceCode="this.handleDragEnd = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDragEnd){try{this.handleDragEnd()}catch(e){console.log("this.handleDragEnd:"+e.message)}}return};UIElement.prototype.callOnDragingHandler=function(){if(!this.enable){return false}if(this.mode===C_MODE_EDITING){return false}if(!this.handleDraging||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onDragging;if(sourceCode){sourceCode="this.handleDraging = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleDraging){try{this.handleDraging()}catch(e){console.log("this.handleDraging:"+e.message)}}return};UIElement.prototype.onDragStart=function(){console.log("Drag Start");this.callOnDragStartHandler();return};UIElement.prototype.onDragging=function(){console.log("Dragging");this.callOnDragingHandler();return};UIElement.prototype.onDragEnd=function(){console.log("Drag End");this.callOnDragEndHandler();return};UIElement.prototype.dragMove=function(c,b,a){this.x=this.x+c;this.y=this.y+b;this.onDragging(a);return};UIElement.prototype.handleDragMove=function(a){var c=this.getMoveDeltaX();var b=this.getMoveDeltaY();if(!this.dragging){var e=this.getMoveAbsDeltaX();var d=this.getMoveAbsDeltaY();if(Math.abs(e)>5||Math.abs(d)>5){this.dragging=true;this.onDragStart();c=e;b=d}}if(this.dragging){this.dragMove(c,b,a);if(this.parentShape){this.parentShape.onChildDragging(this,a)}}return};UIElement.prototype.onChildDragging=function(b,a){return};UIElement.prototype.onChildDragged=function(b,a){this.sortChildren();this.relayoutChildren("default");return};UIElement.prototype.handleDragUp=function(a){this.onDragEnd();delete this.dragging;if(this.parentShape){this.parentShape.onChildDragged(this,a)}return};UIElement.prototype.animMove=function(l,j,f){if((this.x===l&&this.y===j)||this.dragging){return}var c=this;var e=1000;var i=this.x;var m=this.y;var a=l-this.x;var d=j-this.y;var b=(new Date()).getTime();var h=new DecelerateInterpolator();function g(){var o=new Date();var n=(o.getTime()-b)/e;var p=h.get(n);if(c.dragging){return}if(n<1&&!c.pointerDown){c.x=Math.floor(i+p*a);c.y=Math.floor(m+p*d);setTimeout(g,10)}else{c.move(l,j);delete b;delete h}delete o;c.postRedraw()}setTimeout(function(){g()},5);return};UIElement.prototype.animate=function(z){if(this.animating||this.dragging||!z){return}var b=this;var a=isNaN(z.duration)?1000:z.duration;var g=isNaN(z.xStart)?this.x:z.xStart;var l=isNaN(z.yStart)?this.y:z.yStart;var c=isNaN(z.wStart)?this.w:z.wStart;var d=isNaN(z.hStart)?this.h:z.hStart;var j=isNaN(z.xEnd)?this.x:z.xEnd;var o=isNaN(z.yEnd)?this.y:z.yEnd;var e=isNaN(z.wEnd)?this.w:z.wEnd;var B=isNaN(z.hEnd)?this.h:z.hEnd;var t=isNaN(z.opacityStart)?this.opacity:z.opacityStart;var h=isNaN(z.opacityEnd)?this.opacity:z.opacityEnd;var u=isNaN(z.rotationStart)?0:z.rotationStart;var f=isNaN(z.rotationEnd)?0:z.rotationEnd;var i=z.onDone;var r=j-g;var v=o-l;var m=e-c;var p=B-d;var A=h-t;var C=f-u;var q=(new Date()).getTime();var s=z.interpolator?z.interpolator:new DecelerateInterpolator();function n(){var E=new Date();var D=(E.getTime()-q)/a;var F=s.get(D);if(b.dragging){return}if(D<1&&!b.pointerDown){if(r){b.x=Math.floor(g+F*r)}if(v){b.y=Math.floor(l+F*v)}if(m){b.w=Math.floor(c+F*m)}if(p){b.h=Math.floor(d+F*p)}if(A){b.opacity=t+F*A}if(C){b.rotation=u+F*C}setTimeout(n,10)}else{if(r||v){b.move(j,o)}if(m||p){b.w=e;b.h=B}if(A){b.opacity=h}if(C){b.rotation=f}if(i){i(b)}delete q;delete s}delete E;b.postRedraw()}var w=z.delay;if(w){setTimeout(function(){n()},w)}else{n()}return};UIElement.prototype.onPointerDownNormal=function(a){var c=new Date();var d=this.translatePoint(a);this.hitTestResult=this.hitTest(a);if(!this.hitTestResult){return false}this.pointerDown=true;this.pointerDownTime=c.getTime();this.childrenRange=this.calcChildrenRange();if(this.mode===C_MODE_EDITING){this.onPointerDownEditing(a,true)}else{this.onPointerDownRunning(d,true)}if(this.hitTestResult===C_HIT_TEST_MM||!this.selected){if(this.dispatchPointerDownToChildren(d)){if(this.mode===C_MODE_EDITING){this.onPointerDownEditing(a,false)}else{this.onPointerDownRunning(d,false)}this.lastPosition.x=a.x;this.lastPosition.y=a.y;return true}}if(this.hitTestResult===C_HIT_TEST_MM&&this.children.length>1&&this.canRectSelectable()){this.hitTestResult=C_HIT_TEST_WORKAREA}this.setTarget(null);this.setSelected(true);this.lastPosition.x=a.x;this.lastPosition.y=a.y;if(this.mode===C_MODE_EDITING){this.handlePointerEvent(a,1)}if(this.mode===C_MODE_EDITING){this.onPointerDownEditing(a,false)}else{this.onPointerDownRunning(d,false)}var b=this.view;if(this.isUIScrollView){setTimeout(function(){b.postRedraw()},20)}else{b.postRedraw()}return true};UIElement.prototype.onPointerMoveNormal=function(m){if(this.draggable){if(this.mode!==C_MODE_EDITING){this.handleDragMove(m);return}else{delete this.dragging}}if(this.hitTestResult){var b=this.translatePoint(m);if(this.mode===C_MODE_EDITING){this.onPointerMoveEditing(m,true)}else{this.onPointerMoveRunning(b,true)}if(this.targetShape){this.targetShape.onPointerMove(b);if(this.mode===C_MODE_EDITING){this.onPointerMoveEditing(m,false)}else{this.onPointerMoveRunning(b,false)}}else{if(this.mode===C_MODE_EDITING){this.onPointerMoveEditing(m,false);if(this.hitTestResult===C_HIT_TEST_WORKAREA){var b={x:0,y:0};var e=this.childrenRange;var l=m.x-this.pointerDownPosition.x;var d=m.y-this.pointerDownPosition.y;var j=this.pointerDownPosition.x-this.x;var g=this.pointerDownPosition.y-this.y;var a={x:j,y:g,w:l,h:d};if(((j>e.r)&&l>0)||((g>e.b)&&d>0)||((j<e.l)&&l<0)||((g<e.t)&&d<0)||((j>(this.w-30))&&l>0)||((g>(this.h-30))&&d>0)||((j<30)&&l<0)||((g<30)&&d<0)){this.hitTestResult=C_HIT_TEST_MM;this.handlePointerEvent(m,0)}else{if(Math.abs(l)>5&&Math.abs(d)>5){a=fixRect(a);this.setSelected(false);for(var c=this.children.length-1;c>=0;c--){var f=this.children[c];b.x=f.x+f.w/2;b.y=f.y+f.h/2;f.setSelected(isPointInRect(b,a))}}}}else{this.handlePointerEvent(m,0)}}else{this.onPointerMoveRunning(b,false)}}this.lastPosition.x=m.x;this.lastPosition.y=m.y;return true}this.lastPosition.x=m.x;this.lastPosition.y=m.y;return false};UIElement.prototype.needDrawEditTextTips=function(a){return this.mode===C_MODE_EDITING&&!this.children.length};UIElement.prototype.textEditable=function(a){return this.mode===C_MODE_EDITING};UIElement.prototype.onPointerUpNormal=function(a){if(this.hitTestResult){var c=this.translatePoint(a);var b=this.isClicked();if(this.mode===C_MODE_EDITING){this.onPointerUpEditing(a,true)}else{this.onPointerUpRunning(c,true)}if(b&&this.enable){this.onClick(c,true)}if(this.targetShape){this.targetShape.onPointerUp(c)}else{if(this.mode===C_MODE_EDITING){this.handlePointerEvent(a,-1)}}if(this.mode===C_MODE_EDITING){this.onPointerUpEditing(a,false)}else{if(this.dragging){this.handleDragUp(a)}else{this.onPointerUpRunning(c,false)}}if(b&&this.enable){this.onClick(c,false)}this.hitTestResult=C_HIT_TEST_NONE;return true}else{this.targetShape=null;if(this.mode!==C_MODE_EDITING){this.onPointerUpRunning(c,false);if(b&&this.enable){this.onClick(c,false)}}}return false};UIElement.prototype.onKeyDownRunning=function(code){if(!this.handleKeyDown||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onKeyDown;if(sourceCode){sourceCode="this.handleKeyDown = function(code) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleKeyDown){try{this.handleKeyDown(code)}catch(e){console.log("this.handleKeyDown:"+e.message)}}return true};UIElement.prototype.onKeyDownEditing=function(a){};UIElement.prototype.onKeyDown=function(a){if(this.targetShape){this.targetShape.onKeyDown(a)}if(this.mode===C_MODE_EDITING){this.onKeyDownEditing(a)}else{this.onKeyDownRunning(a)}return};UIElement.prototype.onKeyUpRunning=function(code){if(!this.handleKeyUp||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onKeyUp;if(sourceCode){sourceCode="this.handleKeyUp = function(code) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleKeyUp){try{this.handleKeyUp(code)}catch(e){console.log("this.handleKeyUp:"+e.message)}}return true};UIElement.prototype.onKeyUpEditing=function(a){};UIElement.prototype.onKeyUp=function(a){if(a===KeyEvent.DOM_VK_BACK&&this.isUIWindow){this.closeWindow(0);return}if(this.targetShape){this.targetShape.onKeyUp(a)}if(this.mode===C_MODE_EDITING){this.onKeyUpEditing(a)}else{this.onKeyUpRunning(a)}return};UIElement.prototype.afterSetView=function(){return true};UIElement.prototype.setView=function(a){this.view=a;for(var b=0;b<this.children.length;b++){var c=this.children[b];c.setView(a)}this.afterSetView(a);return};UIElement.prototype.setApp=function(b){this.app=b;for(var a=0;a<this.children.length;a++){var c=this.children[a];c.setApp(b)}return};UIElement.prototype.shapeCanBeChild=function(a){return true};UIElement.prototype.afterChildAppended=function(a){return true};UIElement.prototype.beforeAddShapeIntoChildren=function(a){return true};UIElement.prototype.addShapeIntoChildren=function(b,e){var d={x:0,y:0,w:0,h:0};for(var c=this.children.length-1;c>=0;c--){var a=this.children[c];if(a===b){continue}if(a.isContainer&&a.visible){d.x=a.getX();d.y=a.getY();d.w=a.w;d.h=a.h;if(isPointInRect(e,d)){return a.addShape(b,true,e)}}}return false};UIElement.prototype.addChildWithJson=function(d,b){var c=d.type?d.type:d.id;var a=ShapeFactoryGet().createShape(c,C_CREATE_FOR_USER);if(a){a.fromJson(d);this.addShape(a,false,null,b)}return};UIElement.prototype.setAlwaysOnTop=function(a){this.alwaysOnTop=a;return};UIElement.prototype.addShape=function(j,a,n,h){if(!j.isUIElement){return false}if(a){j.moveDelta(-this.x,-this.y)}if(this.beforeAddShapeIntoChildren(j)&&n){var b=this.translatePoint(n);if(this.addShapeIntoChildren(j,b)){return true}j.move(b.x,b.y)}if(!this.shapeCanBeChild(j)){return false}if(a){var d={};var e=1;var g=this.getWindow();var c=dupDeviceConfig(this.getDeviceConfig());var m=(g&&g.lcddensity)?g.lcddensity:c.lcdDensity;if(c.lcdDensity!=="xhdpi"&&m!=="xhdpi"){d.version="5";d.platform="iphone";d.lcdDensity="xhdpi";if(m!="all"){c.lcdDensity=m}e=this.getSizeScale(d.lcdDensity,c.lcdDensity);j.notifyDeviceConfigChanged(d,c);j.scaleForDensity(e,c.lcdDensity,true)}}j.setParent(this);j.setView(this.view);j.setApp(this.app);if(isNaN(h)||h<0){this.children.push(j)}else{this.children.insert(h,j)}if(j.isUIElement){j.setMode(this.mode,true)}for(var f=0;f<this.children.length;f++){var l=this.children[f];if(l.alwaysOnTop){this.children.remove(l);this.children.push(l);break}}this.afterChildAppended(j);if(j.isCreatingElement()){this.relayout()}return true};UIElement.prototype.addShapeDirectly=function(a){if(!this.shapeCanBeChild(a)){return false}this.disableRelayout=true;a.disableRelayout=true;a.setParent(this);a.setView(this.view);a.setApp(this.app);this.children.push(a);if(a.isUIElement){a.mode=this.mode}this.afterChildAppended(a);delete a.disableRelayout;delete this.disableRelayout;return true};UIElement.prototype.addChild=function(b,a){return this.addShape(b,false,null,a)};UIElement.prototype.shapeCanBeRemove=function(a){return true};UIElement.prototype.afterChildRemoved=function(a){return true};UIElement.prototype.removeAll=function(){var c=this.children.length;for(var b=0;b<c;b++){var a=this.children[0];this.removeShape(a)}return};UIElement.prototype.removeChild=function(a){return this.removeShape(a)};UIElement.prototype.removeShape=function(a){if(!this.shapeCanBeRemove(a)){return false}if(this.targetShape===a){this.targetShape=null}this.children.remove(a);a.callOnRemoved();this.afterChildRemoved(a);if(a.getParent()===this){a.setParent(null);a.setView(null);a.setApp(null)}if(this.mode===C_MODE_EDITING){this.relayout()}return};UIElement.prototype.afterPropertyChanged=function(){if(this.parentShape){this.parentShape.relayoutChildren()}else{this.relayout()}return};UIElement.prototype.getIndexOfChild=function(a){return this.children.indexOf(a)};UIElement.prototype.findChildByType=function(e,b){var c=0;var d=null;var a=null;var f=this.children.length;for(c=0;c<f;c++){a=this.children[c];if(a.type===e){return a}}if(b){for(c=0;c<f;c++){a=this.children[c];d=a.findChildByType(e,b);if(d){return d}}}return null};UIElement.prototype.findChildByName=function(c,b){var d=0;var e=null;var a=null;var f=this.children.length;for(d=0;d<f;d++){a=this.children[d];if(a.name===c){return a}}if(b){for(d=0;d<f;d++){a=this.children[d];e=a.findChildByName(c,b);if(e){return e}}}return null};UIElement.prototype.setValueOf=function(a,b){var c=this.findChildByName(a,true);return c?c.setValue(b):null};UIElement.prototype.getValueOf=function(a){var b=this.findChildByName(a,true);return b?b.getValue():null};UIElement.prototype.getSelectMark=function(c,a){if(this.mode!=C_MODE_EDITING){return false}var b=true;switch(c){case C_HIT_TEST_TL:a.x=0;a.y=0;break;case C_HIT_TEST_TR:a.x=this.w;a.y=0;break;case C_HIT_TEST_BL:a.x=0;a.y=this.h;break;case C_HIT_TEST_BR:a.x=this.w;a.y=this.h;break;default:b=this.getMoreSelectMark(c,a)}return b};UIElement.prototype.paintSelectingBox=function(c){if(this.hitTestResult===C_HIT_TEST_WORKAREA){var b=this.lastPosition.x-this.pointerDownPosition.x;var d=this.lastPosition.y-this.pointerDownPosition.y;if(Math.abs(b)>10&&Math.abs(d)>10){var a=this.pointerDownPosition.x-this.x;var e=this.pointerDownPosition.y-this.y;c.rect(a,e,b,d);c.strokeStyle="Gray";c.stroke()}}return true};UIElement.prototype.beforePaintChild=function(b,a){return};UIElement.prototype.afterPaintChild=function(b,a){return};UIElement.prototype.defaultPaintChildren=function(b){b.save();b.beginPath();var a=null;var e=this.children.length;var d=null;for(var c=0;c<e;c++){a=this.children[c];if(a.visible){if(a.pointerDown&&(a.selected&&this.mode===C_MODE_EDITING)||a.dragging){d=a}else{this.beforePaintChild(a,b);a.paintSelf(b);this.afterPaintChild(a,b)}}}if(d){a=d;this.beforePaintChild(a,b);a.paintSelf(b);this.afterPaintChild(a,b)}b.restore();return};UIElement.prototype.beforePaintChildren=function(a){return};UIElement.prototype.afterPaintChildren=function(a){return};UIElement.prototype.paintChildren=function(a){this.defaultPaintChildren(a);return};UIElement.prototype.paintSelfOnly=function(a){return};UIElement.prototype.drawImage=function(a){this.drawBgImage(a);this.drawFgImage(a);return};UIElement.prototype.drawFgImage=function(a){return};UIElement.prototype.getBgImage=function(){var a=null;if(this.enable){if(this.pointerDown&&!this.isClicked()){a=this.images.normal_bg}else{if(this.pointerDown){a=this.images.active_bg}else{if(this.selected){a=this.images.focused_bg}else{a=this.images.normal_bg}}}}else{a=this.images.disable_bg}if(!a||!a.getImage()){a=this.images.default_bg}if(!a||!a.getImage()){return}a=a.getImage();return a};UIElement.prototype.drawImageAt=function(b,d,g,o,m,a,j,r){if(!d){return}var i=r?r.w:d.width;var f=r?r.h:d.height;if(i<=0||f<=0){return}var n=r?r.x:0;var l=r?r.y:0;var s=0;var q=0;var p=i;var e=f;switch(g){case C_IMAGE_DISPLAY_CENTER:s=Math.floor(o+(a-i)/2);q=Math.floor(m+(j-f)/2);b.drawImage(d,n,l,p,e,s,q,p,e);break;case C_IMAGE_DISPLAY_SCALE:s=o;q=m;b.drawImage(d,n,l,i,f,s,q,a,j);break;case C_IMAGE_DISPLAY_TILE:s=o;q=m;while(q<this.h){s=o;e=Math.min(this.h-q,f);while(s<this.w){p=Math.min(this.w-s,i);b.drawImage(d,n,l,p,e,s,q,p,e);s=s+p;if(p===i){s=s-2}}q=q+e;if(e===f){q=q-2}}break;case C_IMAGE_DISPLAY_9PATCH:s=o;q=m;if(i>=a&&f>=j){b.drawImage(d,n,l,i,f,s,q,a,j)}else{drawNinePatchEx(b,d,n,l,i,f,s,q,a,j)}break;case C_IMAGE_DISPLAY_AUTO:var c=Math.min(a/i,j/f);p=i*c;e=f*c;s=Math.floor(o+(a-p)*0.5);q=Math.floor(m+(j-e)*0.5);b.drawImage(d,n,l,i,f,s,q,p,e);break;default:s=o;q=m;p=Math.min(i,this.w);e=Math.min(f,this.h);b.drawImage(d,n,l,p,e,s,q,p,e);break}return};UIElement.prototype.drawBgImage=function(a){var b=this.getBgImage();this.drawImageAt(a,b,this.images.display,0,0,this.w,this.h);return};UIElement.prototype.beforeDrawIcon=function(a){return false};UIElement.prototype.afterDrawIcon=function(a){return false};UIElement.prototype.getLockImage=function(){if(!this.aLockImage){this.aLockImage=new WtkImage("/drawapp8/images/lock.png")}if(this.aLockImage){return this.aLockImage.getImage()}return null};UIElement.prototype.prepareStyle=function(a){var b=this.style;a.lineWidth=b.lineWidth;a.strokeStyle=b.lineColor;if(b.enableGradient){a.fillStyle=b.getGradFillStyle(a,0,0,this.w,this.h)}else{if(!this.isFillColorTransparent()){a.fillStyle=b.fillColor}}a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;return};UIElement.prototype.resetStyle=function(a){a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.fillStyle="White";a.beginPath();return};UIElement.prototype.paintSelf=function(a){a.save();this.translate(a);a.globalAlpha=this.opacity;if(this.isIcon){this.beforeDrawIcon(a)}a.save();this.prepareStyle(a);this.paintSelfOnly(a);this.drawImage(a);if(this.drawText&&this.textType!==C_SHAPE_TEXT_NONE){this.drawText(a);this.drawEditTextTips(a)}if((this.hitTestResult!==C_HIT_TEST_NONE&&this.hitTestResult!==C_HIT_TEST_WORKAREA&&this.hitTestResult!==C_HIT_TEST_MM)||this.state!==C_STAT_NORMAL){this.drawSizeTips(a)}this.resetStyle(a);a.restore();a.save();this.beforePaintChildren(a);this.paintChildren(a);this.afterPaintChildren(a);a.restore();if(this.mode===C_MODE_EDITING){this.paintSelectingBox(a);this.drawSelectMarks(a)}if(this.isIcon){this.afterDrawIcon(a)}if(this.selected&&this.mode===C_MODE_EDITING){if(this.isPositionLocked){var b=this.getLockImage();if(b){a.drawImage(b,0,0)}}a.font="16pt Sans";a.textBaseline="bottom";a.textAlign="left";a.fillStyle="#202020";var d=10;if((this.parentShape&&this.parentShape.isUIWindow&&this.y<10)||this.h>400){d=24}var c=dappGetText(this.type);if(this.isUIScrollView){c=c+"(offset="+Math.floor(this.offset)+")"}a.fillText(c,0,d)}a.restore();return};UIElement.prototype.regSerializer=function(b,a){this.toJsoners.push(b);this.fromJsoners.push(a);return};UIElement.prototype.toJsonMore=function(c){if(!this.parentShape){this.setMode(C_MODE_EDITING,true)}for(var b=0;b<this.toJsoners.length;b++){var d=this.toJsoners[b];if(d){d.call(this,c)}}if(this.children.length>0){c.children=new Array();for(var b=0;b<this.children.length;b++){var a=this.children[b];c.children.push(a.toJson())}}return c};UIElement.prototype.childrenFromJson=function(e){if(e.children){this.children.clear();for(var b=0;b<e.children.length;b++){var d=e.children[b];var c=d.type?d.type:d.id;var a=ShapeFactoryGet().createShape(c,C_CREATE_FOR_USER);if(a){this.addShapeDirectly(a);a.fromJson(d)}}}return};UIElement.prototype.fromJsonMore=function(b){for(var a=0;a<this.fromJsoners.length;a++){var c=this.fromJsoners[a];if(c){c.call(this,b)}}this.childrenFromJson(b);this.targetShape=null;this.selected=false;return this};UIElement.prototype.afterApplyFormat=function(){if(this.parentShape){this.parentShape.relayoutChildren()}else{this.relayout()}return};UIElement.prototype.findShapeByPoint=function(a,b){var d=this.translatePoint(a);for(var c=this.children.length;c>0;c--){var e=this.children[c-1];if(e.visible&&e.hitTest(d)){return e.findShapeByPoint(d,b)}}return this};UIElement.prototype.getChildren=function(){return this.children};UIElement.prototype.canBindingData=function(){return(!this.isUIDevice&&!this.isUIScreen&&!this.isUIWindowManager&&this.children.length>0)};UIElement.prototype.onDataBindingTemplate=function(a){if(this.isUIImage){var b=this.getImageByType(C_SHAPE_IMAGE_ALL);var c=b?b.getImageSrc():"";c=c.replace(/http:\/\/www.drawapp8.net/,"");c=c.replace(/http:\/\/www.drawapp8.com/,"");a.image=c}else{if(this.value!==undefined){a.value=this.value}}if(this.text||this.isUILabel){a.text=this.text}return a};UIElement.prototype.getDataBindingTemplate=function(){var c=0;var a=null;var d={};var b=this.children;var e=this.children.length;this.onDataBindingTemplate(d);if(e>0){d.children=[];for(c=0;c<e;c++){a=b[c];if(!this.childIsBuiltin(a)){d.children.push(a.getDataBindingTemplate())}}}return d};UIElement.prototype.setUserData=function(a){this.userData=a;return};UIElement.prototype.getUserData=function(){return this.userData};UIElement.prototype.onBindData=function(b){var d=b.text;var c=b.image;var a=b.value;if(d!==undefined){this.setText(d)}if(c!==undefined){this.setImage(C_SHAPE_IMAGE_ALL,c)}if(a!==undefined){this.value=a}if(b.textColor){this.style.setTextColor(b.textColor)}if(b.fillColor){this.style.setFillColor(b.fillColor)}if(b.lineColor){this.style.setLineColor(b.lineColor)}if(b.fontSize){this.style.setFontSize(b.fontSize)}this.setUserData(b.userData);if(b.height){this.h=b.height}if(this.offset){this.offset=0}return};UIElement.prototype.moveMustBeLastItemToLast=function(){var d=null;var c=this.children;var e=this.children.length;for(var b=0;b<e;b++){var a=c[b];if(a.name==="ui-last"){d=a;c[b]=c[e-1];c[e-1]=d;break}}return};UIElement.prototype.childIsBuiltin=function(a){return false};UIElement.prototype.getTemplateChildJson=function(){if(!this.templateChildJson){var a=this.getTemplateChild();this.templateChildJson=a?a.toJson():null;delete this.templateChildJson.isTemplate}return this.templateChildJson};UIElement.prototype.getTemplateChild=function(){if(!this.templateChild){for(var b=0;b<this.children.length;b++){var a=this.children[b];if(a.isTemplate){this.children.remove(a);this.templateChild=a;break}}if(!this.templateChild){this.templateChild=this.getLastUserChild()}}return this.templateChild};UIElement.prototype.dupTemplateChild=function(){var a=this.getTemplateChild().dup();delete a.isTemplate;return a};UIElement.prototype.getLastUserChild=function(){var c=this.children;var d=this.children.length;if(d>0){for(var b=d-1;b>=0;b--){var a=c[b];if(!this.childIsBuiltin(a)){return a}}}return null};UIElement.prototype.countUserChildren=function(){var d=0;var c=this.children;var e=this.children.length;for(var b=0;b<e;b++){var a=this.children[b];if(!this.childIsBuiltin(a)){d=d+1}}return d};UIElement.prototype.bindData=function(c,b,d){var a=this;a.disableRelayout=true;a.doBindData(c,d);delete a.disableRelayout;a.relayoutChildren(b);console.log("bindData: done");setTimeout(function(){a.postRedraw()},500);return};UIElement.prototype.doBindData=function(e,h){var f=0;var d=0;var j=null;var l=(this.isUIList||this.isUIGrid)?this.getTemplateChildJson():null;this.onBindData(e);var a=this.children;var b=this.countUserChildren();if((b<1&&!l)||!e.children){return}var c=e.children.length;if((this.isUIList||this.isUIGrid)){if(c>b){l.y=0;for(f=b;f<c;f++){this.addChildWithJson(l)}}else{if(c<b&&h){var g=[];d=b-c;for(f=(this.children.length-1);f>=0;f--){var j=this.children[f];if(!this.childIsBuiltin(j)&&!j.isTemplate){g.push(j)}}for(var f=0;f<g.length;f++){var j=g[f];if(f===d){break}this.children.remove(j);j.setParent(null);j.setApp(null);j.setView(null)}}}b=this.children.length}else{b=this.children.length}for(f=0,d=0;d<b&f<c;d++){j=a[d];if(!this.childIsBuiltin(j)){j.doBindData(e.children[f]);f=f+1}}return};UIElement.prototype.bindDataUrl=function(e,b,d){var c={};var a=this;c.method="GET";c.url=e;c.noCache=true;c.onDone=function(f,m,g){var l=(m.status===200);if(m.status===200){var h=g;if(b){h=b(g)}try{var j=JSON.parse(h);a.bindData(j,"default",true);console.log("bindDataUrl: done")}catch(i){l=false;console.log("bindDataUrl: failed"+i.message)}}if(d){d(l)}return};httpDoRequest(c);return};var C_IMAGE_DISPLAY_CENTER=0;var C_IMAGE_DISPLAY_TILE=1;var C_IMAGE_DISPLAY_9PATCH=2;var C_IMAGE_DISPLAY_SCALE=3;var C_IMAGE_DISPLAY_AUTO=4;var C_IMAGE_DISPLAY_DEFAULT=5;var C_IMAGE_DISPLAY_NAMES=["incenter","tile","9patch","scale","auto","default"];var C_X_FIX_LEFT=0;var C_X_FIX_RIGHT=1;var C_X_SCALE=2;var C_X_CENTER_IN_PARENT=3;var C_X_LEFT_IN_PARENT=4;var C_X_RIGHT_IN_PARENT=5;var C_X_AFTER_PREV=6;var C_X_LAYOUT_NAMES=["fix_left","fix_right","scale","center_in_parent","left_in_parent","right_in_parent","after_prev"];var C_Y_FIX_TOP=0;var C_Y_FIX_BOTTOM=1;var C_Y_SCALE=2;var C_Y_MIDDLE_IN_PARENT=3;var C_Y_TOP_IN_PARENT=4;var C_Y_BOTTOM_IN_PARENT=5;var C_Y_AFTER_PREV=6;var C_Y_LAYOUT_NAMES=["fix_top","fix_bottom","scale","middle_in_parent","top_in_parent","bottom_in_parent","after_prev"];var C_WIDTH_FIX=0;var C_WIDTH_SCALE=1;var C_WIDTH_FILL_PARENT=2;var C_WIDTH_FILL_AVAILABLE=3;var C_HEIGHT_FIX=0;var C_HEIGHT_SCALE=1;var C_HEIGHT_FILL_PARENT=2;var C_HEIGHT_FILL_AVAILABLE=3;var C_SIZE_LAYOUT_NAMES=["fix","scale","fill_parent","fill_avaible"];var C_SHAPE_IMAGE_ALL="default_bg";var C_SHAPE_IMAGE_MASK="mask_fg";var C_SHAPE_IMAGE_NORMAL="normal_bg";var C_SHAPE_IMAGE_FOCUSED="focused_bg";var C_SHAPE_IMAGE_ACTIVE="active_bg";var C_SHAPE_IMAGE_DISABLE="disable_bg";var C_SHAPE_IMAGE_NORMAL_FG="normal_fg";var C_SHAPE_IMAGE_ACTIVE_FG="active_fg";var C_SHAPE_IMAGE_ON_FG="on_fg";var C_SHAPE_IMAGE_OFF_FG="off_fg";var C_SHAPE_IMAGE_CHECKED_FG="checked_fg";var C_SHAPE_IMAGE_UNCHECK_FG="uncheck_fg";var C_SHAPE_IMAGE_ON_FOCUSED="focused_on_bg";var C_SHAPE_IMAGE_ON_ACTIVE="active_on_bg";var C_SHAPE_IMAGE_OFF_FOCUSED="focused_off_bg";var C_SHAPE_IMAGE_OFF_ACTIVE="active_off_bg";var C_SHAPE_IMAGE_IMAGE="image";var C_SHAPE_IMAGE_NORMAL_DRAG="normal_drag";var C_SHAPE_IMAGE_DELETE_ITEM="delete_item";var C_SHAPE_ITEM_BG_NORMAL="item_bg_normal";var C_SHAPE_ITEM_BG_ACTIVE="item_bg_active";var C_SHAPE_ITEM_BG_CURRENT_NORMAL="item_bg_current_normal";var C_SHAPE_ITEM_BG_CURRENT_ACTIVE="item_bg_current_active";var C_TEXT_ALIGN_CENTER=0;var C_TEXT_ALIGN_LEFT=0;var C_TEXT_ALIGN_RIGHT=0;var C_TEXT_ALIGN_NAMES=["center","left","right"];function UIElementCreator(b){b=b?b:"ui-element";var a=[b,"UI-Element",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UIElement();return c.initUIElement(this.type)};return}UIElement.prototype.sortChildren=function(){return};UIElement.prototype.shouldShowContextMenu=function(){return this.mode===C_MODE_EDITING};UIElement.prototype.getValue=function(){return this.getText()};UIElement.prototype.setValue=function(a){this.setText(a);return};UIElement.prototype.getPositionInView=function(){var b=this.getX();var d=this.getY();var a={x:0,y:0};var c=this.parentShape;while(c!=null){b+=c.getX();d+=c.getY();if(c.isUIVScrollView){d=d-c.offset}else{if(c.isUIHScrollView){b=b-c.offset}}c=c.parentShape}a.x=b;a.y=d;return a};UIElement.prototype.getLocaleText=function(b){var a=webappGetText(b);if(!a){return b}if(!this.locale){this.locale={text:a};this.needRelayout=true}return a};UIElement.prototype.asIcon=function(){var b=0;var c=0;var a=dappGetShapeIconSize();this.isIcon=true;if(this.defWidth>a||this.defHeight>a){var d=this.defWidth/this.defHeight;if(d<1){b=d*a;c=a}else{b=a;c=a/d}}else{b=this.defWidth;c=this.defHeight}this.resize(b,c);return};UIElement.prototype.setImage=function(a,c){var b=this.images[a];if(b){b.setImageSrc(c)}else{b=new WtkImage(c)}this.images[a]=b;return};UIElement.prototype.getHtmlImageByType=function(a){var b=this.images[a];return b?b.getImage():null};UIElement.prototype.getImageByType=function(a){return this.images[a]};UIElement.prototype.getImageSrcByType=function(a){var b=this.images[a];return b?b.getImageSrc():""};UIElement.prototype.getImageTypes=function(){var c=[];for(var a in this.images){var b=this.images[a];if(a!="display"){c.push(a)}}return c};UIElement.prototype.addEventNames=function(c){if(c){for(var b=0;b<c.length;b++){var a=c[b];this.events[a]=null}}return};UIElement.prototype.removeEventNames=function(c){if(c){for(var b=0;b<c.length;b++){var a=c[b];delete this.events[a]}}return};UIElement.prototype.getEventNames=function(){var b=[];for(var a in this.events){b.push(a)}return b};UIElement.prototype.initUIElement=function(a){this.initContainerShape(a);this.enable=true;this.visible=true;this.opacity=1;this.vMargin=0;this.hMargin=0;this.xAttr=C_X_FIX_LEFT;this.yAttr=C_Y_FIX_TOP;this.widthAttr=C_WIDTH_FIX;this.heightAttr=C_HEIGHT_FIX;this.name=a;this.events={};this.images={};this.images.display=C_IMAGE_DISPLAY_9PATCH;this.addEventNames(["onClick"]);this.regSerializer(this.elementToJson,this.elementFromJson);return this};UIElement.prototype.updateLayoutParams=function(){this.xParam=1;this.yParam=1;this.widthParam=1;this.heightParam=1;var b=this.parentShape;if(!b){return}var c=b.getWidth(true);var a=b.getHeight(true);if(this.xAttr===C_X_SCALE){this.xParam=this.x/c}else{if(this.xAttr===C_X_FIX_RIGHT){this.xParam=c-(this.x+this.w)}}if(this.yAttr===C_Y_SCALE){this.yParam=this.y/a}else{if(this.yAttr===C_Y_FIX_BOTTOM){this.yParam=a-(this.y+this.h)}}if(this.widthAttr===C_WIDTH_SCALE){this.widthParam=this.w/c}if(this.heightAttr===C_HEIGHT_SCALE){this.heightParam=this.h/a}return};UIElement.prototype.elementToJson=function(d){this.updateLayoutParams();d.xAttr=this.xAttr;d.yAttr=this.yAttr;d.widthAttr=this.widthAttr;d.heightAttr=this.heightAttr;d.vMargin=this.vMargin;d.hMargin=this.hMargin;d.xParam=this.xParam;d.yParam=this.yParam;d.widthParam=this.widthParam;d.heightParam=this.heightParam;d.events=this.events;d.images={};d.enable=this.enable;d.opacity=this.opacity;if(this.value!=undefined){d.value=this.value}for(var a in this.images){var b=this.images[a];if(a==="display"){d.images[a]=b}else{var c=b.getImageSrc();c=c.replace(/http:\/\/www.drawapp8.net/,"");c=c.replace(/http:\/\/www.drawapp8.com/,"");if(c){d.images[a]=c}}}return d};UIElement.prototype.elementFromJson=function(c){if(c.events){for(var a in c.events){this.events[a]=c.events[a]}}for(var a in this.images){var b=this.images[a];if(a!=="display"){this.setImage(a,null)}}if(c.images){for(var a in c.images){var b=c.images[a];if(a==="display"){this.images[a]=b}else{this.setImage(a,b)}}}if(c.enable!=undefined){this.setEnable(c.enable)}if(c.opacity!=undefined){this.setOpacity(c.opacity)}return this};UIElement.prototype.setEnable=function(a){this.enable=a;return};UIElement.prototype.setOpacity=function(a){this.opacity=Math.max(0,a);this.opacity=Math.min(1,this.opacity);return};UIElement.prototype.calcTextPosition=function(){var a=this.getHMargin();var b=this.style.textAlignment;this.textY=this.h/2;this.textBaseline="middle";if(b==="left"){this.textX=a;this.textAlign="left"}else{if(b==="right"){this.textX=this.w-a;this.textAlign="right"}else{this.textX=this.w/2;this.textY=this.h/2;this.textAlign="center"}}return};UIElement.prototype.setVisible=function(a){this.visible=a;return};UIElement.prototype.isVisible=function(){var a=this;while(a!=null){if(!a.visible){return false}a=a.parentShape}return true};UIElement.prototype.hide=function(){this.visible=false;return};UIElement.prototype.onShowHTML=function(){return};UIElement.prototype.onHideHTML=function(){return};UIElement.prototype.showHTML=function(){var a=0;var c=this.children.length;for(a=0;a<c;a++){var b=this.children[a];b.showHTML()}this.onShowHTML();return};UIElement.prototype.hideHTML=function(){var a=0;var c=this.children.length;for(a=0;a<c;a++){var b=this.children[a];b.hideHTML()}this.onHideHTML();return};UIElement.prototype.show=function(){this.setVisible(true);return};UIElement.prototype.hide=function(){this.setVisible(false);return};UIElement.prototype.showEventDialog=function(){showUIPropertyDialog(this,this.textType,null,3);return};UIElement.prototype.showProperty=function(){showUIPropertyDialog(this,this.textType);return};UIElement.prototype.beforeRelayout=function(){};UIElement.prototype.afterRelayout=function(){};UIElement.prototype.getPrevSibling=function(){if(!this.parentShape||this.parentShape.children.length<2){return null}var a=0;for(a=0;a<this.parentShape.children.length;a++){if(this.parentShape.children[a]===this){break}}return a>0?this.parentShape.children[a-1]:null};UIElement.prototype.setAutoScaleFontSize=function(a){this.enableAutoScaleFontSize=a;return};UIElement.prototype.autoScaleFontSize=function(b){if(this.enableAutoScaleFontSize){var a=Math.round(this.style.fontSize*b);a=Math.min(a,36);a=Math.max(a,12);this.style.setFontSize(a)}return};UIElement.prototype.relayout=function(){if(this.disableRelayout){return}var b=getParentShapeOfShape(this);if(!b||!b.isUIElement){if(this.mode===C_MODE_EDITING){this.setUserMovable(true);this.setUserResizable(true)}}if(this.isUIDevice){this.setUserResizable(false)}if(!b){this.relayoutChildren();return}var q=0;var e=0;var o=0;var m=0;var j=b.getWidth(true);var f=b.getHeight(true);var a=this.y+this.h;var r=this.x+this.w;this.beforeRelayout();switch(this.widthAttr){case C_WIDTH_SCALE:q=j*this.widthParam;if(this.widthScaleMin&&q<this.widthScaleMin){if(this.pointerDown){this.widthScaleMin=q}else{q=this.widthScaleMin}}if(this.widthScaleMax&&q>this.widthScaleMax){if(this.pointerDown){this.widthScaleMax=q}else{q=this.widthScaleMax}}break;case C_WIDTH_FILL_PARENT:q=j;break;case C_WIDTH_FILL_AVAILABLE:break;default:q=this.w;break}switch(this.heightAttr){case C_HEIGHT_SCALE:e=f*this.heightParam;if(this.heightScaleMin&&e<this.heightScaleMin){if(this.pointerDown){this.heightScaleMin=e}else{e=this.heightScaleMin}}if(this.heightScaleMax&&e>this.heightScaleMax){if(this.pointerDown){this.heightScaleMax=e}else{e=this.heightScaleMax}}break;case C_HEIGHT_FILL_PARENT:e=f;break;case C_HEIGHT_FILL_AVAILABLE:break;default:e=this.h;break}switch(this.xAttr){case C_X_SCALE:o=j*this.xParam;break;case C_X_FIX_RIGHT:o=j-this.xParam-this.w;break;case C_X_CENTER_IN_PARENT:o=(j-q)/2;break;case C_X_LEFT_IN_PARENT:o=0;break;case C_X_RIGHT_IN_PARENT:o=j-q;break;case C_X_AFTER_PREV:var c=this.getPrevSibling();o=c?(c.x+c.w):0;break;default:o=this.x;break}switch(this.yAttr){case C_Y_SCALE:m=f*this.yParam;break;case C_Y_FIX_BOTTOM:m=f-this.yParam-this.h;break;case C_Y_MIDDLE_IN_PARENT:m=(f-e)/2;break;case C_Y_TOP_IN_PARENT:m=0;break;case C_Y_BOTTOM_IN_PARENT:m=f-e;break;case C_Y_AFTER_PREV:var c=this.getPrevSibling();m=c?(c.y+c.h):0;break;default:m=this.y;break}if(this.widthAttr===C_WIDTH_FILL_AVAILABLE||this.heightAttr===C_HEIGHT_FILL_AVAILABLE){var g=null;var n=null;this.x=o;this.y=m;for(var d=0;d<b.children.length;d++){var l=b.children[d];if(l.y>(this.y+30)&&this.x<(l.x+l.w)&&l.x<r){if(!g||l.y<g.y){g=l}}if(l.x>(this.x+30)&&this.y<(l.y+l.h)&&l.y<a){if(!n||l.x<n.x){n=l}}}if(this.widthAttr===C_WIDTH_FILL_AVAILABLE){if(n){q=n.x-o}else{q=j-o-b.hMargin}if(q<=0){q=this.w}}if(this.heightAttr===C_HEIGHT_FILL_AVAILABLE){if(g){e=g.y-m}else{e=f-m-b.vMargin}if(e<=0){e=this.h}}}var s=this.w;this.x=o;this.y=m;this.w=q;this.h=e;if(b.isUIElement){b.fixChildSize(this);b.fixChildPosition(this)}this.autoScaleFontSize(q/s);this.relayoutChildren();this.afterRelayout();this.setTextNeedRelayout(true);return};UIElement.prototype.getCustomProp=function(){return""};UIElement.prototype.loadCustomProp=function(a){return};UIElement.prototype.onMoved=function(){if(!this.parentShape||this.mode!=C_MODE_EDITING){return}if(this.fixedX!=null&&!isNaN(this.fixedX)){this.x=this.fixedX}if(this.fixedY!=null&&!isNaN(this.fixedY)){this.y=this.fixedY}this.updateLayoutParams();this.relayout();return};UIElement.prototype.setFixPosition=function(a,b){this.fixedX=a;this.fixedY=b;return};UIElement.prototype.beforeRelayoutChild=function(a){return true};UIElement.prototype.afterRelayoutChild=function(a){return true};UIElement.prototype.relayoutChildren=function(){if(this.disableRelayout){return}for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.widthAttr===C_WIDTH_FILL_AVAILABLE||b.heightAttr===C_HEIGHT_FILL_AVAILABLE){continue}if(this.beforeRelayoutChild(b)){b.relayout()}this.afterRelayoutChild(b)}for(var a=0;a<this.children.length;a++){var b=this.children[a];if(!(b.widthAttr===C_WIDTH_FILL_AVAILABLE||b.heightAttr===C_HEIGHT_FILL_AVAILABLE)){continue}if(this.beforeRelayoutChild(b)){b.relayout()}this.afterRelayoutChild(b)}return};UIElement.prototype.getWindowManager=function(){var a=this;while(a!=null&&!a.isUIWindowManager){a=a.parentShape}return a};UIElement.prototype.windowIsCurrent=function(){var c=this.getWindow();var b=this.getWindowManager();if(c&&b){var a=b.getCurrentWindow();return c===a}return false};UIElement.prototype.getDevice=function(){var a=this;while(a!=null&&!a.isUIDevice){a=a.parentShape}return a};UIElement.prototype.getDeviceConfig=function(){var a=this.getWindowManager();if(a){return a.getDeviceConfig()}return null};UIElement.prototype.isOnTopWindow=function(){var c=this.getWindow();var a=this.getWindowManager();var b=a.getCurrentFrame();if(c===b||c===b.popupWindow){return true}return false};UIElement.prototype.getWindow=function(){var a=this;while(a!=null&&!a.isUIWindow){a=a.parentShape}return a};UIElement.prototype.getPositionInWindow=function(){var b=this;var a=b.x;var c=b.y;while(b!=null&&!b.isUIWindow){b=b.parentShape;if(b.isUIWindow){break}a=a+b.x;c=c+b.y}return{x:a,y:c}};UIElement.prototype.getWindowNames=function(){var a=this.getWindowManager();if(a){return a.getWindowNames()}return[]};UIElement.prototype.openWindow=function(c,b,e,a){var d=this.getWindowManager();if(d){return d.openWindow(c,b,e,a)}return false};UIElement.prototype.closeWindow=function(a){var c=this.getWindow();var b=this.getWindowManager();if(b&&c){if(b.isWindowOpen(c)){return b.closeCurrentWindow(a)}else{console.log("Current Window Is Not Open.")}}return false};UIElement.prototype.canBeComponent=function(){return true};UIElement.prototype.makeItComponent=function(){showMakeItComponentDialog(this);return};UIElement.prototype.showBindingDataDialog=function(){showBindingDataDialog(this);return};UIElement.prototype.isCreatingElement=function(){if(this.view&&this.view.creatingShape===this){return true}return false};UIElement.prototype.onScaleForDensityDone=function(a,b){};UIElement.prototype.scaleForDensity=function(a,f,e){if(!a||a===1){return}if(this.widthAttr===C_WIDTH_FIX||this.widthAttr===C_WIDTH_SCALE){this.w=Math.floor(this.w*a)}if(this.heightAttr===C_HEIGHT_FIX||this.heightAttr===C_HEIGHT_SCALE){this.h=this.h*a;if(this.h<36&&(this.isUIButton||this.isUIProgressBar||this.isUIColorTile||this.isUIColorButton||this.isUIEdit||this.isUIRadioBox||this.isUICheckBox||this.isUIWaitBar||this.isUISwitch)){this.h=40}if(this.h<50&&(this.isUIToolBar||this.isUIButtonGroup)){this.h=50}if(this.hMin>this.h){this.hMin=this.h}}var c=this.isCreatingElement();if(this.yAttr===C_Y_SCALE||this.yAttr===C_Y_FIX_TOP){if(!c){this.y=Math.floor(this.y*a)}}if(this.xAttr===C_X_SCALE||this.xAttr===C_X_FIX_LEFT){if(!c){this.x=Math.floor(this.x*a)}}this.style.setFontSize(Math.floor(this.style.fontSize*a));if(this.itemHeight>40){this.itemHeight=Math.floor(this.itemHeight*a)}if(this.buttonHeight>40){this.buttonHeight=Math.floor(this.buttonHeight*a)}this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.w=Math.floor(this.w);this.h=Math.floor(this.h);if(e){for(var d=0;d<this.children.length;d++){var b=this.children[d];b.scaleForDensity(a,f,true)}}if(this.isUIProgressBar){var g=this.getValue();this.setValue(0);this.setValue(g)}this.onScaleForDensityDone(a,f);return};UIElement.prototype.onDeviceConfigChanged=function(a,b){return};UIElement.prototype.fixImagePath=function(c,d){var f=c.version;var e=c.platform;var j=c.lcdDensity;var g=d.version;var b=d.platform;var l=d.lcdDensity;for(var i in this.images){var h=this.images[i];if(i==="display"){continue}var a=h.getImageSrc();if(a){a=a.replaceAll("/"+f+"/","/"+g+"/");a=a.replaceAll("/"+e+"/","/"+b+"/");a=a.replaceAll("/"+j+"/","/"+l+"/");h.setImageSrc(a)}}return};UIElement.prototype.getDensitySizeScale=function(a){switch(a){case"ldpi":return 80;case"mdpi":return 160;case"hdpi":return 240;case"xhdpi":return 350}return 160};UIElement.prototype.getSizeScale=function(b,e){var d=this.getDensitySizeScale(b);var c=this.getDensitySizeScale(e);var a=c/d;return a};UIElement.prototype.notifyDeviceConfigChanged=function(a,c){for(var b=0;b<this.children.length;b++){var d=this.children[b];d.notifyDeviceConfigChanged(a,c)}this.fixImagePath(a,c);this.onDeviceConfigChanged(a,c);return};UIElement.prototype.callOnScrollDone=function(){if(!this.enable){return false}if(!this.handleOnScrollDone||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onScrollDone;if(sourceCode){sourceCode="this.handleOnScrollDone = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnScrollDone){try{this.handleOnScrollDone()}catch(e){console.log("this.handleOnScrollDone:"+e.message)}}return true};UIElement.prototype.callOnRemoved=function(){if(!this.enable){return false}if(!this.handleOnRemoved||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onRemoved;if(sourceCode){sourceCode="this.handleOnRemoved = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnRemoved){try{this.handleOnRemoved()}catch(e){console.log("this.handleOnRemoved:"+e.message)}}return true};UIElement.prototype.callOnChildDragging=function(sourceChildIndex,targetChildIndex){if(!this.enable){return false}if(!this.handleOnChildDragging||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onChildDragging;if(sourceCode){sourceCode="this.handleOnChildDragging = function(sourceChildIndex, targetChildIndex) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChildDragging){try{this.handleOnChildDragging(sourceChildIndex,targetChildIndex)}catch(e){console.log("this.handleOnChildDragging:"+e.message)}}return true};UIElement.prototype.callOnChildDragged=function(sourceChildIndex,targetChildIndex){if(!this.enable){return false}if(!this.handleOnChildDragged||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onChildDragged;if(sourceCode){sourceCode="this.handleOnChildDragged = function(sourceChildIndex, targetChildIndex) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChildDragged){try{this.handleOnChildDragged(sourceChildIndex,targetChildIndex)}catch(e){console.log("this.handleOnChildDragged:"+e.message)}}return true};UIElement.prototype.callOnChanging=function(value){if(!this.enable){return false}if(!this.handleOnChanging||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onChanging;if(sourceCode){sourceCode="this.handleOnChanging = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChanging){try{this.handleOnChanging(value)}catch(e){console.log("this.handleOnChanging:"+e.message)}}return true};UIElement.prototype.callOnChanged=function(value){if(!this.enable){return false}if(!this.handleOnChanged||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onChanged;if(sourceCode){sourceCode="this.handleOnChanged = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChanged){try{this.handleOnChanged(value)}catch(e){console.log("this.handleOnChanged:"+e.message)}}return true};UIElement.prototype.callOnInit=function(){if(!this.handleOnInit||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onInit;if(sourceCode){sourceCode="this.handleOnInit = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnInit){try{this.handleOnInit()}catch(e){console.log("this.handleOnInit:"+e.message)}}return true};UIElement.prototype.callOnChanging=function(value){if(!this.enable){return false}if(!this.handleOnChanging||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onChanging;if(sourceCode){sourceCode="this.handleOnChanging = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnChanging){try{this.handleOnChanging(value)}catch(e){console.log("this.handleOnChanging:"+e.message)}}return true};UIElement.prototype.callOnFocusIn=function(){if(!this.handleOnFocusIn||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onFocusIn;if(sourceCode){sourceCode="this.handleOnFocusIn = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnFocusIn){try{this.handleOnFocusIn()}catch(e){console.log("this.handleOnFocusIn:"+e.message)}}return true};UIElement.prototype.callOnFocusOut=function(){if(!this.handleOnFocusOut||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onFocusOut;if(sourceCode){sourceCode="this.handleOnFocusOut = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnFocusOut){try{this.handleOnFocusOut()}catch(e){console.log("this.handleOnFocusOut:"+e.message)}}return true};UIElement.prototype.addMovementForVelocityTracker=function(){if(this.velocityTracker){var c={};c.x=this.getMoveAbsDeltaX();c.y=this.getMoveAbsDeltaY();var b=new Date();var a=b.getTime()*1000000;this.velocityTracker.addMovement(a,c);delete b}return};UIElement.prototype.animShow=function(a){if(!this.visible){animateUIElement(this,a)}return};UIElement.prototype.animHide=function(a){if(this.isVisible()){animateUIElement(this,a)}else{this.setVisible(false)}return};UIElement.prototype.atLeft=function(){this.exec(new PositionSizeAttrCommand(this,C_X_LEFT_IN_PARENT,null,null,null));return};UIElement.prototype.atRight=function(){this.exec(new PositionSizeAttrCommand(this,C_X_RIGHT_IN_PARENT,null,null,null));return};UIElement.prototype.atTop=function(){this.exec(new PositionSizeAttrCommand(this,null,C_Y_TOP_IN_PARENT,null,null));return};UIElement.prototype.atBottom=function(){this.exec(new PositionSizeAttrCommand(this,null,C_Y_BOTTOM_IN_PARENT,null,null));return};UIElement.prototype.atCenter=function(){this.exec(new PositionSizeAttrCommand(this,C_X_CENTER_IN_PARENT,null,null,null));return};UIElement.prototype.atMiddle=function(){this.exec(new PositionSizeAttrCommand(this,null,C_Y_MIDDLE_IN_PARENT,null,null));return};UIElement.prototype.saveState=function(){this.savedState={};this.savedState.json=this.toJson();return};UIElement.prototype.restoreState=function(){if(this.savedState&&this.savedState.json){this.fromJson(this.savedState.json);delete this.savedState.json}return};UIElement.prototype.isUserMovable=function(){if(this.widthAttr==C_WIDTH_FILL_PARENT&&(this.yAttr===C_Y_TOP_IN_PARENT||this.yAttr===C_Y_MIDDLE_IN_PARENT||this.yAttr===C_Y_BOTTOM_IN_PARENT)){return false}if(this.heightAttr===C_HEIGHT_FILL_PARENT&&(this.xAttr===C_X_LEFT_IN_PARENT||this.x===C_X_CENTER_IN_PARENT||this.xAttr===C_X_RIGHT_IN_PARENT)){return false}if(this.widthAttr===C_WIDTH_FILL_PARENT&&this.heightAttr===C_HEIGHT_FILL_PARENT){return false}return this.userMovable};UIElement.prototype.isUserResizable=function(){if(this.widthAttr===C_WIDTH_FILL_PARENT&&this.heightAttr===C_HEIGHT_FILL_PARENT){return false}return this.userResizable};function UIGroup(){return}UIGroup.prototype=new UIElement();UIGroup.prototype.isUIGroup=true;UIGroup.prototype.initUIGroup=function(d,a,c,b){this.initUIElement(d);this.roundRadius=5;this.setDefSize(a,c);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,b);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setCanRectSelectable(false,false);this.addEventNames(["onInit"]);return this};UIGroup.prototype.setRoundRadius=function(a){this.roundRadius=Math.max(0,a);this.roundRadius=Math.min(this.w/2,this.roundRadius);this.roundRadius=Math.min(this.h/2,this.roundRadius);return};UIGroup.prototype.getCustomProp=function(){var a=' 		<label class="description" for="roundradius">'+dappGetText("Round Radius")+':</label>		<input id="roundradius"  class="element text small" type="number" maxlength="2" value="0"/>';return a};UIGroup.prototype.loadCustomProp=function(a){var b=this;a.roundradius.value=this.roundRadius;a.roundradius.onchange=function(c){b.setRoundRadius(parseInt(this.value));return};return};UIGroup.prototype.shapeCanBeChild=function(a){if(a.isUIDevice||a.isUIScreen||a.isUIStatusBar||a.isUIWindow||a.isUIPageManager||a.isUIPage){return false}return true};UIGroup.prototype.onPointerUpEditing=function(a,b){if(!b){this.relayoutChildren()}return};UIGroup.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.beginPath();a.lineWidth=1;a.fillStyle=this.style.fillColor;a.strokeStyle=this.style.lineColor;drawRoundRect(a,this.w,this.h,this.roundRadius);if(!this.isFillColorTransparent()){a.fillStyle=this.style.fillColor;a.fill()}if(!this.isStrokeColorTransparent()){a.stroke()}}return};function UIGroupCreator(a,d,b){var c=["ui-group","ui-group",null,1];ShapeCreator.apply(this,c);this.createShape=function(f){var e=new UIGroup();return e.initUIGroup(this.type,a,d,b)};return}function createUIGroupShape(){var a=new UIGroup();a.initUIGroup("ui-group",200,200,null);a.state=C_STAT_NORMAL;return a}function dupDeviceConfig(a){var b={};b.name=a.name;b.bg=a.bg;b.platform=a.platform;b.version=a.version;b.lcdDensity=a.lcdDensity;b.width=a.width;b.height=a.height;b.screenX=a.screenX;b.screenY=a.screenY;b.screenW=a.screenW;b.screenH=a.screenH;b.hasMenuBar=a.hasMenuBar;return b}function isDeviceConfigEqual(d,c){var b=JSON.stringify(d);var a=JSON.stringify(c);return b===a}function webappPreloadImage(b){var a=new WtkImage(b);return a}function webappLoadUserScripts(){console.log("webappLoadUserScripts");registerViewBeforeLoadListener(function(a,d){var c=d.meta;if(c&&c.extlibs){for(var b=0;b<c.extlibs.length;b++){idrawDelayLoadScript(c.extlibs[b]);console.log("ExLibs: "+c.extlibs[b])}loadDelayScriptsNow()}});registerViewAfterLoadListener(function(a,b){});return}var gTempCanvas=null;function motkGetTempCanvas(b,a){if(!gTempCanvas){gTempCanvas=document.createElement("canvas");gTempCanvas.type="backend_canvas";gTempCanvas.width=b;gTempCanvas.height=a}if(gTempCanvas){if(gTempCanvas.width!=b){gTempCanvas.width=b}if(gTempCanvas.height!=a){gTempCanvas.height=a}}return gTempCanvas}var gApp8LocaleStrings=null;function webappGetText(b){var a=null;if(!b){return""}if(gApp8LocaleStrings){a=gApp8LocaleStrings[b]}if(!a){}return a}function webappSetLocaleStrings(a){gApp8LocaleStrings=a;return}var gDeviceConfigs=[];function dappRegisterDevice(a){gDeviceConfigs.push(dupDeviceConfig(a));return}function idrawGetDeviceConfig(a){for(var b=0;b<gDeviceConfigs.length;b++){var c=gDeviceConfigs[b];if(c.name===a){return dupDeviceConfig(c)}}return null}function idrawGetAllDeviceConfig(){return gDeviceConfigs}function idrawLoadDefaultDeviceConfigs(){var a={name:"firefox-QVGA-Emulator",bg:"/drawapp8/images/devices/device_firefoxos.png",platform:"firefox",version:"4",lcdDensity:"mdpi",width:390,height:754,screenX:34,screenY:138,screenW:320,screenH:480,hasMenuBar:false};var c={name:"android-WVGA800",bg:"/drawapp8/images/devices/device_800x480.png",platform:"android",version:"4",lcdDensity:"hdpi",width:600,height:1126,screenX:60,screenY:198,screenW:480,screenH:800,hasMenuBar:true};var m={name:"android-WXGA720",bg:"/drawapp8/images/devices/device_1280x720.png",platform:"android",version:"4",lcdDensity:"xhdpi",width:860,height:1802,screenX:74,screenY:268,screenW:720,screenH:1280,hasMenuBar:true};var l={name:"android-WXGA800",bg:"/drawapp8/images/devices/device.png",platform:"android",version:"4",lcdDensity:"mdpi",width:1400,height:964,screenX:60,screenY:82,screenW:1280,screenH:800,hasMenuBar:true};var b={name:"android-WSVGA",bg:"/drawapp8/images/devices/device.png",platform:"android",version:"4",lcdDensity:"mdpi",width:1130,height:764,screenX:60,screenY:82,screenW:1024,screenH:600,hasMenuBar:true};var d={name:"iphone4s",bg:"/drawapp8/images/devices/device_iphone4s.png",platform:"iphone",version:"4s",lcdDensity:"xhdpi",width:760,height:1487,screenX:65,screenY:265,screenW:640,screenH:960,hasMenuBar:false};var i={name:"iphone5",bg:"/drawapp8/images/devices/device_iphone5.png",platform:"iphone",version:"5",lcdDensity:"xhdpi",width:765,height:1600,screenX:65,screenY:238,screenW:640,screenH:1136,hasMenuBar:false};var j={name:"BlackBerry Q10",bg:"/drawapp8/images/devices/device_bb_q10.jpg",platform:"blackberry",version:"10",lcdDensity:"xhdpi",width:860,height:1520,screenX:66,screenY:246,screenW:720,screenH:720,hasMenuBar:false};var g={name:"BlackBerry Z10",bg:"/drawapp8/images/devices/device_bb_z10.jpg",platform:"blackberry",version:"10",lcdDensity:"xhdpi",width:920,height:1820,screenX:72,screenY:258,screenW:768,screenH:1280,hasMenuBar:false};var f={name:"Nokia Lumia 800",bg:"/drawapp8/images/devices/device_nokia_lumia_800.jpg",platform:"winphone",version:"8",lcdDensity:"hdpi",width:620,height:1170,screenX:86,screenY:146,screenW:480,screenH:800,hasMenuBar:false};var n={name:"Nokia Lumia 920",bg:"/drawapp8/images/devices/device_nokia_lumia_920.jpg",platform:"winphone",version:"8",lcdDensity:"xhdpi",width:1050,height:1780,screenX:136,screenY:192,screenW:768,screenH:1280,hasMenuBar:false};var e={name:"iPad Mini",bg:"/drawapp8/images/devices/device_ipad_mini.jpg",platform:"iphone",version:"5",lcdDensity:"mdpi",width:876,height:1290,screenX:52,screenY:132,screenW:768,screenH:1024,hasMenuBar:false};var h={name:"iPad 4",bg:"/drawapp8/images/devices/device_ipad_4.jpg",platform:"iphone",version:"5",lcdDensity:"hdpi",width:1942,height:2542,screenX:198,screenY:238,screenW:1536,screenH:2048,hasMenuBar:false};dappRegisterDevice(d);dappRegisterDevice(i);dappRegisterDevice(c);dappRegisterDevice(m);dappRegisterDevice(l);dappRegisterDevice(b);dappRegisterDevice(a);dappRegisterDevice(j);dappRegisterDevice(g);dappRegisterDevice(f);dappRegisterDevice(n);dappRegisterDevice(e);dappRegisterDevice(h);return}idrawLoadDefaultDeviceConfigs();function uiGetImage(d,e,a){var c="/drawapp8/images/theme/default/";var b=c;if(e){b=b+e+"/"}if(a){b=b+a+"/"}b=b+d;return b}function UIDevice(){return}UIDevice.PORTRAIT=0;UIDevice.LANDSCAPE=1;UIDevice.prototype=new UIElement();UIDevice.prototype.isUIDevice=true;UIDevice.prototype.deviceToJson=function(a){a.config=this.config;return};UIDevice.prototype.deviceFromJson=function(a){if(a.config){this.config=dupDeviceConfig(a.config)}return};UIDevice.prototype.resize=function(a,b){if(this.state===C_STAT_NORMAL){this.realResize(a,b)}return};UIDevice.prototype.getDirection=function(){return(this.h>this.w)?UIDevice.PORTRAIT:UIDevice.LANDSCAPE};UIDevice.prototype.setDirection=function(g){var d=this.getDirection();if(g===d){return}var m=JSON.stringify(this.toJson());var i=this.w;var e=this.h;var j=(e-i)/2;this.x=this.x-j;this.y=this.y+j;var b=0;var a=0;var c=this.config.screenW;var l=this.config.screenH;if(d===UIDevice.PORTRAIT){this.y=100;b=this.config.screenY;a=i-(this.config.screenX+this.config.screenW)}else{this.y=0;a=this.config.screenX;b=e-(this.config.screenY+this.config.screenH)}this.w=e;this.h=i;this.config.screenX=b;this.config.screenY=a;this.config.screenW=l;this.config.screenH=c;var f=JSON.stringify(this.toJson());this.exec(new PropertyCommand(this,m,f));return};UIDevice.prototype.setName=function(a){this.name=a;this.loadConfig();return};UIDevice.prototype.beforePropertyChanged=function(){this.oldConfig=dupDeviceConfig(this.config);return};UIDevice.prototype.afterPropertyChanged=function(){if(!isDeviceConfigEqual(this.oldConfig,this.config)){this.notifyDeviceConfigChanged(this.oldConfig,this.config);this.relayout()}return};UIDevice.prototype.onDeviceConfigChanged=function(a,b){this.relayoutChildren();return};UIDevice.prototype.onModeChanged=function(){var a=this.findChildByName("button-preview",true);if(a){if(this.mode===C_MODE_EDITING){a.isPreview=false;a.setText(dappGetText("Preview"))}}return};UIDevice.prototype.loadConfig=function(){var a=idrawGetDeviceConfig(this.name);if(!a){a=idrawGetDeviceConfig("iphone5")}if(a){this.config=a}return};UIDevice.prototype.initUIDevice=function(e,a,d,b,c){this.initUIElement(e);this.setDefSize(a,d);this.setName(b);this.loadConfig();this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,c);this.setUserResizable(false);this.rectSelectable=false;this.regSerializer(this.deviceToJson,this.deviceFromJson);return this};UIDevice.prototype.drawBgImage=function(a){var c=this.getDirection();var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(b){if(c===UIDevice.PORTRAIT){this.drawImageAt(a,b,this.images.display,0,0,this.w,this.h)}else{a.save();a.translate(this.h/2,this.h/2);a.rotate(-Math.PI/2);a.translate(-this.h/2,-this.h/2);this.drawImageAt(a,b,this.images.display,0,0,this.h,this.w);a.restore()}}return};UIDevice.prototype.getCustomProp=function(){var a='<table class="prop_table" style="width: 600px; padding: 0; margin: 0;" cellspacing="0">		<tr><td class="title"><label class="description" for="configs">'+dappGetText("Choose Config")+':</label></td>		<td><select class="element select medium" id="configs" > </select></td></tr>		<tr><td class="title"><label class="description" for="platform">'+dappGetText("Platform")+':</label></td>		<td><select class="element select small" id="platform" > 		<option>android</option>		<option>iphone</option>		<option>firefox</option>		<option>blackberry</option>		<option>winphone</option>		</select></td></tr> 		<tr><td class="title"><label class="description" for="density">'+dappGetText("LCD Density")+':</label></td>		<td><select class="element select small" id="density" > 		<option>xhdpi</option>		<option>hdpi</option>		<option>mdpi</option>		</select></td></tr> 		<tr><td class="title"><label class="description" for="version">'+dappGetText("Version")+':</label></td>		<td><input id="version"  class="element text small" type="number" value="0"/></td></tr>		<tr><td class="title"><label class="description" for="screenx">'+dappGetText("Screen X")+':</label></td>		<td><input id="screenx"  class="element text small" type="number" value="0"/></td></tr>		<tr><td class="title"><label class="description" for="screeny">'+dappGetText("Screen Y")+':</label></td>		<td><input id="screeny"  class="element text small" type="number" value="0"/></td></tr>		<tr><td class="title"><label class="description" for="screenw">'+dappGetText("Screen Width")+':</label></td>		<td><input id="screenw"  class="element text small" type="number" value="0"/></td></tr>		<tr><td class="title"><label class="description" for="screenh">'+dappGetText("Screen Height")+':</label></td>		<td><input id="screenh"  class="element text small" type="number" value="0"/></td></tr></table>';return a};UIDevice.prototype.loadCustomProp=function(f){var e=this;var g=idrawGetAllDeviceConfig();for(var d=0;d<g.length;d++){var b=g[d].name;var c=new Option(dappGetText(b),b);f.configs.add(c)}function a(h){if(h!=="android"){f.density.disabled=true}else{f.density.disabled=false}}f.platform.value=this.config.platform;f.platform.onchange=function(h){e.config.platform=this.value;a(e.config.platform);return};a(e.config.platform);f.density.value=this.config.lcdDensity;f.density.onchange=function(h){e.config.lcdDensity=this.value;return};f.version.value=this.config.version;f.version.onchange=function(h){e.config.version=this.value;return};f.configs.value=this.name;f.configs.onchange=function(m){var i=idrawGetDeviceConfig(this.value);if(i){var l=e.getWindowManager();var j=e.config.lcdDensity;var h=l.getSizeScale(j,i.lcdDensity);f.screenx.value=i.screenX;f.screeny.value=i.screenY;f.screenw.value=i.screenW;f.screenh.value=i.screenH;f.platform.value=i.platform;f.density.value=i.lcdDensity;f.version.value=i.version;e.w=i.width;e.h=i.height;e.setName(i.name);e.setImage(C_SHAPE_IMAGE_ALL,i.bg);e.config.version=i.version;e.config.platform=i.platform;e.config.lcdDensity=i.lcdDensity;e.config.screenX=parseInt(f.screenx.value);e.config.screenY=parseInt(f.screeny.value);e.config.screenW=parseInt(f.screenw.value);e.config.screenH=parseInt(f.screenh.value);e.images.display=C_IMAGE_DISPLAY_9PATCH;a(e.config.platform);l.scaleForDensity(h,i.lcdDensity,true);e.relayoutChildren()}return};f.screenx.value=this.config.screenX;f.screenx.onchange=function(h){e.config.screenX=parseInt(f.screenx.value);return};f.screeny.value=this.config.screenY;f.screeny.onchange=function(h){e.config.screenY=parseInt(f.screeny.value);return};f.screenw.value=this.config.screenW;f.screenw.onchange=function(h){e.config.screenW=parseInt(f.screenw.value);return};f.screenh.value=this.config.screenH;f.screenh.onchange=function(h){e.config.screenH=parseInt(f.screenh.value);return};return};UIDevice.prototype.getScreen=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.isUIScreen){return b}}return null};UIDevice.prototype.shapeCanBeChild=function(a){if(a.isUIButton){return true}return(a.isUIScreen&&this.getScreen()===null)};UIDevice.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var g=0;var e=0;var l=0;var c=0;var a=this;for(var b=0;b<this.children.length;b++){var d=this.children[b];if(d.isUIScreen){g=this.config.screenX;e=this.config.screenY;l=this.config.screenW;c=this.config.screenH;d.widthAttr=C_WIDTH_FIX;d.heightAttr=C_HEIGHT_FIX;d.setPosition(g,e);d.setSize(l,c);d.relayout()}if(d.isUIButton){d.setMode(C_MODE_RUNNING);if(this.config.screenW>400){d.x=this.config.screenX;d.w=this.config.screenW/4}else{d.x=20;d.w=(this.w-40)/4}d.style.setFontSize(d.w<100?10:16);e=this.config.screenY-d.h-5;if(d.name==="button-prev"){g=d.x;d.setText(dappGetText("Prev Window"));d.onClick=function(i,m){if(m){return}var h=a.getWindowManager();if(h){h.showPrevFrame();a.updateWindowStatus()}return}}if(d.name==="button-next"){g=d.x+d.w;d.setText(dappGetText("Next Window"));d.onClick=function(i,m){if(m){return}var h=a.getWindowManager();if(h){h.showNextFrame();a.updateWindowStatus()}return}}if(d.name==="button-direction"){var f=a.getDirection();var j=(f===UIDevice.PORTRAIT)?"Landscape":"Portrait";g=d.x+d.w*2;d.setText(dappGetText(j));d.onClick=function(h,m){if(m){return}var i=a.getDirection();if(i===UIDevice.PORTRAIT){j="Portrait";a.setDirection(UIDevice.LANDSCAPE)}else{j="Landscape";a.setDirection(UIDevice.PORTRAIT)}this.setText(dappGetText(j));return}}if(d.name==="button-preview"){d.isPreview=false;g=d.x+d.w*3;d.setText(dappGetText("Preview"));d.onClick=function(i,n){if(n){return}var m=a.getScreen();var h=a.getWindowManager();if(!h||!m||!this.app){return}this.app.clearCommandHistory();this.isPreview=!this.isPreview;if(this.isPreview){this.setText(dappGetText("Edit"));h.saveState();a.setMode(C_MODE_PREVIEW);m.setMode(C_MODE_PREVIEW,true);h.systemInit();h.showInitWindow()}else{h.systemExit();a.setMode(C_MODE_EDITING);m.setMode(C_MODE_EDITING,true);h.restoreState();this.setText(dappGetText("Preview"))}return}}if(d.name==="button-status"){d.h=40;d.w=this.config.screenW/2;d.style.setFontSize(d.w<100?12:18);e=this.config.screenY-2*d.h-10;g=this.config.screenX+(this.config.screenW-d.w)/2;this.statusButton=d;a.updateWindowStatus()}d.setMode=function(i,h){this.mode=C_MODE_RUNNING}}d.setPosition(g,e);d.setUserMovable(false);d.setUserResizable(false)}return true};UIDevice.prototype.afterSetView=function(){this.relayoutChildren();return};UIDevice.prototype.getWindowManager=function(){var a=this.getScreen();return a?a.getWindowManager():null};UIDevice.prototype.updateWindowStatus=function(){if(this.statusButton){var b=this.getScreen();if(b){var a=b.getWindowManager();if(a){this.statusButton.setText(a.getStatusString())}}}return};UIDevice.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.beginPath();drawRoundRect(a,this.w,this.h,40);a.fill();a.stroke()}return};function UIDeviceCreator(d,b,a,e){var c=["ui-device","ui-device",null,1];ShapeCreator.apply(this,c);this.createShape=function(h){var f=new UIDevice();f.initUIDevice(this.type,a,e,d+b,null);return f};return}function UIScreen(){return}UIScreen.prototype=new UIElement();UIScreen.prototype.isUIScreen=true;UIScreen.prototype.initUIScreen=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);return this};UIScreen.prototype.getWindowManager=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.isUIWindowManager){return b}}return};UIScreen.prototype.shapeCanBeChild=function(a){if(!a.isUIStatusBar&&!a.isUIWindowManager){return false}for(var b=0;b<this.children.length;b++){var c=this.children[b];if(c.type===a.type){return false}}return true};UIScreen.prototype.beforeRelayoutChild=function(a){this.relayoutChildren();return false};UIScreen.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var m=0;var j=0;var e=0;var n=this.w;var g=null;var l=null;var f=null;for(var d=0;d<this.children.length;d++){var a=this.children[d];a.x=0;a.w=n;a.setUserMovable(false);a.setUserResizable(false);a.widthAttr=C_WIDTH_FILL_PARENT;if(a.type==="ui-status-bar"){l=a;if(a.h>this.h/4){a.h=this.h/4}a.move(0,0);a.relayout();continue}if(a.type==="ui-menu-bar"){var b=this.getDeviceConfig();var c=b&&b.hasMenuBar;if(c){g=a;if(a.h>this.h/4){a.h=this.h/4}a.move(0,this.h-a.h);a.relayout()}else{a.y=0;a.x=0}a.setVisible(c);a.setEnable(c);continue}if(a.isUIWindowManager){f=a;continue}}e=this.h;if(f){if(l){j=l.h;e=e-l.h}if(g){e=e-g.h}f.h=e;f.relayout()}return};function UIScreenCreator(a,c){var b=["ui-screen","ui-screen",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIScreen();return d.initUIScreen(this.type,a,c)};return}function UIStatusBar(){return}UIStatusBar.prototype=new UIElement();UIStatusBar.prototype.isUIStatusBar=true;UIStatusBar.prototype.initUIStatusBar=function(d,a,c,b){this.initUIElement(d);this.setDefSize(a,c);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,b);this.images.display=C_IMAGE_DISPLAY_SCALE;this.widthAttr=C_WIDTH_FILL_PARENT;return this};UIStatusBar.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage||a.isUIButton){return true}return false};UIStatusBar.prototype.afterChildAppended=function(a){a.yAttr=C_Y_MIDDLE_IN_PARENT;if(this.type==="ui-menu-bar"){a.hideSelectMark=true;a.textType=C_SHAPE_TEXT_NONE;this.hideSelectMark=true}return true};UIStatusBar.prototype.beforeRelayoutChild=function(a){a.yAttr=C_Y_MIDDLE_IN_PARENT;return true};function UIStatusBarCreator(e,a,d,c){var b=[e,"ui-status-bar",null,true];ShapeCreator.apply(this,b);this.createShape=function(h){var f=new UIStatusBar();return f.initUIStatusBar(this.type,a,d,c)};return}function UIWindow(){return}UIWindow.serialNo=0;UIWindow.prototype=new UIElement();UIWindow.prototype.isUIWindow=true;UIWindow.prototype.callOnGesture=function(gesture){if(!this.enable){return false}if(!this.handleOnGesture||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onGesture;if(sourceCode){sourceCode="this.handleOnGesture = function(gesture) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnGesture){try{this.handleOnGesture(gesture)}catch(e){console.log("this.callOnGesture:"+e.message)}}console.log("callOnGesture: scale="+gesture.scale+" rotation="+gesture.rotation);return true};UIWindow.prototype.onGesture=function(a){this.callOnGesture(a);return};UIWindow.prototype.resize=function(a,b){if(this.state===C_STAT_NORMAL){this.realResize(a,b)}return};UIWindow.prototype.initUIWindow=function(e,a,f,b,d,c){this.initUIElement(e);this.move(a,f);this.setDefSize(b,d);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,c);this.setName("window-"+UIWindow.serialNo++);if(!c){this.style.setFillColor("White")}this.addEventNames(["onLoad"]);this.addEventNames(["onUnload"]);this.addEventNames(["onOpen"]);this.addEventNames(["onClose"]);this.addEventNames(["onSwithToBack"]);this.addEventNames(["onSwithToFront"]);this.addEventNames(["onGesture"]);this.setAnimHint("htranslate");this.oldHitTest=this.hitTest;return this};UIWindow.prototype.setAnimHint=function(a){this.animHint=a;return true};UIWindow.prototype.shapeCanBeChild=function(a){if(a.isUIDevice||a.isUIScreen||a.isUIStatusBar||a.isUIWindow){return false}return true};UIWindow.prototype.onModeChanged=function(){if(this.mode===C_MODE_EDITING){this.popupWindow=null}return};UIWindow.prototype.removePopupWindow=function(a){if(this.popupWindow){if(this.popupWindow===a){this.popupWindow=null;this.targetShape=null;return true}return this.popupWindow.removePopupWindow(a)}return false};UIWindow.prototype.setPopupWindow=function(a){if(this.popupWindow){return this.popupWindow.setPopupWindow(a)}else{this.popupWindow=a}return true};UIWindow.prototype.getPopupWindow=function(){if(this.popupWindow){return this.popupWindow.getPopupWindow()}return this.isUIPopupWindow?this:null};UIWindow.prototype.isGrabElement=function(a){return this.grabElement===a};UIWindow.prototype.grab=function(a){this.grabElement=a;return};UIWindow.prototype.ungrab=function(a){this.grabElement=null;return};UIWindow.prototype.dispatchPointerDownToChildren=function(a){if(this.grabElement){this.grabElement.onPointerDown(a);this.setTarget(this.grabElement);return true}if(this.popupWindow){this.popupWindow.onPointerDown(a);this.setTarget(this.popupWindow);return true}return this.defaultDispatchPointerDownToChildren(a)};UIWindow.prototype.paintChildren=function(a){a.save();a.beginPath();a.rect(0,0,this.w,this.h);a.clip();a.beginPath();this.defaultPaintChildren(a);if(this.popupWindow){this.popupWindow.paintSelf(a)}a.restore();return};UIWindow.prototype.show=function(){this.setVisible(true);this.showHTML();return};UIWindow.prototype.hide=function(){this.setVisible(false);this.hideHTML();wtkHideAllInput();return};UIWindow.prototype.callOnOpen=function(initData){delete this.openPending;if(!this.handleOnOpen||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onOpen;if(sourceCode){sourceCode="this.handleOnOpen = function(initData) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnOpen){this.handleOnOpen(initData)}if(this.isSplashWindow()){var win=this;setTimeout(function(){if(win.visible){win.openWindow(null,null,true)}},3000)}this.init();return true};UIWindow.prototype.callOnClose=function(){if(!this.handleOnClose||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onClose;if(sourceCode){sourceCode="this.handleOnClose = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnClose){this.handleOnClose()}this.deinit();this.hide();return true};UIWindow.prototype.callOnSwithToBack=function(){if(!this.handleOnSwithToBack||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onSwithToBack;if(sourceCode){sourceCode="this.handleOnSwithToBack = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnSwithToBack){this.handleOnSwithToBack()}this.hide();return true};UIWindow.prototype.callOnSwithToFront=function(){this.show();if(!this.handleOnSwithToFront||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onSwithToFront;if(sourceCode){sourceCode="this.handleOnSwithToFront = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnSwithToFront){this.handleOnSwithToFront()}return true};UIWindow.prototype.callOnLoad=function(){if(!this.handleOnLoad||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onLoad;if(sourceCode){sourceCode="this.handleOnLoad = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnLoad){this.handleOnLoad()}return true};UIWindow.prototype.callOnUnload=function(){if(!this.handleOnUnload||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onUnload;if(sourceCode){sourceCode="this.handleOnUnload = function() {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnUnload){this.handleOnUnload()}return true};UIWindow.prototype.onPointerUpRunning=function(a,b){if(b){return}if(this.isSplashWindow()){if(this.visible){this.openWindow(null,null,true)}}return};UIWindow.prototype.setCloseWhenPointerUpOutside=function(a){if(a){this.hitTest=function(b){var c=this.oldHitTest(b);if(!c){if(this.mode!=C_MODE_EDITING){c=C_HIT_TEST_MM}}return c}}else{this.hitTest=this.oldHitTest}this.closeWhenPointerUpOutside=a;return};UIWindow.prototype.getCustomProp=function(){var a=' 		<label class="description" for="animhint">'+dappGetText("Animation Hint")+':</label>		<select class="element select medium" id="animhint" > </select>';a=a+' 			<label class="description" for="lcddensity">'+dappGetText("Apply To LCD Density")+':</label>			<select class="element select medium" id="lcddensity" >			<option>all</option>			<option>mdpi</option>			<option>hdpi</option>			<option>xhdpi</option>			</select>';if(this.isUINormalWindow){a=a+' 			<label class="description" for="windowtype">'+dappGetText("Window Type")+':</label>			<select class="element select medium" id="windowtype" > </select>'}if(this.isUIPopupWindow){a=a+'<br><input id="closeWhenPointerUpOutside" class="checkbox_i"  type="checkbox" >		'+dappGetText("Close When Click Outside")+"</input>"}return a};UIWindow.prototype.loadCustomProp=function(d){var e=this;var f=this.getSupportedAnimations();for(var c=0;c<f.length;c++){var a=f[c];var b=new Option(dappGetText(a),a);d.animhint.add(b)}d.animhint.value=this.animHint;d.animhint.onchange=function(g){e.animHint=this.value;return};d.lcddensity.value=this.lcddensity?this.lcddensity:"all";d.lcddensity.onchange=function(l){var h=e.lcddensity?e.lcddensity:"all";e.lcddensity=this.value;if(e.lcddensity!="all"){var g=1;var i=dupDeviceConfig(e.getDeviceConfig());var j=dupDeviceConfig(i);j.lcdDensity=e.lcddensity;if(h!="all"){i.lcdDensity=h}g=e.getSizeScale(i.lcdDensity,j.lcdDensity);e.notifyDeviceConfigChanged(i,j);e.scaleForDensity(g,j.lcdDensity,true);e.relayout()}return};if(this.isUINormalWindow){d.windowtype.add(new Option(dappGetText("Normal Window"),"normal"));d.windowtype.add(new Option(dappGetText("Splash Window"),"splash"));d.windowtype.add(new Option(dappGetText("Main Window"),"main"));d.windowtype.value=e.windowType?e.windowType:"normal";d.windowtype.onchange=function(h){e.windowType=this.value;if(e.windowType!="normal"){var g="win-"+this.value;e.setName(g);d.name.value=g}return}}if(this.isUIPopupWindow){d.closeWhenPointerUpOutside.checked=this.closeWhenPointerUpOutside;d.closeWhenPointerUpOutside.onchange=function(g){e.setCloseWhenPointerUpOutside(d.closeWhenPointerUpOutside.checked)}}return};UIWindow.prototype.isAnimationEnabled=function(){return this.animHint!=="none"};UIWindow.prototype.getAnimationName=function(a){var b="";switch(this.animHint){case"fade":b=a?"anim-fade-in":"anim-fade-out";break;case"scale":if(this.isUIDialog){b=a?"anim-scale-show-dialog":"anim-scale-hide-dialog"}else{b=a?"anim-scale-show-win":"anim-scale-hide-win"}break;case"popup":b=a?"anim-move-up":"anim-move-down";break;case"htranslate":b=a?"anim-forward":"anim-backward";break;default:if(this.isUIDialog){b=a?"anim-scale-show-dialog":"anim-scale-hide-dialog"}else{if(isAndroid()||isFirefoxMobile()){b=a?"anim-scale-show-win":"anim-scale-hide-win"}else{b=a?"anim-forward":"anim-backward"}}break}return b};UIWindow.prototype.isSplashWindow=function(){return this.isUINormalWindow&&this.windowType==="splash"};UIWindow.prototype.getSupportedAnimations=function(){var a=["none","default","scale","fade","htranslate","popup"];return a};UIWindow.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.beginPath();a.fillRect(0,0,this.w,this.h)}return};function UINormalWindow(){return}UINormalWindow.prototype=new UIWindow();UINormalWindow.prototype.isUINormalWindow=true;UINormalWindow.prototype.onPointerUpEditing=function(a,b){if(this.view&&this.view.isClicked()){return}if(!b){this.relayoutChildren()}return};function UINormalWindowCreator(b){var a=["ui-window","ui-window",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UINormalWindow();c.initUIWindow(this.type,0,0,100,100,b);c.widthAttr=C_WIDTH_FILL_PARENT;c.heightAttr=C_HEIGHT_FILL_PARENT;return c};return}function UIPopupWindow(){return}UIPopupWindow.prototype=new UIWindow();UIPopupWindow.prototype.isUIPopupWindow=true;UIPopupWindow.prototype.onPointerUpRunning=function(a,b){if(b||!this.closeWhenPointerUpOutside){return}if(a.x<this.x||a.y<this.y||a.x>(this.x+this.w)||a.y>(this.y+this.h)){this.closeWindow(0)}return};function UIDialog(){return}UIDialog.prototype=new UIPopupWindow();UIDialog.prototype.isUIDialog=true;function UIDialogCreator(a,d,c){var b=["ui-dialog","ui-dialog",null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new UIDialog();e.initUIWindow(this.type,0,0,a,d,c);e.setMargin(8,8);e.xAttr=C_X_CENTER_IN_PARENT;e.yAttr=C_Y_MIDDLE_IN_PARENT;e.images.display=C_IMAGE_DISPLAY_SCALE;e.setAnimHint("scale");return e};return}function UIDialogMenu(){return}UIDialogMenu.prototype=new UIPopupWindow();UIDialogMenu.prototype.isUIDialogMenu=true;function UIDialogMenuCreator(a,d,c){var b=["ui-dialog-menu","ui-dialog-menu",null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new UIDialogMenu();e.initUIWindow(this.type,0,0,a,d,c);e.images.display=C_IMAGE_DISPLAY_9PATCH;return e};return}function UIPopupMenuCreator(a,d,c){var b=["ui-popup-menu","ui-popup-menu",null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new UIDialogMenu();e.initUIWindow(this.type,0,0,a,d,c);e.setMargin(8,8);e.xAttr=C_X_CENTER_IN_PARENT;e.yAttr=C_Y_MIDDLE_IN_PARENT;e.images.display=C_IMAGE_DISPLAY_9PATCH;e.setAnimHint("scale");return e};return}function UISystemMenuCreator(a,d,c){var b=["ui-system-menu","ui-system-menu",null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new UIDialogMenu();e.initUIWindow(this.type,0,0,a,d,c);e.images.display=C_IMAGE_DISPLAY_9PATCH;e.setAnimHint("popup");return e};return}function UIFrames(){return}UIFrames.prototype=new UIElement();UIFrames.prototype.isUIFrames=true;UIFrames.prototype.initUIFrames=function(a){this.initUIElement(a);this.current=0;this.setDefSize(200,200);this.setTextType(C_SHAPE_TEXT_NONE);this.widthAttr=C_WIDTH_FILL_PARENT;this.addEventNames(["onChanged"]);return this};UIFrames.prototype.getStatusString=function(){var c="";var a=this.current+1;var d=this.children.length;var b=this.getCurrentFrame();a=a<=d?a:d;if(b&&b.name){c=b.name+"("+a+"/"+d+")"}else{c=a+"/"+d}return c};UIFrames.prototype.getCurrent=function(){return this.current};UIFrames.prototype.setCurrent=function(a){if(this.current!==a){this.current=a;if(this.mode!=C_MODE_EDITING){this.callOnChanged(a)}}return};UIFrames.prototype.getCurrentFrame=function(){if(this.children.length<1){return null}if(this.current<0||!this.current){this.current=0}if(this.current>=this.children.length){this.current=this.children.length-1}return this.children[this.current]};UIFrames.prototype.fixChildSize=function(a){return};UIFrames.prototype.fixChildPosition=function(e){var a=e.x;var d=e.y;var c=e.h;var b=e.w;if(e.freePosition){return}if(e.widthAttr===C_WIDTH_FILL_PARENT){a=this.getHMargin();b=this.getWidth(true)}if(e.heightAttr===C_HEIGHT_FILL_PARENT){d=this.getVMargin();c=this.getHeight(true)}e.x=a;e.y=d;e.h=c;e.w=b;return};UIFrames.prototype.setTarget=function(a){for(var b=0;b<this.children.length;b++){var c=this.children[b];if(!a){c.setSelected(false);continue}if(c!=a&&c!=a.popupWindow){c.setSelected(false)}}this.targetShape=a;this.selected=!a;return};UIFrames.prototype.dispatchPointerDownToChildren=function(a){var b=null;if(this.children.length<1){return false}b=this.getCurrentFrame();if(b.onPointerDown(a)){this.setTarget(b);return true}return false};UIFrames.prototype.addShapeIntoChildren=function(a,b){var c=null;if(this.children.length<1){return false}c=this.getCurrentFrame();return c.addShape(a,true,b)};UIFrames.prototype.paintChildren=function(a){var b=this.getCurrentFrame();if(b){a.save();a.beginPath();b.paintSelf(a);a.restore()}return};UIFrames.prototype.showNextFrame=function(){this.showFrame(this.current+1);this.relayoutChildren();return};UIFrames.prototype.getFrame=function(a){if(a<0||a>=this.children.length){return null}return this.children[a]};UIFrames.prototype.getFrameIndex=function(b){for(var a=0;a<this.children.length;a++){if(b===this.children[a]){return a}}return -1};UIFrames.prototype.getFrames=function(){return this.children.length};UIFrames.prototype.showPrevFrame=function(){this.showFrame(this.current-1);this.relayoutChildren();return};UIFrames.prototype.showFrame=function(a){this.current=(a+this.children.length)%this.children.length;var b=this.children[this.current];if(b){b.show(true)}return};UIFrames.prototype.shapeCanBeChild=function(a){return true};UIFrames.prototype.initDefaultNameForChild=function(a){};UIFrames.prototype.relayoutChildren=function(){for(var b=0;b<this.children.length;b++){var a=this.children[b];a.x=0;a.y=0;a.w=this.w;a.h=this.h;a.widthAttr=C_WIDTH_FILL_PARENT;a.heightAttr=C_HEIGHT_FILL_PARENT;a.relayoutChildren()}return};UIFrames.prototype.afterChildAppended=function(a){this.current=this.children.length-1;if(!a.name){this.initDefaultNameForChild(a)}return};UIFrames.prototype.onChildRemoved=function(a){return};UIFrames.prototype.afterChildRemoved=function(a){if(this.children.length===0){this.current=0}else{if(this.current>=this.children.length){this.current--}}this.onChildRemoved(a);return};UIFrames.prototype.findShapeByPoint=function(a,b){var c=this.translatePoint(a);var d=this.getCurrentFrame();if(d){return d.findShapeByPoint(c,b)}return this};function UIFramesCreator(){var a=["ui-frames","ui-frames",null,0];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIFrames();return b.initUIFrames(this.type)};return}function UIWindowManager(){}UIWindowManager.prototype=new UIFrames();UIWindowManager.prototype.isUIWindowManager=true;UIWindowManager.prototype.initUIWindowManager=function(a){this.initUIFrames(a);this.history=new Array();return this};UIWindowManager.prototype.beforeAddShapeIntoChildren=function(a){return !a.isUIWindow};UIWindowManager.prototype.initDefaultNameForChild=function(a){a.name="newwin";return};UIWindowManager.prototype.getSplashWindow=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.isUINormalWindow&&b.windowType==="splash"){return b}}return null};UIWindowManager.prototype.getMainWindow=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.isUINormalWindow&&b.windowType==="main"){return b}}for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.isUINormalWindow){return b}}return null};UIWindowManager.prototype.getWindowNames=function(){var c=[];for(var a=0;a<this.children.length;a++){var b=this.children[a];c.push(b.name)}return c};UIWindowManager.prototype.showInitWindow=function(){var a=null;if(this.children.length===0){return false}this.history.clear();var b=getQueryParameter("startwin");if(b){a=this.findBestFitWindowByName(b)}if(!a){a=this.getSplashWindow();if(!a){a=this.getMainWindow()}}if(a){a.relayout();index=this.getFrameIndex(a);this.showFrame(index);a.callOnOpen();this.history.push(index);this.postRedraw()}return true};UIWindowManager.prototype.callOnLoad=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];b.callOnLoad()}return true};UIWindowManager.prototype.callOnUnload=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];b.callOnUnload()}return true};UIWindowManager.prototype.systemInit=function(){this.callOnLoad();console.log("systemInit");return};UIWindowManager.prototype.systemExit=function(){var a=this.getCurrentWindow();if(a){a.hide()}this.callOnUnload();console.log("systemExit");return};function preparseBackendCanvas(b,e){var a=b.w;var d=b.h;var f=BackendCanvasGet(2*a,d);var c=f.getContext("2d");c.clearRect(0,0,2*a,d);c.save();b.paint(c);c.translate(a,0);e.paint(c);c.restore();return f}UIWindowManager.prototype.findBestFitWindowByName=function(d){var h=null;var b=null;var n=null;var l=null;var j=null;var f=this.getDeviceConfig();var e=d;var c=d+"-"+f.platform;var a=c+"-"+f.lcdDensity;var m=a+"-"+f.screenW+"x"+f.screenH;for(var g=0;g<this.children.length;g++){h=this.children[g];switch(h.name){case e:if(f.lcdDensity===h.lcddensity){l=h}else{if(!h.lcddensity||h.lcddensity==="all"){b=h}else{if(!b){b=h}}}break;case c:n=h;break;case a:l=h;break;case m:j=h;break;default:break}}if(j){console.log("Find "+j.name);return j}if(l){console.log("Find "+l.name);return l}if(n){console.log("Find "+n.name);return n}if(b){console.log("Find "+b.name);return b}return null};UIWindowManager.prototype.openWindow=function(d,c,e,a){var b=null;if(d){b=this.findBestFitWindowByName(d)}else{b=this.getMainWindow()}if(!b){console.log("Not findBestFitWindowByName window "+d);return false}if(b.openPending){b.openPending=false;console.log("This window is already open:"+d);return false}if(!b.isUIWindow){console.log("It is not a window: "+d);return false}b.openPending=true;b.initData=a;b.onWindowClose=c;if(b.isUINormalWindow){return this.openNormalWindow(b,e)}else{return this.openPopupWindow(b,e)}};UIWindowManager.prototype.openPopupWindow=function(a,g){var e=this;var b=this.getCurrentFrame();a.relayout();function c(){a.show();b.setPopupWindow(a);e.postRedraw();a.callOnOpen(a.initData)}if(b){b.callOnSwithToBack();if(a.isAnimationEnabled()){var f=this.getPositionInScreen();var d=animationCreate(a.getAnimationName(true));var h=preparseBackendCanvas(b,a);d.setScale(this.getRealScale());d.prepare(f.x,f.y,this.w,this.h,h,c);d.setRectOfFront(a.x,a.y,a.w,a.h);d.run()}else{c()}}return true};UIWindowManager.prototype.openNormalWindow=function(d,f){var i=this;var e=0;if(f){this.closeCurrentWindow(0)}d.relayout();var a=this.getCurrentFrame();function g(){e=i.getFrameIndex(d);i.showFrame(e);i.history.push(e);a=i.getCurrentFrame();i.postRedraw();d.callOnOpen(d.initData);return}if(a){a.callOnSwithToBack();if(d.isAnimationEnabled()){var b=this.getPositionInScreen();var c=animationCreate(d.getAnimationName(true));var h=preparseBackendCanvas(a,d);c.setScale(this.getRealScale());c.prepare(b.x,b.y,this.w,this.h,h,g);c.run()}else{setTimeout(g,10)}}else{g()}return true};UIWindowManager.prototype.getCurrentWindow=function(){var a=this.getCurrentFrame();var b=a.getPopupWindow();return b?b:a};UIWindowManager.prototype.closeCurrentWindow=function(a){var b=this.getCurrentWindow();if(!b||b.mode===C_MODE_EDITING||!b.visible){return false}if(b.isUINormalWindow){return this.closeCurrentNormalWindow(b,a)}else{return this.closeCurrentPopupWindow(b,a)}};UIWindowManager.prototype.closeCurrentPopupWindow=function(h,c){var j=this;var a=this.getCurrentFrame();if(a){function f(){a.removePopupWindow(h);j.postRedraw()}if(h.isAnimationEnabled()){var b=this.getPositionInScreen();var d=animationCreate(h.getAnimationName(false));a.removePopupWindow(h);var i=preparseBackendCanvas(a,h);a.setPopupWindow(h);d.setScale(this.getRealScale());d.prepare(b.x,b.y,this.w,this.h,i,f);d.setRectOfFront(h.x,h.y,h.w,h.h);d.run()}else{f()}if(h.onWindowClose){try{h.onWindowClose(c)}catch(g){console.log("onWindowClose: "+g.message)}}h.callOnClose();a.callOnSwithToFront()}return true};UIWindowManager.prototype.closeCurrentNormalWindow=function(a,c){var j=this;var f=null;if(this.history.length<2){return false}lastWinIndex=this.history[this.history.length-2];f=this.getFrame(lastWinIndex);function h(){j.showFrame(lastWinIndex);j.postRedraw();return}if(a.isAnimationEnabled()){var b=this.getPositionInScreen();var d=animationCreate(a.getAnimationName(false));var i=preparseBackendCanvas(f,a);d.setScale(this.getRealScale());d.prepare(b.x,b.y,this.w,this.h,i,h);d.run()}else{setTimeout(h,10)}if(a.onWindowClose){try{a.onWindowClose(c)}catch(g){console.log("onWindowClose: "+g.message)}}a.callOnClose();j.history.remove(j.current);f.callOnSwithToFront();return};UIWindowManager.prototype.isWindowOpen=function(d){for(var c=0;c<this.history.length;c++){var b=this.history[c];var a=this.children[b];if(a===d||a.popupWindow===d){return true}}return false};UIWindowManager.prototype.shapeCanBeChild=function(a){return a.isUIWindow};UIWindowManager.prototype.afterChildAppended=function(a){if(this.mode!==C_MODE_RUNNING&&!this.isUnpacking){var b=this.getFrameIndex(a);this.showFrame(b);var c=this.getDevice();if(c){c.updateWindowStatus()}}return};UIWindowManager.prototype.onChildRemoved=function(a){var b=this.getDevice();if(b){b.updateWindowStatus()}return};UIWindowManager.prototype.scaleForDensity=function(a,e,d){if(!a||a===1){return}for(var c=0;c<this.children.length;c++){var b=this.children[c];if(!b.lcddensity||b.lcddensity==="all"){b.scaleForDensity(a,e,d)}}return};UIWindowManager.prototype.setDeviceConfig=function(c){var b=this.deviceConfig;this.deviceConfig=c;if(b&&c){if(isMobile()){var a=this.getSizeScale(b.lcdDensity,c.lcdDensity);this.scaleForDensity(a,c.lcdDensity,true)}this.notifyDeviceConfigChanged(b,c);console.log("call this.notifyDeviceConfigChanged: "+this.type)}console.log("setDeviceConfig platform:"+c.platform);return};UIWindowManager.prototype.getDeviceConfig=function(){if(this.deviceConfig){return this.deviceConfig}else{var a=this.getDevice();if(a){return a.config}}return null};UIWindowManager.prototype.afterPaintChildren=function(b){var a=this.getCreatingShape();if(a&&a.isUIElement&&this.showHignlight){if(!a.isUIDevice){b.beginPath();b.rect(0,0,this.w,this.h);b.lineWidth=5;b.strokeStyle="Orange";b.stroke()}if(a.isUIWindow){b.textBaseline="middle";b.textAlign="center";b.fillStyle="Gray";b.font="24pt Sans";b.fillText(dappGetText("Please Drag Window To Here."),this.w/2,this.h*0.2)}}this.showHignlight=!this.showHignlight;return};UIWindowManager.prototype.paintSelfOnly=function(a){if(this.mode===C_MODE_EDITING){a.fillStyle="white";a.fillRect(0,0,this.w,this.h)}return};UIWindowManager.prototype.relayoutChildren=function(){var a=this.getCurrentFrame();var b=a.getPopupWindow();if(a){a.relayout();if(b){b.relayout()}}console.log("UIWindowManager.prototype.relayoutChildren");return};function UIWindowManagerCreator(){var a=["ui-window-manager","ui-window-manager",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIWindowManager();return b.initUIWindowManager(this.type)};return}function UILabel(){return}UILabel.prototype=new UIElement();UILabel.prototype.isUILabel=true;UILabel.prototype.initUILabel=function(c,a,b){this.initUIElement(c);this.setText(a);this.setDefSize(200,200);this.setMargin(5,5);this.setTextType(C_SHAPE_TEXT_TEXTAREA);this.setImage(C_SHAPE_IMAGE_ALL,b);this.autoAdjustHeight=false;this.addEventNames(["onChanged"]);return this};UILabel.prototype.setAutoAdjustHeight=function(a){this.autoAdjustHeight=a;return true};UILabel.prototype.shapeCanBeChild=function(a){return false};UILabel.prototype.getCustomProp=function(){var a='		<label class="description" for="fontfamily">'+dappGetText("Font Family")+':</label>		<input id="fontfamily"  class="element text"  style="width:50%;"  type="text" value="serif"/> 		<input id="textshadow" class="checkbox_i"  type="checkbox" >'+dappGetText("Enable Text Shadow")+'</input> 		<input id="textinmiddle" class="checkbox_i"  type="checkbox" >'+dappGetText("Text In Middle")+'</input> 		<label class="description" for="textangle">'+dappGetText("Text Angle")+':</label>		<input id="textangle"  class="element text " style="width:50%;" type="number" value="0"/> 		<input id="autoascalefontsize" class="checkbox_i"  type="checkbox" >'+dappGetText("Auto Scale Font Size")+'</input> 		<input id="autoadustheight" class="checkbox_i"  type="checkbox" >'+dappGetText("Auto Adjust Height")+"</input>";return a};UILabel.prototype.loadCustomProp=function(b){var a=this;b.fontfamily.value=this.style.fontFamily;b.fontfamily.onchange=function(c){a.style.setFontFamily(this.value);return};b.textshadow.checked=this.textShadow?true:false;b.textshadow.onchange=function(c){a.setTextShadow(this.checked);return};b.textinmiddle.checked=this.textInMiddle?true:false;b.textinmiddle.onchange=function(c){a.setTextInMiddle(this.checked);return};b.textangle.value=this.textAngle?this.textAngle:0;b.textangle.onchange=function(c){a.textAngle=parseInt(this.value);return};b.autoadustheight.checked=this.autoAdjustHeight?true:false;b.autoadustheight.onchange=function(c){a.setAutoAdjustHeight(this.checked);return};b.autoascalefontsize.checked=this.enableAutoScaleFontSize?true:false;b.autoascalefontsize.onchange=function(c){a.setAutoScaleFontSize(this.checked);return};return};UILabel.prototype.ANIM_OLD_OUT=1;UILabel.prototype.ANIM_NEW_IN=3;UILabel.prototype.setTextInMiddle=function(a){this.textInMiddle=a;return};UILabel.prototype.animateSetText=function(g,e){var c=this;var f=500;var a=this.getHeight(true);var d=(new Date()).getTime();this.animateYOffset=0;this.animateState=this.ANIM_OLD_OUT;function b(){var h=new Date();var i=(h.getTime()-d)/f;switch(c.animateState){case c.ANIM_OLD_OUT:if(i<1){c.animateYOffset=-i*a}else{c.setText(g);c.animateState=c.ANIM_NEW_IN;d=h.getTime()}break;case c.ANIM_NEW_IN:if(i<1){c.animateYOffset=a*(1-i)}else{delete d;delete c.animateState;delete c.animateYOffset}default:break}if(c.animateState){setTimeout(b,10)}delete h;c.postRedraw()}b();return};UILabel.prototype.beforeDrawText=function(b){if(!this.animateState){return}var a=this.getWidth(true);var c=this.getHeight(true);b.save();b.rect(this.hMargin,this.vMargin,a,c);b.clip();b.translate(0,this.animateYOffset);return};UILabel.prototype.afterDrawText=function(a){if(!this.animateState){return}a.restore();return};UILabel.prototype.setText=function(a){this.text=a+"";this.textNeedRelayout=true;this.callOnChanged(a);return};UILabel.prototype.getTextLineGap=function(){return this.style.fontSize*1.5};UILabel.prototype.drawText=function(c){this.beforeDrawText(c);var b=Math.PI*(this.textAngle?this.textAngle:0)/180;if(this.textInMiddle){if(this.text&&!this.lines){c.font=this.style.getFont();this.layoutText(c)}var d=this.getTextHeight();var a=this.h>d?(this.h-d)/2:0;c.translate(0,a)}if(b){c.save();c.translate(this.w/2,this.h/2);c.rotate(b);c.translate(-this.w/2,-this.h/2);c.textBaseline="middle";c.textAlign="center";c.font=this.style.getFont();c.fillStyle=this.style.textColor;c.fillText(this.text,this.w/2,this.h/2);c.restore()}else{this.drawMLText(c,this.autoAdjustHeight)}if(this.textInMiddle){c.translate(0,-a)}this.afterDrawText(c);return};function UILabelCreator(){var a=["ui-label","ui-label",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UILabel();return b.initUILabel(this.type,dappGetText("Text"),null)};return}function UITips(){return}UITips.prototype=new UIElement();UITips.prototype.isUITips=true;UITips.prototype.initUITips=function(b,a){this.initUIElement(b);this.roundRadius=8;this.setDefSize(200,200);this.setClickable(true);this.setTextType(C_SHAPE_TEXT_TEXTAREA);this.setImage(C_SHAPE_IMAGE_ALL,a);this.pointerDirection=UITips.BOTTOM;this.pointerOffset=1;this.pointer={x:0,y:0};this.setMargin(20,20);this.setSizeLimit(80,80);this.autoAdjustHeight=true;return this};UITips.TOP=0;UITips.LEFT=1;UITips.RIGHT=2;UITips.BOTTOM=3;UITips.prototype.getPointer=function(){var b=0;var d=0;var a=this.roundRadius+this.hMargin*2;var c=this.roundRadius+this.vMargin*2;switch(this.pointerDirection){case UITips.TOP:case UITips.BOTTOM:b=this.pointerOffset*this.w;b=Math.max(b,a);b=Math.min(b,this.w-a);d=this.pointerDirection===UITips.TOP?0:this.h;break;case UITips.LEFT:case UITips.RIGHT:d=this.pointerOffset*this.h;d=Math.max(d,c);d=Math.min(d,this.h-c);b=this.pointerDirection===UITips.LEFT?0:this.w;break}return{x:b,y:d}};UITips.prototype.getMoreSelectMark=function(b,a){if(b===C_HIT_TEST_HANDLE){a.x=this.pointer.x;a.y=this.pointer.y;return true}return false};UITips.prototype.onPointerDownEditing=function(a,b){if(b){this.pointer=this.getPointer()}return};UITips.prototype.moveHandle=function(d,c){var b=0.5*this.w;var e=0.5*this.h;var h=this.roundRadius+this.hMargin;var f=this.pointer;f.x+=d;f.y+=c;var a=f.x>=0?f.x:0;a=a<this.w?a:this.w;var g=f.y>=0?f.y:0;g=g<this.h?g:this.h;if(f.y<h){this.pointerOffset=(a/this.w);this.pointerDirection=UITips.TOP}else{if(f.y<(this.h-h)){this.pointerOffset=(g/this.h);this.pointerDirection=f.x<b?UITips.LEFT:UITips.RIGHT}else{this.pointerOffset=(a/this.w);this.pointerDirection=UITips.BOTTOM}}this.pointer=f;return};UITips.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="border">'+dappGetText("Border Size")+':</label>		<input id="border"  class="element text small" type="number" value="0"/>		<input id="clickable" class="checkbox_i"  type="checkbox" >'+dappGetText("Clickable")+'</input> 		<input id="autoadustheight" class="checkbox_i"  type="checkbox" >		        '+dappGetText("Auto Adjust Height")+"</input>";return a};UITips.prototype.setAutoAdjustHeight=function(a){this.autoAdjustHeight=a;return true};UITips.prototype.loadCustomProp=function(b){var a=this;b.autoadustheight.checked=this.autoAdjustHeight?true:false;b.autoadustheight.onchange=function(c){a.setAutoAdjustHeight(this.checked);return};b.border.value=this.getHMargin();b.border.onchange=function(d){var c=parseInt(this.value);a.setMargin(c,c);return};b.clickable.checked=this.clickable;b.clickable.onchange=function(c){a.setClickable(this.checked);return};return};UITips.prototype.setClickable=function(a){this.clickable=a;return};UITips.prototype.drawText=function(a){this.drawMLText(a,this.autoAdjustHeight);return};UITips.prototype.drawPath=function(f){var l=this.hMargin/2;var i=this.vMargin/2;var o=this.getWidth(true)+this.hMargin;var g=this.getHeight(true)+this.vMargin;var b=this.getPointer();var n=b.x;var j=b.y;var p=this.hMargin*0.75;var a=this.roundRadius;var d=l+o-a;var c=i+g-a;var e=l+o;var m=i+g;if(j<=i&&(n>l&&n<e)){j=0;if(n<(l+a+p)){n=l+a+p}f.moveTo(n-p,i);f.lineTo(n,j);f.lineTo(n+p,i);f.lineTo(d,i);f.arc(d,i+a,a,1.5*Math.PI,2*Math.PI,false);f.lineTo(e,c);f.arc(d,c,a,0,0.5*Math.PI,false);f.lineTo(l+a,m);f.arc(l+a,c,a,0.5*Math.PI,Math.PI,false);f.lineTo(l,a+i);f.arc(l+a,i+a,a,Math.PI,1.5*Math.PI,false);f.lineTo(n-p,i)}else{if(j>i&&(n>l&&n<e)){j=this.h;if(n<(l+a+p)){n=l+a+p}f.moveTo(l+a,i);f.arc(d,i+a,a,1.5*Math.PI,2*Math.PI,false);f.lineTo(e,c);f.arc(d,c,a,0,0.5*Math.PI,false);f.lineTo(n+p,m);f.lineTo(n,j);f.lineTo(n-p,m);f.arc(l+a,c,a,0.5*Math.PI,Math.PI,false);f.lineTo(l,a+i);f.arc(l+a,i+a,a,Math.PI,1.5*Math.PI,false)}else{if(n<=l&&(j>i&&j<m)){n=0;if(j<(i+a+p)){j=i+a+p}f.moveTo(l+a,i);f.arc(d,i+a,a,1.5*Math.PI,2*Math.PI,false);f.lineTo(e,c);f.arc(d,c,a,0,0.5*Math.PI,false);f.lineTo(l+a,m);f.arc(l+a,c,a,0.5*Math.PI,Math.PI,false);f.lineTo(l,j+p);f.lineTo(n,j);f.lineTo(l,j-p);f.lineTo(l,a+i);f.arc(l+a,i+a,a,Math.PI,1.5*Math.PI,false)}else{if(n>l&&(j>i&&j<m)){n=this.w;if(j<(i+a+p)){j=i+a+p}f.moveTo(l+a,i);f.arc(d,i+a,a,1.5*Math.PI,2*Math.PI,false);f.lineTo(e,j-p);f.lineTo(n,j);f.lineTo(e,j+p);f.lineTo(e,c);f.arc(d,c,a,0,0.5*Math.PI,false);f.lineTo(l+a,m);f.arc(l+a,c,a,0.5*Math.PI,Math.PI,false);f.lineTo(l,a+i);f.arc(l+a,i+a,a,Math.PI,1.5*Math.PI,false)}}}}return};UITips.prototype.paintSelfOnlyAndroid=function(a){a.beginPath();this.drawPath(a);a.fill();a.lineWidth=(this.pointerDown&&this.clickable)?6:3;a.strokeStyle="Gray";a.stroke();a.lineWidth=1;a.strokeStyle=this.style.lineColor;a.stroke();return};UITips.prototype.paintSelfOnly=function(a){var c=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!c){if(isAndroid()){return this.paintSelfOnlyAndroid(a)}var b=this.style;a.shadowColor=b.shadow.color;a.shadowOffsetX=b.shadow.x;a.shadowOffsetY=b.shadow.y;a.shadowBlur=b.shadow.blur;a.beginPath();this.drawPath(a);a.fill();if(this.pointerDown&&this.clickable){a.lineWidth=3;a.shadowBlur=2*a.shadowBlur}else{a.lineWidth=2;a.shadowBlur=0}a.stroke();a.shadowBlur=0}return};UITips.prototype.shapeCanBeChild=function(a){return a.isUIButton||a.isUILabel||a.isUIImage};function UITipsCreator(){var a=["ui-tips","ui-tips",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UITips();return b.initUITips(this.type,null)};return}function UICanvas(){return}UICanvas.prototype=new UIElement();UICanvas.prototype.isUICanvas=true;UICanvas.prototype.initUICanvas=function(e,a,d){this.initUIElement(e);this.setDefSize(a,d);this.refreshInterval=50;this.setTextType(C_SHAPE_TEXT_NONE);this.addEventNames(["onPaint","onTimer","onPointerDown","onPointerMove","onPointerUp","onKeyDown","onKeyUp"]);var b=this;function c(){if(b.needRedraw()){var f=b.view;if(f){f.postRedraw()}b.callTimerHandler()}setTimeout(c,b.refreshInterval)}setTimeout(c,b.refreshInterval);return this};UICanvas.prototype.needRedraw=function(){if(!this.isVisible()){return false}if(!this.windowIsCurrent()){return false}if(this.mode===C_MODE_EDITING){return false}return true};UICanvas.prototype.shapeCanBeChild=function(a){return false};UICanvas.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="refreshinterval">'+dappGetText("Refresh Timer")+':</label>		<input id="refreshinterval"  class="element text small" type="number" value="50"/>&nbsp;ms';return a};UICanvas.prototype.loadCustomProp=function(b){var a=this;b.refreshinterval.value=this.refreshInterval;b.refreshinterval.onchange=function(c){a.refreshInterval=parseInt(b.refreshinterval.value);if(a.refreshInterval<10){a.refreshInterval=10}return};return};UICanvas.prototype.paintSelfOnly=function(a){a.save();a.rect(0,0,this.w,this.h);a.clip();a.beginPath();if(this.mode===C_MODE_EDITING){a.fillRect(0,0,this.w,this.h)}this.callPaintHandler(a);a.restore();return};function UICanvasCreator(a,c){var b=["ui-canvas","ui-canvas",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UICanvas();return d.initUICanvas(this.type,a,c)};return}function UIHtml(){return}UIHtml.prototype=new UIElement();UIHtml.prototype.isUIHtml=true;UIHtml.prototype.initUIHtml=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);return this};UIHtml.prototype.shapeCanBeChild=function(a){return false};UIHtml.prototype.paintSelfOnly=function(a){if(!this.htmlVisible){a.beginPath();a.fillRect(0,0,this.w,this.h)}return};UIHtml.prototype.setVisible=function(a){if(this.visible!=a){if(a){this.onShowHTML()}else{this.onHideHTML()}this.visible=a}return};UIHtml.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="content">'+dappGetText("HTML Content")+':</label>		<textarea id="content"  class="large"  rows="10" cols="80" type="text" value=""></textarea>';return a};UIHtml.prototype.loadCustomProp=function(c){var b=this;var a="<p>Put HTML Content At Here.";c.content.value=this.text?this.text:a;c.content.onchange=function(d){b.setText(this.value);return};return};UIHtml.prototype.showHTMLElement=function(){var d=this.element;if(d){var f=this.getRealScale();var e=this.getPositionInView();var a=e.x*f+this.view.rect.x;var g=e.y*f+this.view.rect.y;var b=this.w*f;var c=this.h*f;d.style.position="absolute";d.style.left=a+"px";d.style.top=g+"px";d.style.width=b+"px";d.style.height=c+"px";d.style.visibility="visible";this.htmlVisible=true}return};UIHtml.prototype.createHTMLElement=function(a){var b=null;if(!this.element){b=document.createElement(a);b.id=this.type+this.name;document.body.appendChild(b);this.element=b}return this.element};UIHtml.prototype.onShowHTML=function(){this.createHTMLElement("div");this.element.innerHTML=this.text;this.element.style.overflow="hidden";this.element.style.zIndex=5;if(this.mode!=C_MODE_EDITING){this.showHTMLElement()}return};UIHtml.prototype.onHideHTML=function(){this.htmlVisible=false;if(this.element){this.element.style.visibility="hidden"}return};function UIHtmlCreator(a,c){var b=["ui-html","ui-html",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIHtml();return d.initUIHtml(this.type,a,c)};return}function UISelect(){return}UISelect.prototype=new UIHtml();UISelect.prototype.isUISelect=true;UISelect.prototype.initUISelect=function(c,a,b){this.options={};this.initUIHtml(c,a,b);this.addEventNames(["onChanged"]);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setImage(C_SHAPE_IMAGE_FOCUSED,null);this.setImage(C_SHAPE_IMAGE_ACTIVE,null);this.setImage(C_SHAPE_IMAGE_NORMAL,null);this.setImage(C_SHAPE_IMAGE_DISABLE,null);return this};UISelect.prototype.setText=function(g){var f=null;this.options={};if(g){var c=this.text.split("\n");if(c&&c.length>0){for(var d=0;d<c.length;d++){var a=c[d].split(":");if(a&&a.length>1){var b=a[0];var e=a[1];this.options[e]=b;if(f===null){f=e}}}}}this.text=g;this.value=f;return};UISelect.prototype.paintSelfOnly=function(b){var c=this.getHtmlImageByType(C_SHAPE_IMAGE_NORMAL);if(!c){b.beginPath();b.lineWidth=1;b.rect(0,0,this.w,this.h);b.fill();b.stroke();var a=this.h*0.25;b.beginPath();b.moveTo(this.w,this.h-a);b.lineTo(this.w,this.h);b.lineTo(this.w-a,this.h);b.lineTo(this.w,this.h-a);b.fillStyle="#6371d8";b.fill()}return};UISelect.prototype.afterPaintChildren=function(a){var b=this.options[this.value];if(b&&this.w>60){a.textAlign="left";a.textBaseline="center";a.font=this.style.getFont();a.fillStyle=this.style.textColor;a.fillText(b,20,this.h/2+10,this.w-40)}return};UISelect.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="options">'+dappGetText("Options")+':</label>		<textarea id="options"  class="large"  rows="10" cols="80" type="text" value=""></textarea>';return a};UISelect.prototype.loadCustomProp=function(c){var a=this;var b="key1:value2\nkey2:value2";c.options.value=this.text?this.text:b;c.options.onchange=function(d){a.setText(this.value);return};return};UISelect.prototype.getValue=function(){return this.value};UISelect.prototype.setValue=function(a){if(this.value!=a){this.value=a;this.callOnChanged(this.value)}return};UISelect.prototype.onShowHTML=function(){var e=0;var d=null;var b=this;var a=this.createHTMLElement("select");if(a.options){a.options.length=0}for(var f in this.options){var c=this.options[f];d=new Option(c,f);a.add(d)}a.onchange=function(g){b.setValue(this.value);b.postRedraw();return};if(this.mode!=C_MODE_EDITING){this.showHTMLElement()}a.style.background="transparent";a.style.border="0px solid";a.style.outline="none";a.style.opacity=0;return};function UISelectCreator(a,c){var b=["ui-select","ui-select",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UISelect();return d.initUISelect(this.type,a,c)};return}function UIEdit(){return}UIEdit.prototype=new UIElement();UIEdit.prototype.isUIEdit=true;UIEdit.prototype.initUIEdit=function(g,a,f,e,i,c,d,b){this.initUIElement(g);this.setDefSize(a,f);this.setText(c);this.leftMargin=e;this.rightMargin=i;this.setSizeLimit(60,30,1000,80);this.setTextType(C_SHAPE_TEXT_INPUT);this.setImage(C_SHAPE_IMAGE_ALL,d);this.setImage(C_SHAPE_IMAGE_FOCUSED,b);this.style.setTextAlignment("left");this.setMargin(5,5);this.setInputType("text");this.addEventNames(["onChanged","onChanging","onFocusIn","onFocusOut"]);return this};UIEdit.prototype.shapeCanBeChild=function(a){if(a.isUIButton){return true}return false};UIEdit.prototype.textEditable=function(a){return true};UIEdit.prototype.getLocaleText=function(c){if(c===" "){return c}if(this.inputType==="password"&&c&&c===this.text){var b="";var d=c.length;for(var a=0;a<d;a++){b=b+"*"}return b}else{return c}};UIEdit.prototype.onClick=function(a,b){if(b){return}if(this.mode!==C_MODE_EDITING){this.editText()}return};UIEdit.prototype.calcTextPosition=function(){this.textX=this.leftMargin;this.textY=this.h/2;this.textAlign="left";this.textBaseline="middle";return};UIEdit.prototype.drawText=function(a){this.draw1LText(a);return};UIEdit.prototype.getCustomProp=function(){var a=' 		<label class="description" for="inputtype">'+dappGetText("Input Type")+':</label>		<select class="element select medium" id="inputtype" > </select> 		<label class="description" for="inputtips">'+dappGetText("Input Tips")+':</label>		<input id="inputtips"  class="element text medium" type="text" /> 		<label class="description" for="leftmargin">'+dappGetText("Left Margin")+':</label>		<input id="leftmargin"  class="element text medium" type="number"  maxlength="2"/> 		<label class="description" for="rightmargin">'+dappGetText("Right Margin")+':</label>		<input id="rightmargin"  class="element text medium" type="number"  maxlength="2" />';return a};UIEdit.prototype.loadCustomProp=function(b){var a=this;b.inputtips.value=this.inputTips?this.inputTips:"";b.inputtips.onchange=function(c){a.setInputTips(this.value);return};b.inputtype=this.inputType;b.inputtype.add(new Option(dappGetText("text"),"text"));b.inputtype.add(new Option(dappGetText("tel"),"tel"));b.inputtype.add(new Option(dappGetText("email"),"email"));b.inputtype.add(new Option(dappGetText("url"),"url"));b.inputtype.add(new Option(dappGetText("password"),"password"));b.inputtype.add(new Option(dappGetText("number"),"number"));b.inputtype.add(new Option(dappGetText("search"),"search"));b.inputtype.onchange=function(c){a.setInputType(this.value);return};b.leftmargin.value=this.leftMargin;b.leftmargin.onchange=function(c){a.leftMargin=parseInt(this.value);return};b.rightmargin.value=this.rightMargin;b.rightmargin.onchange=function(c){a.rightMargin=parseInt(this.value);return};return};UIEdit.prototype.getWidth=function(b){var a=this.w;if(b){a=a-this.leftMargin-this.rightMargin}return a};UIEdit.prototype.editText=function(o){if(this.textType&&this.textEditable(o)){var b=this.getPositionInView();var f=this.getRealScale();var d=this.view.rect.x;var c=this.view.rect.y;var m=(b.x+this.leftMargin)*f+d;var n=this.getWidth(true)*f;var g=this.getHeight()*f;var a=this.getTextCookie(o);var j=this;var i=null;var e=this.inputType?this.inputType:"text";var l=b.y*f+c;if(n<60){n=60}var q=this.getText(a);j.editing=true;i=wtkShowInput(m,l,n,g);i.setInputType(e);i.removeBorder();i.setFontSize(this.style.fontSize*f);i.setText(q);i.element.onchange=function(){if(q!==this.value){j.setText(this.value,a);j.callOnChanged(j.text);j.postRedraw()}else{j.text=q}i.element.onchange=null;i.hide();j.callOnFocusOut();j.editing=false;return};i.element.onkeyup=function(h){j.callOnChanging(this.value)};this.callOnFocusIn()}return};function UIEditCreator(a,f,e,g,d,b){var c=["ui-edit","ui-edit",null,1];ShapeCreator.apply(this,c);this.createShape=function(i){var h=new UIEdit();return h.initUIEdit(this.type,a,f,e,g,dappGetText("Edit"),d,b)};return}function UIMLEdit(){return}UIMLEdit.prototype=new UIElement();UIMLEdit.prototype.isUIMLEdit=true;UIMLEdit.prototype.initUIMLEdit=function(f,a,e,g,c,d,b){this.initUIElement(f);this.setDefSize(a,e);this.setText(c);this.setTextType(C_SHAPE_TEXT_TEXTAREA);this.setImage(C_SHAPE_IMAGE_ALL,d);this.setImage(C_SHAPE_IMAGE_FOCUSED,b);this.style.setTextAlignment("left");this.setMargin(g,g);this.addEventNames(["onChanged","onFocusIn","onFocusOut"]);return this};UIMLEdit.prototype.drawText=function(a){this.drawMLText(a);return};UIMLEdit.prototype.shapeCanBeChild=function(a){return false};UIMLEdit.prototype.textEditable=function(a){return true};UIMLEdit.prototype.onClick=function(a,b){if(b){return}if(this.mode!==C_MODE_EDITING){this.editText()}return};UIMLEdit.prototype.editText=function(o){if(this.textType&&this.textEditable(o)){var b=this.getPositionInView();var f=this.getRealScale();var d=this.view.rect.x;var c=this.view.rect.y;var m=(b.x+this.hMargin)*f+d;var n=this.getWidth(true)*f;var g=this.getHeight(true)*f;var a=this.getTextCookie(o);var j=this;var i=null;var e=this.inputType?this.inputType:"text";var l=(b.y+this.vMargin)*f+c;if(n<60){n=60}var q=this.getText(a);j.editing=true;i=wtkShowTextArea(m,l,n,g);i.setInputType(e);i.removeBorder();i.setFontSize(this.style.fontSize*f);i.setText(q);i.element.onchange=function(){if(q!==this.value){j.setText(this.value,a);j.callOnChanged(j.text);j.postRedraw()}else{j.setText(q)}i.element.onchange=null;i.hide();j.callOnFocusOut();j.editing=false;return};this.callOnFocusIn()}return};function UIMLEditCreator(a,e,f,d,b){var c=["ui-mledit","ui-mledit",null,1];ShapeCreator.apply(this,c);this.createShape=function(i){var h=new UIMLEdit();return h.initUIMLEdit(this.type,a,e,f,dappGetText("Edit"),d,b)};return}function UIImage(){return}UIImage.prototype=new UIElement();UIImage.prototype.isUIImage=true;UIImage.prototype.initUIImage=function(d,a,c,b){this.initUIElement(d);this.setDefSize(a,c);this.setTextType(C_SHAPE_TEXT_NONE);this.images.display=C_IMAGE_DISPLAY_CENTER;this.setImage(C_SHAPE_IMAGE_ALL,b);this.setImage("option_image_1",null);this.setImage("option_image_2",null);this.setImage("option_image_3",null);this.setImage("option_image_4",null);this.setImage("option_image_5",null);this.setImage("option_image_6",null);this.setImage("option_image_7",null);this.setImage("option_image_8",null);this.setImage("option_image_9",null);this.setImage("option_image_10",null);this.clickable=false;this.imageRotation=0;this.clickedStyleParam=0.8;this.clickedStyleType=UIImage.CLICKED_STYLE_OPACITY;return this};UIImage.prototype.getImageSrcRect=function(){if(this.imageSrcW&&this.imageSrcH){var a={};a.x=this.imageSrcX;a.y=this.imageSrcY;a.w=this.imageSrcW;a.h=this.imageSrcH;return a}else{return null}};UIImage.prototype.setImageSrcRect=function(a,d,b,c){this.imageSrcX=a;this.imageSrcY=d;this.imageSrcW=b;this.imageSrcH=c;return};UIImage.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="rotation">'+dappGetText("Image Rotation(degree)")+':</label>		<input id="rotation"  class="element text medium" type="number" value="0"/> 		<input id="clickable" class="checkbox_i"  type="checkbox" >'+dappGetText("Clickable")+"</input>";return a};UIImage.prototype.setValue=function(a){this.setImage(C_SHAPE_IMAGE_ALL,a);return};UIImage.prototype.setImageSrc=function(a){this.setImage(C_SHAPE_IMAGE_ALL,a);return};UIImage.prototype.getImageSrc=function(){return this.getImageSrcByType(C_SHAPE_IMAGE_ALL)};UIImage.prototype.getHtmlImage=function(){return this.getHtmlImageByType(C_SHAPE_IMAGE_ALL)};UIImage.prototype.loadCustomProp=function(a){var b=this;a.rotation.value=Math.floor((this.imageRotation/Math.PI)*180);a.rotation.onchange=function(c){var d=(parseInt(this.value)/180)*Math.PI;b.setImageRotation(d);return};a.clickable.checked=this.clickable;a.clickable.onchange=function(c){b.setClickable(this.checked);return};return};UIImage.prototype.setBorderStyle=function(b,a){this.borderColor=b;this.borderWidth=a;return};UIImage.prototype.setClickedStyle=function(a,b){this.clickedStyleType=a;this.clickedStyleParam=b;return};UIImage.CLICKED_STYLE_SHADOW=1;UIImage.CLICKED_STYLE_OPACITY=2;UIImage.CLICKED_STYLE_RECT_BG=3;UIImage.CLICKED_STYLE_RECT_BORDER=4;UIImage.prototype.drawImage=function(a){a.save();if(this.imageRotation){a.translate(this.w/2,this.h/2);a.rotate(this.imageRotation);a.translate(-this.w/2,-this.h/2)}var b=a.globalAlpha;if(this.clickable&&this.pointerDown){switch(this.clickedStyleType){case UIImage.CLICKED_STYLE_OPACITY:a.globalAlpha=b*this.clickedStyleParam;break;case UIImage.CLICKED_STYLE_RECT_BG:a.fillStyle=this.style.fillColor;a.fillRect(0,0,this.w,this.h);break;case UIImage.CLICKED_STYLE_SHADOW:a.shadowColor=this.style.lineColor;a.shadowBlur=isNaN(this.clickedStyleParam)?25:this.clickedStyleParam;a.shadowOffsetX=0;a.shadowOffsetY=0;break}}var d=this.getBgImage();var c=this.getImageSrcRect();this.drawImageAt(a,d,this.images.display,0,0,this.w,this.h,c);if(this.clickable&&this.pointerDown){switch(this.clickedStyleType){case UIImage.CLICKED_STYLE_OPACITY:a.globalAlpha=b;break;case UIImage.CLICKED_STYLE_RECT_BORDER:a.strokeStyle=this.style.lineColor;a.lineWidth=isNaN(this.clickedStyleParam)?1:this.clickedStyleParam;a.rect(0,0,this.w,this.h);a.stroke();break;case UIImage.CLICKED_STYLE_SHADOW:a.shadowColor=null;a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;break}}else{if(this.borderColor&&this.borderWidth){a.strokeStyle=this.borderColor;a.lineWidth=this.borderWidth;a.rect(0,0,this.w,this.h);a.stroke()}}a.restore();return};UIImage.prototype.setClickable=function(a){this.clickable=a;return};UIImage.prototype.setImageRotation=function(a){this.imageRotation=a;return};UIImage.prototype.shapeCanBeChild=function(a){return a.isUILabel};function UIImageCreator(e,a,d,b){var c=[e,"ui-image",null,1];ShapeCreator.apply(this,c);this.createShape=function(h){var f=new UIImage();return f.initUIImage(this.type,a,d,b)};return}function UIStaticMap(){return}UIStaticMap.prototype=new UIImage();UIStaticMap.prototype.isUIStaticMap=true;UIStaticMap.prototype.initUIStaticMap=function(a){this.initUIImage(a,200,200,null);return this};UIStaticMap.prototype.setMapProvider=function(a){this.mapProvider=a;return};UIStaticMap.prototype.setMapType=function(a){this.mapType=a;return};UIStaticMap.prototype.setMapZoom=function(a){this.mapZoom=a;return};UIStaticMap.prototype.setMapCenter=function(a){this.mapCenter=a;return};UIStaticMap.prototype.setMapWidth=function(a){this.mapWidth=a;return};UIStaticMap.prototype.setMapHeight=function(a){this.mapHeight=a;return};UIStaticMap.prototype.setMapExtraParams=function(a){this.mapEtraParams=a;return};UIStaticMap.prototype.getMapType=function(){return this.mapType?this.mapType:""};UIStaticMap.prototype.getMapProvider=function(){return this.mapProvider?this.mapProvider:"google"};UIStaticMap.prototype.getMapZoom=function(){return this.mapZoom?this.mapZoom:10};UIStaticMap.prototype.getMapWidth=function(){return this.mapWidth?this.mapWidth:600};UIStaticMap.prototype.getMapHeight=function(){return this.mapHeight?this.mapHeight:600};UIStaticMap.prototype.getMapCenter=function(){if(!this.mapCenter&&this.currentLocation){return this.currentLocation}else{return this.mapCenter?this.mapCenter:"China"}};UIStaticMap.prototype.getMapExtraParams=function(){return this.mapEtraParams?this.mapEtraParams:""};UIStaticMap.prototype.getMapURL=function(){var a="";if(this.mapProvider==="baidu"){a="http://api.map.baidu.com/staticimage?center="+this.getMapCenter()+"&width="+this.getMapWidth()+"&height="+this.getMapHeight()+"&zoom="+this.getMapZoom()+this.getMapExtraParams()}else{if(this.mapProvider==="google"){a="http://maps.googleapis.com/maps/api/staticmap?center="+this.getMapCenter()+"&size="+this.getMapWidth()+"x"+this.getMapHeight()+"&zoom="+this.getMapZoom()+"&maptype="+this.getMapType()+"&sensor=true"+this.getMapExtraParams()}}console.log("Map URL:"+a);return a};UIStaticMap.prototype.updateMap=function(){var a=this.getMapURL();this.setImageSrc(a);return};UIStaticMap.prototype.onInit=function(){var b=this;function a(c){b.currentLocation=c.coords.latitude+","+c.coords.longitude;b.updateMap();return}if(navigator.geolocation){navigator.geolocation.getCurrentPosition(a)}this.updateMap();return};UIStaticMap.prototype.drawImage=function(a){this.drawBgImage(a);return};UIStaticMap.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="mapprovider">'+dappGetText("Map Provider")+':</label>		<select class="element select small" id="mapprovider" >			<option>baidu</option>			<option>google</option>		</select> 		<label class="description" for="mapprovider">'+dappGetText("Map Type")+':</label>		<select class="element select small" id="maptype" >			<option>roadmap</option>			<option>satellite</option>			<option>hybrid</option>			<option>terrain</option>		</select> 		<label class="description" for="zoom">'+dappGetText("Zoom")+':</label>		<input id="zoom"  class="element text medium" type="number" maxlength="2" value="0"/> 		<label class="description" for="width">'+dappGetText("Width")+':</label>		<input id="width"  class="element text medium" type="number" maxlength="4" value="0"/> 		<label class="description" for="height">'+dappGetText("Height")+':</label>		<input id="height"  class="element text medium" type="number" maxlength="4" value="0"/> 		<label class="description" for="height">'+dappGetText("Center Position")+':</label>		<input id="center"  class="element text medium" type="text" value=""/> 		<label class="description" for="extraparams">'+dappGetText("Other Parameters")+':</label> 		<input id="extraparams"  class="element text medium" type="text" value=""/>';return a};UIStaticMap.prototype.loadCustomProp=function(a){var b=this;a.mapprovider.value=this.getMapProvider();a.mapprovider.onchange=function(c){b.setMapProvider(this.value);b.updateMap();return};a.maptype.value=this.getMapType();a.maptype.onchange=function(c){b.setMapType(this.value);b.updateMap();return};a.zoom.value=this.getMapZoom();a.zoom.onchange=function(c){b.setMapZoom(this.value);b.updateMap();return};a.width.value=this.getMapWidth();a.width.onchange=function(c){b.setMapWidth(this.value);b.updateMap();return};a.height.value=this.getMapHeight();a.height.onchange=function(c){b.setMapHeight(this.value);b.updateMap();return};a.center.value=this.getMapCenter();a.center.onchange=function(c){b.setMapCenter(this.value);b.updateMap();return};a.extraparams.value=this.getMapExtraParams();a.extraparams.onchange=function(c){b.setMapExtraParams(this.value);b.updateMap();return};return};function UIStaticMapCreator(){var a=["ui-static-map","ui-static-map",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIStaticMap();return b.initUIStaticMap(this.type)};return}function UIWaitBar(){return}UIWaitBar.TILES=8;UIWaitBar.prototype=new UIElement();UIWaitBar.prototype.isUIWaitBar=true;UIWaitBar.prototype.initUIWaitBar=function(d,a,c,e,b){this.initUIElement(d);this.offset=0;this.running=false;this.setDefSize(a,c);this.setTextType(C_SHAPE_TEXT_NONE);this.images.display=b;this.setImage(C_SHAPE_IMAGE_ALL,e);return this};UIWaitBar.prototype.shapeCanBeChild=function(a){return false};UIWaitBar.prototype.isRunning=function(){return this.running};UIWaitBar.prototype.start=function(){this.running=true;return};UIWaitBar.prototype.stop=function(){this.running=false;return};UIWaitBar.prototype.drawBgImage=function(b){var d=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!d){return}var j=d.width;var f=d.height;var g=f/UIWaitBar.TILES;var c=this.offset*g;var m=0;var l=c;var n=j;var e=f;var a=this.w;var i=this.h;var p=(a-j)/2;var o=(i-g)/2;if(j<100&&f<100){l=0;o=(i-f)/2;b.save();b.translate(this.w/2,this.h/2);b.rotate(0.1*Math.PI*this.offset);b.translate(-this.w/2,-this.h/2);b.drawImage(d,m,l,j,f,p,o,j,f);b.restore()}else{switch(this.images.display){case C_IMAGE_DISPLAY_CENTER:b.drawImage(d,m,l,n,g,p,o,n,g);break;default:b.drawImage(d,m,l,n,g,0,o,a,g);break}}return};UIWaitBar.prototype.needRedraw=function(){if(!this.isVisible()||!this.running){return false}if(!this.windowIsCurrent()){return false}if(this.mode===C_MODE_EDITING){return false}return true};function UIWaitBarCreator(e,a,d,f,c){var b=[e,"ui-wait-bar",null,1];ShapeCreator.apply(this,b);this.createShape=function(i){var h=new UIWaitBar();if(e!==C_CREATE_FOR_ICON){setInterval(function(){if(h.needRedraw()){h.offset=(h.offset+1);if(h.type==="ui-wait-bar"){h.offset=h.offset%UIWaitBar.TILES}h.redrawSelf()}},80)}return h.initUIWaitBar(this.type,a,d,f,c)};return}function UIButton(){return}UIButton.prototype=new UIElement();UIButton.prototype.isUIButton=true;UIButton.prototype.initUIButton=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setSizeLimit(50,50);this.setAutoScaleFontSize(true);this.setTextType(C_SHAPE_TEXT_INPUT);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setImage(C_SHAPE_IMAGE_FOCUSED,null);this.setImage(C_SHAPE_IMAGE_ACTIVE,null);this.setImage(C_SHAPE_IMAGE_NORMAL,null);this.setImage(C_SHAPE_IMAGE_DISABLE,null);return this};UIButton.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage){return true}return false};UIButton.prototype.paintSelfOnly=function(a){if(this.pointerDown){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ACTIVE);if(!b){a.fillRect(0,0,this.w,this.h)}}return};UIButton.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="fontfamily">'+dappGetText("Font Family")+':</label>		<input id="fontfamily"  class="element text medium" type="text" value="serif"/> 		<br><input id="textshadow" class="checkbox_i"  type="checkbox" >		        '+dappGetText("Enable Text Shadow")+"</input>";return a};UIButton.prototype.loadCustomProp=function(b){var a=this;b.fontfamily.value=this.style.fontFamily;b.fontfamily.onchange=function(c){a.style.setFontFamily(this.value);return};b.textshadow.checked=this.textShadow?true:false;b.textshadow.onchange=function(c){a.setTextShadow(this.checked);return};return};UIButton.prototype.drawText=function(a){this.draw1LText(a);return};function UIButtonCreator(a,c){var b=["ui-button","ui-button",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIButton();return d.initUIButton(this.type,a,c)};return}function UIImageButton(){return}UIImageButton.prototype=new UIButton();UIImageButton.prototype.isUIImageButton=true;UIImageButton.prototype.initUIImageButton=function(c,a,b){this.initUIButton(c,a,b);this.noTextAlignment=true;this.setImage(C_SHAPE_IMAGE_NORMAL_FG,null);this.setImage(C_SHAPE_IMAGE_ACTIVE_FG,null);return this};UIImageButton.prototype.drawText=function(a){return};UIImageButton.prototype.shapeCanBeChild=function(a){return false};UIImageButton.prototype.getFgImage=function(){var a=null;if(this.pointerDown){a=this.getHtmlImageByType(C_SHAPE_IMAGE_ACTIVE_FG)}else{a=this.getHtmlImageByType(C_SHAPE_IMAGE_NORMAL_FG)}return a};UIImageButton.prototype.paintSelfOnly=function(b){var n=2;var c=this.getFgImage();var f=this.getLocaleText(this.text);var p=this.style.fontSize;var i=0;var g=0;var j=this.w;var d=this.h;b.font=this.style.getFont();b.fillStyle=this.style.textColor;if(c){var l=c.width;var e=c.height;var a=this.hMargin;if(f){if(this.w>2*this.h){var o=i+a;var m=Math.floor(g+(d-e)/2);b.drawImage(c,0,0,l,e,o,m,l,e);m=Math.floor(g+d/2);o=Math.floor(i+(j-l)/2+l);b.textAlign="center";b.textBaseline="middle";b.fillText(f,o,m)}else{var o=Math.floor(i+(j-l)/2);var m=Math.floor(g+(d-e-p-n)/2);b.drawImage(c,0,0,l,e,o,m,l,e);o=Math.floor(i+j/2);m=m+e+n;b.textAlign="center";b.textBaseline="top";b.fillText(f,o,m)}}else{var o=Math.floor(i+(j-l)/2);var m=Math.floor(g+(d-e)/2);b.drawImage(c,0,0,l,e,o,m,l,e)}}else{if(f){b.textAlign="center";b.textBaseline="middle";b.fillText(f,Math.floor(i+j/2),Math.floor(g+d/2))}}return};function UIImageButtonCreator(a,c){var b=["ui-image-button","ui-image-button",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIImageButton();return d.initUIImageButton(this.type,a,c)};return}function UIToolBar(){return}UIToolBar.prototype=new UIElement();UIToolBar.prototype.isUIToolBar=true;UIToolBar.prototype.initUIToolBar=function(c,d,b,a){this.initUIElement(c);this.xAttr=C_X_LEFT_IN_PARENT;this.widthAttr=C_WIDTH_FILL_PARENT;this.yAttr=d?C_Y_TOP_IN_PARENT:C_Y_BOTTOM_IN_PARENT;this.setDefSize(200,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,a);this.setSizeLimit(100,50,2000,200);return this};UIToolBar.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage||a.isUIButton||a.isUIButtonGroup||a.isUIEdit||a.isUICheckBox||a.isUIRadioBox||a.isUIProgressBar||a.isUISwitch){return true}return false};UIToolBar.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.beginPath();a.fillRect(0,0,this.w,this.h)}return};function UIToolBarCreator(d,e,c,b){var a=[d,"ui-toolbar",null,1];ShapeCreator.apply(this,a);this.createShape=function(h){var f=new UIToolBar();return f.initUIToolBar(d,e,c,b)};return}function UIScrollView(){return this}UIScrollView.prototype=new UIElement();UIScrollView.prototype.isUIScrollView=true;UIScrollView.prototype.afterChildAppended=function(a){a.setCanRectSelectable(false,true);return true};UIScrollView.prototype.initUIScrollView=function(c,a,b){this.initUIElement(c);this.offset=0;this.scrollBarOpacity=0;this.setMargin(a,a);this.setSizeLimit(100,100,2000,2000);this.setDefSize(300+2*a,300+2*a);this.velocityTracker=new VelocityTracker();this.interpolator=new DecelerateInterpolator(2);this.widthAttr=C_WIDTH_FILL_PARENT;this.heightAttr=C_HEIGHT_FILL_PARENT;this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,b);if(!b){this.style.setFillColor("#f0f0f0")}this.setCanRectSelectable(false,true);return this};UIScrollView.prototype.fixChildSize=function(a){if(a.widthAttr===C_WIDTH_FILL_PARENT){a.w=this.getWidth(true)}if(a.heightAttr===C_HEIGHT_FILL_PARENT){a.h=this.getHeight(true)}if(a.widthAttr===C_WIDTH_FILL_PARENT&&a.heightAttr===C_HEIGHT_FILL_PARENT){a.setUserMovable(false);a.setUserResizable(false)}return};UIScrollView.prototype.shapeCanBeChild=function(a){if(a.isUIButton||a.isUILabel||a.isUIImage||a.isUIList||a.isUIGrid||a.isUIProgressBar||a.isUICheckBox||a.isUIRadioBox||a.isUIWaitBar||a.isUIButtonGroup||a.isUITips||a.isUIGroup){return true}return false};UIScrollView.prototype.onModeChanged=function(){this.offset=0;return};UIScrollView.prototype.scrollTo=function(a){this.offset=a;return};UIScrollView.prototype.scrollDelta=function(b){var a=this.offset+b;this.scrollTo(a);return};UIScrollView.prototype.scrollToPageDelta=function(b){var a=Math.floor(this.offset/this.w)+b;this.scrollToPage(a);return};UIScrollView.prototype.scrollToPage=function(a){if(a<0){a=0}var b=this.w*a;var c=this.offset-b;this.animScrollTo(c,300);return};UIScrollView.prototype.onPointerDownEditing=function(a,b){if(b){return}this.velocityTracker.clear();return};UIScrollView.prototype.onPointerDownRunning=function(a,b){if(b){return}this.velocityTracker.clear();return};UIScrollView.prototype.onPointerMoveEditing=function(a,b){if(b){return}this.addMovementForVelocityTracker();return};UIScrollView.prototype.onDrag=function(a){return};UIScrollView.prototype.onPointerMoveRunning=function(a,b){if(b){return}this.scrollBarOpacity=0;var c=this.getScrollDelta(a);if(this.pointerDown&&this.needScroll(a)){this.scrollBarOpacity=1;this.scrollDelta(-c)}this.addMovementForVelocityTracker();this.onDrag(this.offset);return};UIScrollView.prototype.animScrollTo=function(a,e){var f=this;var d=new Date();var c=d.getTime();var h=this.offset;var j=h-a;var g=this.getScrollRange();var i=this.getPageSize();e=e<600?600:e;if(j<0){e=600;a=h}if(this.mode!=C_MODE_EDITING){if(j>(g-i)){a=h-(g-i)}}if(g<=i){j=0;a=h}function b(){var m=new Date();var o=m.getTime();var l=(o-c)/e;var n=f.interpolator.get(l);var p=h-a*Math.min(n,1);if(l<1&&!f.pointerDown){setTimeout(b,10);f.scrollTo(p);f.scrollBarOpacity=1-n}else{var p=h-a;f.scrollBarOpacity=0;f.scrollTo(p)}f.postRedraw();return}setTimeout(b,30);return};UIScrollView.prototype.onOutOfRange=function(a){return};UIScrollView.prototype.onPointerUpRunning=function(l,j){if(j){return}var m=this.getScrolledSize();if(!this.needScroll(l)){this.scrollBarOpacity=0;return}var c=0;var b=0;var e=this.getVelocity();var i=this.getPageSize();var n=e/i;var g=0.5*i*n*n;b=Math.abs(g);c=2*b/e;b=m<0?-b:b;c=Math.abs(c);if(c>3){c=3}var f=this.offset;var h=f-b;if(h<0){this.onOutOfRange(h)}this.animScrollTo(b,c*1000);return true};UIScrollView.prototype.onPointerUpEditing=function(a,d){if(d){this.sortChildren()}else{this.relayoutChildren();return}var f=0;var e=this.getScrolledSize();var c=this.getVelocity();var b=this.getPageSize();if(Math.abs(e)>0.3*b&&Math.abs(c)>b){f=e>0?b:-b}if(f){this.animScrollTo(f,1000)}return};UIScrollView.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.beginPath();a.fillRect(0,0,this.w,this.h)}return};function UIHScrollView(){return}UIHScrollView.prototype=new UIScrollView();UIHScrollView.prototype.isUIHScrollView=true;UIHScrollView.prototype.initUIHScrollView=function(c,a,b){this.initUIScrollView(c,a,b);return this};UIHScrollView.prototype.needScroll=function(a){var c=Math.abs(this.getMoveAbsDeltaX());var b=Math.abs(this.getMoveAbsDeltaY());return(c>20&&c>b)||(c>20&&this.mode!=C_MODE_EDITING)};UIHScrollView.prototype.getScrolledSize=function(){return Math.floor(this.getMoveAbsDeltaX())};UIHScrollView.prototype.getScrollDelta=function(a){return Math.floor(this.getMoveDeltaX())};UIHScrollView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().x};UIHScrollView.prototype.getPageSize=function(){return this.w};UIHScrollView.prototype.onPointerUpRunning=function(b,e){if(e){return}var c=0;var d=this.getVelocity();var f=this.getScrolledSize();var a=Math.abs(f);if(a>this.w/4||d>this.w){if(f<0){c=1}else{c=-1}}this.scrollToPageDelta(c);return true};UIHScrollView.prototype.translatePoint=function(a){var b={x:(a.x-this.x+this.offset),y:(a.y-this.y)};return b};UIHScrollView.prototype.getScrollRange=function(){var a=0;var b=this.calcChildrenRange();a=b.r-b.l;if(a<this.w){a=this.w}a=Math.ceil(a/this.w)*this.w;return a};UIHScrollView.prototype.fixChildPosition=function(a){if(a.widthAttr===C_WIDTH_FILL_PARENT){a.x=this.offset+this.hMargin;a.widthAttr=C_WIDTH_SCALE}if(a.heightAttr===C_HEIGHT_FILL_PARENT){a.y=this.vMargin}if(a.widthAttr===C_WIDTH_FILL_PARENT&&a.heightAttr===C_HEIGHT_FILL_PARENT){a.setUserMovable(false)}return};UIHScrollView.prototype.paintChildren=function(c){var b=null;var f=null;var e=this.offset;var a=this.offset+this.w;c.save();c.beginPath();c.rect(0,0,this.w,this.h);c.closePath();c.clip();c.beginPath();c.translate(-this.offset,0);for(var d=0;d<this.children.length;d++){b=this.children[d];if(!b.visible){continue}if((b.x+b.w)<e||b.y>a){continue}if(b.pointerDown&&b.selected&&this.mode===C_MODE_EDITING){f=b}else{this.beforePaintChild(b,c);b.paintSelf(c);this.afterPaintChild(b,c)}}if(f){b=f;this.beforePaintChild(b,c);b.paintSelf(c);this.afterPaintChild(b,c)}c.restore();return};function UIHScrollViewCreator(b,c){var a=["ui-h-scroll-view","ui-h-scroll-view",null,1];ShapeCreator.apply(this,a);this.createShape=function(e){var d=new UIHScrollView();return d.initUIHScrollView(this.type,b,c)};return}function UIVScrollView(){return}UIVScrollView.prototype=new UIScrollView();UIVScrollView.prototype.isUIVScrollView=true;UIVScrollView.prototype.initUIVScrollView=function(d,a,c,b){this.initUIScrollView(d,a,c);this.setImage("scrollBarImg",b);this.rectSelectable=false;return this};UIVScrollView.prototype.needScroll=function(a){var c=Math.abs(this.getMoveAbsDeltaX());var b=Math.abs(this.getMoveAbsDeltaY());return(b>50&&b>c)||(b>50&&this.mode!=C_MODE_EDITING)};UIVScrollView.prototype.getScrolledSize=function(){return Math.floor(this.getMoveAbsDeltaY())};UIVScrollView.prototype.getScrollDelta=function(a){return Math.floor(this.getMoveDeltaY())};UIVScrollView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().y};UIVScrollView.prototype.getPageSize=function(){return this.h};UIVScrollView.prototype.translatePoint=function(a){var b={x:(a.x-this.x),y:(a.y-this.y+this.offset)};return b};UIVScrollView.prototype.getScrollRange=function(){var a=0;var b=this.calcChildrenRange();a=b.b;if(a<this.h){a=this.h}a=Math.ceil(a/this.h)*this.h;return a};UIVScrollView.prototype.fixChildPosition=function(a){if(a.widthAttr===C_WIDTH_FILL_PARENT){a.x=this.hMargin}if(a.heightAttr===C_HEIGHT_FILL_PARENT){a.y=this.offset+this.vMargin;a.heightAttr=C_HEIGHT_SCALE}if(a.widthAttr===C_WIDTH_FILL_PARENT&&a.heightAttr===C_HEIGHT_FILL_PARENT){a.setUserMovable(false)}return};UIVScrollView.prototype.paintChildren=function(b){var a=null;var f=null;var e=this.offset;var d=this.offset+this.h;b.save();b.beginPath();b.rect(0,0,this.w,this.h);b.closePath();b.clip();b.beginPath();b.translate(0,-this.offset);var f=null;for(var c=0;c<this.children.length;c++){a=this.children[c];if(!a.visible){continue}if((a.y+a.h)<e||a.y>d){continue}if(a.pointerDown&&a.selected&&this.mode===C_MODE_EDITING){f=a}else{this.beforePaintChild(a,b);a.paintSelf(b);this.afterPaintChild(a,b)}}if(f){a=f;this.beforePaintChild(a,b);a.paintSelf(b);this.afterPaintChild(a,b)}b.restore();return};UIVScrollView.prototype.afterPaintChildren=function(a){this.drawScrollBar(a);return};UIVScrollView.prototype.drawScrollBar=function(d){var f=this.getHtmlImageByType("scrollBarImg");if(!this.scrollBarOpacity||!f){return}var c=this.getScrollRange();var a=this.w-f.width-2;var b=f.width;var e=this.h*this.h/c;var g=(this.offset/c)*this.h;if((g+e)>this.h){e=this.h-g;g=this.h-e}if(g<0){e=e+g;g=0}d.save();d.globalAlpha=this.scrollBarOpacity;drawNinePatchEx(d,f,0,0,f.width,f.height,a,g,b,e);d.restore();return};function UIVScrollViewCreator(b,d,c){var a=["ui-v-scroll-view","ui-v-scroll-view",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new UIVScrollView();return e.initUIVScrollView(this.type,b,d,c)};return}function UIList(){return}UIList.prototype=new UIElement();UIList.prototype.isUIList=true;UIList.prototype.initUIList=function(c,a,d,b){this.initUIElement(c);this.setMargin(a,a);this.setSizeLimit(100,100,1000,1000);this.setDefSize(400,d*3+2*a);this.itemHeight=d;this.widthAttr=C_WIDTH_FILL_PARENT;this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,b);this.rectSelectable=false;this.itemHeightVariable=false;this.addEventNames(["onInit"]);if(!b){this.style.setFillColor("White")}return this};UIList.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="border">'+dappGetText("Border Size")+':</label>		<input id="border"  class="element text small" type="number" value="0"/>		<label class="description" for="itemheight">'+dappGetText("Item Height")+':</label>		<input id="itemheight"  class="element text small" type="number" value="0"/> 		<input id="itemheightvariable" class="checkbox_i" type="checkbox"> '+dappGetText("Item Height Variable")+"</input>";if(!this.isUIScrollView){a=a+'<input id="itemdraggable" class="checkbox_i" type="checkbox"> '+dappGetText("Item Draggable")+"</input>"}return a};UIList.prototype.loadCustomProp=function(a){var b=this;a.itemheight.value=this.itemHeight;a.itemheight.onchange=function(c){b.itemHeight=parseInt(a.itemheight.value);return};a.border.value=this.getHMargin();a.border.onchange=function(d){var c=parseInt(this.value);b.setMargin(c,c);return};a.itemheightvariable.checked=this.itemHeightVariable;a.itemheightvariable.onchange=function(c){b.itemHeightVariable=this.checked;return};if(!this.isUIScrollView){a.itemdraggable.checked=this.itemDraggable;a.itemdraggable.onchange=function(c){b.itemDraggable=this.checked;return}}return};UIList.prototype.shapeCanBeChild=function(a){if(!a.isUIListItem){return false}return true};UIList.prototype.paintSelfOnly=function(a){return};UIList.prototype.childIsBuiltin=function(a){return a.name==="ui-list-item-update-status"||a.name==="ui-list-item-update-tips"||a.name==="ui-last"};UIList.FIRST_ITEM=-1;UIList.LAST_ITEM=1;UIList.MIDDLE_ITEM=0;UIList.SINGLE_ITEM=2;UIList.prototype.fixListItemImage=function(d,b){var a=d.images;for(var c in a){var e=a[c];if(c!="display"){var f=e.getImageSrc();switch(b){case UIList.FIRST_ITEM:f=f.replace(/\.single\./,".first.");f=f.replace(/\.middle\./,".first.");f=f.replace(/\.last\./,".first.");break;case UIList.MIDDLE_ITEM:f=f.replace(/\.single\./,".middle.");f=f.replace(/\.first\./,".middle.");f=f.replace(/\.last\./,".middle.");break;case UIList.LAST_ITEM:f=f.replace(/\.single\./,".last.");f=f.replace(/\.first\./,".last.");f=f.replace(/\.middle\./,".last.");break;case UIList.SINGLE_ITEM:f=f.replace(/\.first\./,".single.");f=f.replace(/\.middle\./,".single.");f=f.replace(/\.last\./,".single.");break}e.setImageSrc(f)}}return};UIList.prototype.relayoutChildren=function(l){if(this.disableRelayout){return}var e=this.getHMargin();var o=e;var m=e;var p=this.w-2*e;var g=this.itemHeight;var d=this.children.length;var a=this.itemHeightVariable;for(var f=0;f<d;f++){var c={};var j=false;var b=this.children[f];if(a||b.isHeightVariable()){g=b.measureHeight(this.itemHeight)}else{g=this.itemHeight}if(d===1){this.fixListItemImage(b,UIList.SINGLE_ITEM)}else{if(f===0){this.fixListItemImage(b,UIList.FIRST_ITEM)}else{if(f===(d-1)){this.fixListItemImage(b,UIList.LAST_ITEM)}else{this.fixListItemImage(b,UIList.MIDDLE_ITEM)}}}if(this.h<=(m+e+g)){this.h=m+e+g}j=(m<this.h)&&(l||this.mode===C_MODE_EDITING);if(j){c.xStart=b.x;c.yStart=b.y;c.wStart=b.w;c.hStart=b.h;c.xEnd=o;c.yEnd=m;c.wEnd=p;c.hEnd=g;c.delay=10;c.duration=1000;c.element=b;c.onDone=function(h){h.relayoutChildren()};b.animate(c)}else{b.move(o,m);b.setSize(p,g);b.relayoutChildren()}b.setUserMovable(true);b.widthAttr=C_WIDTH_FILL_PARENT;if(b.heightAttr===C_HEIGHT_FILL_PARENT){b.heightAttr=C_HEIGHT_FIX}b.setUserResizable(a||b.isHeightVariable());if(!this.isUIScrollView){b.setDraggable(this.itemDraggable)}m+=g}return};UIList.prototype.beforePaintChildren=function(a){a.beginPath();a.rect(0,0,this.w,this.h);a.clip();a.beginPath();return};UIList.prototype.afterPaintChildren=function(a){return};UIList.prototype.afterChildAppended=function(a){if(a.view&&this.mode===C_MODE_EDITING&&a.isCreatingElement()){this.sortChildren()}this.moveMustBeLastItemToLast();a.setUserMovable(true);a.setUserResizable(false);a.setCanRectSelectable(false,true);a.autoAdjustHeight=this.itemHeightVariable;a.setDraggable(this.itemDraggable);return true};UIList.prototype.sortChildren=function(){this.children.sort(function(d,c){var f=c.y;var e=c.pointerDown?d.y+d.h:d.y;return e-f});return};UIList.prototype.onPointerUpEditing=function(a,b){if(this.view&&this.view.isClicked()){return}if(this.mode!==C_MODE_EDITING){return}if(b){this.sortChildren()}else{this.relayoutChildren();return}};function UIListCreator(b,d,c){var a=["ui-list","ui-list",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new UIList();return e.initUIList(this.type,b,d,c)};return}function UIListView(){return}UIListView.prototype=new UIVScrollView();UIListView.prototype.isUIList=true;UIListView.prototype.isUIListView=true;UIListView.prototype.sortChildren=UIList.prototype.sortChildren;UIListView.prototype.initUIList=UIList.prototype.initUIList;UIListView.prototype.getCustomProp=UIList.prototype.getCustomProp;UIListView.prototype.loadCustomProp=UIList.prototype.loadCustomProp;UIListView.prototype.shapeCanBeChild=UIList.prototype.shapeCanBeChild;UIListView.prototype.paintSelfOnly=UIList.prototype.paintSelfOnly;UIListView.prototype.fixListItemImage=function(b,a){};UIListView.prototype.afterChildAppended=UIList.prototype.afterChildAppended;UIListView.prototype.childIsBuiltin=UIList.prototype.childIsBuiltin;UIListView.UPDATE_STATUS_NONE=0;UIListView.UPDATE_STATUS_TIPS=1;UIListView.UPDATE_STATUS_SYNC=2;UIListView.prototype.beginUpdate=function(){this.updateStatus=UIListView.UPDATE_STATUS_SYNC;var a=this.findChildByName("ui-list-item-update-status");if(a){var b=a.findChildByName("ui-wait-box");if(b){b.show();b.start()}var c=a.findChildByName("ui-label-loading");if(c){c.setText(dappGetText("Loading..."))}}return};UIListView.prototype.endUpdate=function(){this.updateStatus=UIListView.UPDATE_STATUS_NONE;var a=this.findChildByName("ui-list-item-update-status");if(a){var b=a.findChildByName("ui-wait-box");if(b){b.stop()}this.setLastUpdateTime(new Date())}return};UIListView.prototype.initUIListView=function(c,a,d,b){this.initUIList(c,a,d,b);this.initUIVScrollView(c,0,b,null);this.updateStatus=UIListView.UPDATE_STATUS_NONE;this.addEventNames(["onUpdateData"]);return this};UIListView.prototype.onModeChanged=function(){this.offset=0;this.updateStatus=UIListView.UPDATE_STATUS_NONE;return};UIListView.prototype.updateDone=function(){var a=this;a.endUpdate();setTimeout(function(){a.relayoutChildren();a.postRedraw()},1000);return};UIListView.prototype.callOnUpdateData=function(){if(!this.handleOnUpdateData||this.mode===C_MODE_PREVIEW){var sourceCode=this.events.onUpdateData;if(sourceCode){sourceCode="this.handleOnUpdateData = function(value) {\n"+sourceCode+"\n}\n";try{eval(sourceCode)}catch(e){console.log("eval sourceCode failed: "+e.message+"\n"+sourceCode)}}}if(this.handleOnUpdateData){try{this.handleOnUpdateData()}catch(e){console.log("this..handleOnUpdateData:"+e.message)}}this.beginUpdate();var listView=this;setTimeout(function(){listView.updateDone()},10000);return true};UIListView.prototype.setLastUpdateTime=function(f){var a=this.findChildByName("ui-list-item-update-tips");if(a&&f){var e="";var b=new Date();if(b.getFullYear()===f.getFullYear()&&b.getDate()===f.getDate()&&b.getMonth()===f.getMonth()){e=dappGetText("Today")}else{e=f.getMonth()+"-"+f.getDate()}e=e+" "+f.getHours()+":"+f.getMinutes();var c=a.findChildByName("ui-label-update-time");if(c){c.setText(e)}var c=a.findChildByName("ui-label-update-time");if(c){c.setText(e)}var d=a.findChildByName("ui-label-update-time-tips");if(d){d.setText(dappGetText("Last Update:"))}}return};UIListView.prototype.onDrag=function(e){var c=this.findChildByName("ui-list-item-update-tips");if(c){var b=c.findChildByName("ui-image");var a=c.findChildByName("ui-label-tips");if(b){if(e<-115){if(b.imageRotation===0){function d(){var f=b.imageRotation+0.2*Math.PI;if(f>Math.PI){f=Math.PI}b.setImageRotation(f);if(f<Math.PI){setTimeout(d,50)}b.postRedraw();return}d();if(a){a.setText(dappGetText("Release To Update."))}}}else{b.setImageRotation(0);if(a){a.setText(dappGetText("Pull To Update."))}}}}return};UIListView.prototype.onOutOfRange=function(a){if(a<-115){this.callOnUpdateData();this.relayoutChildren()}return};UIListView.prototype.relayoutChildren=function(o){if(this.disableRelayout){return}var e=this.getHMargin();var q=e;var p=e;var r=this.w-2*e;var l=this.itemHeight;var d=this.children.length;var a=this.itemHeightVariable;var j=this.getScrollRange();var m=this.getPageSize();var g=j<=m;for(var f=0;f<d;f++){var c={};var s=false;var b=this.children[f];if(a||b.isHeightVariable()){l=b.measureHeight(this.itemHeight)}else{l=this.itemHeight}if(b.name==="ui-list-item-update-tips"){if(this.mode!==C_MODE_EDITING){b.move(q,-l);b.x=q;b.y=-l;b.w=r;b.h=l;b.setUserMovable(false);b.setUserResizable(false);b.setVisible(this.updateStatus!==UIListView.UPDATE_STATUS_TIPS);continue}else{b.setVisible(true)}s=true}else{if(b.name==="ui-list-item-update-status"){if(this.mode!==C_MODE_EDITING){if(this.updateStatus!==UIListView.UPDATE_STATUS_SYNC){b.setVisible(false)}else{b.setVisible(true)}}else{b.setVisible(true)}s=true}}if(!b.visible){continue}animatable=b.isVisible()&&!s&&(p<this.h)&&(o||this.mode===C_MODE_EDITING);if(animatable){c.xStart=b.x;c.yStart=b.y;c.wStart=b.w;c.hStart=b.h;c.xEnd=q;c.yEnd=p;c.wEnd=r;c.hEnd=l;c.delay=10;c.duration=1000;c.element=b;c.onDone=function(h){h.relayoutChildren()};b.animate(c)}else{b.move(q,p);b.setSize(r,l);b.relayoutChildren()}b.widthAttr=C_WIDTH_FILL_PARENT;if(b.heightAttr===C_HEIGHT_FILL_PARENT){b.heightAttr=C_HEIGHT_FIX}b.setUserMovable(g);b.setUserResizable(a||b.isHeightVariable());p+=l}return};function UIListViewCreator(b,d,c){var a=["ui-list-view","ui-list-view",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new UIListView();return e.initUIListView(this.type,b,d,c)};return}function UIListItem(){return}UIListItem.prototype=new UIElement();UIListItem.prototype.isUIListItem=true;UIListItem.prototype.initUIListItem=function(c,e,d,a,b){this.initUIElement(c);this.setDefSize(200,120);this.widthAttr=C_WIDTH_FILL_PARENT;this.setTextType(C_SHAPE_TEXT_NONE);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setImage(C_SHAPE_IMAGE_FOCUSED,e);this.setImage(C_SHAPE_IMAGE_ACTIVE,d);this.setImage(C_SHAPE_IMAGE_NORMAL,a);this.setImage(C_SHAPE_IMAGE_DISABLE,b);this.setImage(C_SHAPE_IMAGE_DELETE_ITEM,null);this.addEventNames(["onRemoved"]);return this};UIListItem.prototype.dragMove=function(b,a){this.y=this.y+a;this.onDragging();return};UIListItem.prototype.getDeleteItemIcon=function(){var a=this.getHtmlImageByType(C_SHAPE_IMAGE_DELETE_ITEM);if(!a){this.setImage(C_SHAPE_IMAGE_DELETE_ITEM,"drawapp8/images/common/icons/xhdpi/list_delete_item.png");a=this.getHtmlImageByType(C_SHAPE_IMAGE_DELETE_ITEM)}return a};UIListItem.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage||a.isUIButton||a.isUICheckBox||a.isUISwitch||a.isUIProgressBar||a.isUIWaitBar||a.isUIEdit||a.isUIColorBar||a.isUITips||a.isUIGroup||a.isUILayout||a.isUIColorTile||a.isUISelect){return true}return false};UIListItem.prototype.onUserResized=function(){var a=this.parentShape;if(a){a.relayoutChildren()}return};UIListItem.cachedBgImages=new Array();UIListItem.prototype.addCacheImage=function(c,e,b,d){var a={name:c,data:e,w:b,h:d};UIListItem.cachedBgImages.push(a);return};UIListItem.prototype.getCacheImage=function(d,c,f){var e=0;var b=null;var a=UIListItem.cachedBgImages;var g=UIListItem.cachedBgImages.length;for(e=0;e<g;e++){b=a[e];if(b.w===c&&b.h===f&&b.name===d){return b.data}}return null};UIListItem.prototype.createCacheImage=function(f){var b=this.w;var e=this.h;var d=null;var f=this.getBgImage();var c=BackendCanvasGet();var a=c.getContext("2d");if(f){a.clearRect(0,0,b,e);drawNinePatchEx(a,f,0,0,f.width,f.height,0,0,b,e);d=a.getImageData(0,0,b,e);this.addCacheImage(f.src,d,b,e)}return d};UIListItem.prototype.getCustomProp=function(){var a=' <br>		<input id="istemplate" class="checkbox_i"  type="checkbox" > '+dappGetText("As Template For DataBinding")+'</input> 		<input id="slidetoremove" class="checkbox_i"  type="checkbox" > '+dappGetText("Slide To Remove This Item")+'</input> 		<input id="heightvariable" class="checkbox_i" type="checkbox"> '+dappGetText("Height Variable")+"</input>";return a};UIListItem.prototype.loadCustomProp=function(b){var a=this;b.heightvariable.checked=this.isHeightVariable();b.heightvariable.onchange=function(c){a.setHeightVariable(this.checked);return};b.slidetoremove.checked=this.slideToRemove;b.slidetoremove.onchange=function(d){var c=a.getDeleteItemIcon();a.slideToRemove=this.checked;return};b.istemplate.checked=this.isTemplate;b.istemplate.onchange=function(d){var c=a.getDeleteItemIcon();a.isTemplate=this.checked;return};return};UIListItem.prototype.setHeightVariable=function(a){this.heightVariable=a;return};UIListItem.prototype.isHeightVariable=function(){return this.heightVariable};UIListItem.prototype.measureHeight=function(a){return this.h};UIListItem.prototype.ANIM_DRAW_LINE=1;UIListItem.prototype.onPointerUpRunning=function(g,f){if(f||!this.slideToRemove){return}var l=this.getMoveAbsDeltaX();var j=this.getMoveAbsDeltaY();if(Math.abs(l)<this.w/2||(Math.abs(j)>this.h)){return}var h=this;var b=300;var a=(new Date()).getTime();h.animateState=this.ANIM_DRAW_LINE;for(var c=0;c<this.children.length;c++){var e=this.children[c];e.style.setTextColor("#C0C0C0")}function d(){var i=new Date();var m=(i.getTime()-a)/b;if(m<1){h.animatePercent=m;setTimeout(d,10)}else{h.animatePercent=1;setTimeout(function(){delete a;delete h.animatePercent;delete h.animateState;var n=h.parentShape;n.removeChild(h);n.relayoutChildren("default");n.postRedraw()},300)}delete i;h.postRedraw()}d();return};UIListItem.prototype.paintSelfOnly=function(b){var d=this.getBgImage();if(!d){b.beginPath();var a=this.getWidth(true);var c=this.getHeight(true);if(!this.isFillColorTransparent()){b.fillRect(this.hMargin,this.vMargin,a,c)}}return};UIListItem.prototype.afterPaintChildren=function(c){if(!this.animateState){return}var f=this.getDeleteItemIcon();if(this.animateState===this.ANIM_DRAW_LINE&&f&&f.width>0){var e=20;var d=this.animatePercent;var b=(this.w-e)*d-f.width;if(b>e){c.lineWidth=1;c.strokeStyle="#D0D0D0";c.moveTo(e,this.h/2);c.lineTo(b,this.h/2);c.stroke();if(d>0.9){var g=(this.h-f.height)/2;var a=this.w-f.width-e;c.drawImage(f,a,g)}}}return};UIListItem.prototype.afterChildAppended=function(a){if(!a.isUILabel&&!a.isUIImage&&!a.isUIColorTile&&!a.isUILayout&&!a.isUIColorBar){this.setImage(C_SHAPE_IMAGE_ACTIVE,this.getImageByType(C_SHAPE_IMAGE_NORMAL).getImageSrc());this.setImage(C_SHAPE_IMAGE_FOCUSED,this.getImageByType(C_SHAPE_IMAGE_NORMAL).getImageSrc())}return true};function UIListItemCreator(e,d,b,c){var a=["ui-list-item","ui-list-item",null,1];ShapeCreator.apply(this,a);this.createShape=function(h){var f=new UIListItem();f.initUIListItem(this.type,e,d,b,c);return f};return}function UIListItemGroup(){return}UIListItemGroup.prototype=new UIList();UIListItemGroup.prototype.isUIListItem=true;UIListItemGroup.prototype.isUIListItemGroup=true;UIListItemGroup.prototype.isHeightVariable=UIListItem.prototype.isHeightVariable;UIListItemGroup.prototype.setHeightVariable=UIListItem.prototype.setHeightVariable;UIListItemGroup.prototype.initUIListItemGroup=function(a){this.initUIList(a,0,30,null);this.setHeightVariable(true);this.setSizeLimit(100,30);return this};UIListItemGroup.prototype.relayoutChildren=function(a){if(this.disableRelayout){return}if(this.mode===C_MODE_EDITING){this.collapsed=false}UIList.prototype.relayoutChildren.call(this,a);this.h=this.getNewHeight();return};UIListItemGroup.prototype.collapseOrExpand=function(a){if(this.collapsed){this.expand(a)}else{this.collapse(a)}return};UIListItemGroup.prototype.collapseSelf=function(){var b=this.children.length;if(b<1){return}var a=this.h;this.collapsed=true;this.relayoutChildren();this.h=a;return};UIListItemGroup.prototype.collapse=function(a){this.collapseSelf();if(this.parentShape){this.parentShape.relayoutChildren(a)}return};UIListItemGroup.prototype.expandSelf=function(){var b=this.children.length;if(b<1){return}var a=this.h;this.collapsed=false;this.relayoutChildren();this.h=a;return};UIListItemGroup.prototype.expand=function(a){this.expandSelf();if(this.parentShape){this.parentShape.relayoutChildren(a)}return};UIListItemGroup.prototype.getNewHeight=function(){var d=this.children.length;if(d>0){if(this.collapsed){this.newHeight=this.children[0].h}else{var b=0;for(var c=0;c<d;c++){var a=this.children[c];b=b+a.h}this.newHeight=b}}else{this.newHeight=this.h}return this.newHeight};UIListItemGroup.prototype.afterChildAppended=function(a){UIList.prototype.afterChildAppended.call(this,a);if(this.disableRelayout){return}if(this.parentShape){this.parentShape.relayoutChildren("default")}return true};UIListItemGroup.prototype.afterChildRemoved=function(a){if(this.disableRelayout){return}if(this.parentShape){this.parentShape.relayoutChildren("default")}return true};UIListItemGroup.prototype.shapeCanBeChild=function(a){if(!a.isUIListItem||a.isUIListItemGroup){return false}return true};UIListItemGroup.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="itemheight">'+dappGetText("Item Height")+':</label>		<input id="itemheight"  class="element text small" type="number" value="0"/> 		<input id="collapseddefault" class="checkbox_i" type="checkbox"> '+dappGetText("Collapsed Default")+'</input> 		<input id="itemheightvariable" class="checkbox_i" type="checkbox"> '+dappGetText("Item Height Variable")+"</input>";return a};UIListItemGroup.prototype.loadCustomProp=function(a){var b=this;a.itemheight.value=this.itemHeight;a.itemheight.onchange=function(c){b.itemHeight=parseInt(a.itemheight.value);return};a.collapseddefault.checked=this.collapsedDefault;a.collapseddefault.onchange=function(c){b.collapsedDefault=this.checked;return};a.itemheightvariable.checked=this.itemHeightVariable;a.itemheightvariable.onchange=function(c){b.itemHeightVariable=this.checked;return};return};UIListItemGroup.prototype.measureHeight=function(a){if(this.mode===C_MODE_EDITING){this.collapsed=false}return this.getNewHeight()};UIListItemGroup.prototype.fixListItemImage=function(b,a){};UIListItemGroup.prototype.onModeChanged=function(){if(this.collapsedDefault&&this.mode!=C_MODE_EDITING){this.collapsed=true;this.h=this.getNewHeight()}return};function UIListItemGroupCreator(){var a=["ui-list-item-group","ui-list-item-group",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIListItemGroup();return b.initUIListItemGroup(this.type)};return}function UIListCheckableItem(){return}UIListCheckableItem.prototype=new UIListItem();UIListCheckableItem.prototype.isUIListCheckableItem=true;UIListCheckableItem.prototype.initUIListCheckableItem=function(d,c,f,e,a,b,h,g){this.initUIListItem(c,f,e,a,b);this.isRadio=d;this.setImage(C_SHAPE_IMAGE_CHECKED_FG,h);this.setImage(C_SHAPE_IMAGE_UNCHECK_FG,g);this.addEventNames(["onChanged"]);return this};UIListCheckableItem.prototype.getValue=function(){return this.value};UIListCheckableItem.prototype.setValue=function(a){if(this.value!=a){this.value=a;this.callOnChanged(this.value)}return};UIListCheckableItem.prototype.setChecked=function(){var b=this.parentShape;if(b){for(var c=0;c<b.children.length;c++){var a=b.children[c];if(a.isUIListCheckableItem){a.setValue(false)}}}this.setValue(true);return};UIListCheckableItem.prototype.setParent=function(a){this.parentShape=a;if(this.value){this.setChecked()}return};UIListCheckableItem.prototype.onClick=function(a,b){if(b){return}if(this.isRadio){this.setChecked()}else{this.setValue(!this.value)}return};UIListCheckableItem.prototype.drawFgImage=function(b){var c=this.getHtmlImageByType(this.value?C_SHAPE_IMAGE_CHECKED_FG:C_SHAPE_IMAGE_UNCHECK_FG);if(c){var a=this.w-c.width-20;var d=(this.h-c.height)/2;b.drawImage(c,0,0,c.width,c.height,a,d,c.width,c.height)}return};function UIListCheckBoxItemCreator(e,d,b,c,g,f){var a=["ui-list-checkbox-item","ui-list-checkbox-item",null,1];ShapeCreator.apply(this,a);this.createShape=function(i){var h=new UIListCheckableItem();h.initUIListCheckableItem(false,this.type,e,d,b,c,g,f);return h};return}function UIListRadioBoxItemCreator(e,d,b,c,g,f){var a=["ui-list-radiobox-item","ui-list-radiobox-item",null,1];ShapeCreator.apply(this,a);this.createShape=function(i){var h=new UIListCheckableItem();h.initUIListCheckableItem(true,this.type,e,d,b,c,g,f);return h};return}function UIGrid(){return}UIGrid.ITEM_FIXED_HEIGHT=0;UIGrid.ITEM_FIXED_ROWS=1;UIGrid.ITEM_FIXED_WIDTH=0;UIGrid.ITEM_FIXED_COLS=1;UIGrid.prototype=new UIElement();UIGrid.prototype.isUIGrid=true;UIGrid.prototype.gridToJson=function(a){a.spacer=this.spacer;a.itemWidth=this.itemWidth;a.itemHeight=this.itemHeight;a.itemWidthType=this.itemWidthType;a.itemHeightType=this.itemHeightType;a.scrollDirection=this.scrollDirection;return};UIGrid.prototype.gridFromJson=function(a){if(a.itemWidth){this.itemWidth=a.itemWidth;this.itemWidthType=a.itemWidthType}if(a.itemHeight){this.itemHeight=a.itemHeight;this.itemHeightType=a.itemHeightType}if(a.spacer){this.spacer=a.spacer}if(a.scrollDirection){this.scrollDirection=a.scrollDirection}return};UIGrid.prototype.initUIGrid=function(d,a,f,c){var b=f*3+2*a;var e=f+2*a;this.initUIElement(d);this.spacer=0;this.offset=0;this.setDefSize(b,b);this.setMargin(a,a);this.setSizeLimit(e,e,2000,2000);this.itemSize=f;this.itemWidth=f;this.itemHeight=f;this.itemWidthType=UIGrid.ITEM_FIXED_WIDTH;this.itemHeightType=UIGrid.ITEM_FIXED_HEIGHT;this.widthAttr=C_WIDTH_FILL_PARENT;this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,c);this.setImage(C_SHAPE_IMAGE_DELETE_ITEM,null);this.regSerializer(this.gridToJson,this.gridFromJson);this.rectSelectable=false;this.addEventNames(["onChildDragged","onChildDragging"]);if(!c){this.style.setFillColor("White")}return this};UIGrid.prototype.getDeleteItemIcon=function(){var a=this.getHtmlImageByType(C_SHAPE_IMAGE_DELETE_ITEM);if(!a){this.setImage(C_SHAPE_IMAGE_DELETE_ITEM,"drawapp8/images/common/icons/xhdpi/grid_delete_item.png");a=this.getHtmlImageByType(C_SHAPE_IMAGE_DELETE_ITEM)}return a};UIGrid.prototype.getCustomProp=function(){var a=' 		<label class="description" for="border">'+dappGetText("Border Size")+':</label>		<input id="border"  class="element text small" type="number" value="0"/>		<label class="description" for="spacer">'+dappGetText("Range Interval")+':</label>		<input id="spacer"  class="element text small" type="number" value="0"/>		<label class="description" for="itemwidth" id="itemwidthlabel">'+dappGetText("Item Width")+':</label>		<select class="element select small" id="itemwidthtype" > </select> 		<input id="itemwidth"  class="element text small" type="number" value="0"/> 		<label class="description" for="itemheight" id="itemheightlabel">'+dappGetText("Item Height")+':</label>		<select class="element select small" id="itemheighttype" > </select> 		<input id="itemheight"  class="element text small" type="number" value="0"/>';if(!this.isUIScrollView){a=a+'<input id="itemdraggable" class="checkbox_i" type="checkbox"> '+dappGetText("Item Draggable")+"</input>"}return a};UIGrid.prototype.setRows=function(a){if(a<20){this.itemHeightType=UIGrid.ITEM_FIXED_ROWS}else{this.itemHeightType=UIGrid.ITEM_FIXED_HEIGHT}this.itemHeight=a;return};UIGrid.prototype.getRows=function(){if(this.itemHeightType===UIGrid.ITEM_FIXED_ROWS){return this.itemHeight}else{return Math.floor(this.getHeight(true)/(this.itemHeight+this.spacer))}return};UIGrid.prototype.setCols=function(a){if(a<20){this.itemWidthType=UIGrid.ITEM_FIXED_COLS}else{this.itemWidthType=UIGrid.ITEM_FIXED_WIDTH}this.itemWidth=a;return};UIGrid.prototype.getCols=function(){if(this.itemWidthType===UIGrid.ITEM_FIXED_COLS){return this.itemWidth}else{return Math.floor(this.getWidth(true)/(this.itemWidth+this.spacer))}};UIGrid.prototype.getChildAt=function(d,b){var c=this.getCols();var a=d*c+b;if(a<this.children.length){return this.children[a]}else{return null}};UIGrid.prototype.loadCustomProp=function(c){var a=this;c.border.value=this.getHMargin();c.border.onchange=function(g){var f=parseInt(c.border.value);a.setMargin(f,f);return};c.spacer.value=this.spacer;c.spacer.onchange=function(f){a.spacer=parseInt(c.spacer.value);return};function d(){if(a.itemWidthType===UIGrid.ITEM_FIXED_COLS){a.itemWidth=a.itemWidth<20?a.itemWidth:3}else{a.itemWidth=a.itemWidth>40?a.itemWidth:100}c.itemwidth.value=a.itemWidth;return}function b(){if(a.itemHeightType===UIGrid.ITEM_FIXED_ROWS){a.itemHeight=a.itemHeight<20?a.itemHeight:3}else{a.itemHeight=a.itemHeight>40?a.itemHeight:100}c.itemheight.value=a.itemHeight;return}c.itemwidthtype.add(new Option(dappGetText("Fixed Width"),"fixedwidth"));c.itemwidthtype.add(new Option(dappGetText("Fixed Cols"),"fixedcols"));c.itemwidthtype.value=this.itemWidthType?"fixedcols":"fixedwidth";c.itemwidthtype.onchange=function(f){a.itemWidthType=(this.value==="fixedcols")?UIGrid.ITEM_FIXED_COLS:UIGrid.ITEM_FIXED_WIDTH;d();return};c.itemheighttype.add(new Option(dappGetText("Fixed Height"),"fixedheight"));c.itemheighttype.add(new Option(dappGetText("Fixed Rows"),"fixedrows"));c.itemheighttype.value=this.itemHeightType?"fixedrows":"fixedheight";c.itemheighttype.onchange=function(f){a.itemHeightType=(this.value==="fixedrows")?UIGrid.ITEM_FIXED_ROWS:UIGrid.ITEM_FIXED_HEIGHT;b();return};c.itemwidth.value=this.itemWidth;c.itemwidth.onchange=function(f){a.itemWidth=parseInt(this.value);d()};c.itemheight.value=this.itemHeight;c.itemheight.onchange=function(f){a.itemHeight=parseInt(this.value);b()};if(!this.isUIScrollView){c.itemdraggable.checked=this.itemDraggable;c.itemdraggable.onchange=function(f){a.itemDraggable=this.checked;return}}return};UIGrid.prototype.shapeCanBeChild=function(a){if(a.isUIGridItem||a.isUIButton||a.isUILabel||a.isUIImage){return true}return false};UIGrid.prototype.childIsBuiltin=function(a){return a.name==="ui-last"};UIGrid.prototype.afterPaintChildren=function(a){if(this.mode!==C_MODE_EDITING){return}var l=0;var f=0;var b=0;var g=this.vMargin;var e=this.hMargin;var j=this.w;var d=this.h;l=this.rows?this.rows:3;f=this.cols?this.cols:3;drawDashedRect(a,g,e,j,d);for(var c=1;c<l;c++){b=(d*c)/l;drawDashedLine(a,{x:g,y:b},{x:j,y:b},8,4)}for(var c=1;c<f;c++){b=(j*c)/f;drawDashedLine(a,{x:b,y:e},{x:b,y:d},8,4)}a.strokeStyle=this.style.lineColor;a.stroke();return};UIGrid.prototype.calcItemSize=function(){var b=0;var d=0;var a=this.getWidth(true);var c=this.getHeight(true);if(this.itemWidthType===UIGrid.ITEM_FIXED_COLS){b=a/this.itemWidth-this.spacer}else{var f=Math.floor(a/this.itemWidth);b=Math.floor(a/f)}if(this.itemHeightType===UIGrid.ITEM_FIXED_ROWS){d=c/this.itemHeight-this.spacer}else{var e=Math.floor(c/this.itemHeight);d=Math.floor(c/e)}return{w:Math.floor(b),h:Math.floor(d)}};UIGrid.prototype.sortChildren=function(){var c=this.calcItemSize();var a=c.h;var b=c.w;this.children.sort(function(e,d){var h=0;var i=0;var f=Math.floor((e.y+5)/a);var g=Math.floor((d.y+5)/a);if(f===g){i=d.x;h=d.pointerDown?e.x+e.w:e.x}else{h=f;i=g}return h-i});return};UIGrid.prototype.getChildIndexByPosition=function(m){var b=this.getHMargin();var o=this.calcItemSize();var g=this.spacer;var l=this.getWidth(true);var d=this.getHeight(true);var n=o.w+g;var e=o.h+g;var j=Math.floor(l/n);var p=Math.floor(d/e);var a=Math.floor((m.y-b)/o.h);var i=Math.floor((m.x-b)/o.w);var f=a*j+i;return f};UIGrid.prototype.onChildDragging=function(d,a){var c=this.getChildIndexByPosition(a);var b=this.getIndexOfChild(d);this.callOnChildDragging(b,c);return};UIGrid.prototype.onChildDragged=function(d,a){var c=this.getChildIndexByPosition(a);var b=this.getIndexOfChild(d);this.callOnChildDragged(b,c);this.relayoutChildren("default");return};UIGrid.prototype.onPointerUpEditing=function(a,b){if(this.view&&this.view.isClicked()){return}if(this.mode!==C_MODE_EDITING){return}if(b){this.sortChildren()}else{this.relayoutChildren()}return};UIGrid.prototype.relayoutChildren=function(u){if(this.disableRelayout){return}var e=this.spacer;var t=this.getHMargin();var d=this.calcItemSize();var s=0;var A=0;var p=0;var n=0;var j=t;var f=t;var q=0;var l=this.getWidth(true);var z=this.getHeight(true);var a=d.w+e;var o=d.h+e;var m=Math.floor(l/a);var g=Math.floor(z/o);p=t;n=(this.w-m*a)/2;this.cols=m;this.rows=g;for(var v=0;v<this.children.length;v++){var b=this.children[v];s=Math.floor(v/m);A=Math.floor(v%m);j=n+A*a;f=p+s*o;if(u||this.mode===C_MODE_EDITING){b.animMove(j,f,u)}else{b.move(j,f)}b.widthAttr=C_WIDTH_FIX;b.heightAttr=C_HEIGHT_FIX;b.setSize(d.w,d.h);b.setUserMovable(true);b.setUserResizable(false);b.relayoutChildren();if(!this.isUIScrollView){b.setDraggable(this.itemDraggable)}}return};UIGrid.prototype.afterChildAppended=function(a){if(a.view&&this.mode===C_MODE_EDITING&&a.isCreatingElement()){this.sortChildren()}this.moveMustBeLastItemToLast();a.setUserMovable(true);a.setUserResizable(false);a.setCanRectSelectable(false,true);a.setDraggable(this.itemDraggable);return true};UIGrid.prototype.triggerUserEditingMode=function(){if(this.mode===C_MODE_EDITING){return}this.userEditingMode=!this.userEditingMode;var a=this;function b(){a.postRedraw();if(a.userEditingMode){setTimeout(b,20)}}b();return};UIGrid.prototype.isInUserEditingMode=function(){return this.userEditingMode&&this.mode!=C_MODE_EDITING};UIGrid.prototype.beforePaintChild=function(f,b){if(this.isInUserEditingMode()){b.save();var a=f.x+f.w/2;var e=f.y+f.h/2;var c=(new Date()).getTime()/1000;var d=0.03*Math.cos(20*c);b.translate(a,e);b.rotate(d);b.translate(-a,-e)}return};UIGrid.prototype.afterPaintChild=function(e,b){if(this.isInUserEditingMode()){var c=this.getDeleteItemIcon();if(c&&c.width>0){var d=e.y;var a=e.x+e.w-c.width-10;b.drawImage(c,a,d)}b.restore()}return};function UIGridCreator(b,d,c){var a=["ui-grid","ui-grid",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new UIGrid();return e.initUIGrid(this.type,b,d,c)};return}function UIGridView(){return}UIGridView.prototype=new UIVScrollView();UIGridView.prototype.isUIGrid=true;UIGridView.prototype.isUIGridView=true;UIGridView.prototype.gridToJson=UIGrid.prototype.gridToJson;UIGridView.prototype.gridFromJson=UIGrid.prototype.gridFromJson;UIGridView.prototype.sortChildren=UIGrid.prototype.sortChildren;UIGridView.prototype.onPointerUpEditing=UIGrid.prototype.onPointerUpEditing;UIGridView.prototype.initUIGrid=UIGrid.prototype.initUIGrid;UIGridView.prototype.getCustomProp=UIGrid.prototype.getCustomProp;UIGridView.prototype.loadCustomProp=UIGrid.prototype.loadCustomProp;UIGridView.prototype.shapeCanBeChild=UIGrid.prototype.shapeCanBeChild;UIGridView.prototype.childIsBuiltin=UIGrid.prototype.childIsBuiltin;UIGridView.prototype.paintSelfOnly=UIGrid.prototype.paintSelfOnly;UIGridView.prototype.calcItemSize=UIGrid.prototype.calcItemSize;UIGridView.prototype.relayoutChildren=UIGrid.prototype.relayoutChildren;UIGridView.prototype.afterChildAppended=UIGrid.prototype.afterChildAppended;UIGridView.prototype.triggerUserEditingMode=UIGrid.prototype.triggerUserEditingMode;UIGridView.prototype.isInUserEditingMode=UIGrid.prototype.isInUserEditingMode;UIGridView.prototype.beforePaintChild=UIGrid.prototype.beforePaintChild;UIGridView.prototype.afterPaintChild=UIGrid.prototype.afterPaintChild;UIGridView.prototype.afterPaintChildren=UIGrid.prototype.afterPaintChildren;UIGridView.prototype.initUIGridView=function(c,a,d,b){this.initUIGrid(c,a,d,b);this.initUIVScrollView(c,0,b,null);return this};UIGridView.prototype.onModeChanged=function(){this.offset=0;return};function UIGridViewCreator(b,d,c){var a=["ui-grid-view","ui-grid-view",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new UIGridView();return e.initUIGridView(this.type,b,d,c)};return}function UIGridItem(){return}UIGridItem.prototype=new UIElement();UIGridItem.prototype.isUIGridItem=true;UIGridItem.prototype.initUIGridItem=function(c,e,d,a,b){this.initUIElement(c);this.setDefSize(100,100);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setImage(C_SHAPE_IMAGE_FOCUSED,e);this.setImage(C_SHAPE_IMAGE_ACTIVE,d);this.setImage(C_SHAPE_IMAGE_NORMAL,a);this.setImage(C_SHAPE_IMAGE_DISABLE,b);return this};UIGridItem.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage||a.isUIButton||a.isUICheckBox){return true}return false};UIGridItem.prototype.afterChildAppended=function(a){a.xAttr=C_X_CENTER_IN_PARENT;return true};UIGridItem.prototype.beforeRelayoutChild=function(a){a.xAttr=C_X_CENTER_IN_PARENT;return true};function UIGridItemCreator(e,d,b,c){var a=["ui-grid-item","ui-grid-item",null,1];ShapeCreator.apply(this,a);this.createShape=function(h){var f=new UIGridItem();f.initUIGridItem(this.type,e,d,b,c);return f};return}function UIButtonGroup(){return}UIButtonGroup.prototype=new UIElement();UIButtonGroup.prototype.isUIButtonGroup=true;UIButtonGroup.prototype.initUIButtonGroup=function(c,a,d,b){this.initUIElement(c);this.setMargin(a,a);this.setDefSize(300,60);this.setSizeLimit(100,40,1000,120);this.buttonMaxWidth=d;this.widthAttr=C_WIDTH_FILL_PARENT;this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,b);this.rectSelectable=false;this.addEventNames(["onInit"]);if(!b){this.style.setFillColor("White")}return this};UIButtonGroup.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage||a.isUIButton||a.isUIRadioBox||a.isUICheckBox){return true}return false};UIButtonGroup.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="border">'+dappGetText("Border Size")+':</label>		<input id="border"  class="element text small" type="number" value="0"/>';return a};UIButtonGroup.prototype.loadCustomProp=function(b){var a=this;b.border.value=this.getHMargin();b.border.onchange=function(d){var c=parseInt(this.value);a.setMargin(c,c);return};return};UIButtonGroup.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b&&!this.isFillColorTransparent()){a.beginPath();a.fillRect(0,0,this.w,this.h)}return};UIButtonGroup.prototype.relayoutChildren=function(){var c=this.getHMargin();var b=this.children.length;if(b===0||this.disableRelayout){return}var g=c;var f=c;var e=this.h-2*c;var l=this.buttonMaxWidth;var m=Math.floor((this.w-2*c)/b);var j=Math.min(m,l);for(var d=0;d<b;d++){var a=this.children[d];g=d*m+(m-j)/2+c;a.setPosition(g,f);a.setSize(j,e);a.setUserMovable(false);a.setUserResizable(false);a.relayoutChildren()}this.w=m*b+2*c;return};UIButtonGroup.prototype.afterChildAppended=function(a){a.yAttr=C_Y_MIDDLE_IN_PARENT;return true};function UIButtonGroupCreator(b,d,c){var a=["ui-button-group","ui-button-group",null,1];ShapeCreator.apply(this,a);this.createShape=function(f){var e=new UIButtonGroup();return e.initUIButtonGroup(this.type,b,d,c)};return}function UICheckBox(){return}UICheckBox.prototype=new UIElement();UICheckBox.prototype.isUICheckBox=true;UICheckBox.prototype.initUICheckBox=function(f,g,d,j,e,b,c,i,a){this.initUIElement(f);this.setDefSize(g,d);this.setTextType(C_SHAPE_TEXT_INPUT);this.images.display=C_IMAGE_DISPLAY_SCALE;j=j?j:b;e=e?e:b;c=c?c:a;i=i?i:a;this.setImage(C_SHAPE_IMAGE_ON_FG,b);this.setImage(C_SHAPE_IMAGE_ON_ACTIVE,e);this.setImage(C_SHAPE_IMAGE_ON_FOCUSED,j);this.setImage(C_SHAPE_IMAGE_OFF_FG,a);this.setImage(C_SHAPE_IMAGE_OFF_ACTIVE,i);this.setImage(C_SHAPE_IMAGE_OFF_FOCUSED,c);this.addEventNames(["onChanged"]);this.value=true;return this};UICheckBox.prototype.shapeCanBeChild=function(a){return false};UICheckBox.prototype.getValue=function(){return this.value};UICheckBox.prototype.setValue=function(a){if(this.value!=a){this.value=a;this.callOnChanged(this.value)}return};UICheckBox.prototype.getFgImage=function(){var a=null;if(this.value){if(this.pointerDown){a=this.getImageByType(C_SHAPE_IMAGE_ON_ACTIVE).getImage()}else{if(this.selected){a=this.getImageByType(C_SHAPE_IMAGE_ON_FOCUSED).getImage()}}if(!a){a=this.getImageByType(C_SHAPE_IMAGE_ON_FG).getImage()}}else{if(this.pointerDown){a=this.getImageByType(C_SHAPE_IMAGE_OFF_ACTIVE).getImage()}else{if(this.selected){a=this.getImageByType(C_SHAPE_IMAGE_OFF_FOCUSED).getImage()}}if(!a){a=this.getImageByType(C_SHAPE_IMAGE_OFF_FG).getImage()}}return a};UICheckBox.prototype.drawFgImage=function(b){var c=this.getFgImage();if(c){if(this.images.display===C_IMAGE_DISPLAY_9PATCH){drawNinePatchEx(b,c,0,0,c.width,c.height,0,0,this.w,this.h)}else{var a=(this.w-c.width)/2;var d=(this.h-c.height)/2;b.drawImage(c,0,0,c.width,c.height,a,d,c.width,c.height);if(a<0||d<0){this.moveDelta(a,d);this.resize(c.width,c.height)}}}return};UICheckBox.prototype.onClick=function(a,b){if(b){return}this.setValue(!this.value);return};function UICheckBoxCreator(g,d,j,e,b,c,i,a){var f=["ui-checkbox","ui-checkbox",null,1];ShapeCreator.apply(this,f);this.createShape=function(l){var h=new UICheckBox();return h.initUICheckBox(this.type,g,d,j,e,b,c,i,a)};return}function UISwitch(){return}UISwitch.prototype=new UICheckBox();UISwitch.prototype.isUISwitch=true;UISwitch.prototype.initUISwitch=function(d,a,c,e,b){this.initUIElement(d);this.setDefSize(a,c);this.setTextType(C_SHAPE_TEXT_NONE);this.images.display=C_IMAGE_DISPLAY_CENTER;this.setImage(C_SHAPE_IMAGE_ALL,b);this.value=true;this.imageWidth=412;this.maskWidth=e;this.offsetImage=e;this.addEventNames(["onChanged"]);this.interpolator=new DecelerateInterpolator(2);return this};UISwitch.prototype.updateImageSize=function(a){this.imageWidth=a;this.maskWidth=Math.floor(a*0.373786);if(!this.animating){this.offsetImage=this.value?this.maskWidth:(this.imageWidth-this.maskWidth)}return};UISwitch.prototype.animateChange=function(){var f=this;var d=new Date();var e=d.getTime();var a=this.offsetImage;var c=this.value?this.maskWidth:(this.imageWidth-this.maskWidth);var b=c-a;this.animating=true;var g=500;function h(){var j=new Date();var m=j.getTime();var i=(m-e)/g;var l=f.interpolator.get(i);var n=a+b*l;if(i<1){f.offsetImage=n;setTimeout(h,10)}else{f.offsetImage=c;delete this.animating}f.postRedraw();delete j;return}setTimeout(h,30);return};UISwitch.prototype.onClick=function(a,b){if(b||this.mode!==C_MODE_EDITING){return}this.setValue(!this.value);return};UISwitch.prototype.onPointerDownRunning=function(a,b){if(b){return}this.pointerDownPosition=a;return};UISwitch.prototype.onPointerUpRunning=function(a,c){if(c){return}var b=a.x-this.pointerDownPosition.x;if(Math.abs(b)<5){this.setValue(!this.value)}else{this.setValue(b>0)}return};UISwitch.prototype.setValue=function(a){if(this.value!=a){this.value=a;this.callOnChanged(this.value);this.animateChange()}return};UISwitch.prototype.drawBgImage=function(a){return};UISwitch.prototype.drawFgImage=function(d){var f=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(f){this.updateImageSize(f.width);var e=f.height;var b=this.maskWidth;var c=(this.w-b)/2;var a=(this.h-e)/2;this.imageWidth=f.width;d.drawImage(f,this.offsetImage,0,b,e,c,a,b,e);d.drawImage(f,0,0,b,e,c,a,b,e)}return};function UISwitchCreator(a,d,e,b){var c=["ui-switch","ui-switch",null,1];ShapeCreator.apply(this,c);this.createShape=function(h){var f=new UISwitch();return f.initUISwitch(this.type,a,d,e,b)};return}function UIRadioBox(){return}UIRadioBox.prototype=new UICheckBox();UIRadioBox.prototype.isUIRadioBox=true;UIRadioBox.prototype.initUIRadioBox=function(f,g,d,j,e,b,c,i,a){return this.initUICheckBox(f,g,d,j,e,b,c,i,a)};UIRadioBox.prototype.setParent=function(a){this.parentShape=a;if(this.value){this.setChecked()}return};UIRadioBox.prototype.setChecked=function(){var b=this.parentShape;if(b){for(var c=0;c<b.children.length;c++){var a=b.children[c];if(a.isUIRadioBox){a.setValue(false)}}}this.setValue(true);return};UIRadioBox.prototype.onClick=function(a,b){if(b){return}this.setChecked();return this.callClickHandler(a,b)};function UIRadioBoxCreator(g,d,j,e,b,c,i,a){var f=["ui-radiobox","ui-radiobox",null,1];ShapeCreator.apply(this,f);this.createShape=function(l){var h=new UIRadioBox();h.initUIRadioBox(this.type,g,d,j,e,b,c,i,a);return h};return}function UIProgressBar(){return}UIProgressBar.prototype=new UIElement();UIProgressBar.prototype.isUIProgressBar=true;UIProgressBar.prototype.initUIProgressBar=function(g,b,f,d,c,e,a){this.initUIElement(g);this.setPercent(50);this.setDefSize(b,f);this.setInteractive(d);this.setTextType(C_SHAPE_TEXT_INPUT);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setSizeLimit(60,f,null,f);this.setImage(C_SHAPE_IMAGE_ALL,c);this.setImage(C_SHAPE_IMAGE_NORMAL_FG,e);this.drawSize=f;this.dragImg=a;if(d){this.addEventNames(["onChanged"]);this.addEventNames(["onChanging"])}return this};UIProgressBar.prototype.shapeCanBeChild=function(a){return(a.isUIImage||a.isUILabel)};UIProgressBar.prototype.afterChildAppended=function(a){var c=this;var b=this.drawSize?this.drawSize:this.h;this.setTextType(C_SHAPE_TEXT_NONE);a.yAttr=C_Y_MIDDLE_IN_PARENT;a.setTextType(C_SHAPE_TEXT_NONE);a.setSizeLimit(b,b,b,b);a.setUserResizable(false);a.horMove=function(e){var f=e;var d=c.w-this.w;f=f<0?0:f;f=f<=d?f:d;this.move(f,this.y);return};c.onPointerMoveRunning=function(d,e){if(e){return}if(this.pointerDown){c.isChanging=true;a.horMove(d.x)}return};c.onPointerUpRunning=function(d,e){if(e){return}delete this.isChanging;a.horMove(d.x);return};c.onSized=function(){this.updateLayoutParams();this.setPercent(this.getPercent());return};a.onMoved=function(){var d=100*(a.x+a.w/2)/c.w;if(a.x===0){d=0}if((a.x+a.w)===c.w){d=100}c.setPercentOnly(d);c.relayoutChildren();return};this.drag=a;return};UIProgressBar.prototype.setInteractive=function(a){this.interactive=a;return};UIProgressBar.prototype.setPercentOnly=function(a){var b=(a%101)/100;if(this.value!=b){this.value=b}if(this.mode===C_MODE_EDITING||!this.isVisible()){return}if(this.isChanging){this.callOnChanging(this.value)}else{this.callOnChanged(this.value)}return};UIProgressBar.prototype.setPercent=function(b){this.setPercentOnly(b);if(this.drag){var a=this.value*this.w-this.drag.w+5;this.drag.y=Math.floor((this.h-this.drag.h)/2);this.drag.x=Math.floor(a>0?a:0)}return};UIProgressBar.prototype.onClick=function(b,d){if(d){return}if(!this.drag&&this.interactive){var a=b.x-this.x;var c=a/this.w;this.setPercent(c*100)}return};UIProgressBar.prototype.getPercent=function(){return Math.round(this.value*100)};UIProgressBar.prototype.getValue=function(){return this.getPercent()};UIProgressBar.prototype.setValue=function(a){this.setPercent(a);return};UIProgressBar.prototype.drawImage=function(b){var d=null;var e=0;var c=this.h;d=this.getImageByType(C_SHAPE_IMAGE_ALL);d=d.getImage();if(d){c=d.height;e=(this.h-c)/2;drawNinePatchEx(b,d,0,0,d.width,d.height,0,e,this.w,c)}d=this.getImageByType(C_SHAPE_IMAGE_NORMAL_FG).getImage();if(d){var a=this.w*this.value;if(a>=d.width){c=d.height;e=(this.h-c)/2;drawNinePatchEx(b,d,0,0,d.width,d.height,0,e,this.w*this.value,c)}else{b.drawImage(d,0,0)}}return};function UIProgressBarCreator(b,i,d,c,f,a){var g=d?"ui-slider":"ui-progressbar";var e=[g,"ui-progressbar",null,1];ShapeCreator.apply(this,e);this.createShape=function(j){var h=new UIProgressBar();return h.initUIProgressBar(this.type,b,i,d,c,f,a)};return}function UIPage(){return}UIPage.prototype=new UIElement();UIPage.prototype.isUIPage=true;UIPage.prototype.initUIPage=function(b,a){this.initUIElement(b);this.setDefSize(200,200);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,a);this.widthAttr=C_WIDTH_FILL_PARENT;this.heightAttr=C_HEIGHT_FILL_PARENT;if(!a){this.style.setFillColor("Gold")}return this};UIPage.prototype.show=function(){this.setVisible(true);this.showHTML();return};UIPage.prototype.hide=function(){this.setVisible(false);this.hideHTML();wtkHideAllInput();return};UIPage.prototype.shapeCanBeChild=function(a){if(a.isUIDevice||a.isUIScreen||a.isUIStatusBar||a.isUIWindow||a.isUIPage){return false}if(a.isUIPageIndicator){return this.findChildByType("ui-view-pager")}return true};UIPage.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.beginPath();a.fillRect(0,0,this.w,this.h)}return};function UIPageCreator(b){var a=["ui-page","ui-page",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UIPage();return c.initUIPage(this.type,b)};return}function UIPageManager(){}UIPageManager.prototype=new UIFrames();UIPageManager.prototype.isUIPageManager=true;UIPageManager.prototype.initUIPageManager=function(a){return this.initUIFrames(a)};UIPageManager.prototype.beforeAddShapeIntoChildren=function(a){return !a.isUIPage};UIPageManager.prototype.shapeCanBeChild=function(a){return a.isUIPage};UIPageManager.prototype.relayoutChildren=function(){for(var b=0;b<this.children.length;b++){var a=this.children[b];a.x=0;a.y=0;a.w=this.w;a.h=this.h;a.relayoutChildren();a.setUserMovable(false);a.setUserResizable(false)}return};UIPageManager.prototype.showHTML=function(){var a=this.getCurrentFrame();if(a){a.showHTML()}return};UIPageManager.prototype.hideHTML=function(){var a=this.getCurrentFrame();if(a){a.hideHTML()}return};UIPageManager.prototype.switchTo=function(d){var h=this;var f=this.getCurrentFrame();var c=this.getFrame(d);var e=this.current;if(f){f.hideHTML()}if(e<0||e===d||!f||!c){this.showFrame(d);if(c){c.showHTML()}return}function i(){h.showFrame(d);h.postRedraw();return}if(!this.isOnTopWindow()){i();return}var b=null;var g=null;var a=this.getPositionInScreen();if(d<e){b=animationCreate("anim-backward");g=preparseBackendCanvas(c,f)}else{b=animationCreate("anim-forward");g=preparseBackendCanvas(f,c)}b.setScale(this.getRealScale());b.prepare(a.x,a.y,this.w,this.h,g,i);b.run();return};function UIPageManagerCreator(){var a=["ui-page-manager","ui-page-manager",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageManager();b.initUIPageManager(this.type);return b};return}function UITabButton(){}UITabButton.prototype=new UIRadioBox();UITabButton.prototype.isUITabButton=true;UITabButton.prototype.initUITabButton=function(c,a,b,e,d,f){this.initUIRadioBox(this.type,a,b,null,null,d,null,null,f);this.setImage(C_SHAPE_IMAGE_ACTIVE,e);this.setTextType(C_SHAPE_TEXT_INPUT);return this};UITabButton.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage){return true}return false};UITabButton.prototype.drawBgImage=function(a){if(this.value){var b=this.getImageByType(C_SHAPE_IMAGE_ACTIVE);b=b.getImage();if(b){drawNinePatchEx(a,b,0,0,b.width,b.height,0,0,this.w,this.h)}}return};UITabButton.prototype.calcTextPosition=function(){var a=this.getVMargin();a=a?a:10;this.textX=this.w/2;this.textY=this.h-a;this.textBaseline="bottom";this.textAlign="center";return};UITabButton.prototype.drawFgImage=function(b){var d=this.value?this.getImageByType(C_SHAPE_IMAGE_ON_FG).getImage():this.getImageByType(C_SHAPE_IMAGE_OFF_FG).getImage();if(d){var c=this.getVMargin();c=c?c:10;var a=(this.w-d.width)/2;var e=this.text?c:(this.h-d.height)/2;b.drawImage(d,a,e)}return};function UITabButtonCreator(a,c,e,d,f){var b=["ui-tabbutton","ui-tabbutton",null,1];ShapeCreator.apply(this,b);this.createShape=function(i){var h=new UITabButton();return h.initUITabButton(this.type,a,c,e,d,f)};return}function UITab(){return}UITab.prototype=new UIElement();UITab.prototype.isUITab=true;UITab.prototype.initUITab=function(d,a,c,e,b){this.initUIElement(d);this.setMargin(a,a);this.tabAtTop=c;this.setDefSize(400,400);this.buttonHeight=e;this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_IMAGE,b);this.widthAttr=C_WIDTH_FILL_PARENT;this.heightAttr=C_HEIGHT_FILL_PARENT;if(!b){this.style.setFillColor("Green")}return this};UITab.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="buttonheight">'+dappGetText("Button Height")+':</label>		<input id="buttonheight"  class="element text medium" type="text" value=""/>';return a};UITab.prototype.loadCustomProp=function(b){var a=this;b.buttonheight.value=this.buttonHeight;b.buttonheight.onchange=function(c){a.buttonHeight=parseInt(this.value);a.relayoutChildren();return};return};UITab.prototype.resize=function(a,b){if(this.state===C_STAT_NORMAL){this.realResize(a,b)}return};UITab.prototype.shapeCanBeChild=function(a){for(var b=0;b<this.children.length;b++){var c=this.children[b];if(c.isUIPageManager&&a.isUIPageManager){return false}}if(a.isUITabButton||a.isUIPageManager){return true}return false};UITab.prototype.afterChildAppended=function(a){a.setUserMovable(false);a.setUserResizable(false);if(a.isUIPageManager){this.pageManager=a}if(a.isUITabButton){a.pageManager=this.pageManager;a.index=this.buttonCount();a.setSizeLimit(null,this.buttonHeight,null,this.buttonHeight);var b=this;a.onClick=function(c,d){if(d){return}b.pageManager.switchTo(this.index);this.setChecked()}}return true};UITab.prototype.buttonCount=function(){var b=0;for(var a=0;a<this.children.length;a++){var c=this.children[a];if(c.isUITabButton){b=b+1}}return b};UITab.prototype.onModeChanged=function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];if(b.isUITabButton){b.onClick();break}}return};UITab.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var n=0;var m=0;var p=0;var f=0;var b=0;var d=this.getHMargin();var q=d;var r=(this.w-2*d)/this.buttonCount();var o=this.tabAtTop?d:(this.h-d-this.buttonHeight);var j=this.buttonHeight;var g=this.tabAtTop?(d+j):0;var l=this.w-2*d;var c=this.h-d-this.buttonHeight;for(var e=0;e<this.children.length;e++){var a=this.children[e];if(a.isUITabButton){a.index=b;m=o;f=j;p=r;n=a.index*p+d;q+=p;a.setFixPosition(null,o);if(b===0){a.setChecked()}b=b+1;a.setSizeLimit(null,j,null,j)}if(a.isUIPageManager){n=d;m=g;p=l;f=c}a.widthAttr=C_WIDTH_SCALE;a.heightAttr=C_HEIGHT_SCALE;a.xAttr=C_X_FIX_LEFT;a.yAttr=C_Y_FIX_TOP;a.setPosition(n,m);a.setSize(p,f);a.relayoutChildren()}return};UITab.prototype.drawImage=function(d){var f=this.getImageByType(C_SHAPE_IMAGE_IMAGE);f=f.getImage();if(f){var a=0;var g=0;var b=this.w;var c=this.getHMargin();var e=c+this.buttonHeight;if(!this.tabAtTop){g=this.h-e}drawNinePatchEx(d,f,0,0,f.width,f.height,a,g,b,e)}return};function UITabCreator(e,b,d,f,c){var a=[e,"ui-tab",null,1];ShapeCreator.apply(this,a);this.createShape=function(i){var h=new UITab();return h.initUITab(this.type,b,d,f,c)};return}function UIColorButton(){return}UIColorButton.prototype=new UIElement();UIColorButton.prototype.isUIButton=true;UIColorButton.prototype.isUIColorButton=true;UIColorButton.prototype.initUIColorTile=function(c,a,b){this.initUIColorButton(c,a,b);this.isUIButton=false;this.isUIColorButton=false;this.isUIColorTile=true;this.setAutoScaleFontSize(true);return this};UIColorButton.prototype.initUIColorButton=function(c,a,b){this.initUIElement(c);this.roundRadius=5;this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_INPUT);this.setCanRectSelectable(false,false);this.setMargin(8,8);return this};UIColorButton.prototype.setRoundRadius=function(a){this.roundRadius=Math.max(0,a);this.roundRadius=Math.min(this.w/2,this.roundRadius);this.roundRadius=Math.min(this.h/2,this.roundRadius);return};UIColorButton.prototype.getCustomProp=function(){var a=' 		<label class="description" for="border">'+dappGetText("Border Size")+':</label>		<input id="border"  class="element text small" type="number" value="0"/>		<label class="description" for="roundradius">'+dappGetText("Round Radius")+':</label>  		<input id="roundradius"  class="element text small" type="number" maxlength="2" value="0"/> 		<label class="description" for="linecolor">'+dappGetText("Line Color")+':</label>  		<input id="linecolor"  class="element text small" type="text"/> 		<label class="description" for="fillcolor">'+dappGetText("Fill Color")+':</label>  		<input id="fillcolor"  class="element text small" type="text"/>';return a};UIColorButton.prototype.loadCustomProp=function(b){var a=this;b.border.value=this.getHMargin();b.border.onchange=function(d){var c=parseInt(this.value);a.setMargin(c,c);return};b.linecolor.value=this.style.lineColor;b.linecolor.onchange=function(c){a.style.lineColor=this.value;return};b.fillcolor.value=this.style.fillColor;b.fillcolor.onchange=function(c){a.style.fillColor=this.value;return};b.roundradius.value=this.roundRadius;b.roundradius.onchange=function(c){a.setRoundRadius(parseInt(this.value));return};return};UIColorButton.prototype.shapeCanBeChild=function(a){if(a.isUILabel||a.isUIImage){return true}return false};UIColorButton.prototype.calcTextPosition=function(){this.textX=this.getWidth(true)/2;this.textY=this.getHeight(true)/2;this.textAlign="center";this.textBaseline="middle";return};UIColorButton.prototype.drawText=function(a){this.draw1LText(a);return};UIColorButton.prototype.paintSelfOnly=function(b){var a=this.isUIColorButton&&this.pointerDown;b.beginPath();b.lineWidth=a?5:0;b.strokeStyle=this.style.lineColor;b.translate(this.hMargin,this.vMargin);drawRoundRect(b,this.w-2*this.hMargin,this.h-2*this.vMargin,this.roundRadius);if(!this.isFillColorTransparent()){b.fillStyle=this.style.fillColor;b.fill()}if(a){b.stroke()}return};function UIColorTileCreator(a,c){var b=["ui-color-tile","ui-color-tile",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIColorButton();return d.initUIColorTile(this.type,a,c)};return}function UIColorButtonCreator(a,c){var b=["ui-color-button","ui-color-button",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIColorButton();return d.initUIColorButton(this.type,a,c)};return}function UIColorBar(){return}UIColorBar.prototype=new UIElement();UIColorBar.prototype.isUIButton=false;UIColorBar.prototype.isUIColorBar=true;UIColorBar.prototype.initUIColorBar=function(c,a,b){this.initUIElement(c);this.setBarPosition(0);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setCanRectSelectable(false,false);return this};UIColorBar.prototype.setColorsStr=function(a){this.strColors=a;this.colors=a.split(",");return};UIColorBar.prototype.getColorsStr=function(){return this.strColors};UIColorBar.prototype.getColors=function(){if(!this.colors||!this.colors.length){if(this.strColors){this.colors=this.strColors.split(",")}}return this.colors};UIColorBar.prototype.setBarPosition=function(a){this.barPosition=a;return};UIColorBar.prototype.getBarPosition=function(){return this.barPosition};UIColorBar.prototype.getCustomProp=function(){var a=' 		<label class="description" for="colors">'+dappGetText("Colors")+':</label>		<input id="colors"  class="element text medium" type="text" value="0"/>';if(this.w>this.h){a=a+'<select class="element select medium" id="position" > 			<option value="-1">top</option>			<option value="0">middle</option>			<option value="1">bottom</option>		</select>'}else{a=a+'<select class="element select medium" id="position" > 			<option value="-1">left</option>			<option value="0">center</option>			<option value="1">right</option>		</select>'}return a};UIColorBar.prototype.loadCustomProp=function(b){var a=this;b.colors.value=this.getColorsStr();b.colors.onchange=function(c){a.setColorsStr(this.value);return};b.position.value=this.getBarPosition();b.position.onchange=function(c){a.setBarPosition(parseInt(this.value));return};return};UIColorBar.prototype.shapeCanBeChild=function(a){return false};UIColorBar.prototype.paintSelfOnly=function(e){var d=0;var b=0;var a=this.getColors();if(!a||!a.length){this.fillRect(0,0,this.w,this.h);return}var g=a.length;var c=this.h>this.w;switch(this.barPosition){case -1:break;case 1:if(c){d=this.w-g}else{b=this.h-g}break;default:if(c){d=Math.floor((this.w-g)/2)}else{b=Math.floor((this.h-g)/2)}}e.lineWidth=1;if(c){for(var f=0;f<g;f++){e.moveTo(d+f,0);e.lineTo(d+f,this.h);e.strokeStyle=a[f];e.stroke()}}else{for(var f=0;f<g;f++){e.moveTo(0,b+f);e.lineTo(this.w,b+f);e.strokeStyle=a[f];e.stroke()}}return};function UIColorBarCreator(a,c){var b=["ui-color-bar","ui-color-bar",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIColorBar();return d.initUIColorBar(this.type,a,c)};return}function UISimpleHTML(){return}UISimpleHTML.prototype=new UIVScrollView();UISimpleHTML.prototype.isUISimpleHTML=true;UISimpleHTML.prototype.initUISimpleHTML=function(c,a,b){this.initUIVScrollView(c,10,b,null);this.setText(a);this.setDefSize(200,200);this.setTextType(C_SHAPE_TEXT_TEXTAREA);this.setImage(C_SHAPE_IMAGE_ALL,b);return this};UISimpleHTML.prototype.extractHtmlElements=function(c){var g=0;var b=this;var o=c.localName;var d=c.childNodes.length;var m=c.childNodes;if(o==="b"){this.bold=this.bold+1}if(o==="i"){this.italic=this.italic+1}if(o==="u"){this.underline=this.underline+1}if(o==="a"){this.anchor=this.anchor+1}if(c.style&&c.style.color){this.colors.push(c.style.color)}for(var g=0;g<d;g++){var j=m[g];this.extractHtmlElements(j)}var e={x:0,y:0};if(o==="img"&&c.src){var a=c.src;var f=new Image();f.onload=function(i){e.imageLoaded=true;b.textNeedRelayout=true;return};f.onerror=function(i){e.imageLoaded=false;if(a){console.log("load "+a+" failed.")}};f.onabort=function(i){e.imageLoaded=false;if(a){console.log("load "+a+" failed(abort).")}};f.src=a;e.type="img";e.value=f}else{if(!d&&c.textContent){var l="";var h=c.textContent.replace(/\t/g," ");for(var g=0;g<h.length;g++){if(h[g]===" "){for(;g<h.length;g++){if(h[g]!=" "){l=l+" "+h[g];break}}}else{l=l+h[g]}}e.type="text";e.value=l;e.bold=this.bold;e.italic=this.italic;e.underline=this.underline;e.anchor=this.anchor;e.fontStyle="";if(this.colors.length){e.color=this.colors[this.colors.length-1]}if(e.bold){e.fontStyle=e.fontStyle+"bold "}if(e.italic){e.fontStyle=e.fontStyle+"italic "}}}if(o==="b"){this.bold=this.bold-1}if(o==="i"){this.italic=this.italic-1}if(o==="u"){this.underline=this.underline-1}if(o==="a"){e.href=c.href;this.anchor=this.anchor-1}if(o==="p"||(c.style!=null&&c.style.display==="block")){e.type="newblock"}else{if(o==="li"||o==="br"||o==="hr"||o==="dd"){e.type="newline"}}if(c.style&&c.style.color){this.colors.pop()}if(e.type){e.tag=o;this.elements.push(e)}return};UISimpleHTML.prototype.getNodeByPoint=function(o){var f=0;var l=o.x;var h=o.y;var d=null;var g=null;var j={};var b=this.elements.length;var a=this.elements;for(f=0;f<b;f++){d=a[f];g=((f+1)<b)?a[f+1]:null;if(h<d.y){continue}if(g&&(h>g.y&&d.y<g.y)){continue}if(d.type==="text"){var e=0;var c=d.lines.length;j.h=d.lineHeight;for(e=0;e<c;e++){j.x=0;j.y=d.y+e*d.lineHeight;if(e===0){j.x=d.x;j.w=d.firstLineWidth}else{if((e+1)===c){j.w=d.lastLineWidth}else{j.w=this.w}}if(isPointInRect(o,j)){return d}}}else{if(d.type==="img"){j.x=d.x;j.y=d.y;j.w=d.w;j.h=d.h;if(isPointInRect(o,j)){return d}}}}return d};UISimpleHTML.prototype.layoutHtmlElements=function(d){var m=0;var o=0;var l=0;var g=null;var p=0;var b=null;var e=this.elements.length;var a=this.elements;var c=this.getWidth(true);var t=this.style.fontSize;var j=new TextLayout(d);var f=t+"pt "+this.style.fontFamily;var r=t*2;d.font=f;for(m=0;m<e;m++){g=a[m];if(g.type==="text"){g.lines=[];g.x=o;g.y=l;g.firstLineWidth=0;d.font=g.fontStyle+f;g.lineHeight=r;j.setText(g.value);while(true){p=c-o;if(j.hasNext()){b=j.nextLine(p,t);g.lines.push(b.text);if(g.lines.length===1){g.firstLineWidth=b.width}if(j.hasNext()){o=0;l=l+r}else{o=o+b.width;g.lastLineWidth=b.width;break}}else{break}}}else{if(g.type==="newline"){g.x=o;g.y=l;o=0;l=l+r}else{if(g.type==="newblock"){g.x=o;g.y=l;o=0;l=l+r*1.5}else{if(g.type==="img"){if(g.imageLoaded){var h=g.value;var s=h.width;var q=h.height;g.y=l+r*0.5;if(s<c){g.x=(c-s)/2;l=g.y+q;g.w=s;g.h=q}else{g.x=0;g.w=c;g.h=q*(c/s);l=g.y+g.h}l=l+0.5*r}else{l=l+r}o=0}}}}this.scrollRange=l}return};UISimpleHTML.prototype.getScrollRange=function(){return this.scrollRange?this.scrollRange:this.h};UISimpleHTML.prototype.loadUrl=function(d,a){var c={};var b=this;c.method="GET";c.url=d;c.headers={"Cache-Control":"no-cache",Pragma:"no-cache"};c.onDone=function(f,l,g){var j=(l.status===200);if(l.status===200){var h=g;try{b.setText(h);console.log("loadUrl: done")}catch(i){j=false;console.log("loadUrl: failed"+i.message)}}if(a){a(j)}return};httpDoRequest(c);return};UISimpleHTML.prototype.setText=function(b){this.text=b;this.elements=[];var a=document.createElement("div");a.innerHTML=this.text;this.bold=0;this.anchor=0;this.italic=0;this.underline=0;this.strong=0;this.colors=[];this.extractHtmlElements(a);delete this.colors;delete this.anchor;delete this.bold;delete this.italic;delete this.underline;delete this.strong;this.textNeedRelayout=true;return};UISimpleHTML.prototype.layoutHtml=function(a){if(!this.textNeedRelayout){return}if(!this.text){return}this.layoutHtmlElements(a);this.textNeedRelayout=false;return};UISimpleHTML.prototype.shapeCanBeChild=function(a){return false};UISimpleHTML.prototype.drawText=function(e){var s=0;var j=0;var h=0;var v=0;var r=null;var q=this.getWidth(true);var c=this.style.fontSize;var f=2*c;var u=this.hMargin;var t=-this.offset+this.vMargin;var d=c+"pt "+this.style.fontFamily;this.layoutHtml(e);e.save();e.rect(0,0,this.w,this.h);e.clip();e.fillStyle=this.style.fillColor;e.fill();e.beginPath();e.font=d;e.textAlign="left";e.textBaseline="top";e.fillStyle=this.style.textColor;var p=this.elements.length;var l=this.elements;for(s=0;s<p;s++){r=l[s];if(r.type==="text"){var m=r.lines.length;e.font=r.fontStyle+d;if(r.color){e.fillStyle=r.color}else{if(r.anchor){e.fillStyle="Blue"}else{e.fillStyle=this.style.textColor}}for(k=0;k<m;k++){if(k===0){j=r.x;h=r.y}else{j=0;h=r.y+k*(f)}j=j+u;h=h+t;v=h+c;if(h<this.h&&v>=0){q=this.w-j-this.hMargin;e.fillText(r.lines[k],j,h,q)}}}else{if(r.type==="img"&&r.imageLoaded){var o=r.value;var a=o.width;var g=o.height;j=r.x+u;h=r.y+t;v=h+r.h;if(h<this.h&&v>=0){e.drawImage(o,0,0,a,g,j,h,r.w,r.h)}}}}e.restore();return};function UISimpleHTMLCreator(){var a=["ui-simple-html","ui-simple-html",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UISimpleHTML();var b="Simpe HTML";return c.initUISimpleHTML(this.type,b,null)};return}function UILayout(){return}UILayout.prototype=new UIElement();UILayout.prototype.isUILayout=true;UILayout.prototype.initUILayout=function(d,a,c,b){this.initUIElement(d);this.setDefSize(a,c);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,b);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.setCanRectSelectable(false,false);this.vLayout=(this.type==="ui-v-layout");this.addEventNames(["onInit"]);return this};UILayout.prototype.getCustomProp=function(){var a=' 		<label class="description" for="border">'+dappGetText("Border Size")+':</label>		<input id="border"  class="element text small" type="number" value="0"/>';return a};UILayout.prototype.loadCustomProp=function(b){var a=this;b.border.value=this.getHMargin();b.border.onchange=function(d){var c=parseInt(this.value);a.setMargin(c,c);return};return};UILayout.prototype.shapeCanBeChild=function(a){if(a.isUIDevice||a.isUIScreen||a.isUIStatusBar||a.isUIWindow||a.isUIPageManager||a.isUIPage){return false}return true};UILayout.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b&&this.mode===C_MODE_EDITING){var j=this.vMargin;var g=this.hMargin;var l=this.getWidth(true);var d=this.getHeight(true);var e=this.vLayout;drawDashedRect(a,j,g,l,d);if(this.children.length===0){if(e){drawDashedLine(a,{x:j,y:0.2*d},{x:l,y:0.2*d},8,4);drawDashedLine(a,{x:j,y:0.5*d},{x:l,y:0.5*d},8,4)}else{drawDashedLine(a,{x:0.2*l,y:g},{x:0.2*l,y:d},8,4);drawDashedLine(a,{x:0.5*l,y:g},{x:0.5*l,y:d},8,4)}}else{for(var c=0;c<this.children.length;c++){var f=this.children[c];if(e){var g=f.y+f.h;drawDashedLine(a,{x:j,y:g},{x:l,y:g},8,4)}else{var j=f.x+f.w;drawDashedLine(a,{x:j,y:g},{x:j,y:d},8,4)}}}a.stroke()}return};UILayout.prototype.sortChildren=function(){var a=this.vLayout;if(a){this.children.sort(function(d,c){var f=c.y;var e=c.pointerDown?d.y+d.h/2:d.y;return e-f})}else{this.children.sort(function(d,c){var f=c.x;var e=c.pointerDown?d.x+d.w/2:d.x;return e-f})}return};UILayout.prototype.onPointerUpEditing=function(a,b){if(this.view&&this.view.isClicked()){return}if(this.mode!==C_MODE_EDITING){return}if(b){this.sortChildren()}else{this.relayoutChildren()}return};UILayout.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var a=this.hMargin;var e=this.vMargin;var d=this.vLayout;for(var c=0;c<this.children.length;c++){var b=this.children[c];if(d){if(b.heightAttr===C_HEIGHT_FILL_PARENT){b.heightAttr=C_HEIGHT_SCALE}b.y=e;b.relayout();b.y=e;e=e+b.h;if(e>this.h){this.h=e+this.vMargin}}else{if(b.widthAttr===C_WIDTH_FILL_PARENT){b.widthAttr=C_WIDTH_SCALE}b.x=a;b.relayout();b.x=a;a=a+b.w;if(a>this.w){this.w=a+this.hMargin}}}return};UILayout.prototype.afterChildAppended=function(a){var b=this.vLayout;if(b){if(a.heightAttr===C_HEIGHT_FILL_PARENT){a.heightAttr=C_HEIGHT_SCALE}}else{if(a.widthAttr===C_WIDTH_FILL_PARENT){a.widthAttr=C_WIDTH_SCALE}}if(this.mode===C_MODE_EDITING&&a.isCreatingElement()){this.sortChildren()}a.setUserMovable(true);a.setUserResizable(true);a.setCanRectSelectable(false,true);return true};function UIVLayoutCreator(a,d,b){var c=["ui-v-layout","ui-layout",null,1];ShapeCreator.apply(this,c);this.createShape=function(f){var e=new UILayout();return e.initUILayout(this.type,a,d,b)};return}function UIHLayoutCreator(a,d,b){var c=["ui-h-layout","ui-layout",null,1];ShapeCreator.apply(this,c);this.createShape=function(f){var e=new UILayout();return e.initUILayout(this.type,a,d,b)};return}function UIPlaceholder(){return}UIPlaceholder.prototype=new UIElement();UIPlaceholder.prototype.isUIPlaceholder=true;UIPlaceholder.prototype.initUIPlaceholder=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setCanRectSelectable(false,false);return this};UIPlaceholder.prototype.shapeCanBeChild=function(a){return false};UIPlaceholder.prototype.paintSelfOnly=function(c){if(this.mode===C_MODE_EDITING){var a=this.vMargin;var e=this.hMargin;var b=this.getWidth(true);var d=this.getHeight(true);drawDashedRect(c,a,e,b,d);c.stroke()}return};function UIVPlaceholderCreator(a,c){var b=["ui-v-placeholder","ui-placeholder",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIPlaceholder();d.initUIPlaceholder(this.type,a,c);d.widthAttr=C_WIDTH_FILL_PARENT;d.MIN_SIZE=4;d.setSizeLimit(20,4);return d};return}function UIHPlaceholderCreator(a,c){var b=["ui-h-placeholder","ui-placeholder",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UIPlaceholder();d.initUIPlaceholder(this.type,a,c);d.heightAttr=C_HEIGHT_FILL_PARENT;d.MIN_SIZE=4;d.setSizeLimit(4,20);return d};return}function UICollapsable(){return}UICollapsable.prototype=new UILayout();UICollapsable.prototype.isUICollapsable=true;UICollapsable.prototype.initUICollapsable=function(d,a,c,b){this.initUILayout(d,a,c,b);this.vLayout=(this.type==="ui-v-collapsable");return this};UICollapsable.prototype.getCustomProp=function(){return""};UICollapsable.prototype.loadCustomProp=function(b){var a=this;return};UICollapsable.prototype.shapeCanBeChild=function(a){if(a.isUIDevice||a.isUIScreen||a.isUIStatusBar||a.isUIWindow||a.isUIPageManager||a.isUIPage){return false}if(this.children.length>=2){return false}return true};UICollapsable.prototype.paintSelfOnly=function(a){a.fillRect(0,0,this.w,this.h);return};UICollapsable.prototype.expandChild=function(c){var b="";if(this.children.length!=2||!c||c.visible){return}var a=null;if(c===this.children[0]){if(this.vLayout){this.y=this.y-c.h;this.h=this.h+c.h;b="anim-expand-up"}else{this.x=this.x-c.w;this.w=this.w+c.w;b="anim-expand-left"}}else{if(c===this.children[1]){if(this.vLayout){this.h=this.h+c.h;b="anim-expand-down"}else{this.w=this.w+c.w;b="anim-expand-right"}}else{return}}c.setVisible(true);this.relayoutChildren();this.parentShape.relayoutChildren("default");c.setVisible(false);animateUIElement(c,b);return};UICollapsable.prototype.collapseChild=function(b){b.setVisible(true);if(this.children.length!=2||!b||!b.visible){return}var a=null;if(b===this.children[0]){if(this.vLayout){animhint="anim-collapse-down";animateUIElement(b,animhint);this.y=this.y+b.h;this.h=this.h-b.h}else{animhint="anim-collapse-right";animateUIElement(b,animhint);this.x=this.x+b.w;this.w=this.w-b.w}}else{if(b===this.children[1]){if(this.vLayout){animhint="anim-collapse-up";animateUIElement(b,animhint);this.h=this.h-b.h}else{animhint="anim-collapse-left";animateUIElement(b,animhint);this.w=this.w-b.w}}else{return}}b.setVisible(false);this.relayoutChildren();this.parentShape.relayoutChildren("default");return};UICollapsable.prototype.getChild=function(a){var b=this.findChildByName(a);if(!b){if(a==="first"||a===0){b=this.children[0]}if(a==="second"||a===1){b=this.children[1]}}return b};UICollapsable.prototype.collapse=function(a){this.collapseChild(this.getChild(a));return};UICollapsable.prototype.expand=function(a){this.collapseChild(this.getChild(a));return};UICollapsable.prototype.collapseOrExpand=function(a){var b=this.getChild(a);if(!b){return}if(b.visible){this.collapseChild(b)}else{this.expandChild(b)}return};UICollapsable.prototype.relayoutChildren=function(){if(this.disableRelayout){return}var a=this.hMargin;var e=this.vMargin;var d=this.vLayout;for(var c=0;c<this.children.length;c++){var b=this.children[c];if(!b.visible){continue}if(d){b.heightAttr=C_HEIGHT_FIX;b.widthAttr=C_WIDTH_FILL_PARENT;b.relayout();b.y=e;e=e+b.h;if(e>this.h){this.h=e+this.vMargin}}else{b.widthAttr=C_WIDTH_FIX;b.heightAttr=C_HEIGHT_FILL_PARENT;b.relayout();b.x=a;a=a+b.w;if(a>this.w){this.w=a+this.hMargin}}}return};function UIVCollapsableCreator(a,d,b){var c=["ui-v-collapsable","ui-collapsable",null,1];ShapeCreator.apply(this,c);this.createShape=function(f){var e=new UICollapsable();e.isUIVCollapsable=true;return e.initUICollapsable(this.type,a,d,b)};return}function UIHCollapsableCreator(a,d,b){var c=["ui-h-collapsable","ui-collapsable",null,1];ShapeCreator.apply(this,c);this.createShape=function(f){var e=new UICollapsable();e.isUIHCollapsable=true;return e.initUICollapsable(this.type,a,d,b)};return}function UILedDigits(){return}UILedDigits.prototype=new UIElement();UILedDigits.prototype.isUILedDigits=true;UILedDigits.prototype.initUILedDigits=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);return this};UILedDigits.prototype.getCustomProp=function(){var a='		<label class="description" for="text">'+dappGetText("Text")+':</label>		<input id="value"  class="element text small" type="text" value="0"/> 		<label class="description" for="fillcolor">'+dappGetText("Background Color")+':</label>		<input id="fillcolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="textcolor">'+dappGetText("Light LED Color")+':</label>		<input id="textcolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="linecolor">'+dappGetText("Dark LED Color")+':</label>		<input id="linecolor"  class="element text small" type="text" value="0"/>';return a};UILedDigits.prototype.loadCustomProp=function(a){var b=this;a.value.value=this.text;a.value.onchange=function(c){b.setText(this.value);return};a.textcolor.value=this.style.textColor;a.textcolor.onchange=function(c){b.style.setTextColor(this.value);return};a.fillcolor.value=this.style.fillColor;a.fillcolor.onchange=function(c){b.style.setFillColor(this.value);return};a.linecolor.value=this.style.lineColor;a.linecolor.onchange=function(c){b.style.setLineColor(this.value);return};return};UILedDigits.prototype.shapeCanBeChild=function(a){return false};UILedDigits.prototype.setText=function(b){this.text="";for(var a=0;a<b.length;a++){var d=b[a];switch(d){case".":case":":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"E":case"F":case"F":this.text=this.text+d;default:break}}return};UILedDigits.prototype.drawBarV=function(b,a,c){b.beginPath();b.moveTo(a/2,0);b.lineTo(a,a/2);b.lineTo(a,c-a/2);b.lineTo(a/2,c);b.lineTo(0,c-a/2);b.lineTo(0,a/2);b.lineTo(a/2,0);return};UILedDigits.prototype.drawBarH=function(b,a,c){b.beginPath();b.moveTo(0,c/2);b.lineTo(c/2,0);b.lineTo(a-c/2,0);b.lineTo(a,c/2);b.lineTo(a-c/2,c);b.lineTo(c/2,c);b.lineTo(0,c/2);return};UILedDigits.prototype.drawBar=function(b,a,c){if(a<c){this.drawBarV(b,a,c)}else{this.drawBarH(b,a,c)}return};UILedDigits.prototype.drawDot=function(c,a,e,b){var d=(a/4+e/8)/2;if(b==="."){c.fillRect((a-d)/2,0.75*e-d/2,d,d)}else{if(b=":"){c.fillRect((a-d)/2,0.25*e-d/2,d,d);c.fillRect((a-d)/2,0.75*e-d/2,d,d)}}return};UILedDigits.prototype.map={"0":125,"1":96,"2":55,"3":103,"4":106,"5":79,"6":95,"7":97,"8":127,"9":111,E:31,F:27,H:122};UILedDigits.prototype.fillBar=function(b,a){if(a){b.fillStyle=this.style.textColor;b.fill()}else{b.lineWidth=1;b.strokeStyle=this.style.lineColor;b.stroke()}return};UILedDigits.prototype.drawDigit=function(b,j,d,i){var g=d/10;var c=j/10;var m=(c+g)/2;var a=m;var f=j-2*a;var e=d/2-2*a;var l=this.map[i];b.translate(a,0);this.drawBar(b,f,m);b.translate(-a,0);this.fillBar(b,l&1);b.translate(a,(d-g)/2);this.drawBar(b,f,m);b.translate(-a,-(d-g)/2);this.fillBar(b,(l>>1)&1);b.translate(a,d-g);this.drawBar(b,f,m);b.translate(-a,-(d-g));this.fillBar(b,(l>>2)&1);b.translate(0,a);this.drawBar(b,m,e);b.translate(0,-a);this.fillBar(b,(l>>3)&1);b.translate(0,(a+(d-g)/2));this.drawBar(b,m,e);b.translate(0,-(a+(d-g)/2));this.fillBar(b,(l>>4)&1);b.translate((j-m),a);this.drawBar(b,m,e);b.translate(-(j-m),-a);this.fillBar(b,(l>>5)&1);b.translate((j-m),(a+(d-g)/2));this.drawBar(b,m,e);b.translate(-(j-m),-(a+(d-g)/2));this.fillBar(b,(l>>6)&1);return};UILedDigits.prototype.drawDigits=function(b){var j=0;var m=this.text;var c=m.length;if(!c){return}for(var e=0;e<c;e++){var g=m[e];if(g==="."||g===":"){j=j+1}}var a=this.w/c*0.2;var l=this.w/c-a;var f=this.h;b.save();b.translate(l/4*j,0);for(var e=0;e<c;e++){var g=m[e];if(g==="."||g===":"){this.drawDot(b,l/2,f,m[e]);b.translate(l/2+a,0)}else{this.drawDigit(b,l,f,m[e]);b.translate(l+a,0)}}b.restore();return};UILedDigits.prototype.paintSelfOnly=function(a){if(!this.isFillColorTransparent()){a.fillStyle=this.style.fillColor;a.fillRect(0,0,this.w,this.h)}a.fillStyle=this.style.lineColor;this.drawDigits(a);return};function UILedDigitsCreator(a,c){var b=["ui-led-digits","ui-led-digits",null,1];ShapeCreator.apply(this,b);this.createShape=function(e){var d=new UILedDigits();return d.initUILedDigits(this.type,a,c)};return}function UIGauge(){return}UIGauge.prototype=new UIElement();UIGauge.prototype.isUIGauge=true;UIGauge.prototype.initUIGauge=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,null);this.addEventNames(["onInit"]);return this};UIGauge.prototype.shapeCanBeChild=function(a){return a.isUILedDigits||a.isUILabel||a.isUIGaugePointer};UIGauge.prototype.afterChildAppended=function(b){var e=20;var d=0;if(b.isUIGaugePointer){b.xAttr=C_X_CENTER_IN_PARENT;b.yAttr=C_Y_MIDDLE_IN_PARENT}for(var c=0;c<this.children.length;c++){var a=this.children[c];if(!a.isUIGaugePointer){continue}switch(d){case 0:e=100;break;case 1:e=70;break;case 2:e=40;break}d=d+1;a.setSizeLimit(e,e,e,e,1);a.setSize(e,e)}this.setSizeLimit(100,100,1000,1000,1);return};UIGauge.prototype.onPointerUpEditing=function(a,b){if(!b){this.relayoutChildren()}return};UIGauge.prototype.paintSelfOnly=function(a){return};function UIGaugeCreator(){var a=["ui-gauge","ui-gauge",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIGauge();return b.initUIGauge(this.type,200,200)};return}function UIGaugePointer(){return}UIGaugePointer.prototype=new UIElement();UIGaugePointer.prototype.isUIGaugePointer=true;UIGaugePointer.prototype.initUIGaugePointer=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_IMAGE,null);this.value=0;this.minAngle=0;this.maxAngle=360;this.minValue=0;this.maxValue=60;return this};UIGaugePointer.prototype.shapeCanBeChild=function(a){return false};UIGaugePointer.prototype.setText=function(b){if(!b){return}try{this.setValue(parseInt(b))}catch(a){console.log("UIGaugePointer.prototype.setText:"+a.message)}return};UIGaugePointer.prototype.getText=function(){return this.getValue()+""};UIGaugePointer.prototype.setValue=function(a){if(a>=this.minValue&&a<=this.maxValue){this.value=a}else{console.log("UIGaugePointer.prototype.setValue: Out Of Range.")}return};UIGaugePointer.prototype.getValue=function(){return this.value};UIGaugePointer.prototype.animSetValue=function(b,a){return this.animSetValue(b,a)};UIGaugePointer.prototype.animateSetValue=function(j,h){if(j<this.minValue){j=this.minValue}if(j>this.maxValue){j=this.maxValue}var a=this;var i=j;var c=this.getValue();var g=j-c;var b=Math.abs(g*(this.maxAngle-this.minAngle)/(this.maxValue-this.minValue));if(b<5){this.setValue(j);return}var d=(new Date()).getTime();var e=(h&&h=="slow")?1000:500;function f(){var l=new Date();var m=(l.getTime()-d)/e;if(m<1){var n=c+g*m;a.setValue(n);setTimeout(f,10)}else{delete d;a.setValue(i)}delete l;a.postRedraw()}f();return};UIGaugePointer.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="minangle">'+dappGetText("Min Angle(degree)")+':</label>		<input id="minangle"  class="element text small" type="number" value="0"/> 		<label class="description" for="minvalue">'+dappGetText("Min Value")+':</label>		<input id="minvalue"  class="element text small" type="number" value="0"/> 		<label class="description" for="maxangle">'+dappGetText("Max Angle(degree)")+':</label>		<input id="maxangle"  class="element text small" type="number" value="0"/> 		<label class="description" for="maxvalue">'+dappGetText("Max Value")+':</label>		<input id="maxvalue"  class="element text small" type="number" value="0"/> 		<label class="description" for="value">'+dappGetText("Value")+':</label>		<input id="value"  class="element text small" type="number" value="0"/>';return a};UIGaugePointer.prototype.loadCustomProp=function(a){var b=this;a.value.value=this.getText();a.value.onchange=function(c){b.setText(this.value);return};a.minangle.value=this.minAngle;a.minangle.onchange=function(c){b.minAngle=parseInt(this.value);if(b.maxAngle<=b.minAngle){b.maxAngle=b.minAngle+1}return};a.minvalue.value=this.minValue;a.minvalue.onchange=function(c){b.minValue=parseInt(this.value);if(b.maxValue<=b.minValue){b.maxValue=b.minValue+1}return};a.maxangle.value=this.maxAngle;a.maxangle.onchange=function(c){b.maxAngle=parseInt(this.value);if(b.maxAngle<=b.minAngle){b.maxAngle=b.minAngle+1}return};a.maxvalue.value=this.maxValue;a.maxvalue.onchange=function(c){b.maxValue=parseInt(this.value);if(b.maxValue<=b.minValue){b.maxValue=b.minValue+1}return};return};UIGaugePointer.prototype.getAngle=function(a){var c=this.maxAngle-this.minAngle;var b=this.maxValue-this.minValue;var d=(this.value/b)*c+this.minAngle;d=Math.PI*(d/180);return d};UIGaugePointer.prototype.paintSelfOnly=function(a){var g=0;var f=0;var i=this.w;var d=this.h;var b=this.getAngle();var c=this.getHtmlImageByType(C_SHAPE_IMAGE_IMAGE);if(c&&c.width){var j=c.width;var e=c.height;a.translate(i/2,d/2);a.rotate(b);a.translate(-i/2,-d/2);g=(i-j)/2;f=(d-e)/2;a.drawImage(c,g,f)}else{a.fillRect(0,0,this.w,this.h)}return};function UIGaugePointerCreator(){var a=["ui-gauge-pointer","ui-gauge-pointer",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIGaugePointer();return b.initUIGaugePointer(this.type,20,200)};return}function UIImageView(){return}UIImageView.prototype=new UIElement();UIImageView.prototype.isUIImageView=true;UIImageView.cachedImages={};UIImageView.IMAGE_STATE_PENDING=0;UIImageView.IMAGE_STATE_ERROR=1;UIImageView.IMAGE_STATE_DONE=2;UIImageView.prototype.imageViewToJson=function(a){a.userImages=this.getValue();return a};UIImageView.prototype.imageViewFromJson=function(a){if(a.userImages){this.userImages=[];this.setValue(a.userImages)}return};UIImageView.prototype.initUIImageView=function(a,b){this.setDefSize(a,b);this.userImages=[];this.onSized=UIImageView.prototype.onSized;this.setValue=UIImageView.prototype.setValue;this.getValue=UIImageView.prototype.getValue;this.ensureImages=UIImageView.prototype.ensureImages;this.addUserImage=UIImageView.prototype.addUserImage;this.getCustomProp=UIImageView.prototype.getCustomProp;this.loadCustomProp=UIImageView.prototype.loadCustomProp;this.imageViewToJson=UIImageView.prototype.imageViewToJson;this.imageViewFromJson=UIImageView.prototype.imageViewFromJson;this.getCustomPropMore=UIImageView.prototype.getCustomPropMore;this.loadCustomPropMore=UIImageView.prototype.loadCustomPropMore;this.onScaleForDensityDone=UIImageView.prototype.onScaleForDensityDone;this.regSerializer(this.imageViewToJson,this.imageViewFromJson);return this};UIImageView.createImage=function(d,a){var b=UIImageView.cachedImages[d];if(!b){b=new Image();b.src=d;b.onLoadDoneListeners=[];function c(h,e){if(!h||!h.onLoadDoneListeners){return}for(var f=0;f<h.onLoadDoneListeners.length;f++){var g=h.onLoadDoneListeners[f];g(h,e)}h.onLoadDoneListeners.clear();return}b.onload=function(f){c(this,true);this.loaded=true};b.onabort=function(f){c(this,false);this.failed=true;console.log("load "+this.src+" failed.")};b.onerror=function(f){c(this,false);this.failed=true;console.log("load "+this.src+" failed.")}}else{console.log("Create Image From Cache: "+d)}if(a){if(b.loaded){a(b,true)}else{if(b.failed){a(b,false)}else{b.onLoadDoneListeners.push(a)}}}return b};UIImageView.drawImageAtCenter=function(o,c,i,g,l,d,j){o.clearRect(i,g,l,d);if(c&&c.width>0){var m=c.width;var e=c.height;if(j){var b=Math.min(1,Math.min(d/e,l/m));var a=m*b;var f=e*b;var p=(l-a)/2+i;var n=(d-f)/2+g;p=Math.max(p,i);n=Math.max(n,g)}else{p=i;n=g;a=l;f=d}o.drawImage(c,0,0,m,e,p,n,a,f)}return};UIImageView.prototype.ensureImages=function(){if(!this.cacheInvalid){return}var c=this;function a(g,f){c.postRedraw();return}this.cachedImages=[];for(var b=0;b<this.userImages.length;b++){var e=this.userImages[b];var d=UIImageView.createImage(e,a);this.cachedImages.push(d)}delete this.cacheInvalid;return};UIImageView.prototype.onSized=function(){this.cacheInvalid=true;return};UIImageView.prototype.onScaleForDensityDone=function(){this.cacheInvalid=true;return};UIImageView.prototype.addUserImage=function(b){this.cacheInvalid=true;this.userImages.push(b);var a="image_"+this.userImages.length;this.setImage(a,b);return};UIImageView.prototype.getCurrentImage=function(){return this.curentImage};UIImageView.prototype.setValue=function(c){var a=c.split("\n");this.userImages=[];for(var b=0;b<a.length;b++){if(a[b]){this.addUserImage(a[b])}}return};UIImageView.prototype.getValue=function(){var b="";for(var a=0;a<this.userImages.length;a++){b=b+this.userImages[a]+"\n"}return b};UIImageView.prototype.getCustomPropMore=function(){return""};UIImageView.prototype.getCustomProp=function(){var a=' <br>		<label class="description" for="userimages">'+dappGetText("Images")+':</label>		<textarea id="userimages"  cols="70" rows="8" type="text" value=""></textarea>';return a+this.getCustomPropMore()};UIImageView.prototype.loadCustomPropMore=function(a){};UIImageView.prototype.loadCustomProp=function(a){var b=this;a.userimages.value=this.getValue();a.userimages.onchange=function(c){b.setValue(this.value);return};this.loadCustomPropMore(a);return};function UIImageNormalView(){return}UIImageNormalView.prototype=new UIImageView();UIImageNormalView.prototype.isUIImageNormalView=true;UIImageNormalView.prototype.initUIImageNormalView=function(c,a,b){this.userImages=[];this.cachedImages=[];this.initUIElement(c);this.initUIImageView(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.current=0;this.offsetX=0;this.offsetY=0;this.imageScale=1;this.velocityTracker=new VelocityTracker();this.interpolator=new DecelerateInterpolator();this.errorImage=UIImageView.createImage("drawapp8/images/common/failed.png",null);this.loadingImage=UIImageView.createImage("drawapp8/images/common/loading.png",null);return this};UIImageNormalView.prototype.onPointerDownRunning=function(a,b){if(b){return}this.velocityTracker.clear();return};UIImageNormalView.prototype.onPointerMoveRunning=function(a,b){if(b){return}this.offsetX=this.offsetX+this.getMoveDeltaX();this.offsetY=this.offsetY+this.getMoveDeltaY();this.addMovementForVelocityTracker();return};UIImageNormalView.prototype.getVelocity=function(){return this.velocityTracker.getVelocity().x};UIImageNormalView.prototype.onPointerUpRunning=function(g,f){if(f){return}var c=this.velocityTracker.getVelocity();var a=this.w;var e=this.h;var b=c.x/a;var h=c.y/e;var j=Math.max(b,h);var i=0.5*a*b*b;var d=0.5*e*h*h;i=c.x>0?i:-i;d=c.y>0?d:-d;this.scrollTo(i,d,j*1000);return true};UIImageNormalView.prototype.scrollTo=function(g,f,j){var m=this;var d=Math.max(500,Math.min(j,1000));var a=(new Date()).getTime();var i=this.offsetX;var b=this.offsetY;var c=this.cachedImages[this.current];var l=Math.min(c.width/2,g);var h=Math.min(c.height/2,f);function e(){var n=new Date();var o=(n.getTime()-a)/d;if(o<1){m.offsetX=i+o*l;m.offsetY=b+o*h;setTimeout(e,10)}else{delete a;m.offsetX=i+l;m.offsetY=b+h}delete n;m.postRedraw()}e();return};UIImageNormalView.prototype.switchTo=function(b){var a=this.current;var c=this.userImages.length;if(b>0){if((this.current+b)<c){a=this.current+b}}else{if((this.current+b)>0){a=this.current+b}}};UIImageNormalView.prototype.calcImageDefaultOffset=function(){var b=this.current;if(b<0||b>=this.cachedImages.length){return}var d=this.cachedImages[b];if(!d||!d.width){return}this.imageScale=Math.min(this.w/d.width,this.h/d.height);var a=this.imageScale*d.width;var c=this.imageScale*d.height;this.offsetX=(this.w-a)/2;this.offsetY=(this.h-c)/2;return};UIImageNormalView.prototype.setCurrentImage=function(a){if(a<0||a>=this.userImages.length){return}this.current=a;this.calcImageDefaultOffset();return};UIImageNormalView.prototype.onDoubleClick=function(a,b){this.calcImageDefaultOffset();return this.callDoubleClickHandler(a)};UIImageNormalView.prototype.paintSelfOnly=function(a){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var b=this.cachedImages[this.current];if(!b||!b.width){return}this.imageScale=1;a.save();a.rect(0,0,this.w,this.h);a.clip();a.translate(this.offsetX,this.offsetY);a.scale(this.imageScale,this.imageScale);a.drawImage(b,0,0);a.restore();return};function UIUIImageNormalViewCreator(){var a=["ui-image-normal-view","ui-image-normal-view",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIImageNormalView();return b.initUIImageNormalView(this.type,300,300)};return}function UIImageThumbView(){return}UIImageThumbView.prototype=new UIImageView();UIImageThumbView.prototype.isUIImageThumbView=true;UIImageThumbView.prototype.initUIImageThumbView=function(a,b){this.userImages=[];this.imageProxies=[];this.setDefSize(a,b);this.initUIImageView(a,b);this.getCacheCanvas=UIImageThumbView.prototype.getCacheCanvas;this.getCacheCanvasContext=UIImageThumbView.prototype.getCacheCanvasContext;this.getCustomPropMore=UIImageThumbView.prototype.getCustomPropMore;this.loadCustomPropMore=UIImageThumbView.prototype.loadCustomPropMore;this.getCurrentImage=UIImageThumbView.prototype.getCurrentImage;this.getCurrentImageSrc=UIImageThumbView.prototype.getCurrentImageSrc;this.errorImage=UIImageView.createImage("drawapp8/images/common/failed.png",null);this.loadingImage=UIImageView.createImage("drawapp8/images/common/loading.png",null);return this};UIImageThumbView.prototype.getCustomPropMore=function(){var a='<br><input id="keepratio" class="checkbox_i"  type="checkbox" >		'+dappGetText("Keep Width/Height Ratio")+"</input>";return a};UIImageThumbView.prototype.loadCustomPropMore=function(a){var b=this;a.keepratio.checked=this.keepRatio;a.keepratio.onchange=function(c){b.keepRatio=this.checked};return};UIImageThumbView.prototype.setKeepRatio=function(a){if(this.keepRatio!=a){this.cacheInvalid=true}this.keepRatio=a;return};UIImageThumbView.prototype.getCacheCanvasContext=function(b,c){if(!this.cacheCanvas){canvas=document.createElement("canvas");canvas.width=b;canvas.height=c;this.cacheCanvas=canvas}if(canvas.width!=b){canvas.width=b}if(canvas.height!=c){canvas.height=c}var a=canvas.getContext("2d");a.clearRect(0,0,b,c);return a};UIImageThumbView.prototype.getCurrentImageSrc=function(){return this.currentImageProxy?this.currentImageProxy.src:null};UIImageThumbView.prototype.getCurrentImage=function(){return this.currentImageProxy?this.currentImageProxy.image:null};UIImageThumbView.createImageProxy=function(g,a,b,f,d,l,j,n,e){var c={};c.x=l;c.y=j;c.w=n;c.h=e;c.src=a;c.imageState=UIImageView.IMAGE_STATE_PENDING;function i(o,h){var p=g.keepRatio;if(h){c.imageState=UIImageView.IMAGE_STATE_DONE;UIImageView.drawImageAtCenter(d,o,c.x,c.y,c.w,c.h,p)}else{c.imageState=UIImageView.IMAGE_STATE_ERROR;UIImageView.drawImageAtCenter(d,f,c.x,c.y,c.w,c.h,p)}g.postRedraw()}c.image=UIImageView.createImage(a,i);if(c.imageState===UIImageView.IMAGE_STATE_PENDING){var m=g.keepRatio;UIImageView.drawImageAtCenter(d,b,c.x,c.y,c.w,c.h,m)}return c};UIImageThumbView.prototype.createCacheCanvas=function(){};UIImageThumbView.prototype.getCacheCanvas=function(){if(this.cacheInvalid){this.createCacheCanvas()}return this.cacheCanvas};function UIImageThumbViewTape(){return}UIImageThumbViewTape.prototype=new UIHScrollView();UIImageThumbViewTape.prototype.isUIImageView=true;UIImageThumbViewTape.prototype.isUIImageThumbView=true;UIImageThumbViewTape.prototype.isUIImageThumbViewTape=true;UIImageThumbViewTape.prototype.initUIImageView=UIImageView.prototype.initUIImageView;UIImageThumbViewTape.prototype.initUIImageThumbView=UIImageThumbView.prototype.initUIImageThumbView;UIImageThumbViewTape.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIImageThumbViewTape.prototype.initUIImageThumbViewTape=function(c,a,b){this.initUIHScrollView(c,10,null);this.initUIImageThumbView(a,b);this.heightAttr=C_HEIGHT_FIX;return this};UIImageThumbViewTape.prototype.getSpaceBetweenImages=function(){return this.spaceBetweenImages?this.spaceBetweenImages:2};UIImageThumbViewTape.prototype.createCacheCanvas=function(){var b=this.getSpaceBetweenImages();var o=this.w;var j=this.h;var q=j;var d=this.cacheCanvas;var f=this.userImages.length;delete this.cacheInvalid;this.imageProxies.clear();this.currentImageProxy=null;if(!f){return}o=f*(q+b);var m=0;var l=this.errorImage;var c=this.loadingImage;var p=this.getCacheCanvasContext(o,j);for(var g=0;g<this.userImages.length;g++){var a=this.userImages[g];var e=UIImageThumbView.createImageProxy(this,a,c,l,p,m,0,q,q);this.imageProxies.push(e);m=m+q+b}return};UIImageThumbViewTape.prototype.getScrollRange=function(){var b=this.h;var c=this.getSpaceBetweenImages();var a=this.userImages.length*(b+c)+c;return a};UIImageThumbViewTape.prototype.paintChildren=function(a){return};UIImageThumbViewTape.prototype.getCacheCanvasOffset=function(){var a=Math.max(0,(this.w-this.cacheCanvas.width)/2);return a};UIImageThumbViewTape.prototype.onClick=function(b,e){if(!this.imageProxies||!this.imageProxies.length||e){return}this.currentImageProxy=null;var a=b.x-this.getCacheCanvasOffset();for(var d=0;d<this.imageProxies.length;d++){var c=this.imageProxies[d];if(a>=c.x&&a<(c.x+c.w)){this.currentImageProxy=c}}this.callClickHandler(b,e);return};UIImageThumbViewTape.prototype.paintSelfOnly=function(a){if(!this.userImages||!this.userImages.length||!this.getCacheCanvas()){a.rect(0,0,this.w,this.h);a.stroke();return}var i=0;var f=0;var e=this.h;var j=this.w;var b=this.getCacheCanvas();var d=this.getCacheCanvasOffset();var g=d;a.rect(0,0,this.w,this.h);a.clip();a.beginPath();if(this.offset>=0){if(g>this.offset){g=g-this.offset;var i=b.width;a.drawImage(this.cacheCanvas,0,0,i,e,g,f,i,e);d=g}else{var c=this.offset-g;var i=Math.min(j,b.width-c);a.drawImage(this.cacheCanvas,c,0,i,e,0,f,i,e);d=-c}}else{g=g-this.offset;var i=Math.min(j+this.offset,b.width);a.drawImage(this.cacheCanvas,0,0,i,e,g,f,i,e);d=g}if(this.currentImageProxy){g=d+this.currentImageProxy.x;f=this.currentImageProxy.y;a.rect(g,f,this.currentImageProxy.w,this.currentImageProxy.h);a.stroke()}return};function UIUIImageThumbViewTapeCreator(){var a=["ui-image-thumb-view-tape","ui-image-thumb-view-tape",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIImageThumbViewTape();return b.initUIImageThumbViewTape(this.type,300,100)};return}function UIImageThumbViewGrid(){return}UIImageThumbViewGrid.prototype=new UIHScrollView();UIImageThumbViewGrid.prototype.isUIImageView=true;UIImageThumbViewGrid.prototype.isUIImageThumbView=true;UIImageThumbViewGrid.prototype.isUIImageThumbViewGrid=true;UIImageThumbViewGrid.prototype.initUIImageView=UIImageView.prototype.initUIImageView;UIImageThumbViewGrid.prototype.initUIImageThumbView=UIImageThumbView.prototype.initUIImageThumbView;UIImageThumbViewGrid.prototype.onPointerUpRunning=UIScrollView.prototype.onPointerUpRunning;UIImageThumbViewGrid.prototype.initUIImageThumbViewGrid=function(c,a,b){this.initUIHScrollView(c,10,null);this.initUIImageThumbView(a,b);this.rows=4;this.cols=3;this.pageNr=1;return this};UIImageThumbViewGrid.prototype.calcSize=function(){if(!this.userImages){return}if(this.isIcon){this.cols=3;this.rows=4;this.pageNr=1;return}var i=this.userImages.length;var g=this.getDeviceConfig();var b=g?g.lcdDensity:"hdpi";var f=this.getDensitySizeScale(b)/160;var a=this.w/f;var c=this.h/f;var e=Math.round(a/100);var d=Math.round(c/100);this.cols=e;this.rows=d;this.pageNr=Math.ceil(i/(d*e));return};UIImageThumbViewGrid.prototype.getSpaceBetweenImages=function(){return this.spaceBetweenImages?this.spaceBetweenImages:2};UIImageThumbViewGrid.prototype.createCacheCanvas=function(){var g=this.userImages.length;var d=this.getSpaceBetweenImages();delete this.cacheInvalid;this.imageProxies.clear();this.currentImageProxy=null;this.calcSize();if(!g){return}var t=0;var s=0;var j=0;var m=this.h;var u=this.pageNr*this.w;var z=this.getCacheCanvasContext(u,m);var v=Math.floor((this.w-d)/this.cols)-d;var o=Math.floor((this.h-d)/this.rows)-d;var p=this.errorImage;var e=this.loadingImage;for(var l=0;l<this.pageNr;l++){s=d;for(var b=0;b<this.rows;b++){t=l*this.w+d;for(var q=0;q<this.cols;q++,j++){if(j>=g){break}var a=this.userImages[j];var f=UIImageThumbView.createImageProxy(this,a,e,p,z,t,s,v,o);this.imageProxies.push(f);t=t+v+d}s=s+o+d}}return};UIImageThumbViewGrid.prototype.getScrollRange=function(){var a=this.pageNr*this.w;return a};UIImageThumbViewGrid.prototype.paintChildren=function(a){return};UIImageThumbViewGrid.prototype.getCacheCanvasOffset=function(){return this.getSpaceBetweenImages()};UIImageThumbViewGrid.prototype.onClick=function(h,g){if(!this.imageProxies||!this.imageProxies.length||g){return}var f=h.x;var e=h.y;var a=this.imageProxies.length;var d=Math.floor(f/this.w);var j=Math.floor(e*this.rows/this.h);var b=Math.floor((f%this.w)*this.cols/this.w);var c=d*this.rows*this.cols+j*this.cols+b;if(c<a){this.currentImageProxy=this.imageProxies[c]}return this.callClickHandler(h,g)};UIImageThumbViewGrid.prototype.paintSelfOnly=function(c){var g=this.getSpaceBetweenImages();if(!this.userImages||!this.userImages.length||!this.getCacheCanvas()){c.rect(0,0,this.w,this.h);c.stroke();return}var b=0;var e=this.w;var i=this.offset;var f=this.getCacheCanvas();var d=f.height;var a=f.width;if(i>=0){var b=Math.min(e,a-i);c.drawImage(this.cacheCanvas,i,0,b,d,0,0,b,d)}else{var b=Math.min(a+i,e);c.drawImage(this.cacheCanvas,0,0,b,d,-i,0,b,d)}if(this.currentImageProxy){y=this.currentImageProxy.y;x=this.currentImageProxy.x-i;c.rect(x,y,this.currentImageProxy.w,this.currentImageProxy.h);c.stroke()}return};function UIUIImageThumbViewGridCreator(){var a=["ui-image-thumb-view-grid","ui-image-thumb-view-grid",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIImageThumbViewGrid();return b.initUIImageThumbViewGrid(this.type,300,100)};return}function UIImageAnimation(){return}UIImageAnimation.prototype=new UIImageView();UIImageAnimation.prototype.isUIImageAnimation=true;UIImageAnimation.prototype.initUIImageAnimation=function(c,a,b){this.initUIElement(c);this.initUIImageView(a,b);this.addEventNames(["onChanged"]);this.setTextType(C_SHAPE_TEXT_NONE);this.getCustomPropMore=UIImageAnimation.prototype.getCustomPropMore;this.loadCustomPropMore=UIImageAnimation.prototype.loadCustomPropMore;return this};UIImageAnimation.prototype.setCurrent=function(a){if(this.userImages.length){a=a%this.userImages.length}if(this.currFrame!=a){this.callOnChanged(a)}this.currFrame=a;return};UIImageAnimation.prototype.onInit=function(){var c=this;this.currFrame=0;function a(){if(c.isVisible()){var d=1000/c.getFrameRate();c.postRedraw();setTimeout(a,d);c.setCurrent(c.currFrame+1)}}var b=1000/this.getFrameRate();setTimeout(a,b);return};UIImageAnimation.prototype.getFrameRate=function(){return this.frameRate?this.frameRate:5};UIImageAnimation.prototype.setFrameRate=function(a){this.frameRate=Math.max(1,Math.min(a,30));return};UIImageAnimation.prototype.getCustomPropMore=function(){var a='<label class="description" for="framerate">'+dappGetText("Frame Rate")+':</label>		<input id="framerate"  class="element text medium" type="number" value="0"/>';return a};UIImageAnimation.prototype.loadCustomPropMore=function(a){var b=this;a.framerate.value=this.frameRate?this.frameRate:5;a.framerate.onchange=function(c){b.setFrameRate(parseInt(this.value));return};return};UIImageAnimation.prototype.drawImage=function(c){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var d=(this.currFrame?this.currFrame:0)%this.userImages.length;var f=this.cachedImages[d];if(f&&f.width>0){var e=f.width;var g=f.height;var b=(this.w-e)/2;var a=(this.h-g)/2;c.drawImage(f,0,0,e,g,b,a,e,g)}return};UIImageAnimation.prototype.shapeCanBeChild=function(a){return false};function UIImageAnimationCreator(){var a=["ui-image-animation","ui-image-animation",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIImageAnimation();return b.initUIImageAnimation(this.type,200,200)};return}function UIImageSlideView(){return}UIImageSlideView.prototype=new UIImageView();UIImageSlideView.prototype.isUIImageSlideView=true;UIImageSlideView.prototype.initUIImageSlideView=function(c,a,b){this.initUIElement(c);this.initUIImageView(a,b);this.offset=0;this.addEventNames(["onChanged"]);this.setTextType(C_SHAPE_TEXT_NONE);this.getCustomPropMore=UIImageSlideView.prototype.getCustomPropMore;this.loadCustomPropMore=UIImageSlideView.prototype.loadCustomPropMore;return this};UIImageSlideView.prototype.onInit=function(){var a=this;this.currFrame=0;function b(){if(a.mode!=C_MODE_EDITING&&a.isVisible()){var d=a.getFrameDuration();a.postRedraw();setTimeout(b,d);var e=a.currFrame+1;a.animScrollTo(-a.w,e)}}var c=this.getFrameDuration();setTimeout(b,c);return};UIImageSlideView.prototype.getFrameDuration=function(){return this.frameDuration?this.frameDuration:5000};UIImageSlideView.prototype.setFrameDuration=function(a){this.frameDuration=Math.max(1000,Math.min(a,30000));return};UIImageSlideView.prototype.getCustomPropMore=function(){var a='<label class="description" for="frameduration">'+dappGetText("Frame Duration")+':</label>		<input id="frameduration"  class="element text medium" type="number" value="0"/> 		<br><input id="showindicator" class="checkbox_i"  type="checkbox" >'+dappGetText("Show Frame Indicator")+"</input>";return a};UIImageSlideView.prototype.loadCustomPropMore=function(b){var a=this;b.frameduration.value=this.getFrameDuration();b.frameduration.onchange=function(c){a.setFrameDuration(parseInt(this.value));return};b.showindicator.checked=this.showIndicator;b.showindicator.onchange=function(c){a.setShowIndicator(this.checked)};return};UIImageSlideView.prototype.setShowIndicator=function(a){this.showIndicator=a;return};UIImageSlideView.prototype.getFrameIndicatorParams=function(){var e=this.userImages.length;var d=Math.min((0.5*this.w)/e,40);var c=d*e;var b=(this.w-c)/2;var a=0.8*this.h;return{offsetX:b,offsetY:a,itemSize:d,n:e}};UIImageSlideView.prototype.setCurrentFrame=function(a){this.offset=0;this.currFrame=(a+this.userImages.length)%this.userImages.length;this.postRedraw();this.callOnChanged(this.currFrame);return};UIImageSlideView.prototype.animScrollTo=function(b,h){var f=1000;var d=this;var a=this.offset;var e=(new Date()).getTime();var g=new DecelerateInterpolator(2);if(d.animating){return}d.animating=true;function c(){var j=new Date();var i=(j.getTime()-e)/f;var l=g.get(i);if(i<1){d.offset=a+b*l;setTimeout(c,10)}else{d.offset=0;d.setCurrentFrame(h);delete e;delete g;delete d.animating}delete j;d.postRedraw()}c();return};UIImageSlideView.prototype.onPointerDownRunning=function(a,b){if(!this.velocityTracker){this.velocityTracker=new VelocityTracker()}this.velocityTracker.clear();return true};UIImageSlideView.prototype.onPointerMoveRunning=function(a,b){if(b||this.animating){return}this.offset=this.getMoveAbsDeltaX();this.addMovementForVelocityTracker();return};UIImageSlideView.prototype.onPointerUpRunning=function(b,e){if(e||this.animating){return}var c=0;var a=this.offset;var g=this.currFrame;var d=this.velocityTracker.getVelocity().x;var f=a+d;if(Math.abs(a)<10){this.offset=0;return}if(Math.abs(f)>this.w/3){if(a>0){c=this.w-a;g=this.currFrame-1}else{c=-this.w-a;g=this.currFrame+1}}else{c=-a}this.animScrollTo(c,g);return};UIImageSlideView.prototype.onClick=function(g,f){if(f||this.animating){return}var b=this.getFrameIndicatorParams();var l=b.offsetX;var j=b.offsetY;var h=b.itemSize;var a=b.n;var e=g.x;var d=g.y;if(d<j||d>(j+h)||e<l||e>(l+a*h)){return}for(var c=0;c<a;c++){if(e>l&&e<(l+h)){this.setCurrentFrame(c);break}l+=h}return};UIImageSlideView.prototype.drawFrameIndicator=function(c,e){var g=this.getFrameIndicatorParams();var b=g.offsetX;var a=g.offsetY;var f=g.itemSize;var h=g.n;b+=f/2;a+=f/2;for(var d=0;d<h;d++){c.beginPath();c.arc(b,a,10,0,Math.PI*2);b+=f;if(d===e){c.save();c.shadowColor=this.style.lineColor;c.shadowBlur=5;c.shadowOffsetX=0;c.shadowOffsetY=0;c.fill();c.stroke();c.restore()}else{c.fill()}}return};UIImageSlideView.prototype.getPrevFrame=function(){var a=(this.currFrame-1+this.userImages.length)%this.userImages.length;return this.cachedImages[a]};UIImageSlideView.prototype.getNextFrame=function(){var a=(this.currFrame+1)%this.userImages.length;return this.cachedImages[a]};UIImageSlideView.prototype.drawImage=function(a){if(!this.userImages||!this.userImages.length){return}this.ensureImages();var b=(this.currFrame?this.currFrame:0)%this.userImages.length;var c=this.cachedImages[b];if(c&&c.width>0){a.save();a.rect(0,0,this.w,this.h);a.clip();a.beginPath();a.translate(this.offset,0);UIImageView.drawImageAtCenter(a,c,0,0,this.w,this.h,true);var d=Math.abs(this.offset);if(this.offset<0){c=this.getNextFrame();if(c&&c.width>0){a.translate(this.w,0);UIImageView.drawImageAtCenter(a,c,0,0,this.w,this.h,true)}}else{if(d>0){c=this.getPrevFrame();if(c&&c.width>0){a.translate(-this.w,0);UIImageView.drawImageAtCenter(a,c,0,0,this.w,this.h,true)}}}a.restore();if(this.showIndicator){this.drawFrameIndicator(a,b)}}return};UIImageSlideView.prototype.shapeCanBeChild=function(a){return false};function UIImageSlideViewCreator(){var a=["ui-image-slide-view","ui-image-slide-view",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIImageSlideView();return b.initUIImageSlideView(this.type,200,200)};return}function UIScrollText(){return}UIScrollText.prototype=new UIElement();UIScrollText.prototype.isUIScrollText=true;UIScrollText.prototype.initUIScrollText=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_TEXTAREA);this.setImage(C_SHAPE_IMAGE_ALL,null);this.addEventNames(["onScrollDone"]);return this};UIScrollText.prototype.onModeChanged=function(){this.offsetX=0;this.offsetY=0;return};UIScrollText.prototype.shapeCanBeChild=function(a){return false};UIScrollText.prototype.getCustomProp=function(){var a='		<label class="description" for="pauseduration">'+dappGetText("Pause Duration")+':</label>		<input id="pauseduration"  class="element text"  style="width:50%;"  type="text" value="0"/> 		<label class="description" for="animationduration">'+dappGetText("Animation Duration")+':</label>		<input id="animationduration"  class="element text"  style="width:50%;"  type="text" value="0"/>';return a};UIScrollText.prototype.loadCustomProp=function(b){var a=this;b.pauseduration.value=this.getPauseDuration();b.pauseduration.onchange=function(c){a.setPauseDuration(parseInt(this.value));return};b.animationduration.value=this.getAnimationDuration();b.animationduration.onchange=function(c){a.setAnimationDuration(parseInt(this.value));return};return};UIScrollText.prototype.getAnimationDuration=function(){return this.animationDuration?this.animationDuration:1000};UIScrollText.prototype.setAnimationDuration=function(a){this.animationDuration=a;return};UIScrollText.prototype.getPauseDuration=function(){return this.pauseDuration?this.pauseDuration:0};UIScrollText.prototype.setPauseDuration=function(a){this.pauseDuration=a;return};UIScrollText.prototype.startVScroll=function(){var f=this;var i=this.getTextHeight();var j=this.getLineHeight(true);if(i<=this.h){return}this.offsetX=0;this.offsetY=0;var b=0;var g=0;var c=this.getAnimationDuration();var l=this.getPauseDuration();this.h=Math.floor(this.h/j)*j;var d=-this.h;var a=true;var h=new DecelerateInterpolator();function e(){if(a){a=false;b=(new Date()).getTime()}if(!f.isVisible()){return}var n=new Date();var m=(n.getTime()-b)/c;var o=l>0?h.get(m):m;delete n;if(m<1){f.offsetY=g+d*o;setTimeout(e,10)}else{f.offsetY=g+d;if(Math.abs(f.offsetY)<(i-f.h)){a=true;g=f.offsetY;setTimeout(e,l)}else{delete h;f.callOnScrollDone()}delete b}delete n;f.postRedraw()}setTimeout(e,l);return};UIScrollText.prototype.startHScroll=function(){var f=this;var g=this.textWidth;if(g<=this.w){return}this.offsetX=0;this.offsetY=0;var b=0;var h=0;var c=this.getAnimationDuration();var j=this.getPauseDuration();var d=-this.w;var a=true;var i=new DecelerateInterpolator();function e(){if(a){a=false;b=(new Date()).getTime()}if(!f.isVisible()){return}var m=new Date();var l=(m.getTime()-b)/c;var n=j>0?i.get(l):l;if(l<1){f.offsetX=h+d*n;setTimeout(e,10)}else{f.offsetX=h+d;if(Math.abs(f.offsetX)<(g-f.w)){a=true;h=f.offsetX;setTimeout(e,j)}else{delete b;f.callOnScrollDone()}}delete m;f.postRedraw()}setTimeout(e,j);return};UIScrollText.prototype.startScroll=function(){if(!this.isVisible()){return}if(this.type==="ui-vscroll-text"){this.startVScroll()}else{this.startHScroll()}return};UIScrollText.prototype.onInit=function(){this.offsetX=0;this.offsetY=0;var a=this;setTimeout(function(){a.startScroll()},1000);return};UIScrollText.prototype.drawText=function(b){var a=this.offsetX?this.offsetX:0;var c=this.offsetY?this.offsetY:0;b.save();b.rect(0,0,this.w,this.h);b.clip();b.translate(a,c);if(this.type==="ui-vscroll-text"){this.drawMLText(b,false,true)}else{this.textWidth=this.draw1LText(b,true)}b.restore();return};function UIScrollTextCreator(d,a,c){var b=[d,d,null,1];ShapeCreator.apply(this,b);this.createShape=function(f){var e=new UIScrollText();return e.initUIScrollText(this.type,a,c)};return}function UIViewPager(){return}UIViewPager.prototype=new UIPageManager();UIViewPager.prototype.isUIViewPager=true;UIViewPager.prototype.initUIViewPager=function(a){this.initUIPageManager(a);this.current=0;this.setDefSize(200,200);this.setTextType(C_SHAPE_TEXT_NONE);this.widthAttr=C_WIDTH_FILL_PARENT;this.heightAttr=C_HEIGHT_FILL_PARENT;return this};UIViewPager.prototype.getFrameIndicatorParams=function(){var e=this.children.length;var d=Math.min((0.5*this.w)/e,40);var c=d*e;var b=(this.w-c)/2;var a=0.8*this.h;return{offsetX:b,offsetY:a,itemSize:d,n:e}};UIViewPager.prototype.onClick=function(g,f){if(f||this.animating){return}if(!this.needShowIndicator()){return}var b=this.getFrameIndicatorParams();var e=g.x;var d=g.y;var a=b.n;var l=b.offsetX;var j=b.offsetY;var h=b.itemSize;if(d<j||d>(j+h)||e<l||e>(l+a*h)){return}for(var c=0;c<a;c++){if(e>l&&e<(l+h)){this.setCurrent(c);break}l+=h}return};UIViewPager.prototype.drawFrameIndicator=function(b,f){var d=this.getFrameIndicatorParams();var c=d.n;var j=d.offsetX;var h=d.offsetY;var g=d.itemSize;j+=g/2;h+=g/2;var a=15;b.fillStyle=this.style.fillColor;for(var e=0;e<c;e++){b.beginPath();b.arc(j,h,a,0,Math.PI*2);j+=g;if(e===f){b.save();b.shadowColor=this.style.lineColor;b.shadowBlur=5;b.shadowOffsetX=0;b.shadowOffsetY=0;b.fill();b.stroke();b.restore()}else{b.fill()}}return};UIViewPager.prototype.needShowIndicator=function(){if(this.pageIndicator){return false}if(this.mode===C_MODE_EDITING||this.showIndicator){return true}return false};UIViewPager.prototype.afterPaintChildren=function(a){if(this.needShowIndicator()){this.drawFrameIndicator(a,this.current)}return};UIViewPager.prototype.getPrevFrame=function(){var b=this.children.length;var a=(this.current-1+b)%b;return this.children[a]};UIViewPager.prototype.getNextFrame=function(){var b=this.children.length;var a=(this.current+1)%b;return this.children[a]};UIViewPager.prototype.animScrollTo=function(b,h){var f=1000;var d=this;var a=this.offset;var e=(new Date()).getTime();var g=new DecelerateInterpolator(2);if(d.animating){return}d.animating=true;function c(){var j=new Date();var i=(j.getTime()-e)/f;var l=g.get(i);if(i<1){d.offset=a+b*l;setTimeout(c,10)}else{d.offset=0;d.setCurrent(h);delete e;delete g;delete d.animating}delete j;d.postRedraw()}c();return};UIViewPager.prototype.onPointerDownRunning=function(a,b){if(!this.velocityTracker){this.velocityTracker=new VelocityTracker()}this.velocityTracker.clear();return true};UIViewPager.prototype.onPointerMoveRunning=function(a,d){if(d||this.animating||!this.slideToChange){return}var c=Math.abs(this.getMoveAbsDeltaX());var b=Math.abs(this.getMoveAbsDeltaY());if(c>b&&c>10){this.offset=this.getMoveAbsDeltaX()}else{this.offset=0}this.addMovementForVelocityTracker();return};UIViewPager.prototype.onPointerUpRunning=function(h,g){if(g||this.animating||!this.slideToChange){return}var e=0;var f=this.offset;var d=this.current;var i=Math.abs(this.getMoveAbsDeltaY());var c=this.velocityTracker.getVelocity().x;if(Math.abs(f)<10||i>50){this.offset=0;return}var b=this.children.length;var a=f+c;if(Math.abs(a)>this.w/3){if(f>0){e=this.w-f;d=(this.current-1+b)%b}else{e=-this.w-f;d=(this.current+1)%b}}else{e=-f}this.animScrollTo(e,d);return};UIViewPager.prototype.paintChildrenAnimating=function(b){var c=this.getCurrentFrame();var e=this.getPrevFrame();var d=this.getNextFrame();b.save();b.rect(0,0,this.w,this.h);b.clip();if(this.offset>0){var a=this.w-this.offset;e.x=-a;e.paintSelf(b);a=this.offset;c.x=a;c.paintSelf(b)}else{c.x=this.offset;c.paintSelf(b);d.x=this.w+this.offset;d.paintSelf(b)}c.x=0;d.x=0;e.x=0;b.restore();return};UIViewPager.prototype.paintChildrenNormal=function(a){var b=this.getCurrentFrame();if(b){a.save();a.beginPath();b.paintSelf(a);a.restore()}return};UIViewPager.prototype.paintChildren=function(a){if(this.offset&&this.children.length>1){this.paintChildrenAnimating(a)}else{this.paintChildrenNormal(a)}return};UIViewPager.prototype.setSlideToChange=function(a){this.slideToChange=a;return};UIViewPager.prototype.setShowIndicator=function(a){this.showIndicator=a;return};UIViewPager.prototype.getCustomProp=function(){var a=' <br>		<input id="slidetochange" class="checkbox_i"  type="checkbox" >'+dappGetText("Slide To Change Frame")+'</input>		<input id="showindicator" class="checkbox_i"  type="checkbox" >'+dappGetText("Show Frame Indicator")+"</input>";return a};UIViewPager.prototype.loadCustomProp=function(b){var a=this;b.slidetochange.checked=this.slideToChange;b.slidetochange.onchange=function(c){a.setSlideToChange(this.checked);return};b.showindicator.checked=this.showIndicator;b.showindicator.onchange=function(c){a.setShowIndicator(this.checked);return};return};UIViewPager.prototype.onModeChanged=function(){this.setCurrent(0);return};function UIViewPagerCreator(){var a=["ui-view-pager","ui-view-pager",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIViewPager();return b.initUIViewPager(this.type)};return}function UIMenu(){return}UIMenu.prototype=new UIList();UIMenu.prototype.isUIMenu=true;UIMenu.prototype.initUIMenu=function(a){this.initUIList(a,5,114,null);this.setAlwaysOnTop(true);return this};UIMenu.prototype.onModeChanged=function(){if(this.mode===C_MODE_EDITING){this.setVisible(true)}else{this.setVisible(false)}return};UIMenu.prototype.show=function(c){this.showDown=true;this.fromLeft=true;this.callerElement=c;if(c){var g=this.y;var a=c.x;var e=this.getWindow().h;var b=this.getWindow().w;var f=c.getPositionInWindow();if((f.y+c.h+this.h)<e){g=f.y+c.h}else{g=f.y-this.h;this.showDown=false}if(f.x>0.6*b){this.fromLeft=false;a=(f.x+c.w-this.w)}if((a+this.w)>b){a=b-this.w;this.fromLeft=false}this.x=a;this.y=g}var d="";if(this.showDown){d=this.fromLeft?"anim-scale1-show-origin-topleft":"anim-scale1-show-origin-topright"}else{d=this.fromLeft?"anim-scale1-show-origin-bottomleft":"anim-scale1-show-origin-bottomright"}this.animShow(d);this.getWindow().grab(this);return};UIMenu.prototype.hide=function(a){if(!this.visible){return}if(a){if(this.showDown){a=this.fromLeft?"anim-scale1-hide-origin-topleft":"anim-scale1-hide-origin-topright"}else{a=this.fromLeft?"anim-scale1-hide-origin-bottomleft":"anim-scale1-hide-origin-bottomright"}this.animHide(a)}else{this.setVisible(false)}this.getWindow().ungrab(this);delete this.showDown;delete this.fromLeft;delete this.callerElement;return};UIMenu.prototype.onPointerUpRunning=function(a,b){if(!b){this.hide("default")}return};UIMenu.prototype.fixListItemImage=function(b,a){return};function UIMenuCreator(){var a=["ui-menu","ui-menu",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIMenu();return b.initUIMenu(this.type)};return}function UIContextMenu(){return}UIContextMenu.prototype=new UIElement();UIContextMenu.prototype.isUIContextMenu=true;UIContextMenu.prototype.initUIContextMenu=function(a){this.initUIElement(a);this.setMargin(5,5);this.setDefSize(300,80);this.setAlwaysOnTop(true);this.setTextType(C_SHAPE_TEXT_NONE);return this};UIContextMenu.prototype.onModeChanged=function(){if(this.mode===C_MODE_EDITING){this.setVisible(true)}else{this.setVisible(false)}return};UIContextMenu.prototype.show=function(a){this.showDown=true;this.fromLeft=true;this.callerElement=a;if(a){var e=this.y;var c=this.getWindow().h;var d=a.getPositionInWindow();if((d.y+a.h+this.h)<c){e=d.y+a.h}else{e=d.y-this.h;this.showDown=false}this.y=e}var b=this.showDown?"anim-expand-down":"anim-expand-up";this.animShow(b);this.getWindow().grab(this);return};UIContextMenu.prototype.hide=function(a){if(!this.visible){return}if(a){a=this.showDown?"anim-collapse-up":"anim-collapse-down";this.animHide(a)}else{this.setVisible(false)}this.getWindow().ungrab(this);delete this.showDown;delete this.fromLeft;delete this.callerElement;return};UIContextMenu.prototype.onPointerUpRunning=function(a,b){if(!b){this.hide("default")}return};UIContextMenu.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.fillRect(0,0,this.w,this.h)}return};UIContextMenu.prototype.afterChildAppended=function(a){a.setUserMovable(false);a.setUserResizable(false);return};UIContextMenu.prototype.shapeCanBeChild=function(a){return a.isUIButton||a.isUIImage||a.isUILabel};UIContextMenu.prototype.relayoutChildren=function(){var b=this.children.length;if(this.disableRelayout||!b){return}var d=this.getVMargin();var a=this.getHMargin();var l=a;var j=d;var m=this.getWidth(true);var e=this.getHeight(true);var f=this.w<this.h;if(f){e=Math.floor(e/b)}else{m=Math.floor(m/b)}for(var c=0;c<this.children.length;c++){var g=this.children[c];g.x=l;g.y=j;g.w=m;g.h=e;if(f){j=j+e}else{l=l+m}g.relayoutChildren()}return};function UIContextMenuCreator(){var a=["ui-context-menu","ui-context-menu",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIContextMenu();return b.initUIContextMenu(this.type)};return}function UIFanMenu(){return}UIFanMenu.prototype=new UIElement();UIFanMenu.prototype.isUIFanMenu=true;UIFanMenu.prototype.initUIFanMenu=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);return this};UIFanMenu.prototype.getOriginElement=function(){for(var b=0;b<this.children.length;b++){var a=this.children[b];if(a.name==="ui-origin"){return a}}if(this.children.length>0){return this.children[0]}return null};UIFanMenu.prototype.onModeChanged=function(){if(this.mode===C_MODE_EDITING){this.restoreState()}else{this.saveState();this.collapse()}return};UIFanMenu.prototype.restoreState=function(){if(this.save){this.x=this.save.x;this.y=this.save.y;this.w=this.save.w;this.h=this.save.h;for(var b=0;b<this.children.length;b++){var a=this.children[b];if(a.save){a.x=a.save.x;a.y=a.save.y;a.opacity=1}a.setVisible(true)}this.setVisible(true)}return};UIFanMenu.prototype.saveState=function(){var b=this.getOriginElement();if(b){this.save={};this.save.x=this.x;this.save.y=this.y;this.save.w=this.w;this.save.h=this.h;for(var c=0;c<this.children.length;c++){var a=this.children[c];a.save={};a.save.x=a.x;a.save.y=a.y;a.save.opacity=a.opacity}}return};UIFanMenu.prototype.expand=function(){this.getWindow().grab(this);if(this.save){this.x=this.save.x;this.y=this.save.y;this.w=this.save.w;this.h=this.save.h}return};UIFanMenu.prototype.collapse=function(){var b=this.getOriginElement();this.getWindow().ungrab(this);if(b){this.x=this.x+b.x;this.y=this.y+b.y;this.w=b.w;this.h=b.h;for(var c=0;c<this.children.length;c++){var a=this.children[c];a.setVisible(false)}b.x=0;b.y=0;b.setVisible(true)}this.collapsed=true;return};UIFanMenu.prototype.show=function(){};UIFanMenu.prototype.hide=function(){this.collapse();return};UIFanMenu.prototype.animShowOrHide=function(){if(this.collapsed){this.animShow()}else{this.animHide()}};UIFanMenu.prototype.animShow=function(){var b=this.getOriginElement();if(!b||!this.collapsed){return}this.expand();b.x=b.save.x;b.y=b.save.y;var c={};for(var d=0;d<this.children.length;d++){var a=this.children[d];a.setVisible(true);if(a!=b){a.x=b.x;a.y=b.y;c.xStart=b.x;c.yStart=b.y;c.xEnd=a.save.x;c.yEnd=a.save.y;c.opacityStart=0.1;c.opacityEnd=1;c.delay=0;c.duration=1000;a.animate(c)}}delete this.collapsed;return};UIFanMenu.prototype.animHide=function(){var b=this.getOriginElement();if(!b||this.collapsed){return}var c={};for(var d=0;d<this.children.length;d++){var a=this.children[d];if(a!=b){c.xStart=a.x;c.yStart=a.y;c.xEnd=b.x;c.yEnd=b.y;c.opacityStart=1;c.opacityEnd=0.1;c.delay=0;c.duration=1000;a.animate(c)}}var e=this;setTimeout(function(){e.collapse()},200);return};UIFanMenu.prototype.onPointerUpRunning=function(a,c){if(c){return}var b=this.getOriginElement();if(b!==this.targetShape){if(this.targetShape){this.hide()}else{this.animHide()}}return};UIFanMenu.prototype.beforePaintChildren=function(b){if(this.mode!==C_MODE_EDITING){return}b.save();b.rect(0,0,this.w,this.h);b.fillStyle=this.style.fillColor;b.fill();b.clip();var h=this.getOriginElement();if(h){var c=h.x+h.w/2;var a=h.y+h.w/2;b.strokeStyle="Green";b.fillStyle=this.style.lineColor;for(var e=0;e<this.children.length;e++){var g=this.children[e];if(g!=h){var l=c-(g.x+g.w/2);var j=a-(g.y+g.h/2);var f=Math.sqrt(l*l+j*j);b.beginPath();b.arc(c,a,f,0,2*Math.PI);b.stroke()}}b.fill()}b.restore();return};function UIFanMenuCreator(){var a=["ui-fan-menu","ui-fan-menu",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIFanMenu();return b.initUIFanMenu(this.type,200,200)};return}function UISlidingMenu(){return}UISlidingMenu.prototype=new UIElement();UISlidingMenu.prototype.isUISlidingMenu=true;UISlidingMenu.prototype.initUISlidingMenu=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setFreeSize(true);this.setFreePosition(true);this.setAlwaysOnTop(true);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,null);this.setCanRectSelectable(false,false);this.images.display=C_IMAGE_DISPLAY_9PATCH;this.collapsePosition="both";return this};UISlidingMenu.prototype.shapeCanBeChild=function(a){if(a.isUIDevice||a.isUIScreen||a.isUIStatusBar||a.isUIWindow){return false}return true};UISlidingMenu.prototype.onPointerUpEditing=function(a,b){if(!b){this.relayoutChildren()}return};UISlidingMenu.prototype.onScaleForDensityDone=function(a,b){return};UISlidingMenu.prototype.setCollapsePosition=function(a){this.collapsePosition=a;return};UISlidingMenu.prototype.getCollapsePosition=function(){return this.collapsePosition};UISlidingMenu.prototype.getCustomProp=function(){var a='		<label class="description" for="collapseposition">'+dappGetText("Image Position")+':</label>		<select class="element select medium" id="collapseposition" > 			<option>left</option>			<option>right</option>			<option>both</option>		</select>';return a};UISlidingMenu.prototype.loadCustomProp=function(a){var b=this;a.collapseposition.value=this.getCollapsePosition();a.collapseposition.onchange=function(c){b.setCollapsePosition(this.value);return}};UISlidingMenu.prototype.onInit=function(){this.collapsed=true;var c=this.getParent().w;var b=this.getParent().h;var a=this.x?this.x:this.getParent().w*0.8;if(a>0){this.positiveOffsetX=a;this.negetiveOffsetX=-(this.w-(c-a));this.collapseWidth=c-a}else{this.negetiveOffsetX=a;this.positiveOffsetX=c-(this.w+a);this.collapseWidth=this.w+a}this.x=a;return};UISlidingMenu.prototype.dispatchPointerDownToChildren=function(a){if(this.collapsed&&this.mode!=C_MODE_EDITING){return false}return this.defaultDispatchPointerDownToChildren(a)};UISlidingMenu.prototype.expand=function(){this.collapsed=false;if(this.x){this.animMove(0,this.y)}return};UISlidingMenu.prototype.collapseLeft=function(){this.collapsed=true;if(!this.x){this.animMove(this.negetiveOffsetX,this.y)}return};UISlidingMenu.prototype.collapseRight=function(){this.collapsed=true;if(!this.x){this.animMove(this.positiveOffsetX,this.y)}return};UISlidingMenu.prototype.autoExpandOrCollapse=function(a){if(this.x){this.expand()}else{if(a==="left"){this.collapseLeft()}else{this.collapseRight()}}return};UISlidingMenu.prototype.onClick=function(a,b){if(b||this.animating){return}if(this.mode===C_MODE_EDITING){if(!this.targetShape||a.x<30||(a.x>(this.w-30))){this.autoExpandOrCollapse()}}else{this.expand()}this.y=0;if(this.parentShape){this.w=this.parentShape.w;this.h=this.parentShape.h}return};UISlidingMenu.prototype.onPointerDownRunning=function(a,b){if(b||this.animating){return}if(!this.velocityTracker){this.velocityTracker=new VelocityTracker()}this.velocityTracker.clear();this.saveX=this.x;return true};UISlidingMenu.prototype.onPointerMoveRunning=function(a,d){if(d||this.animating){return}var c=Math.abs(this.getMoveAbsDeltaX());var b=Math.abs(this.getMoveAbsDeltaY());if(c>b&&c>10){this.x=this.x+this.getMoveDeltaX()}this.addMovementForVelocityTracker();return};UISlidingMenu.prototype.onPointerUpRunning=function(b,f){if(f||this.animating){return}var d=Math.abs(this.getMoveAbsDeltaX());var c=Math.abs(this.getMoveAbsDeltaY());var e=this.velocityTracker.getVelocity().x;if(d<10||c>50){this.x=this.saveX;return}var a=this.x;var h=this.y;var g=d+e;if(Math.abs(g)>this.w/3){if(e>0){if(this.collapsed){if(this.x<0){a=0;this.collapsed=false}else{a=this.saveX}}else{if(this.offsetX>0){a=this.offsetX}else{a=this.w-this.collapseWidth}this.collapsed=true}}else{if(this.collapsed){if(this.x>0){a=0;this.collapsed=false}else{a=this.saveX}}else{if(this.offsetX>0){a=this.getParent().w-(this.offsetX+this.w)}else{a=this.offsetX}this.collapsed=true}}}else{a=this.saveX}this.animMove(a,this.y);return};UISlidingMenu.prototype.fixOffsetX=function(){if(!this.getParent()){return}var a=this.getParent().w;if(this.offsetX>0){if((this.offsetX+40)>a){this.offsetX=Math.max(0.8*a,a-80);this.collapsed=true;this.x=this.offsetX}}if(this.offsetX<0){if(this.offsetX<-this.w){this.offsetX=Math.min(-0.8*this.w,80-this.w);this.collapsed=true;this.x=this.offsetX}}if(!this.offsetX){this.offsetX=Math.max(0.8*a,a-80);this.collapsed=true;this.x=this.offsetX}return};UISlidingMenu.prototype.paintSelfOnly=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_ALL);if(!b){a.fillRect(0,0,this.w,this.h)}if(this.mode===C_MODE_EDITING){this.fixOffsetX()}return};function UISlidingMenuCreator(){var a=["ui-sliding-menu","ui-sliding-menu",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UISlidingMenu();return b.initUISlidingMenu(this.type,200,200)};return}function UIPageIndicator(){return}UIPageIndicator.prototype=new UIElement();UIPageIndicator.prototype.isUIPageIndicator=true;UIPageIndicator.prototype.initUIPageIndicator=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,null);this.setCanRectSelectable(false,false);this.images.display=C_IMAGE_DISPLAY_9PATCH;return this};UIPageIndicator.prototype.getViewPager=function(){if(!this.getParent()){return}if(!this.viewPager){this.viewPager=this.getParent().findChildByType("ui-view-pager",true);if(!this.viewPager){this.viewPager=this.getWindow().findChildByType("ui-view-pager",true)}}if(this.viewPager){this.viewPager.setShowIndicator(false)}return this.viewPager};UIPageIndicator.prototype.getViewPagerOffset=function(){var a=this.getViewPager();return a?a.offset/a.w:0};UIPageIndicator.prototype.getPages=function(){var a=this.getViewPager();if(a){a.pageIndicator=this}return a?a.getFrames():3};UIPageIndicator.prototype.getCurrent=function(){var a=this.getViewPager();return a?a.getCurrent():0};UIPageIndicator.prototype.paintOneIndicator=function(e,c,d,a,g,b,f){e.beginPath();e.arc(a+b/2,g+f/2,10,0,2*Math.PI);e.fill();if(c){e.stroke()}return};UIPageIndicator.prototype.shapeCanBeChild=function(a){return false};UIPageIndicator.prototype.paintOneIndicatorCircle=function(e,c,d,a,i,b,f){var g=Math.floor(Math.max(10,f/4));e.fillStyle=c?this.fillColorOfCurrent:this.style.fillColor;e.strokeStyle=c?this.lineColorOfCurrent:this.style.lineColor;e.beginPath();e.arc(a+b/2,i+f/2,g,0,2*Math.PI);e.fill();e.stroke();return};UIPageIndicator.prototype.paintOneIndicatorNumber=function(e,b,g,j,i,l,f){var a=Math.floor(Math.max(10,f/4));var d=Math.floor(j+l/2);var c=Math.floor(i+f/2);e.fillStyle=b?this.fillColorOfCurrent:this.style.fillColor;e.strokeStyle=b?this.lineColorOfCurrent:this.style.lineColor;e.beginPath();e.arc(d,c,a,0,2*Math.PI);e.fill();e.stroke();e.font=a<20?"16px sans":"22px sans";e.textAlign="center";e.textBaseline="middle";e.fillStyle=this.style.textColor;e.fillText(g+1,d,c);return};UIPageIndicator.prototype.paintOneIndicatorRect=function(b,a,d,f,e,g,c){var l=10;if(g>c){l=Math.max(20,c/4)}else{l=Math.max(20,g/4)}l=Math.floor(l);b.fillStyle=a?this.fillColorOfCurrent:this.style.fillColor;b.strokeStyle=a?this.lineColorOfCurrent:this.style.lineColor;var j=(g-l)/2;var i=(c-l)/2;b.beginPath();b.rect(f+j,e+i,l,l);b.fill();b.stroke();return};UIPageIndicator.prototype.paintOneIndicatorLine=function(b,a,d,f,e,g,c){var l=4;if(g>c){l=Math.max(4,c/4)}else{l=Math.max(4,g/4)}l=Math.floor(l);b.fillStyle=a?this.fillColorOfCurrent:this.style.fillColor;b.strokeStyle=a?this.lineColorOfCurrent:this.style.lineColor;var j=(g-l)/2;var i=(c-l)/2;b.beginPath();if(g>c){b.rect(f,e+i,g,l)}else{b.rect(f+j,e,l,c)}b.fill();b.stroke();return};UIPageIndicator.prototype.onClickItem=function(b){var a=this.getViewPager();if(a){a.setCurrent(b)}return};UIPageIndicator.prototype.findItemByPoint=function(a){var e=this.getPages();if(this.w>this.h){var d=this.w/e;for(var c=0;c<e;c++){if(a.x>c*d&&a.x<(c+1)*d){return c}}}else{var b=this.h/e;for(var c=0;c<e;c++){if(a.y>c*b&&a.y<(c+1)*b){return c}}}return -1};UIPageIndicator.prototype.onClick=function(a,c){if(c){return}var b=this.findItemByPoint(a);if(b>=0){this.onClickItem(b)}return};UIPageIndicator.prototype.paintBackground=function(a){};UIPageIndicator.prototype.paintSelfOnly=function(a){var b=this.getPages();var f=this.getCurrent();var g={};g.x=this.lastPosition.x-this.x;g.y=this.lastPosition.y-this.y;this.pointerOnItem=this.findItemByPoint(g);this.paintBackground(a);if(this.w>this.h){var e=this.h;var h=this.w/b;var c=Math.floor(this.getViewPagerOffset()*h);for(var d=0;d<b;d++){var l=d*h;this.paintOneIndicator(a,d===f,d,l,0,h,e)}}else{var h=this.w;var e=this.h/b;for(var d=0;d<b;d++){var j=d*e;this.paintOneIndicator(a,d===f,d,0,j,h,e)}}delete this.pointerOnItem;return};function UIPageIndicatorCreator(){var a=["ui-page-indicator","ui-page-indicator",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageIndicator();return b.initUIPageIndicator(this.type,200,60)};return}function UIPageIndicatorSimple(){return}UIPageIndicatorSimple.prototype=new UIPageIndicator();UIPageIndicatorSimple.prototype.isUIPageIndicatorSimple=true;UIPageIndicatorSimple.prototype.initUIPageIndicatorSimple=function(c,a,b){this.initUIPageIndicator(c,a,b);this.fillColorOfCurrent="Gray";this.lineColorOfCurrent="Black";this.setAlwaysOnTop(true);return this};UIPageIndicatorSimple.prototype.setLineColorOfCurrent=function(a){this.lineColorOfCurrent=a;return};UIPageIndicatorSimple.prototype.setFillStyleOfCurrent=function(a){this.fillColorOfCurrent=a;return};UIPageIndicatorSimple.prototype.getCustomProp=function(){var a='		<label class="description" for="fillcolor">'+dappGetText("Fill Color")+':</label>		<input id="fillcolor"  class="element text"  style="width:50%;"  type="text" value=""/> 		<label class="description" for="linecolor">'+dappGetText("Line Color")+':</label>		<input id="linecolor"  class="element text"  style="width:50%;"  type="text" value=""/> 		<label class="description" for="fillcolorofcurrent">'+dappGetText("Fill Color Of Current")+':</label>		<input id="fillcolorofcurrent"  class="element text"  style="width:50%;"  type="text" value=""/> 		<label class="description" for="linecolorofcurrent">'+dappGetText("Line Color Of Current")+':</label>		<input id="linecolorofcurrent"  class="element text"  style="width:50%;"  type="text" value=""/>';return a};UIPageIndicatorSimple.prototype.loadCustomProp=function(b){var a=this;b.fillcolor.value=this.style.fillColor;b.fillcolor.onchange=function(c){a.style.setFillColor(this.value);return};b.linecolor.value=this.style.lineColor;b.linecolor.onchange=function(c){a.style.setLineColor(this.value);return};b.fillcolorofcurrent.value=this.fillColorOfCurrent;b.fillcolorofcurrent.onchange=function(c){a.setFillStyleOfCurrent(this.value);return};b.linecolorofcurrent.value=this.lineColorOfCurrent;b.linecolorofcurrent.onchange=function(c){a.setLineColorOfCurrent(this.value);return};return};function UIPageIndicatorCircleCreator(){var a=["ui-page-indicator-circle","ui-page-indicator-circle",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageIndicatorSimple();b.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorCircle;return b.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorNumberCreator(){var a=["ui-page-indicator-number","ui-page-indicator-number",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageIndicatorSimple();b.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorNumber;return b.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorRectCreator(){var a=["ui-page-indicator-rect","ui-page-indicator-rect",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageIndicatorSimple();b.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorRect;return b.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorLineCreator(){var a=["ui-page-indicator-line","ui-page-indicator-line",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageIndicatorSimple();b.paintOneIndicator=UIPageIndicator.prototype.paintOneIndicatorLine;return b.initUIPageIndicatorSimple(this.type,200,60)};return}function UIPageIndicatorNormal(){return}UIPageIndicatorNormal.prototype=new UIPageIndicator();UIPageIndicatorNormal.prototype.isUIPageIndicatorNormal=true;UIPageIndicatorNormal.prototype.initUIPageIndicatorNormal=function(c,a,b){this.initUIPageIndicator(c,a,b);this.itemTexts=[];this.itemImages=[];this.imagePosition="left";this.itemImagesOfCurrent=[];this.setMargin(5,5);this.setAlwaysOnTop(false);this.setImage(C_SHAPE_ITEM_BG_NORMAL,null);this.setImage(C_SHAPE_ITEM_BG_ACTIVE,null);this.setImage(C_SHAPE_ITEM_BG_CURRENT_NORMAL,null);this.setImage(C_SHAPE_ITEM_BG_CURRENT_ACTIVE,null);return this};UIPageIndicatorNormal.prototype.getCustomProp=function(){var a='		<label class="description" for="inputtips">'+dappGetText("Text Color Of Current Item")+':</label>		<input id="textcolorofcurrent"  class="element text small" type="text" /> 		<input id="enableanimatepage" class="checkbox_i"  type="checkbox" >'+dappGetText("Enable Animate Page")+'</input> 		<label class="description" for="imageposition">'+dappGetText("Image Position")+':</label>		<select class="element select medium" id="imageposition" > 			<option>left</option>			<option>top</option>			<option>middle</option>		</select> 		<label class="description" for="images">'+dappGetText("Images")+':</label>		<textarea id="images"  cols="60" rows="3" type="text" value=""></textarea> 		<label class="description" for="imagesofcurrent">'+dappGetText("Images Of Current")+':</label>		<textarea id="imagesofcurrent"  cols="60" rows="3" type="text" value=""></textarea> 		<label class="description" for="texts">'+dappGetText("texts")+':</label>		<textarea id="texts" cols="60" rows="3"  type="text" value=""></textarea>';return a};UIPageIndicatorNormal.prototype.loadCustomProp=function(b){var a=this;b.images.value=this.getItemImagesStr();b.images.onchange=function(c){a.setItemImagesByStr(this.value);return};b.imagesofcurrent.value=this.getItemImagesStrOfCurrent();b.imagesofcurrent.onchange=function(c){a.setItemImagesOfCurrentByStr(this.value);return};b.texts.value=this.getItemTextsStr();b.texts.onchange=function(c){a.setItemTextsByStr(this.value);return};b.imageposition.value=this.imagePosition;b.imageposition.onchange=function(c){a.setImagePosition(this.value);return};b.textcolorofcurrent.value=this.getItemTextColorOfCurrent();b.textcolorofcurrent.onchange=function(c){a.setItemTextColorOfCurrent(this.value);return};b.enableanimatepage.checked=this.enableAnimatePage;b.enableanimatepage.onchange=function(c){a.setEnableAnimatePage(this.checked);return};return};UIPageIndicatorNormal.prototype.fixImagePath=function(b,c){var e=b.version;var d=b.platform;var i=b.lcdDensity;var h=c.version;var a=c.platform;var j=c.lcdDensity;UIElement.prototype.fixImagePath.call(this,b,c);function g(l){l=l.replaceAll("/"+e+"/","/"+h+"/");l=l.replaceAll("/"+d+"/","/"+a+"/");l=l.replaceAll("/"+i+"/","/"+j+"/");return l}var f=g(this.strItemImages);this.setItemImagesByStr(f);f=g(this.strItemImagesOfCurrent);this.setItemImagesOfCurrentByStr(f);return};UIPageIndicatorNormal.prototype.setEnableAnimatePage=function(a){this.enableAnimatePage=a;return};UIPageIndicatorNormal.prototype.setItemImagesByStr=function(d){this.itemImages=[];var a=d.split("\n");for(var c=0;c<a.length;c++){var b=a[c];if(b){this.itemImages.push(new WtkImage(b))}}this.strItemImages=d;return};UIPageIndicatorNormal.prototype.setItemImagesOfCurrentByStr=function(d){this.itemImagesOfCurrent=[];var a=d.split("\n");for(var c=0;c<a.length;c++){var b=a[c];if(b){this.itemImagesOfCurrent.push(new WtkImage(b))}}this.strItemImagesOfCurrent=d;return};UIPageIndicatorNormal.prototype.setItemTextsByStr=function(a){this.strItemTexts=a;this.itemTexts=a.split("\n");return};UIPageIndicatorNormal.prototype.setImagePosition=function(a){this.imagePosition=a;return};UIPageIndicatorNormal.prototype.getItemImagesStr=function(){return this.strItemImages?this.strItemImages:""};UIPageIndicatorNormal.prototype.getItemImagesStrOfCurrent=function(){return this.strItemImagesOfCurrent?this.strItemImagesOfCurrent:""};UIPageIndicatorNormal.prototype.getItemImages=function(){if(!this.itemImages.length&&this.strItemImages){this.setItemImagesByStr(this.strItemImages)}return this.itemImages};UIPageIndicatorNormal.prototype.getItemImagesOfCurrent=function(){if(!this.itemImagesOfCurrent.length&&this.strItemImagesOfCurrent){this.setItemImagesOfCurrentByStr(this.strItemImagesOfCurrent)}return this.itemImagesOfCurrent};UIPageIndicatorNormal.prototype.getItemTextsStr=function(){return this.strItemTexts?this.strItemTexts:""};UIPageIndicatorNormal.prototype.getItemTexts=function(){if(!this.itemTexts.length&&this.strItemTexts){this.setItemTextsByStr(this.strItemTexts)}return this.itemTexts};UIPageIndicatorNormal.prototype.getItemImage=function(c,b){var a=b?this.getItemImagesOfCurrent():this.getItemImages();if(a&&c<a.length){return a[c]}return null};UIPageIndicatorNormal.prototype.getBackgroundImage=function(b,a){var c="";var d=this.pointerDown&&this.pointerOnItem===b;if(a){c=d?C_SHAPE_ITEM_BG_CURRENT_ACTIVE:C_SHAPE_ITEM_BG_CURRENT_NORMAL}else{c=d?C_SHAPE_ITEM_BG_ACTIVE:C_SHAPE_ITEM_BG_NORMAL}return this.getImageByType(c)};UIPageIndicatorNormal.prototype.paintOneIndicatorBackground=function(b,a,f,i,g,j,d){var c=this.getBackgroundImage(f,a);if(!c||!c.getImage()){return}c=c.getImage();var l=c.width;var e=c.height;this.drawImageAt(b,c,this.images.display,i,g,j,d);return};UIPageIndicatorNormal.prototype.setItemTextColorOfCurrent=function(a){this.itemTextColorOfCurrent=a;return};UIPageIndicatorNormal.prototype.getItemTextColorOfCurrent=function(){return this.itemTextColorOfCurrent?this.itemTextColorOfCurrent:"green"};UIPageIndicatorNormal.prototype.paintBackground=function(a){var b=this.getHtmlImageByType(C_SHAPE_IMAGE_NORMAL);if(!b){a.fillStyle=this.style.fillColor;a.rect(0,0,this.w,this.h);a.fill()}return};UIPageIndicatorNormal.prototype.paintOneIndicator=function(c,b,i,m,l,n,f){var e=this.getItemImage(i,b);this.paintOneIndicatorBackground(c,b,i,m,l,n,f);if(e){e=e.getImage()}var q=4;var d=this.getItemTexts();var j=d&&i<d.length?d[i]:null;var s=this.style.fontSize;if(n<60&&f<60){s=12}else{if(n>140&&f>60){s=28}else{s=20}}this.style.setFontSize(s);c.font=this.style.getFont();c.fillStyle=b?this.getItemTextColorOfCurrent():this.style.textColor;if(e){var o=e.width;var g=e.height;var a=this.hMargin;if(j){if(this.imagePosition==="left"){var r=m+a;var p=Math.floor(l+(f-g)/2);c.drawImage(e,0,0,o,g,r,p,o,g);p=Math.floor(l+f/2);r=Math.floor(m+(n-o)/2+o);c.textAlign="center";c.textBaseline="middle";c.fillText(j,r,p)}else{if(this.imagePosition==="middle"){this.drawImageAt(c,e,C_IMAGE_DISPLAY_9PATCH,m,l,n,f);var p=Math.floor(l+f/2);var r=Math.floor(m+n/2);this.style.setFontSize(s+4);c.font=this.style.getFont();c.textAlign="center";c.textBaseline="middle";c.fillText(j,r,p)}else{var r=Math.floor(m+(n-o)/2);var p=Math.floor(l+(f-g-s-q)/2);c.drawImage(e,0,0,o,g,r,p,o,g);r=Math.floor(m+n/2);p=p+g+q;c.textAlign="center";c.textBaseline="top";c.fillText(j,r,p)}}}else{var r=Math.floor(m+(n-o)/2);var p=Math.floor(l+(f-g)/2);c.drawImage(e,0,0,o,g,r,p,o,g)}}else{if(j){c.textAlign="center";c.textBaseline="middle";c.fillText(j,Math.floor(m+n/2),Math.floor(l+f/2))}}return};UIPageIndicator.prototype.onClickItem=function(b){var a=this.getViewPager();if(a){if(this.enableAnimatePage){a.switchTo(b)}else{a.setCurrent(b)}}return};function UIPageIndicatorNormalCreator(){var a=["ui-page-indicator-normal","ui-page-indicator-normal",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIPageIndicatorNormal();return b.initUIPageIndicatorNormal(this.type,200,60)};return}var C_UI_ELEMENTS="";function dappRegisterUIElements(){var a=ShapeFactoryGet();a.addShapeCreator(new UIStaticMapCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIListItemGroupCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIImageButtonCreator(120,90),C_UI_ELEMENTS);a.addShapeCreator(new UISlidingMenuCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIMenuCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIContextMenuCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageCreator(null),C_UI_ELEMENTS);a.addShapeCreator(new UIViewPagerCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageIndicatorNormalCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageIndicatorCircleCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageIndicatorNumberCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageIndicatorRectCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageIndicatorLineCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIPageManagerCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIScrollTextCreator("ui-vscroll-text",200,200),C_UI_ELEMENTS);a.addShapeCreator(new UIScrollTextCreator("ui-hscroll-text",200,50),C_UI_ELEMENTS);a.addShapeCreator(new UIImageSlideViewCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIImageAnimationCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIUIImageNormalViewCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIUIImageThumbViewTapeCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIUIImageThumbViewGridCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIGaugePointerCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIGaugeCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UILedDigitsCreator(100,100),C_UI_ELEMENTS);a.addShapeCreator(new UIVCollapsableCreator(100,100,null),C_UI_ELEMENTS);a.addShapeCreator(new UIHCollapsableCreator(100,100,null),C_UI_ELEMENTS);a.addShapeCreator(new UIVLayoutCreator(100,100,null),C_UI_ELEMENTS);a.addShapeCreator(new UIVPlaceholderCreator(100,20),C_UI_ELEMENTS);a.addShapeCreator(new UIHLayoutCreator(100,100,null),C_UI_ELEMENTS);a.addShapeCreator(new UIHPlaceholderCreator(20,100),C_UI_ELEMENTS);a.addShapeCreator(new UITipsCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIGridViewCreator(5,114,null),C_UI_ELEMENTS);a.addShapeCreator(new UIListViewCreator(5,114,null),C_UI_ELEMENTS);a.addShapeCreator(new UISimpleHTMLCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIColorTileCreator(80,80),C_UI_ELEMENTS);a.addShapeCreator(new UIColorButtonCreator(80,80),C_UI_ELEMENTS);a.addShapeCreator(new UIColorBarCreator(100,10),C_UI_ELEMENTS);a.addShapeCreator(new UISelectCreator("ui-select",300,50),C_UI_ELEMENTS);a.addShapeCreator(new UIStatusBarCreator("ui-status-bar",640,40,null),C_UI_ELEMENTS);a.addShapeCreator(new UIStatusBarCreator("ui-menu-bar",640,96,null),C_UI_ELEMENTS);a.addShapeCreator(new UIGroupCreator(200,200,null),C_UI_ELEMENTS);a.addShapeCreator(new UIListCheckBoxItemCreator(null,null,null,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIListRadioBoxItemCreator(null,null,null,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UISystemMenuCreator(600,400,null),C_UI_ELEMENTS);a.addShapeCreator(new UISwitchCreator(154,54,154,null),C_UI_ELEMENTS);a.addShapeCreator(new UIVScrollViewCreator(0,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIHScrollViewCreator(0,null),C_UI_ELEMENTS);a.addShapeCreator(new UIDeviceCreator("android","",420,700),C_UI_ELEMENTS);a.addShapeCreator(new UIScreenCreator(640,960),C_UI_ELEMENTS);a.addShapeCreator(new UIListItemCreator(null,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIGridItemCreator(null,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIToolBarCreator("ui-toolbar",true,85,null),C_UI_ELEMENTS);a.addShapeCreator(new UIPopupMenuCreator(600,400,null),C_UI_ELEMENTS);a.addShapeCreator(new UIDialogCreator(600,400,null),C_UI_ELEMENTS);a.addShapeCreator(new UINormalWindowCreator(null),C_UI_ELEMENTS);a.addShapeCreator(new UITabCreator("ui-tab-top",0,true,100,null),C_UI_ELEMENTS);a.addShapeCreator(new UITabCreator("ui-tab-bottom",0,false,100,null),C_UI_ELEMENTS);a.addShapeCreator(new UIWindowManagerCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UITabButtonCreator(120,60,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIListCreator(5,114,null),C_UI_ELEMENTS);a.addShapeCreator(new UIGridCreator(5,150,null),C_UI_ELEMENTS);a.addShapeCreator(new UIButtonGroupCreator(5,200,null),C_UI_ELEMENTS);a.addShapeCreator(new UIProgressBarCreator(200,45,false,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIProgressBarCreator(200,45,true,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UILabelCreator(),C_UI_ELEMENTS);a.addShapeCreator(new UIEditCreator(120,50,12,12,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIMLEditCreator(300,300,12,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIImageCreator("ui-icon",32,32,null),C_UI_ELEMENTS);a.addShapeCreator(new UIImageCreator("ui-image",200,200,null),C_UI_ELEMENTS);a.addShapeCreator(new UIWaitBarCreator("ui-wait-box",60,60,null,C_IMAGE_DISPLAY_CENTER),C_UI_ELEMENTS);a.addShapeCreator(new UIWaitBarCreator("ui-wait-bar",200,24,null,C_IMAGE_DISPLAY_SCALE),C_UI_ELEMENTS);a.addShapeCreator(new UIButtonCreator(120,60),C_UI_ELEMENTS);a.addShapeCreator(new UICheckBoxCreator(160,60,null,null,null,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UIRadioBoxCreator(50,50,null,null,null,null,null,null),C_UI_ELEMENTS);a.addShapeCreator(new UICanvasCreator(200,200),C_UI_ELEMENTS);return}VelocityTracker.prototype.HISTORY_SIZE=20;VelocityTracker.prototype.HORIZON=200*1000000;VelocityTracker.prototype.MIN_DURATION=10*1000000;function Movement(){this.eventTime=0;this.point=new Point(0,0);this.getPoint=function(){return this.point};return this}function VelocityTracker(){this.clear();return this}VelocityTracker.prototype.clear=function(){this.index=0;var b=this.HISTORY_SIZE;if(!this.movements){this.movements=new Array();for(var c=0;c<b;c++){this.movements.push(new Movement())}}for(var c=0;c<b;c++){var a=this.movements[c];a.eventTime=0;a.point={x:0,y:0}}return};VelocityTracker.prototype.addMovement=function(b,a){if(++this.index==this.HISTORY_SIZE){this.index=0}this.movements[this.index].eventTime=b;this.movements[this.index].point=a;return};VelocityTracker.prototype.getVelocity=function(){var a={x:0,y:0};this.estimate();a.x=this.xVelocity;a.y=this.yVelocity;return a};VelocityTracker.prototype.estimate=function(){var u=this.HORIZON;var i=this.MIN_DURATION;var p=this.HISTORY_SIZE;var b=this.movements[this.index];var q=b.eventTime-u;var t=this.index;var r=1;do{var s=(t==0?p:t)-1;var c=this.movements[s];if(c.eventTime<q){break}t=s}while(++r<p);var f=0;var e=0;var d=t;var g=0;var j=this.movements[t];var h=j.getPoint();var n=0;while(r-->1){if(++d==p){d=0}var o=this.movements[d];var a=o.eventTime-j.eventTime;if(a>=i){var w=o.getPoint();var v=1000000000/a;var m=(w.x-h.x)*v;var l=(w.y-h.y)*v;f=(f*n+m*a)/(a+n);e=(e*n+l*a)/(a+n);n=a;g+=1}}if(g){this.xVelocity=f;this.yVelocity=e}else{this.xVelocity=0;this.yVelocity=0}return true};function testVelocityTracker(){var a=null;var d=new VelocityTracker();function c(e){return e*1000000}for(var b=0;b<20;b++){d.addMovement(c(10*b),{x:10*b,y:10*b*b/2})}a=d.getVelocity();console.log("xv: "+a.x+" yv: "+a.y);return}function Interpolator(){this.get=function(a){return 0};return this}function LinearInterpolator(){this.get=function(a){return a};return this}function BounceInterpolator(){function a(b){return 8*b*b}this.get=function(b){b*=1.1226;if(b<0.3535){return a(b)}else{if(b<0.7408){return a(b-0.54719)+0.7}else{if(b<0.9644){return a(b-0.8526)+0.9}else{return a(b-1.0435)+0.95}}}};return this}function AccelerateInterpolator(){this.get=function(a){return a*a};return this}function AccDecelerateInterpolator(){this.get=function(a){return((Math.cos((a+1)*Math.PI)/2)+0.5)};return this}function DecelerateInterpolator(a){this.factor=a?a:2;this.get=function(b){if(this.factor===1){return(1-(1-b)*(1-b))}else{return(1-Math.pow((1-b),2*this.factor))}};return this}function AnimationFactory(){this.animations=[];this.createAnimation=function(b){var c=this.animations[b];if(c){return c}var a=isIPhone()?2:3;switch(b){case"anim-forward":var d=new DecelerateInterpolator();c=isAndroid()?new AnimationHTranslateAndroid(true):new AnimationHTranslate(true);c.toLeft();c.init(200*a,d);break;case"anim-backward":var d=new DecelerateInterpolator();c=isAndroid()?new AnimationHTranslateAndroid(true):new AnimationHTranslate(false);c.toRight();c.init(200*a,d);break;case"anim-scale-show-win":var d=new DecelerateInterpolator(1);if(isMobile()){c=new AnimationBrowserScaleWin(true);c.setRange(1.2,1)}else{c=new AnimationScale(true);c.setRange(0.9,1)}c.init(600,d);break;case"anim-scale-hide-win":var d=new AccelerateInterpolator();if(isMobile()){c=new AnimationBrowserScaleWin(false);c.setRange(0.9,1)}else{c=new AnimationScale(false);c.setRange(1,0.9)}c.init(400,d);break;case"anim-scale-show-dialog":var d=new DecelerateInterpolator();c=isAndroid()?new AnimationBrowserScaleDialog(true):new AnimationScale(true);c.setRange(0.9,1);c.init(300,d);break;case"anim-scale-hide-dialog":var d=new AccelerateInterpolator();c=isAndroid()?new AnimationBrowserScaleDialog(false):new AnimationScale(false);c.setRange(1,0.9);c.init(300,d);break;case"anim-fade-in":var d=new AccelerateInterpolator();c=isAndroid()?new AnimationBrowserAlpha(true):new AnimationAlpha(true);c.setRange(0.6,1);c.init(500,d);break;case"anim-fade-out":var d=new AccelerateInterpolator();c=isAndroid()?new AnimationBrowserAlpha(false):new AnimationAlpha(false);c.setRange(1,0.8);c.init(300,d);break;case"anim-move-up":var d=new DecelerateInterpolator();c=isMobile()?new AnimationBrowserMove(true):new AnimationMove(true);c.init(600,d);break;case"anim-move-down":var d=new AccelerateInterpolator();c=isMobile()?new AnimationBrowserMove(false):new AnimationMove(false);c.init(600,d);break;case"anim-expand-up":case"anim-expand-left":case"anim-expand-right":case"anim-expand-down":var d=new DecelerateInterpolator();c=new Animation1Expand(true);c.init(400,d);break;case"anim-collapse-up":case"anim-collapse-left":case"anim-collapse-right":case"anim-collapse-down":var d=new AccelerateInterpolator();c=new Animation1Expand(true);c.init(400,d);break;case"anim-scale1-show-origin-topleft":case"anim-scale1-show-origin-bottomleft":case"anim-scale1-show-origin-topright":case"anim-scale1-show-origin-bottomright":case"anim-scale1-show":var d=new DecelerateInterpolator();c=new Animation1Scale(true);c.init(400,d);break;case"anim-scale1-hide-origin-topleft":case"anim-scale1-hide-origin-bottomleft":case"anim-scale1-hide-origin-topright":case"anim-scale1-hide-origin-bottomright":case"anim-scale1-hide":var d=new AccelerateInterpolator();c=new Animation1Scale(false);c.init(400,d);break;case"anim-alpha1-show":var d=new DecelerateInterpolator();c=new Animation1Alpha(true);c.init(400,d);break;case"anim-alpha1-hide":var d=new AccelerateInterpolator();c=new Animation1Alpha(false);c.init(400,d);break}this.animations[b]=c;return c};return this}var gAnimationFactory=null;function AnimationFactoryGet(){if(!gAnimationFactory){gAnimationFactory=new AnimationFactory()}return gAnimationFactory}function animationCreate(a){return AnimationFactoryGet().createAnimation(a)}var gAnimationOldWinCanvas=null;function AnimationOldWinCanvasGet(){if(!gAnimationOldWinCanvas){gAnimationOldWinCanvas=document.createElement("canvas");gAnimationOldWinCanvas.type="animation_canvas"}gAnimationOldWinCanvas.style.opacity=1;gAnimationOldWinCanvas.style.zIndex=9;return gAnimationOldWinCanvas}function AnimationCanvasGet(){var a=AnimationOldWinCanvasGet();return a}var gAnimationNewWinCanvas=null;function AnimationNewWinCanvasGet(){if(!gAnimationNewWinCanvas){gAnimationNewWinCanvas=document.createElement("canvas");gAnimationNewWinCanvas.type="animation_canvas"}gAnimationNewWinCanvas.style.opacity=1;gAnimationNewWinCanvas.style.zIndex=9;return gAnimationNewWinCanvas}var gBackendCanvas=null;function BackendCanvasGet(b,a){if(!gBackendCanvas){gBackendCanvas=document.createElement("canvas");gBackendCanvas.type="backend_canvas";gBackendCanvas.width=b;gBackendCanvas.height=a}if(gBackendCanvas){if(gBackendCanvas.width!=b){gBackendCanvas.width=b}if(gBackendCanvas.height!=a){gBackendCanvas.height=a}}return gBackendCanvas}function Animation(a){this.scale=1;this.visible=false;this.showWin=a;this.init=function(b,c){this.duration=b?b:500;this.interpolator=c;return};this.setRectOfFront=function(b,e,c,d){this.frontX=b;this.frontY=e;this.frontW=c;this.frontH=d;return};this.setScale=function(b){this.scale=b;return};this.prepare=function(b,g,c,e,d,f){this.x=Math.round(b);this.y=Math.round(g);this.w=Math.round(c);this.h=Math.round(e);this.onFinish=f;this.canvasImage=d;this.setRectOfFront(0,0,c,e);if(d){this.sw=d.width;this.sh=d.height}this.show();return true};this.moveResizeCanvas=function(d,b,f,c,e){d.style.position="absolute";d.width=c;d.height=e;d.style.left=b+"px";d.style.top=f+"px";d.style.width=c+"px";d.style.height=e+"px";d.style.visibility="visible";return};this.show=function(){var b=this.w*this.scale;var c=this.h*this.scale;this.visible=true;this.canvasElement=AnimationCanvasGet();this.moveResizeCanvas(this.canvasElement,this.x,this.y,b,c);document.body.appendChild(this.canvasElement);return true};this.hide=function(){this.visible=false;if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.getTimePercent=function(){var c=new Date();var b=c.getTime()-this.startTime;return b/this.duration};this.getPercent=function(b){return this.interpolator.get(b)};this.step=function(b){return true};this.beforeRun=function(){return true};this.afterRun=function(){return true};this.drawBackground=function(d){if(this.isFirstStep){this.canvas.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h)}else{var b=this.frontX;var f=this.frontY;var c=this.frontW;var e=this.frontH;this.canvas.drawImage(this.canvasImage,b,f,c,e,b,f,c,e)}return};this.doStep=function(b){this.canvas.save();this.canvas.scale(this.scale,this.scale);this.step(b);this.canvas.restore();return};this.run=function(){var e=0;var b=0;var d=new Date();var f=this;this.startTime=d.getTime();f.isFirstStep=true;this.beforeRun();function c(){if(b<1){f.doStep(e);b=f.getTimePercent();e=f.getPercent(b);requestAnimFrame(c)}else{f.cleanup();f.afterRun();console.log("Animation done.")}f.isFirstStep=false}c();return};this.cleanup=function(){var c=this;var b=this.onFinish;setTimeout(function(){c.hide()},100);if(b){b()}};this.hide();return this}function setElementPosition(b,a,c){b.style.position="absolute";b.style.left=Math.round(a)+"px";b.style.top=Math.round(c)+"px";b.style.opacity=1;return}function moveElement(b,a,c){setElementPosition(b,a,c);return}function alphaElement(b,a){b.style.opacity=a;return}function showElement(a){a.style.opacity=1}function hideElement(a){a.style.opacity=0}function scaleElement(c,b,e,a,g){var h=(a&&g)?a+" "+g:"50% 50%";var f=["transform","-ms-transform","-webkit-transform","-o-transform","-moz-transform"];c.style["transform-style"]="preserve-3d";for(var d=0;d<f.length;d++){var j=f[d];c.style[j+"-origin"]=h;c.style[j]="scale("+b+")"}c.style.opacity=e;return}function AnimationHTranslateAndroid(){Animation.apply(this,arguments);this.leftToRight=true;this.show=function(){document.body.appendChild(gBackendCanvas);gBackendCanvas.style.zIndex=9;this.canvasElement=gBackendCanvas;setElementPosition(gBackendCanvas,this.x,this.y);return true};this.hide=function(){if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.doStep=function(a){this.step(a);return};this.beforeRun=function(){var a=this.sw-this.w;this.range=a*0.7;this.start=a-this.range;return};this.toLeft=function(){this.leftToRight=true;return};this.toRight=function(){this.leftToRight=false;return};this.step=function(b){var a=0;if(this.leftToRight){a=this.start+this.range*b}else{a=this.w-this.range*b-this.start}moveElement(gBackendCanvas,-a+this.x,this.y);return true}}function AnimationHTranslate(){Animation.apply(this,arguments);this.leftToRight=true;this.beforeRun=function(){var a=this.sw-this.w;if(isMobile()){this.range=a*0.8}else{this.range=a}this.start=a-this.range;this.canvas=this.canvasElement.getContext("2d")};this.toLeft=function(){this.leftToRight=true;return};this.toRight=function(){this.leftToRight=false;return};this.step=function(b){var a=0;if(this.leftToRight){a=this.start+this.range*b}else{a=this.w-this.range*b-this.start}if(this.lastOffset===a){return true}this.canvas.drawImage(this.canvasImage,a,0,this.w,this.h,0,0,this.w,this.h);this.lastOffset=a;return true}}function AnimationScale(){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(b,a){this.to=a;this.from=b;return};this.beforeRun=function(){this.canvas=this.canvasElement.getContext("2d")};this.step=function(c){var e=this.from+c*(this.to-this.from);var d=this.to>this.from?c:(1-c);if(this.canvasImage){var b=this.canvas;var a=this.frontX+0.5*this.frontW;var f=this.frontY+0.5*this.frontH;this.drawBackground(b);b.save();b.translate(a,f);b.globalAlpha=d;b.scale(e,e);b.translate(-0.5*this.frontW,-0.5*this.frontH);b.drawImage(this.canvasImage,this.frontX+this.w,this.frontY,this.frontW,this.frontH,0,0,this.frontW,this.frontH);b.restore()}return true}}function AnimationAlpha(){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(b,a){this.to=a;this.from=b;return};this.beforeRun=function(){this.canvas=this.canvasElement.getContext("2d")};this.step=function(b){var c=this.from+b*(this.to-this.from);if(this.canvasImage){var a=this.canvas;a.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h);a.save();a.globalAlpha=c;a.drawImage(this.canvasImage,this.frontX+this.w,this.frontY,this.frontW,this.frontH,this.frontX,this.frontY,this.frontW,this.frontH);a.restore()}return true}}function AnimationMove(a){Animation.apply(this,arguments);this.beforeRun=function(){this.range=this.frontH;this.canvas=this.canvasElement.getContext("2d");return true};this.step=function(g){this.drawBackground(this.canvas);var b=this.frontX;var i=this.frontY;var e=this.frontW;var d=this.range*g;var f=this.showWin?d:(this.range-d);var c=this.showWin?(this.frontY+this.range-d):(this.frontY+d);if(f>0){this.canvas.drawImage(this.canvasImage,b+this.w,i,e,f,b,c,e,f)}return true}}function AnimationBrowser(a){Animation.apply(this,arguments);this.to=1;this.from=0;this.frontX=0;this.frontY=0;this.frontW=0;this.frontH=0;this.setRange=function(c,b){this.to=b;this.from=c;return};this.onShowCanvas=function(){setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.y);showElement(this.oldWinCanvas);showElement(this.newWinCanvas);return};this.showCanvas=function(i,g){var d=this.w;var f=this.h;var b=AnimationOldWinCanvasGet();var j=AnimationNewWinCanvasGet();this.moveResizeCanvas(b,this.x,this.y,d,f);this.moveResizeCanvas(j,this.x,this.y,d,f);b.style.zIndex=i;j.style.zIndex=g;var c=b.getContext("2d");var e=j.getContext("2d");if(this.showWin){c.drawImage(gBackendCanvas,0,0,d,f,0,0,d,f);e.drawImage(gBackendCanvas,this.w,0,d,f,0,0,d,f)}else{e.drawImage(gBackendCanvas,0,0,d,f,0,0,d,f);c.drawImage(gBackendCanvas,this.w,0,d,f,0,0,d,f)}this.oldWinCanvas=b;this.newWinCanvas=j;this.onShowCanvas();if(i>g){document.body.appendChild(j);document.body.appendChild(b)}else{document.body.appendChild(j);document.body.appendChild(b)}return true};this.show=function(){this.showCanvas(8,9);return true};this.hide=function(){if(this.oldWinCanvas&&this.newWinCanvas){if(this.showWin){document.body.removeChild(this.oldWinCanvas);document.body.removeChild(this.newWinCanvas)}else{document.body.removeChild(this.oldWinCanvas);document.body.removeChild(this.newWinCanvas)}this.newWinCanvas=null;this.oldWinCanvas=null}return true};this.afterRun=function(){};this.doStep=function(b){this.step(b);return};this.step=function(b){var d=this.from+b*(this.to-this.from);var c=b;scaleElement(this.newWinCanvas,d,c);return true}}function AnimationBrowserScaleWin(a){AnimationBrowser.apply(this,arguments);this.onShowCanvas=function(){setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.y);showElement(this.oldWinCanvas);hideElement(this.newWinCanvas);return};this.step=function(b){var c=b;var d=this.from+b*(this.to-this.from);scaleElement(this.newWinCanvas,d,c);return true}}function AnimationBrowserScaleDialog(a){AnimationBrowser.apply(this,arguments);this.show=function(){if(this.showWin){this.showCanvas(8,9)}else{this.showCanvas(9,8)}return true};this.step=function(b){var d=this.from+b*(this.to-this.from);var c=this.showWin?b:1-b;if(this.showWin){scaleElement(this.newWinCanvas,d,c)}else{scaleElement(this.oldWinCanvas,d,c)}return true}}function AnimationBrowserAlpha(a){AnimationBrowser.apply(this,arguments);this.show=function(){if(this.showWin){this.showCanvas(8,9)}else{this.showCanvas(9,8)}};this.step=function(b){var c=this.from+b*(this.to-this.from);if(this.showWin){alphaElement(this.newWinCanvas,c)}else{alphaElement(this.oldWinCanvas,c)}return true}}function AnimationBrowserMove(a){AnimationBrowser.apply(this,arguments);this.onShowCanvas=function(){if(this.showWin){setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.frontH)}else{setElementPosition(this.oldWinCanvas,this.x,this.y);setElementPosition(this.newWinCanvas,this.x,this.y)}showElement(this.oldWinCanvas);showElement(this.newWinCanvas);return};this.show=function(){if(this.showWin){this.showCanvas(8,9)}else{this.showCanvas(9,8)}return};this.step=function(d){var c=0;this.range=this.frontH;var b=this.range*d;if(this.showWin){c=this.range-b;moveElement(this.newWinCanvas,0,c)}else{c=b;moveElement(this.oldWinCanvas,0,c)}return true}}var C_DIR_UP=1;var C_DIR_DOWN=2;var C_DIR_LEFT=3;var C_DIR_RIGHT=4;var C_ACTION_EXPAND=1;var C_ACTION_COLLAPSE=2;function Animation1Expand(){Animation.apply(this,arguments);this.prepare=function(a,f,b,d,c,e){this.x=Math.round(a);this.y=Math.round(f);this.w=Math.round(b);this.h=Math.round(d);this.onFinish=e;this.canvasImage=c;this.xto=this.xfrom=0;this.yto=this.yfrom=0;this.wto=this.wfrom=b;this.hto=this.hfrom=d;this.show();return};this.expandV=function(a){this.direction=a?C_DIR_UP:C_DIR_DOWN;this.action=C_ACTION_EXPAND;this.yfrom=this.h;this.yto=0;this.hfrom=0;this.hto=this.h;return};this.expandH=function(a){this.direction=a?C_DIR_LEFT:C_DIR_RIGHT;this.action=C_ACTION_EXPAND;this.xfrom=this.w;this.xto=0;this.wfrom=0;this.wto=this.w;return};this.collapseV=function(a){this.direction=a?C_DIR_UP:C_DIR_DOWN;this.action=C_ACTION_COLLAPSE;this.yfrom=0;this.yto=this.h;this.hfrom=this.h;this.hto=0;return};this.collapseH=function(a){this.direction=a?C_DIR_LEFT:C_DIR_RIGHT;this.action=C_ACTION_COLLAPSE;this.xfrom=0;this.xto=this.w;this.wfrom=this.w;this.wto=0;return};this.expandUp=function(){return this.expandV(true)};this.expandDown=function(){return this.expandV(false)};this.expandLeft=function(){return this.expandH(true)};this.expandRight=function(){return this.expandH(false)};this.collapseUp=function(){return this.collapseV(true)};this.collapseDown=function(){return this.collapseV(false)};this.collapseLeft=function(){return this.collapseH(true)};this.collapseRight=function(){return this.collapseH(false)};this.show=function(){this.canvasElement=AnimationCanvasGet();this.moveResizeCanvas(this.canvasElement,this.x,this.y,this.w,this.h);this.canvas=this.canvasElement.getContext("2d");document.body.appendChild(this.canvasElement);this.canvasElement.style.zIndex=9;setElementPosition(this.canvasElement,this.x,this.y);showElement(this.canvasElement);return true};this.hide=function(){this.visible=false;if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.step=function(c){var a=this.canvas;var g=this.xfrom+((this.xto-this.xfrom)*c);var e=this.yfrom+((this.yto-this.yfrom)*c);var i=this.wfrom+(this.wto-this.wfrom)*c;var b=this.hfrom+(this.hto-this.hfrom)*c;if(!i||!b){return}a.clearRect(0,0,this.w,this.h);var l=g;var j=e;var f=g;var d=e;if(this.action===C_ACTION_EXPAND){switch(this.direction){case C_DIR_UP:d=0;break;case C_DIR_DOWN:j=0;break;case C_DIR_LEFT:f=0;break;case C_DIR_RIGHT:l=0;break}}else{switch(this.direction){case C_DIR_UP:j=0;break;case C_DIR_DOWN:d=0;break;case C_DIR_LEFT:l=0;break;case C_DIR_RIGHT:f=0;break}}console.log("y:"+e+" h:"+b);a.drawImage(this.canvasImage,f,d,i,b,l,j,i,b);return true}}function Animation1Alpha(){Animation.apply(this,arguments);this.prepare=function(a,f,b,d,c,e){this.x=Math.round(a);this.y=Math.round(f);this.w=Math.round(b);this.h=Math.round(d);this.onFinish=e;this.canvasImage=c;this.show();return};this.setRange=function(b,a){this.from=b;this.to=a;return};this.show=function(){this.canvasElement=AnimationCanvasGet();this.moveResizeCanvas(this.canvasElement,this.x,this.y,this.w,this.h);this.canvas=this.canvasElement.getContext("2d");document.body.appendChild(this.canvasElement);this.canvasElement.style.zIndex=9;setElementPosition(this.canvasElement,this.x,this.y);showElement(this.canvasElement);this.canvas.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h);return true};this.hide=function(){this.visible=false;if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.step=function(c){var b=this.canvas;var a=this.from+(this.to-this.from)*c;alphaElement(this.canvasElement,a);console.log("opacity:"+a);return true}}function Animation1Scale(){Animation.apply(this,arguments);this.prepare=function(a,f,b,d,c,e){this.x=Math.round(a);this.y=Math.round(f);this.w=Math.round(b);this.h=Math.round(d);this.xOrigin="50%";this.yOrigin="50%";this.onFinish=e;this.canvasImage=c;this.show();return};this.setOrigin=function(b,a){this.xOrigin=b;this.yOrigin=a;return};this.setRange=function(b,a){this.from=b;this.to=a;return};this.show=function(){this.canvasElement=AnimationCanvasGet();this.moveResizeCanvas(this.canvasElement,this.x,this.y,this.w,this.h);this.canvas=this.canvasElement.getContext("2d");document.body.appendChild(this.canvasElement);this.canvasElement.style.zIndex=9;setElementPosition(this.canvasElement,this.x,this.y);showElement(this.canvasElement);this.canvas.drawImage(this.canvasImage,0,0,this.w,this.h,0,0,this.w,this.h);return true};this.hide=function(){this.visible=false;if(this.canvasElement){document.body.removeChild(this.canvasElement);this.canvasElement=null}return true};this.step=function(b){var a=this.canvas;var d=this.from+(this.to-this.from)*b;var c=this.showWin?b:1-b;scaleElement(this.canvasElement,d,c,this.xOrigin,this.yOrigin);return true}}function animateUIElement(i,g){var c=false;var d=i.getRealScale();var a=i.getPositionInView();var o=i.view.getAbsPosition();var m=Math.round(a.x*d)+o.x;var j=Math.round(a.y*d)+o.y;var n=Math.round(i.w*d);var f=Math.round(i.h*d);var l=BackendCanvasGet(n,f);var b=l.getContext("2d");b.save();c=i.visible;i.visible=true;b.scale(d,d);b.translate(-i.x,-i.y);i.paint(b);i.visible=c;b.restore();var e=animationCreate(g);e.prepare(m,j,n,f,l,function(){i.setVisible(!c);i.postRedraw()});if(c){i.setVisible(!c);i.postRedraw()}switch(g){case"anim-expand-up":e.expandUp();break;case"anim-expand-left":e.expandLeft();break;case"anim-expand-right":e.expandRight();break;case"anim-expand-down":e.expandDown();break;case"anim-collapse-up":e.collapseUp();break;case"anim-collapse-left":e.collapseLeft();break;case"anim-collapse-right":e.collapseRight();break;case"anim-collapse-down":e.collapseDown();break;case"anim-scale1-show-origin-topleft":e.setOrigin("0%","0%");e.setRange(0.5,1);break;case"anim-scale1-show-origin-bottomleft":e.setOrigin("0%","100%");e.setRange(0.5,1);break;case"anim-scale1-show-origin-topright":e.setOrigin("100%","0%");e.setRange(0.5,1);break;case"anim-scale1-show-origin-bottomright":e.setOrigin("100%","100%");e.setRange(0.5,1);break;case"anim-scale1-show":e.setRange(0.5,1);break;case"anim-scale1-hide-origin-topleft":e.setOrigin("0%","0%");e.setRange(1,0.5);break;case"anim-scale1-hide-origin-bottomleft":e.setOrigin("0%","100%");e.setRange(1,0.5);break;case"anim-scale1-hide-origin-topright":e.setOrigin("100%","0%");e.setRange(1,0.5);break;case"anim-scale1-hide-origin-bottomright":e.setOrigin("100%","100%");e.setRange(1,0.5);break;case"anim-scale1-hide":e.setRange(1,0.5);break;case"anim-alpha1-show":e.setRange(0.2,1);break;case"anim-alpha1-hide":e.setRange(1,0.2);break}e.run();return}function testAnimation1Expand(a){var b=a.getWindow().findChildByName("ui-button-test",true);b.setVisible(false);b.postRedraw();setTimeout(function(){animateUIElement(b,"anim-alpha1-show")},100);setTimeout(function(){animateUIElement(b,"anim-alpha1-hide")},3000);return}function DummyFileSystem(){this.data=[{name:"Docs",type:"folder",items:[{name:"test.txt",type:"file",content:"hello world",mtime:0,size:10}]},{name:"Images",type:"folder"},{name:"test.txt",type:"file",content:"hello world",mtime:0,size:10},{name:"good1.txt",type:"file",content:"hello world",mtime:0,size:100201},{name:"good2.txt",type:"file",content:"hello world",mtime:0,size:10},{name:"good3.txt",type:"file",content:"hello world",mtime:0,size:10},{name:"good4.txt",type:"file",content:"hello world",mtime:0,size:10},{name:"good5.txt",type:"file",content:"hello world",mtime:0,size:10},{name:"good6.txt",type:"file",content:"hello world",mtime:0,size:10},{name:"good7.txt",type:"file",content:"hello world",mtime:0,size:10},{name:"good8.txt",type:"file",content:"hello world",mtime:0,size:10},{name:"good.jpg",type:"file",content:"hello world",mtime:0,size:10},{name:"good.png",type:"file",content:"hello world",mtime:0,size:10},{name:".good.pdf",type:"file",content:"hello world",mtime:0,size:10},{name:"good1.pdf",type:"file",content:"hello world",mtime:0,size:10},{name:"good2.pdf",type:"file",content:"hello world",mtime:0,size:10}];this.list=function(b,a){if(!b){b="/"}if(b==="/"){a(this.data)}else{if(b==="/Docs/"){a(this.data[0].items)}else{a(this.data[1].items)}}return};this.read=function(a,c){var b=this[a];b=b?b:"hello world";c(a,b);return};this.save=function(a,b,c){this[a]=b;c(true,a);return}}function DeviceLocalFileSystem(){this.rootEntry=null;this.fileSystem=null;this.init=function(){var b=this;function c(d){console.log("gotFS");b.fileSystem=d;b.rootEntry=d.root;return}function a(d){console.log("requestFileSystem failed: "+d);return}console.log("init");window.requestFileSystem(1,0,c,a)};this.list=function(c,b){var a=function(g){function h(j){var m=[];for(var n=0;n<j.length;n++){var o={};var l=j[n];if(l.name.indexOf(".")===0){continue}o.size=0;o.mtime=0;o.name=l.name;o.type=l.isDirectory?"folder":"file";l.getMetadata(function(i){o.mtime=i.modificationTime},function(i){});m.push(o)}b(m);console.log("onReadEntriesOK")}function f(i){b(null)}var e=g.createReader();e.readEntries(h,f);console.log("onGetDirectoryOK");return};function d(e){console.log("error getting dir:"+c)}console.log("list");this.fileSystem.root.getDirectory(c,{create:true,exclusive:false},a,d);return};this.read=function(b,e){function a(g){var f=new FileReader();f.onloadend=function(h){e(b,h.target.result)};f.readAsText(g);return}function c(f){console.log("getFile Failed: "+b)}function d(f){f.file(a,c);return}this.fileSystem.root.getFile(b,{create:false,exclusive:false},d,c);return};this.save=function(b,c,f){function e(g){g.onwrite=function(h){console.log("write success");f(true,b)};g.truncate(0);g.write(c);return}function a(g){alert(dappGetText("Write File Failed: "+b));console.log("getFile Failed: "+b+" code:"+g.code)}function d(g){g.createWriter(e,a);return}this.fileSystem.root.getFile(b,{create:true,exclusive:false},d,a);return};this.init();return}function FileBrowser(){this.cwd="/";this.cacheEntries={};if(window.requestFileSystem){this.fs=new DeviceLocalFileSystem()}else{this.fs=new DummyFileSystem()}console.log("window.requestFileSystem: "+window.requestFileSystem);this.initForSave=function(b,c,d,e,a){this.content=d;this.cwd=b?b:"/";this.initFileName=c;this.onDone=e;if(a){this.fs=a}this.cacheEntries={};return};this.initForOpen=function(b,c,a){this.cwd=b?b:"/";this.onContent=c;if(a){this.fs=a}this.cacheEntries={};return};this.filteItemByExtNames=function(a){function b(e){for(var c=0;c<a.length;c++){var d=a[c];if(e.name.indexOf(d)>0){return true}}return false}if(a){this.setItemFilter(b)}else{this.setItemFilter(null)}};this.setItemFilter=function(a){this.filter=a;return};this.getSizeStr=function(c){var d="";var b="";var a=c.size;if(c.type==="file"){if(a>1024*1024){a=a/(1024*1024);b=a+"";b=b.substr(0,4);b=b+"MB"}else{if(a>1024){a=a>>10;b=a+"";b=b.substr(0,4);b=b+"KB"}else{b=a+"Bytes"}}d=b}else{if(c.items){b=c.items.length+" Items"}else{b=0+" Items"}d=b}return d};this.getDateInfo=function(c){var a="";var b=c.mtime?new Date(c.mtime):new Date();a=b.getFullYear()+"-"+b.getMonth()+"-"+b.getDay()+" "+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds();return a};this.getMimeIcon=function(c){var b="";var a=c.name;var d="drawapp8/images/common/mimetypes/";if(c.type==="folder"){if(a===".."){b=d+"goback.png"}else{b=d+"folder.png"}}else{if(a.indexOf(".txt")>=0){b=d+"text.png"}else{b=d+"image.png"}}return b};this.createItem=function(a,d,c,b){var e={children:[]};e.userData=a;e.children.push({children:[]});e.children[0].children.push({image:d});e.children[0].children.push({children:[]});e.children[0].children[1].children.push({text:c});e.children[0].children[1].children.push({text:b});return e};this.list=function(c){var a=this;c.setValueOf("ui-label-cwd",this.cwd);console.log("list: "+this.cwd);var b=c.findChildByName("ui-list-view",true);b.children.length=1;if(this.cacheEntries[this.cwd]){b.bindData(this.cacheEntries[this.cwd]);console.log("list: found cached entries.");return}this.fs.list(this.cwd,function(f){var d={};var h=null;var l={children:[]};var j={type:"folder",name:"..",children:[]};if(a.canUp()){d.name="..";d.type="folder";h=a.getMimeIcon(d);j=a.createItem(d,h,"Up","Return To Parent");j.userData=null;l.children.push(j)}if(f){f.sort(function(m,i){if(m.name<i.name){return -1}else{if(m.name>i.name){return 1}else{return 0}}});for(var g=0;g<f.length;g++){d=f[g];if(d.type==="file"){continue}var e=a.getDateInfo(d);h=a.getMimeIcon(d);j=a.createItem(d,h,d.name,e);l.children.push(j)}for(var g=0;g<f.length;g++){d=f[g];if(d.name.indexOf(".")===0){continue}if(d.type!=="file"){continue}if(a.filter&&!a.filter(d)){continue}var e=a.getDateInfo(d);h=a.getMimeIcon(d);j=a.createItem(d,h,d.name,e);l.children.push(j)}}b.bindData(l);a.cacheEntries[a.cwd]=l});return};this.canUp=function(){if(!this.cwd||this.cwd=="/"){return false}else{return true}};this.up=function(b){var a=this.cwd.split("/");a.remove("",true);if(a.length){a.length=a.length-1}if(a.length){this.cwd="/"+a.join("/")+"/"}else{this.cwd="/"}this.list(b);return};this.enter=function(b,a){this.cwd=this.cwd+a.name+"/";this.list(b);return};this.read=function(d,b){var c=this.onContent;var a=this.cwd+b.name;if(c){this.fs.read(a,function(e,f){c(e,f);d.closeWindow(f)})}return};this.save=function(c,b){var d=this.onDone;var a=this.cwd+b.name;this.fs.save(a,this.content,function(e,f){if(d){d(e,f);c.closeWindow(e)}});this.content=null;return}}var gFileBrowser=null;function FileBrowserGet(){if(!gFileBrowser){webappPreloadImage("drawapp8/images/common/mimetypes/goback.png");webappPreloadImage("drawapp8/images/common/mimetypes/folder.png");webappPreloadImage("drawapp8/images/common/mimetypes/image.png");webappPreloadImage("drawapp8/images/common/mimetypes/text.png");gFileBrowser=new FileBrowser()}return gFileBrowser}
/*
 * Chart.js
 * http://chartjs.org/
 *
 * Copyright 2013 Nick Downie
 * Released under the MIT license
 * https://github.com/nnnick/Chart.js/blob/master/LICENSE.md
 */
window.Chart=function(d){var p=this;var a={linear:function(D){return D},easeInQuad:function(D){return D*D},easeOutQuad:function(D){return -1*D*(D-2)},easeInOutQuad:function(D){if((D/=1/2)<1){return 1/2*D*D}return -1/2*((--D)*(D-2)-1)},easeInCubic:function(D){return D*D*D},easeOutCubic:function(D){return 1*((D=D/1-1)*D*D+1)},easeInOutCubic:function(D){if((D/=1/2)<1){return 1/2*D*D*D}return 1/2*((D-=2)*D*D+2)},easeInQuart:function(D){return D*D*D*D},easeOutQuart:function(D){return -1*((D=D/1-1)*D*D*D-1)},easeInOutQuart:function(D){if((D/=1/2)<1){return 1/2*D*D*D*D}return -1/2*((D-=2)*D*D*D-2)},easeInQuint:function(D){return 1*(D/=1)*D*D*D*D},easeOutQuint:function(D){return 1*((D=D/1-1)*D*D*D*D+1)},easeInOutQuint:function(D){if((D/=1/2)<1){return 1/2*D*D*D*D*D}return 1/2*((D-=2)*D*D*D*D+2)},easeInSine:function(D){return -1*Math.cos(D/1*(Math.PI/2))+1},easeOutSine:function(D){return 1*Math.sin(D/1*(Math.PI/2))},easeInOutSine:function(D){return -1/2*(Math.cos(Math.PI*D/1)-1)},easeInExpo:function(D){return(D==0)?1:1*Math.pow(2,10*(D/1-1))},easeOutExpo:function(D){return(D==1)?1:1*(-Math.pow(2,-10*D/1)+1)},easeInOutExpo:function(D){if(D==0){return 0}if(D==1){return 1}if((D/=1/2)<1){return 1/2*Math.pow(2,10*(D-1))}return 1/2*(-Math.pow(2,-10*--D)+2)},easeInCirc:function(D){if(D>=1){return D}return -1*(Math.sqrt(1-(D/=1)*D)-1)},easeOutCirc:function(D){return 1*Math.sqrt(1-(D=D/1-1)*D)},easeInOutCirc:function(D){if((D/=1/2)<1){return -1/2*(Math.sqrt(1-D*D)-1)}return 1/2*(Math.sqrt(1-(D-=2)*D)+1)},easeInElastic:function(E){var F=1.70158;var G=0;var D=1;if(E==0){return 0}if((E/=1)==1){return 1}if(!G){G=1*0.3}if(D<Math.abs(1)){D=1;var F=G/4}else{var F=G/(2*Math.PI)*Math.asin(1/D)}return -(D*Math.pow(2,10*(E-=1))*Math.sin((E*1-F)*(2*Math.PI)/G))},easeOutElastic:function(E){var F=1.70158;var G=0;var D=1;if(E==0){return 0}if((E/=1)==1){return 1}if(!G){G=1*0.3}if(D<Math.abs(1)){D=1;var F=G/4}else{var F=G/(2*Math.PI)*Math.asin(1/D)}return D*Math.pow(2,-10*E)*Math.sin((E*1-F)*(2*Math.PI)/G)+1},easeInOutElastic:function(E){var F=1.70158;var G=0;var D=1;if(E==0){return 0}if((E/=1/2)==2){return 1}if(!G){G=1*(0.3*1.5)}if(D<Math.abs(1)){D=1;var F=G/4}else{var F=G/(2*Math.PI)*Math.asin(1/D)}if(E<1){return -0.5*(D*Math.pow(2,10*(E-=1))*Math.sin((E*1-F)*(2*Math.PI)/G))}return D*Math.pow(2,-10*(E-=1))*Math.sin((E*1-F)*(2*Math.PI)/G)*0.5+1},easeInBack:function(D){var E=1.70158;return 1*(D/=1)*D*((E+1)*D-E)},easeOutBack:function(D){var E=1.70158;return 1*((D=D/1-1)*D*((E+1)*D+E)+1)},easeInOutBack:function(D){var E=1.70158;if((D/=1/2)<1){return 1/2*(D*D*(((E*=(1.525))+1)*D-E))}return 1/2*((D-=2)*D*(((E*=(1.525))+1)*D+E)+2)},easeInBounce:function(D){return 1-a.easeOutBounce(1-D)},easeOutBounce:function(D){if((D/=1)<(1/2.75)){return 1*(7.5625*D*D)}else{if(D<(2/2.75)){return 1*(7.5625*(D-=(1.5/2.75))*D+0.75)}else{if(D<(2.5/2.75)){return 1*(7.5625*(D-=(2.25/2.75))*D+0.9375)}else{return 1*(7.5625*(D-=(2.625/2.75))*D+0.984375)}}}},easeInOutBounce:function(D){if(D<1/2){return a.easeInBounce(D*2)*0.5}return a.easeOutBounce(D*2-1)*0.5+1*0.5}};var t=d.canvas.width;var r=d.canvas.height;if(window.devicePixelRatio){d.canvas.style.width=t+"px";d.canvas.style.height=r+"px";d.canvas.height=r*window.devicePixelRatio;d.canvas.width=t*window.devicePixelRatio;d.scale(window.devicePixelRatio,window.devicePixelRatio)}this.PolarArea=function(F,E){p.PolarArea.defaults={scaleOverlay:true,scaleOverride:false,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleShowLine:true,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:true,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowLabelBackdrop:true,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,segmentShowStroke:true,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animation:true,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:true,animateScale:false,onAnimationComplete:null};var D=(E)?w(p.PolarArea.defaults,E):p.PolarArea.defaults;return new e(F,D,d)};this.Radar=function(F,E){p.Radar.defaults={scaleOverlay:false,scaleOverride:false,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleShowLine:true,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:false,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowLabelBackdrop:true,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,angleShowLineOut:true,angleLineColor:"rgba(0,0,0,.1)",angleLineWidth:1,pointLabelFontFamily:"'Arial'",pointLabelFontStyle:"normal",pointLabelFontSize:12,pointLabelFontColor:"#666",pointDot:true,pointDotRadius:3,pointDotStrokeWidth:1,datasetStroke:true,datasetStrokeWidth:2,datasetFill:true,animation:true,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null};var D=(E)?w(p.Radar.defaults,E):p.Radar.defaults;return new B(F,D,d)};this.Pie=function(F,E){p.Pie.defaults={segmentShowStroke:true,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animation:true,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:true,animateScale:false,onAnimationComplete:null};var D=(E)?w(p.Pie.defaults,E):p.Pie.defaults;return new v(F,D,d)};this.Doughnut=function(F,E){p.Doughnut.defaults={segmentShowStroke:true,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animation:true,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:true,animateScale:false,onAnimationComplete:null};var D=(E)?w(p.Doughnut.defaults,E):p.Doughnut.defaults;return new A(F,D,d)};this.Line=function(F,E){p.Line.defaults={scaleOverlay:false,scaleOverride:false,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:true,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowGridLines:true,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:true,pointDot:true,pointDotRadius:4,pointDotStrokeWidth:2,datasetStroke:true,datasetStrokeWidth:2,datasetFill:true,animation:true,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null};var D=(E)?w(p.Line.defaults,E):p.Line.defaults;return new u(F,D,d)};this.Bar=function(F,E){p.Bar.defaults={scaleOverlay:false,scaleOverride:false,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:true,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowGridLines:true,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:true,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,animation:true,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null};var D=(E)?w(p.Bar.defaults,E):p.Bar.defaults;return new c(F,D,d)};var s=function(D){D.clearRect(0,0,t,r)};var e=function(J,H,P){var O,G,F,I,Q,N,D;M();N=L();D=(H.scaleShowLabels)?H.scaleLabel:null;if(!H.scaleOverride){F=i(Q,N.maxSteps,N.minSteps,N.maxValue,N.minValue,D)}else{F={steps:H.scaleSteps,stepValue:H.scaleStepWidth,graphMin:H.scaleStartValue,labels:[]};q(D,F.labels,F.steps,H.scaleStartValue,H.scaleStepWidth)}G=O/(F.steps);g(H,E,K,P);function M(){O=(C([t,r])/2);O-=b([H.scaleFontSize*0.5,H.scaleLineWidth*0.5]);I=H.scaleFontSize*2;if(H.scaleShowLabelBackdrop){I+=(2*H.scaleBackdropPaddingY);O-=H.scaleBackdropPaddingY*1.5}Q=O;I=h(I,5)}function E(){for(var S=0;S<F.steps;S++){if(H.scaleShowLine){P.beginPath();P.arc(t/2,r/2,G*(S+1),0,(Math.PI*2),true);P.strokeStyle=H.scaleLineColor;P.lineWidth=H.scaleLineWidth;P.stroke()}if(H.scaleShowLabels){P.textAlign="center";P.font=H.scaleFontStyle+" "+H.scaleFontSize+"px "+H.scaleFontFamily;var R=F.labels[S];if(H.scaleShowLabelBackdrop){var T=P.measureText(R).width;P.fillStyle=H.scaleBackdropColor;P.beginPath();P.rect(Math.round(t/2-T/2-H.scaleBackdropPaddingX),Math.round(r/2-(G*(S+1))-H.scaleFontSize*0.5-H.scaleBackdropPaddingY),Math.round(T+(H.scaleBackdropPaddingX*2)),Math.round(H.scaleFontSize+(H.scaleBackdropPaddingY*2)));P.fill()}P.textBaseline="middle";P.fillStyle=H.scaleFontColor;P.fillText(R,t/2,r/2-(G*(S+1)))}}}function K(V){var T=-Math.PI/2,S=(Math.PI*2)/J.length,W=1,U=1;if(H.animation){if(H.animateScale){W=V}if(H.animateRotate){U=V}}for(var R=0;R<J.length;R++){P.beginPath();P.arc(t/2,r/2,W*m(J[R].value,F,G),T,T+U*S,false);P.lineTo(t/2,r/2);P.closePath();P.fillStyle=J[R].color;P.fill();if(H.segmentShowStroke){P.strokeStyle=H.segmentStrokeColor;P.lineWidth=H.segmentStrokeWidth;P.stroke()}T+=U*S}}function L(){var V=Number.MIN_VALUE;var R=Number.MAX_VALUE;for(var U=0;U<J.length;U++){if(J[U].value>V){V=J[U].value}if(J[U].value<R){R=J[U].value}}var T=Math.floor((Q/(I*0.66)));var S=Math.floor((Q/I*0.5));return{maxValue:V,minValue:R,maxSteps:T,minSteps:S}}};var B=function(K,I,P){var O,H,G,J,Q,N,D;if(!K.labels){K.labels=[]}M();var N=L();D=(I.scaleShowLabels)?I.scaleLabel:null;if(!I.scaleOverride){G=i(Q,N.maxSteps,N.minSteps,N.maxValue,N.minValue,D)}else{G={steps:I.scaleSteps,stepValue:I.scaleStepWidth,graphMin:I.scaleStartValue,labels:[]};q(D,G.labels,G.steps,I.scaleStartValue,I.scaleStepWidth)}H=O/(G.steps);g(I,E,F,P);function F(U){var V=(2*Math.PI)/K.datasets[0].data.length;P.save();P.translate(t/2,r/2);for(var T=0;T<K.datasets.length;T++){P.beginPath();P.moveTo(0,U*(-1*m(K.datasets[T].data[0],G,H)));for(var S=1;S<K.datasets[T].data.length;S++){P.rotate(V);P.lineTo(0,U*(-1*m(K.datasets[T].data[S],G,H)))}P.closePath();P.fillStyle=K.datasets[T].fillColor;P.strokeStyle=K.datasets[T].strokeColor;P.lineWidth=I.datasetStrokeWidth;P.fill();P.stroke();if(I.pointDot){P.fillStyle=K.datasets[T].pointColor;P.strokeStyle=K.datasets[T].pointStrokeColor;P.lineWidth=I.pointDotStrokeWidth;for(var R=0;R<K.datasets[T].data.length;R++){P.rotate(V);P.beginPath();P.arc(0,U*(-1*m(K.datasets[T].data[R],G,H)),I.pointDotRadius,2*Math.PI,false);P.fill();P.stroke()}}P.rotate(V)}P.restore()}function E(){var Y=(2*Math.PI)/K.datasets[0].data.length;P.save();P.translate(t/2,r/2);if(I.angleShowLineOut){P.strokeStyle=I.angleLineColor;P.lineWidth=I.angleLineWidth;for(var V=0;V<K.datasets[0].data.length;V++){P.rotate(Y);P.beginPath();P.moveTo(0,0);P.lineTo(0,-O);P.stroke()}}for(var T=0;T<G.steps;T++){P.beginPath();if(I.scaleShowLine){P.strokeStyle=I.scaleLineColor;P.lineWidth=I.scaleLineWidth;P.moveTo(0,-H*(T+1));for(var S=0;S<K.datasets[0].data.length;S++){P.rotate(Y);P.lineTo(0,-H*(T+1))}P.closePath();P.stroke()}if(I.scaleShowLabels){P.textAlign="center";P.font=I.scaleFontStyle+" "+I.scaleFontSize+"px "+I.scaleFontFamily;P.textBaseline="middle";if(I.scaleShowLabelBackdrop){var X=P.measureText(G.labels[T]).width;P.fillStyle=I.scaleBackdropColor;P.beginPath();P.rect(Math.round(-X/2-I.scaleBackdropPaddingX),Math.round((-H*(T+1))-I.scaleFontSize*0.5-I.scaleBackdropPaddingY),Math.round(X+(I.scaleBackdropPaddingX*2)),Math.round(I.scaleFontSize+(I.scaleBackdropPaddingY*2)));P.fill()}P.fillStyle=I.scaleFontColor;P.fillText(G.labels[T],0,-H*(T+1))}}for(var R=0;R<K.labels.length;R++){P.font=I.pointLabelFontStyle+" "+I.pointLabelFontSize+"px "+I.pointLabelFontFamily;P.fillStyle=I.pointLabelFontColor;var W=Math.sin(Y*R)*(O+I.pointLabelFontSize);var U=Math.cos(Y*R)*(O+I.pointLabelFontSize);if(Y*R==Math.PI||Y*R==0){P.textAlign="center"}else{if(Y*R>Math.PI){P.textAlign="right"}else{P.textAlign="left"}}P.textBaseline="middle";P.fillText(K.labels[R],W,-U)}P.restore()}function M(){O=(C([t,r])/2);J=I.scaleFontSize*2;var T=0;for(var S=0;S<K.labels.length;S++){P.font=I.pointLabelFontStyle+" "+I.pointLabelFontSize+"px "+I.pointLabelFontFamily;var R=P.measureText(K.labels[S]).width;if(R>T){T=R}}O-=b([T,((I.pointLabelFontSize/2)*1.5)]);O-=I.pointLabelFontSize;O=l(O,null,0);Q=O;J=h(J,5)}function L(){var W=Number.MIN_VALUE;var R=Number.MAX_VALUE;for(var V=0;V<K.datasets.length;V++){for(var U=0;U<K.datasets[V].data.length;U++){if(K.datasets[V].data[U]>W){W=K.datasets[V].data[U]}if(K.datasets[V].data[U]<R){R=K.datasets[V].data[U]}}}var T=Math.floor((Q/(J*0.66)));var S=Math.floor((Q/J*0.5));return{maxValue:W,minValue:R,maxSteps:T,minSteps:S}}};var v=function(J,G,E){var D=0;var F=C([r/2,t/2])-5;for(var H=0;H<J.length;H++){D+=J[H].value}g(G,null,I,E);function I(N){var P=-Math.PI/2,O=1,M=1;if(G.animation){if(G.animateScale){O=N}if(G.animateRotate){M=N}}for(var L=0;L<J.length;L++){var K=M*((J[L].value/D)*(Math.PI*2));E.beginPath();E.arc(t/2,r/2,O*F,P,P+K);E.lineTo(t/2,r/2);E.closePath();E.fillStyle=J[L].color;E.fill();if(G.segmentShowStroke){E.lineWidth=G.segmentStrokeWidth;E.strokeStyle=G.segmentStrokeColor;E.stroke()}P+=K}}};var A=function(J,G,E){var D=0;var F=C([r/2,t/2])-5;var K=F*(G.percentageInnerCutout/100);for(var H=0;H<J.length;H++){D+=J[H].value}g(G,null,I,E);function I(O){var Q=-Math.PI/2,P=1,N=1;if(G.animation){if(G.animateScale){P=O}if(G.animateRotate){N=O}}for(var M=0;M<J.length;M++){var L=N*((J[M].value/D)*(Math.PI*2));E.beginPath();E.arc(t/2,r/2,P*F,Q,Q+L,false);E.arc(t/2,r/2,P*K,Q+L,Q,true);E.closePath();E.fillStyle=J[M].color;E.fill();if(G.segmentShowStroke){E.lineWidth=G.segmentStrokeWidth;E.strokeStyle=G.segmentStrokeColor;E.stroke()}Q+=L}}};var u=function(X,W,Q){var G,J,T,D,F,V,O,M,K,N,L,U,H=0;S();V=P();O=(W.scaleShowLabels)?W.scaleLabel:"";if(!W.scaleOverride){T=i(F,V.maxSteps,V.minSteps,V.maxValue,V.minValue,O)}else{T={steps:W.scaleSteps,stepValue:W.scaleStepWidth,graphMin:W.scaleStartValue,labels:[]};q(O,T.labels,T.steps,W.scaleStartValue,W.scaleStepWidth)}J=Math.floor(F/T.steps);R();g(W,E,I,Q);function I(ac){for(var aa=0;aa<X.datasets.length;aa++){Q.strokeStyle=X.datasets[aa].strokeColor;Q.lineWidth=W.datasetStrokeWidth;Q.beginPath();Q.moveTo(L,U-ac*(m(X.datasets[aa].data[0],T,J)));for(var Z=1;Z<X.datasets[aa].data.length;Z++){if(W.bezierCurve){Q.bezierCurveTo(ad(Z-0.5),ab(aa,Z-1),ad(Z-0.5),ab(aa,Z),ad(Z),ab(aa,Z))}else{Q.lineTo(ad(Z),ab(aa,Z))}}Q.stroke();if(W.datasetFill){Q.lineTo(L+(M*(X.datasets[aa].data.length-1)),U);Q.lineTo(L,U);Q.closePath();Q.fillStyle=X.datasets[aa].fillColor;Q.fill()}else{Q.closePath()}if(W.pointDot){Q.fillStyle=X.datasets[aa].pointColor;Q.strokeStyle=X.datasets[aa].pointStrokeColor;Q.lineWidth=W.pointDotStrokeWidth;for(var Y=0;Y<X.datasets[aa].data.length;Y++){Q.beginPath();Q.arc(L+(M*Y),U-ac*(m(X.datasets[aa].data[Y],T,J)),W.pointDotRadius,0,Math.PI*2,true);Q.fill();Q.stroke()}}}function ab(ae,af){return U-ac*(m(X.datasets[ae].data[af],T,J))}function ad(ae){return L+(M*ae)}}function E(){Q.lineWidth=W.scaleLineWidth;Q.strokeStyle=W.scaleLineColor;Q.beginPath();Q.moveTo(t-K/2+5,U);Q.lineTo(t-(K/2)-N-5,U);Q.stroke();if(H>0){Q.save();Q.textAlign="right"}else{Q.textAlign="center"}Q.fillStyle=W.scaleFontColor;for(var Z=0;Z<X.labels.length;Z++){Q.save();if(H>0){Q.translate(L+Z*M,U+W.scaleFontSize);Q.rotate(-(H*(Math.PI/180)));Q.fillText(X.labels[Z],0,0);Q.restore()}else{Q.fillText(X.labels[Z],L+Z*M,U+W.scaleFontSize+3)}Q.beginPath();Q.moveTo(L+Z*M,U+3);if(W.scaleShowGridLines&&Z>0){Q.lineWidth=W.scaleGridLineWidth;Q.strokeStyle=W.scaleGridLineColor;Q.lineTo(L+Z*M,5)}else{Q.lineTo(L+Z*M,U+3)}Q.stroke()}Q.lineWidth=W.scaleLineWidth;Q.strokeStyle=W.scaleLineColor;Q.beginPath();Q.moveTo(L,U+5);Q.lineTo(L,5);Q.stroke();Q.textAlign="right";Q.textBaseline="middle";for(var Y=0;Y<T.steps;Y++){Q.beginPath();Q.moveTo(L-3,U-((Y+1)*J));if(W.scaleShowGridLines){Q.lineWidth=W.scaleGridLineWidth;Q.strokeStyle=W.scaleGridLineColor;Q.lineTo(L+N+5,U-((Y+1)*J))}else{Q.lineTo(L-0.5,U-((Y+1)*J))}Q.stroke();if(W.scaleShowLabels){Q.fillText(T.labels[Y],L-8,U-((Y+1)*J))}}}function R(){var Y=1;if(W.scaleShowLabels){Q.font=W.scaleFontStyle+" "+W.scaleFontSize+"px "+W.scaleFontFamily;for(var Z=0;Z<T.labels.length;Z++){var aa=Q.measureText(T.labels[Z]).width;Y=(aa>Y)?aa:Y}Y+=10}N=t-Y-K;M=Math.floor(N/(X.labels.length-1));L=t-K/2-N;U=F+W.scaleFontSize/2}function S(){G=r;Q.font=W.scaleFontStyle+" "+W.scaleFontSize+"px "+W.scaleFontFamily;K=1;for(var Z=0;Z<X.labels.length;Z++){var Y=Q.measureText(X.labels[Z]).width;K=(Y>K)?Y:K}if(t/X.labels.length<K){H=45;if(t/X.labels.length<Math.cos(H)*K){H=90;G-=K}else{G-=Math.sin(H)*K}}else{G-=W.scaleFontSize}G-=5;D=W.scaleFontSize;G-=D;F=G}function P(){var ad=Number.MIN_VALUE;var Y=Number.MAX_VALUE;for(var ac=0;ac<X.datasets.length;ac++){for(var ab=0;ab<X.datasets[ac].data.length;ab++){if(X.datasets[ac].data[ab]>ad){ad=X.datasets[ac].data[ab]}if(X.datasets[ac].data[ab]<Y){Y=X.datasets[ac].data[ab]}}}var aa=Math.floor((F/(D*0.66)));var Z=Math.floor((F/D*0.5));return{maxValue:ad,minValue:Y,maxSteps:aa,minSteps:Z}}};var c=function(Y,X,R){var G,I,U,D,F,W,N,L,J,M,K,V,P,H=0;T();W=O();N=(X.scaleShowLabels)?X.scaleLabel:"";if(!X.scaleOverride){U=i(F,W.maxSteps,W.minSteps,W.maxValue,W.minValue,N)}else{U={steps:X.scaleSteps,stepValue:X.scaleStepWidth,graphMin:X.scaleStartValue,labels:[]};q(N,U.labels,U.steps,X.scaleStartValue,X.scaleStepWidth)}I=Math.floor(F/U.steps);S();g(X,E,Q,R);function Q(ac){R.lineWidth=X.barStrokeWidth;for(var aa=0;aa<Y.datasets.length;aa++){R.fillStyle=Y.datasets[aa].fillColor;R.strokeStyle=Y.datasets[aa].strokeColor;for(var Z=0;Z<Y.datasets[aa].data.length;Z++){var ab=K+X.barValueSpacing+L*Z+P*aa+X.barDatasetSpacing*aa+X.barStrokeWidth*aa;R.beginPath();R.moveTo(ab,V);R.lineTo(ab,V-ac*m(Y.datasets[aa].data[Z],U,I)+(X.barStrokeWidth/2));R.lineTo(ab+P,V-ac*m(Y.datasets[aa].data[Z],U,I)+(X.barStrokeWidth/2));R.lineTo(ab+P,V);if(X.barShowStroke){R.stroke()}R.closePath();R.fill()}}}function E(){R.lineWidth=X.scaleLineWidth;R.strokeStyle=X.scaleLineColor;R.beginPath();R.moveTo(t-J/2+5,V);R.lineTo(t-(J/2)-M-5,V);R.stroke();if(H>0){R.save();R.textAlign="right"}else{R.textAlign="center"}R.fillStyle=X.scaleFontColor;for(var aa=0;aa<Y.labels.length;aa++){R.save();if(H>0){R.translate(K+aa*L,V+X.scaleFontSize);R.rotate(-(H*(Math.PI/180)));R.fillText(Y.labels[aa],0,0);R.restore()}else{R.fillText(Y.labels[aa],K+aa*L+L/2,V+X.scaleFontSize+3)}R.beginPath();R.moveTo(K+(aa+1)*L,V+3);R.lineWidth=X.scaleGridLineWidth;R.strokeStyle=X.scaleGridLineColor;R.lineTo(K+(aa+1)*L,5);R.stroke()}R.lineWidth=X.scaleLineWidth;R.strokeStyle=X.scaleLineColor;R.beginPath();R.moveTo(K,V+5);R.lineTo(K,5);R.stroke();R.textAlign="right";R.textBaseline="middle";for(var Z=0;Z<U.steps;Z++){R.beginPath();R.moveTo(K-3,V-((Z+1)*I));if(X.scaleShowGridLines){R.lineWidth=X.scaleGridLineWidth;R.strokeStyle=X.scaleGridLineColor;R.lineTo(K+M+5,V-((Z+1)*I))}else{R.lineTo(K-0.5,V-((Z+1)*I))}R.stroke();if(X.scaleShowLabels){R.fillText(U.labels[Z],K-8,V-((Z+1)*I))}}}function S(){var Z=1;if(X.scaleShowLabels){R.font=X.scaleFontStyle+" "+X.scaleFontSize+"px "+X.scaleFontFamily;for(var aa=0;aa<U.labels.length;aa++){var ab=R.measureText(U.labels[aa]).width;Z=(ab>Z)?ab:Z}Z+=10}M=t-Z-J;L=Math.floor(M/(Y.labels.length));P=(L-X.scaleGridLineWidth*2-(X.barValueSpacing*2)-(X.barDatasetSpacing*Y.datasets.length-1)-((X.barStrokeWidth/2)*Y.datasets.length-1))/Y.datasets.length;K=t-J/2-M;V=F+X.scaleFontSize/2}function T(){G=r;R.font=X.scaleFontStyle+" "+X.scaleFontSize+"px "+X.scaleFontFamily;J=1;for(var aa=0;aa<Y.labels.length;aa++){var Z=R.measureText(Y.labels[aa]).width;J=(Z>J)?Z:J}if(t/Y.labels.length<J){H=45;if(t/Y.labels.length<Math.cos(H)*J){H=90;G-=J}else{G-=Math.sin(H)*J}}else{G-=X.scaleFontSize}G-=5;D=X.scaleFontSize;G-=D;F=G}function O(){var ae=Number.MIN_VALUE;var Z=Number.MAX_VALUE;for(var ad=0;ad<Y.datasets.length;ad++){for(var ac=0;ac<Y.datasets[ad].data.length;ac++){if(Y.datasets[ad].data[ac]>ae){ae=Y.datasets[ad].data[ac]}if(Y.datasets[ad].data[ac]<Z){Z=Y.datasets[ad].data[ac]}}}var ab=Math.floor((F/(D*0.66)));var aa=Math.floor((F/D*0.5));return{maxValue:ae,minValue:Z,maxSteps:ab,minSteps:aa}}};function m(G,E,I){var H=E.steps*E.stepValue;var F=G-E.graphMin;var D=l(F/H,1,0);return(I*E.steps)*D}function g(G,E,D,L){var F=(G.animation)?1/l(G.animationSteps,Number.MAX_VALUE,1):1,K=a[G.animationEasing],H=(G.animation)?0:1;if(typeof E!=="function"){E=function(){}}function J(){var M=(G.animation)?l(K(H),null,0):1;s(L);if(G.scaleOverlay){D(M);E()}else{E();D(M)}}function I(){H+=F;J();if(H<=1){f(I)}else{if(typeof G.onAnimationComplete=="function"){G.onAnimationComplete()}}}G.animation=0;if(G.animation){f(I)}else{J()}}var f=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(D){window.setTimeout(D,1000/60)}})();function i(G,J,P,L,R,D){var Q,E,F,N,S,M,O,I;M=L-R;O=H(M);Q=Math.floor(R/(1*Math.pow(10,O)))*Math.pow(10,O);E=Math.ceil(L/(1*Math.pow(10,O)))*Math.pow(10,O);F=E-Q;N=Math.pow(10,O);S=Math.round(F/N);while(S<P||S>J){if(S<P){N/=2;S=Math.round(F/N)}else{N*=2;S=Math.round(F/N)}}var K=[];q(D,K,S,Q,N);return{steps:S,stepValue:N,graphMin:Q,labels:K};function H(T){return Math.floor(Math.log(T)/Math.LN10)}}function q(F,I,E,H,D){if(F){for(var G=1;G<E+1;G++){I.push(j(F,{value:(H+(D*G)).toFixed(z(D))}))}}}function b(D){return Math.max.apply(Math,D)}function C(D){return Math.min.apply(Math,D)}function h(E,D){if(!E){return D}else{return E}}function o(D){return !isNaN(parseFloat(D))&&isFinite(D)}function l(D,F,E){if(o(F)){if(D>F){return F}}if(o(E)){if(D<E){return E}}return D}function z(D){var E;if(D%1!=0){return D.toString().split(".")[1].length}else{return 0}}function w(G,E){var D={};for(var F in G){D[F]=G[F]}for(var F in E){D[F]=E[F]}return D}var n={};function j(F,E){var D=!/\W/.test(F)?n[F]=n[F]||j(document.getElementById(F).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+F.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return E?D(E):D}};function UIChartLegendItem(){return}UIChartLegendItem.prototype=new UIElement();UIChartLegendItem.prototype.isUIChartLegendItem=true;UIChartLegendItem.prototype.initUIChartLegendItem=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_INPUT);return this};UIChartLegendItem.prototype.shapeCanBeChild=function(a){return false};UIChartLegendItem.prototype.drawText=function(a){};UIChartLegendItem.prototype.paintSelfOnly=function(b){if(this.h>this.w){var c=Math.min(this.w,this.h);b.fillRect(0,0,c,c)}else{var c=this.h-8;b.fillStyle=this.style.fillColor;b.fillRect(4,4,c,c);b.textAlign="left";b.textBaseline="middle";b.font=this.style.getFont();b.fillStyle=this.style.textColor;var a=c+8;var d=c/2-0.2*this.style.fontSize;b.fillText(this.text,a,d)}return};function UIChartLegendItemCreator(){var a=["ui-chart-legend-item","ui-chart-legend-item",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIChartLegendItem();return b.initUIChartLegendItem(this.type,200,40)};return}function UIChartLegendCreator(){var a=["ui-chart-legend","ui-chart-legend",null,1];ShapeCreator.apply(this,a);this.createShape=function(c){var b=new UIGrid();b.isUIChartLegend=true;b.initUIGrid(this.type,5,100,null);b.shapeCanBeChild=function(d){return d.isUIChartLegendItem};return b};return}function UIChart(){return}UIChart.prototype=new UIElement();UIChart.prototype.isUIChart=true;UIChart.prototype.initUIChart=function(c,a,b){this.initUIElement(c);this.setDefSize(a,b);this.setTextType(C_SHAPE_TEXT_NONE);this.setImage(C_SHAPE_IMAGE_ALL,null);this.images.display=C_IMAGE_DISPLAY_CENTER;this.options={};return this};UIChart.prototype.setValue=function(a){try{this.data=JSON.parse(a)}catch(b){console.log("UIChart.prototype.setValue:"+b.message)}return};UIChart.prototype.getValue=function(){var a=this.data?this.data:this.getDefaultData();return a?JSON.stringify(a,null,"\t"):""};UIChart.prototype.getDefaultData=function(){var a={labels:["1","2","3"],datasets:[{fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:[28,48,40]}]};return a};UIChart.prototype.shapeCanBeChild=function(a){return a.isUILabel||a.isUIImage};UIChart.prototype.getOptions=function(){return null};UIChart.prototype.paintChart=function(a,c,b){return};UIChart.prototype.getData=function(){return this.data?this.data:this.getDefaultData()};UIChart.prototype.paintSelfOnly=function(c){var b=motkGetTempCanvas(this.w,this.h);var a=b.getContext("2d");this.paintChart(a,this.getData(),this.getOptions());c.drawImage(b,0,0);return};function UIBarChart(){return}UIBarChart.prototype=new UIChart();UIBarChart.prototype.isUIBarChart=true;UIBarChart.prototype.initUIBarChart=function(a){return this.initUIChart(a,200,200)};UIBarChart.prototype.getCustomProp=function(){var a='		<label class="description" for="fontsize">'+dappGetText("Font Size")+':</label>		<input id="fontsize"  class="element text small" type="number" value="0"/> 		<label class="description" for="textcolor">'+dappGetText("Text Color")+':</label>		<input id="textcolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="scalelinecolor">'+dappGetText("Scale Line Color")+':</label>		<input id="scalelinecolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="gridlinecolor">'+dappGetText("Grid Line Color")+':</label>		<input id="gridlinecolor"  class="element text small" type="text" value="0"/> 		<input id="showgridlines" class="checkbox_i"  type="checkbox" >'+dappGetText("Show Grid Lines")+'</input> 		<label class="description" for="data">'+dappGetText("Data")+':</label>		<textarea id="data"  rows="8" cols="60" type="text" value=""></textarea>';return a};UIBarChart.prototype.loadCustomProp=function(b){var a=this;b.fontsize.value=this.style.fontSize;b.fontsize.onchange=function(d){var c=parseInt(this.value);a.style.setFontSize(c);return};b.textcolor.value=this.style.textColor;b.textcolor.onchange=function(c){a.style.setTextColor(this.value);return};b.scalelinecolor.value=this.style.lineColor;b.scalelinecolor.onchange=function(c){a.style.setLineColor(this.value);return};b.gridlinecolor.value=this.style.fillColor;b.gridlinecolor.onchange=function(c){a.setFillColor(this.value);return};b.showgridlines.checked=this.showGridLines;b.showgridlines.onchange=function(c){a.showGridLines=this.checked;return};b.data.value=this.getValue();b.data.onchange=function(c){a.setValue(this.value);return};return};UIBarChart.prototype.getOptions=function(){this.options.scaleLineColor=this.style.lineColor;this.options.scaleFontSize=this.isIcon?12:this.style.fontSize;this.options.scaleFontColor=this.style.textColor;this.options.scaleGridLineColor=this.style.fillColor;this.options.scaleShowGridLines=this.isIcon?true:this.showGridLines;return this.options};UIBarChart.prototype.paintChart=function(a,d,b){var c=null;if(this.type==="ui-bar-chart"){c=new Chart(a).Bar(d,b)}else{c=new Chart(a).Line(d,b)}delete c;return};function UIBarChartCreator(b){var a=[b,"ui-bar-chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UIBarChart();return c.initUIBarChart(this.type)};return}function UIRadarChart(){return}UIRadarChart.prototype=new UIChart();UIRadarChart.prototype.isUIRadarChart=true;UIRadarChart.prototype.initUIRadarChart=function(a){return this.initUIChart(a,200,200)};UIRadarChart.prototype.getCustomProp=function(){var a='		<label class="description" for="fontsize">'+dappGetText("Font Size")+':</label>		<input id="fontsize"  class="element text small" type="number" value="0"/> 		<label class="description" for="textcolor">'+dappGetText("Text Color")+':</label>		<input id="textcolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="scalelinecolor">'+dappGetText("Scale Line Color")+':</label>		<input id="scalelinecolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="backdropcolor">'+dappGetText("Backdrop Color")+':</label>		<input id="backdropcolor"  class="element text small" type="text" value="0"/> 		<input id="showscalelabels" class="checkbox_i"  type="checkbox" >'+dappGetText("Show Scale Labels")+'</input> 		<label class="description" for="data">'+dappGetText("Data")+':</label>		<textarea id="data"  rows="8" cols="60" type="text" value=""></textarea>';return a};UIRadarChart.prototype.loadCustomProp=function(b){var a=this;b.fontsize.value=this.style.fontSize;b.fontsize.onchange=function(d){var c=parseInt(this.value);a.style.setFontSize(c);return};b.textcolor.value=this.style.textColor;b.textcolor.onchange=function(c){a.style.setTextColor(this.value);return};b.scalelinecolor.value=this.style.lineColor;b.scalelinecolor.onchange=function(c){a.style.setLineColor(this.value);return};b.backdropcolor.value=this.style.fillColor;b.backdropcolor.onchange=function(c){a.setFillColor(this.value);return};b.showscalelabels.checked=this.showScaleLabels;b.showscalelabels.onchange=function(c){a.showScaleLabels=this.checked;return};b.data.value=this.getValue();b.data.onchange=function(c){a.setValue(this.value);return};return};UIRadarChart.prototype.getOptions=function(){this.options.scaleLineColor=this.style.lineColor;this.options.scaleShowLabels=this.showScaleLabels;this.options.scaleFontSize=this.style.fontSize;this.options.pointLabelFontSize=this.options.scaleFontSize;this.options.scaleFontColor=this.style.textColor;this.options.scaleBackdropColor=this.style.fillColor;this.options.angleLineColor=this.options.scaleLineColor;if(this.isIcon){this.options.scaleShowLabels=false;this.options.scaleFontSize=8;this.options.pointLabelFontSize=6}return this.options};UIRadarChart.prototype.paintChart=function(a,d,b){var c=new Chart(a).Radar(d,b);delete c;return};UIRadarChart.prototype.getDefaultData=function(){var a={labels:["1","2","3","4","5","6","7"],datasets:[{fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",data:[65,59,90,81,56,55,40]},{fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:[28,48,40,19,96,27,100]}]};return a};function UIRadarChartCreator(b){var a=[b,"ui-radar-chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UIRadarChart();return c.initUIRadarChart(this.type)};return}function UIPolarAreaChart(){return}UIPolarAreaChart.prototype=new UIChart();UIPolarAreaChart.prototype.isUIPolarAreaChart=true;UIPolarAreaChart.prototype.initUIPolarAreaChart=function(a){return this.initUIChart(a,200,200)};UIPolarAreaChart.prototype.getCustomProp=function(){var a='		<label class="description" for="fontsize">'+dappGetText("Font Size")+':</label>		<input id="fontsize"  class="element text small" type="number" value="0"/> 		<label class="description" for="textcolor">'+dappGetText("Text Color")+':</label>		<input id="textcolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="scalelinecolor">'+dappGetText("Scale Line Color")+':</label>		<input id="scalelinecolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="backdropcolor">'+dappGetText("Backdrop Color")+':</label>		<input id="backdropcolor"  class="element text small" type="text" value="0"/> 		<input id="showscalelabels" class="checkbox_i"  type="checkbox" >'+dappGetText("Show Scale Labels")+'</input> 		<label class="description" for="data">'+dappGetText("Data")+':</label>		<textarea id="data"  rows="8" cols="60" type="text" value=""></textarea>';return a};UIPolarAreaChart.prototype.loadCustomProp=function(b){var a=this;b.fontsize.value=this.style.fontSize;b.fontsize.onchange=function(d){var c=parseInt(this.value);a.style.setFontSize(c);return};b.textcolor.value=this.style.textColor;b.textcolor.onchange=function(c){a.style.setTextColor(this.value);return};b.scalelinecolor.value=this.style.lineColor;b.scalelinecolor.onchange=function(c){a.style.setLineColor(this.value);return};b.backdropcolor.value=this.style.fillColor;b.backdropcolor.onchange=function(c){a.setFillColor(this.value);return};b.showscalelabels.checked=this.showScaleLabels;b.showscalelabels.onchange=function(c){a.showScaleLabels=this.checked;return};b.data.value=this.getValue();b.data.onchange=function(c){a.setValue(this.value);return};return};UIPolarAreaChart.prototype.getOptions=function(){this.options.scaleLineColor=this.style.lineColor;this.options.scaleShowLabels=this.showScaleLabels;this.options.scaleFontSize=this.style.fontSize;this.options.pointLabelFontSize=this.options.scaleFontSize;this.options.scaleFontColor=this.style.textColor;this.options.scaleBackdropColor=this.style.fillColor;this.options.angleLineColor=this.options.scaleLineColor;if(this.isIcon){this.options.scaleShowLabels=false;this.options.scaleFontSize=8;this.options.pointLabelFontSize=6}return this.options};UIPolarAreaChart.prototype.paintChart=function(a,d,b){var c=new Chart(a).PolarArea(d,b);delete c;return};UIPolarAreaChart.prototype.getDefaultData=function(){var a=[{value:30,color:"#D97041"},{value:90,color:"#C7604C"},{value:24,color:"#21323D"},{value:58,color:"#9D9B7F"},{value:82,color:"#7D4F6D"},{value:8,color:"#584A5E"}];return a};function UIPolarAreaChartCreator(b){var a=[b,"ui-polar-area-chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UIPolarAreaChart();return c.initUIPolarAreaChart(this.type)};return}function UIPieChart(){return}UIPieChart.prototype=new UIChart();UIPieChart.prototype.isUIPieChart=true;UIPieChart.prototype.initUIPieChart=function(a){return this.initUIChart(a,200,200)};UIPieChart.prototype.getCustomProp=function(){var a='		<label class="description" for="fontsize">'+dappGetText("Font Size")+':</label>		<input id="fontsize"  class="element text small" type="number" value="0"/> 		<label class="description" for="textcolor">'+dappGetText("Text Color")+':</label>		<input id="textcolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="scalelinecolor">'+dappGetText("Scale Line Color")+':</label>		<input id="scalelinecolor"  class="element text small" type="text" value="0"/> 		<label class="description" for="backdropcolor">'+dappGetText("Backdrop Color")+':</label>		<input id="backdropcolor"  class="element text small" type="text" value="0"/> 		<input id="showscalelabels" class="checkbox_i"  type="checkbox" >'+dappGetText("Show Scale Labels")+'</input> 		<label class="description" for="data">'+dappGetText("Data")+':</label>		<textarea id="data"  rows="8" cols="60" type="text" value=""></textarea>';return a};UIPieChart.prototype.loadCustomProp=function(b){var a=this;b.fontsize.value=this.style.fontSize;b.fontsize.onchange=function(d){var c=parseInt(this.value);a.style.setFontSize(c);return};b.textcolor.value=this.style.textColor;b.textcolor.onchange=function(c){a.style.setTextColor(this.value);return};b.scalelinecolor.value=this.style.lineColor;b.scalelinecolor.onchange=function(c){a.style.setLineColor(this.value);return};b.backdropcolor.value=this.style.fillColor;b.backdropcolor.onchange=function(c){a.setFillColor(this.value);return};b.showscalelabels.checked=this.showScaleLabels;b.showscalelabels.onchange=function(c){a.showScaleLabels=this.checked;return};b.data.value=this.getValue();b.data.onchange=function(c){a.setValue(this.value);return};return};UIPieChart.prototype.getOptions=function(){this.options.scaleLineColor=this.style.lineColor;this.options.scaleShowLabels=this.showScaleLabels;this.options.scaleFontSize=this.style.fontSize;this.options.pointLabelFontSize=this.options.scaleFontSize;this.options.scaleFontColor=this.style.textColor;this.options.scaleBackdropColor=this.style.fillColor;this.options.angleLineColor=this.options.scaleLineColor;if(this.isIcon){this.options.scaleShowLabels=false;this.options.scaleFontSize=8;this.options.pointLabelFontSize=6}return this.options};UIPieChart.prototype.paintChart=function(a,d,b){var c=null;if(this.type==="ui-doughnut-chart"){c=new Chart(a).Pie(d,b)}else{c=new Chart(a).Doughnut(d,b)}delete c;return};UIPieChart.prototype.getDefaultData=function(){var a=[{value:30,color:"#F38630"},{value:50,color:"#E0E4CC"},{value:100,color:"#69D2E7"}];return a};function UIPieChartCreator(b){var a=[b,"ui-pie-chart",null,1];ShapeCreator.apply(this,a);this.createShape=function(d){var c=new UIPieChart();return c.initUIPieChart(this.type)};return}var shapeFactory=ShapeFactoryGet();shapeFactory.addShapeCreator(new UIBarChartCreator("ui-bar-chart"),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIBarChartCreator("ui-line-chart"),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIRadarChartCreator("ui-radar-chart"),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIPolarAreaChartCreator("ui-polar-area-chart"),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIPieChartCreator("ui-pie-chart"),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIPieChartCreator("ui-doughnut-chart"),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIChartLegendItemCreator(),C_UI_ELEMENTS);shapeFactory.addShapeCreator(new UIChartLegendCreator(),C_UI_ELEMENTS);function webappInit(a){dappRegisterUIElements();webappLoadUserScripts();if(a===C_APP_TYPE_PREVIEW){document.body.style.overflow="scroll"}else{document.body.style.overflow="hidden"}return}function WebApp(b){var a=["idraw_canvas",b];AppBase.apply(this,a);webappInit(b);this.onSizeChanged=function(){var e=getViewPort();if(e.width===this.viewPort.width&&e.height===this.viewPort.height){console.log("onSizeChanged: size is not changed.");return}this.adjustCanvasSize();var c=this.canvas.width;var d=this.canvas.height;console.log("onSizeChanged: w="+c+" h="+d);this.manager.resize(c,d);this.win.resize(c,d);this.view.resize(c,d);this.view.resizeWindowManager(c,d);this.viewPort=e};this.viewPort=getViewPort();return this}WebApp.prototype.runWithURL=function(c){var a={};var b=this;a.url=c;a.headers={};a.method="GET";a.noCache=true;a.onDone=function(e,g,f){var d=g.responseText;b.runWithData(d);return};httpDoRequest(a);console.log("dataURL:"+c);return};WebApp.prototype.createWindow=function(){var a=0;var e=0;var c=this.canvas.width;var d=this.canvas.height;this.win=new Window(this.manager,0,0,c,d);this.win.theme[0].bg="White";this.view=new AppView(this.win,a,e,c,d);this.view.forPreview=this.type===C_APP_TYPE_PREVIEW;var b=this.view;this.win.onGesture=function(f){return b.onGesture(f)};return};WebApp.prototype.showWindow=function(){this.view.showIt();this.win.showAll(1);this.manager.postRedraw();return};WebApp.prototype.runWithData=function(a){this.createWindow();this.view.loadFromJson(a);this.showWindow();return};WebApp.prototype.runWithDeviceData=function(a){this.createWindow();this.view.fixDeviceConfig(a);this.view.device=a;this.view.createWindowManager=function(){var c=null;var b=this.getWindowManager();c=b;this.beforeLoad(a);b=ShapeFactoryGet().createShape(c.type,C_CREATE_FOR_PROGRAM);b.fromJson(c);this.afterLoad(a);return b};this.showWindow();return};function webappRunWithData(a){var b=new WebApp(C_APP_TYPE_WEBAPP);b.runWithData(a);return b}function webappRunWithDeviceData(a){var b=new WebApp(C_APP_TYPE_WEBAPP);b.runWithDeviceData(a);return b}function webappPreviewWithData(a){var b=new WebApp(C_APP_TYPE_PREVIEW);b.runWithData(a);return b}function webappRunWithURL(b){var a=new WebApp(C_APP_TYPE_WEBAPP);a.runWithURL(b);return a}function webappPreviewWithURL(b){var a=new WebApp(C_APP_TYPE_PREVIEW);a.runWithURL(b);return a}function shapeFixImagePath(g,c,d){var h=c.version;var f=c.platform;var n=c.lcdDensity;var j=d.version;var b=d.platform;var o=d.lcdDensity;for(var m in g.images){var l=g.images[m];if(m==="display"){continue}var a=l;if(a){a=a.replaceAll("/"+h+"/","/"+j+"/");a=a.replaceAll("/"+f+"/","/"+b+"/");a=a.replaceAll("/"+n+"/","/"+o+"/");g.images[m]=a}}if(g.children){for(var e=0;e<g.children.length;e++){shapeFixImagePath(g.children[e],c,d)}}return}function AppView(d,a,e,b,c){ViewBase.apply(this,arguments);this.forPreview=false;this.init=function(){this.platform="windowphone";if(browser.versions.android){this.platform="android"}else{if(browser.versions.iPhone){this.platform="iphone"}}return};this.showPageIndicator=function(f){return};this.showLogo=function(f){return};this.drawGrid=function(f){return};this.onGesture=function(g){if(this.windowManager){var f=this.windowManager.getCurrentFrame();if(f){f.onGesture(g)}}return};this.setTarget=function(f){for(var h=this.allShapes.length-1;h>=0;h--){var j=this.allShapes[h];if(f!==j){j.setSelected(false)}}this.targetShape=f;return};this.onDoubleClick=function(h){var f={x:(h.x-this.rect.x),y:(h.y-this.rect.y)};var g=this.getSelectedShape();if(g){g.onDoubleClick(f)}return};this.onPointerDown=function(j){var f=this.translatePoint(j);this.pointerDownPosition.x=f.x;this.pointerDownPosition.y=f.y;this.lastPointerPosition.x=f.x;this.lastPointerPosition.y=f.y;this.updateLastPointerPoint(f);for(var h=this.allShapes.length-1;h>=0;h--){var g=this.allShapes[h];if(g.onPointerDown(f)){this.setTarget(g);break}}this.postRedraw();return};this.onPointerMove=function(g){var f=this.translatePoint(g);this.updateLastPointerPoint(f);if(this.targetShape){this.targetShape.onPointerMove(f);if(this.targetShape.pointerDown){this.postRedraw()}return}return};this.onPointerUp=function(g){var f=this.translatePoint(g);this.updateLastPointerPoint(f);if(this.targetShape){this.targetShape.onPointerUp(f);this.postRedraw()}return};this.onKeyDown=function(f){if(this.targetShape){this.targetShape.onKeyDown(f);this.postRedraw()}return};this.onKeyUp=function(f){if(this.targetShape){this.targetShape.onKeyUp(f);this.postRedraw()}return};this.extractDevices=function(m){this.devices=new Array();for(var f=0;f<m.pages.length;f++){var l=m.pages[f];for(var h=0;h<l.shapes.length;h++){var g=l.shapes[h];if(g.type==="ui-device"){if(!this.forPreview){g.images={display:0};this.fixDeviceConfig(g)}var j=ShapeFactoryGet().createShape(g.type,C_CREATE_FOR_PROGRAM);if(j){j.fromJson(g)}this.devices.push(j)}}}return this.devices.length};this.getDevice=function(){if(!this.device){for(var g=0;g<this.devices.length;g++){var h=this.devices[g];var f=h.config;if(!h.config){continue}if(f.platform!=this.platform){continue}this.device=h}if(!this.device){this.device=this.devices[0]}}return this.device};this.getScreen=function(){if(!this.screen){var g=this.getDevice();for(var f=0;f<g.children.length;f++){var h=g.children[f];if(h.isUIScreen){this.screen=h}}}return this.screen};this.getWindowManager=function(h){if(!this.windowManager){var f=this.getScreen();for(var g=0;g<f.children.length;g++){var j=f.children[g];if(j.isUIWindowManager){this.windowManager=j;if(h){f.children.remove(j);j.parentShape=null}break}}}return this.windowManager};this.detectDeviceConfig=function(){if(this.detectedDeviceConfig){return this.detectedDeviceConfig}var f={version:4};if(browser.versions.android){f.platform="android"}else{if(browser.versions.iPhone||browser.versions.iPad){f.platform="iphone"}else{if(isFirefoxMobile()){f.platform="firefox"}else{f.platform="android"}}}if(window.devicePixelRatio>1.5){f.lcdDensity="xhdpi"}else{if(window.devicePixelRatio>1.1){f.lcdDensity="hdpi"}else{if(window.devicePixelRatio>0.8){f.lcdDensity="mdpi"}else{f.lcdDensity="ldpi"}}}if(isFirefoxMobile()){f.lcdDensity="mdpi"}f.screenW=this.rect.w;f.screenH=this.rect.h;this.detectedDeviceConfig=f;console.log("deviceConfig.lcdDensity:"+f.lcdDensity);console.log("deviceConfig.screenW:"+f.screenW);console.log("deviceConfig.screenH:"+f.screenH);return f};this.showIt=function(){if(this.forPreview){this.showDevice()}else{this.showWindowManager()}var f=this;setTimeout(function(){f.postRedraw()},3000);return};this.showDevice=function(){var o=0;var n=0;var p=this.rect.w;var m=this.rect.h;var g=this.getDevice();var f=g.toJson();var s=null;for(var l=0;l<f.children.length;l++){var j=f.children[l];if(j.type==="ui-screen"){s=j}}f.children.clear();f.children.push(s);g=ShapeFactoryGet().createShape(f.type,C_CREATE_FOR_PROGRAM);g.fromJson(f);var r=getViewPort();if(g.h<r.height&&g.w<r.width){n=(r.height-g.h)/2;document.body.style.overflow="hidden"}o=(p-g.w)/2;g.move(o,n);g.setMode(C_MODE_RUNNING,true);this.addShape(g);this.device=g;var q=this.getWindowManager();q.systemInit();q.showInitWindow();this.postRedraw()};this.getDeviceConfig=function(){var f=this.getDevice();return f?f.config:null};this.resizeWindowManager=function(f,g){if(this.windowManager){this.windowManager.setSizeLimit(f,g,f,g);this.windowManager.resize(f,g);console.log("this.windowManager.w="+this.windowManager.w);console.log("this.windowManager.h="+this.windowManager.h)}return};this.createWindowManager=function(){return this.getWindowManager(true)};this.fixDeviceConfig=function(h){var f=h.config;var g=this.detectDeviceConfig();if(!isMobile()){g.lcdDensity=f.lcdDensity}if(g.platform!==f.platform&&g.version!==f.version&&g.lcdDensity!==f.lcdDensity){shapeFixImagePath(h,f,g)}return};this.showWindowManager=function(){var j=null;var f=this.rect.w;var i=this.rect.h;var g=this.detectDeviceConfig();j=this.createWindowManager();j.deviceConfig=this.getDeviceConfig();if(!isMobile()){g.lcdDensity=j.deviceConfig.lcdDensity}j.setDeviceConfig(g);j.setSizeLimit(f,i,f,i);j.setSize(f,i);j.move(0,0);j.setMode(C_MODE_RUNNING,true);this.addShape(j);j.systemInit();j.showInitWindow();this.postRedraw();this.windowManager=j;console.log("w:"+f+" h:"+i);return};this.loadJson=function(f){this.beforeLoad(f);if(!f||!f.pages||!this.extractDevices(f)){console.log("It is not a valid webapp.");return}this.afterLoad(f);return};this.init();return this}function dappGetText(a){return a};console.log("motk.js build at 2013年 08月 25日 星期日 09:15:09 CST ");
